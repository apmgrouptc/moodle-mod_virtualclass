(function(d){d.virtualclass=function(){return{apps:["Whiteboard","ScreenShare","Yts","EditorRich","EditorCode"],appSessionEnd:"virtualclassSessionEnd",appAudioTest:"virtualclassAudioTest",rWidgetConfig:{id:"audioWidget"},wb:"",ss:"",wss:"",rw:"",lang:{},error:[],gObj:{uid:d.wbUser.id,uRole:d.wbUser.role,uName:d.wbUser.name,tempReplayObjs:[],alreadyReplayFromStorage:!1,commandToolsWrapperId:"commandToolsWrapper"},clearSession:function(b){d.pageEnter=(new Date).getTime();b=b.substring(0,b.indexOf("Tool"));
virtualclass.vutil.makeActiveApp("virtualclass"+b,virtualclass.previous);virtualclass.storage.config.endSession();virtualclass.vutil.beforeSend({sEnd:!0});virtualclass.hasOwnProperty("prevScreen")&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();virtualclass.previrtualclass="virtualclass"+b},init:function(b,c,a){this.wbConfig={id:"virtualclass"+this.apps[0],classes:"appOptions"};this.ssConfig={id:"virtualclass"+this.apps[1],classes:"appOptions"};this.ytsConfig=
{id:"virtualclass"+this.apps[2],classes:"appOptions"};this.edConfig={id:"virtualclass"+this.apps[3],classes:"appOptions"};this.edCodeConfig={id:"virtualclass"+this.apps[4],classes:"appOptions"};this.user=new d.user;this.lang.getString=d.getString;this.lang.message=d.message;this.vutil=d.vutil;this.media=d.media;this.system=d.system;this.recorder=d.recorder;this.converter=d.converter;this.clear="";this.currApp=this.vutil.capitalizeFirstLetter(c);this.dirtyCorner=d.dirtyCorner;this.html.init(this);
this.adapter=d.adapter;virtualclass.chat=new Chat;virtualclass.chat.init();virtualclass.vutil.initOnBeforeUnload(virtualclass.system.mybrowser.name);virtualclass.xhr=d.xhr;virtualclass.xhr.init();virtualclass.dtCon=virtualclass.converter();virtualclass.pbar=progressBar;virtualclass.editorRich=d.editor("editorRich","virtualclassEditorRich","virtualclassEditorRichBody");virtualclass.editorCode=d.editor("editorCode","virtualclassEditorCode","virtualclassEditorCodeBody");virtualclass.yts=d.yts();virtualclass.vutil.createReclaimButtonIfNeed();
"t"==this.gObj.uRole&&this.vutil.setOrginalTeacher();"undefined"==typeof a?this.makeAppReady(c,"byclick"):this.makeAppReady(c,"byclick",a);this.system.check();this.vutil.isSystemCompatible();this.storage=d.storage;virtualclass.system.indexeddb&&this.storage.init(function(){virtualclass.vutil.isPlayMode()||io.completeStorage(JSON.stringify(io.cfg))});c==this.apps[1]&&this.system.setAppDimension();virtualclass.vutil.chkValueInLocalStorage("teacherId")&&(virtualclass.gObj.uRole="t");virtualclass.user.assignRole(virtualclass.gObj.uRole,
c);this.gObj.video=new d.virtualclass.media;virtualclass.vutil.isPlayMode()||this.initSocketConn();virtualclass.isPlayMode=virtualclass.vutil.isPlayMode()},initSocketConn:function(){if(this.system.webSocket){var b=d.wbUser;virtualclass.uInfo={userid:b.id,sid:b.sid,rid:b.path,authuser:b.auth_user,authpass:b.auth_pass,userobj:{userid:b.id,name:b.name,lname:b.lname,img:b.imageurl,role:b.role},room:b.room};io.init(virtualclass.uInfo);d.userdata=virtualclass.uInfo}},html:{id:"virtualclassCont",optionsClass:"appOptions",
init:function(b){this.virtualclass=b},leftAppBar:function(){if(!(0<document.getElementsByClassName("appOptions").length)){var b=document.getElementById(this.id),c=this.createElement("div","virtualclassOptionsCont");b.insertBefore(c,b.firstChild);this.createDiv(virtualclass.edConfig.id+"Tool","editorRich",c,virtualclass.edConfig.classes);this.createDiv(virtualclass.wbConfig.id+"Tool","whiteboard",c,virtualclass.wbConfig.classes);this.createDiv(virtualclass.ssConfig.id+"Tool","screenshare",c,virtualclass.ssConfig.classes);
this.createDiv(virtualclass.ytsConfig.id+"Tool","youtubeshare",c,virtualclass.ytsConfig.classes);this.createDiv(virtualclass.edCodeConfig.id+"Tool","editorCode",c,virtualclass.edCodeConfig.classes);virtualclass.gObj.hasOwnProperty("errNotScreenShare")&&virtualclass.view.disableSSUI();"t"==virtualclass.gObj.uRole&&this.createDiv(virtualclass.appSessionEnd+"Tool","sessionend",c,"appOptions");virtualclass.gObj.hasOwnProperty("errAppBar")&&virtualclass.view.disableLeftAppBar()}},createDiv:function(b,
c,a,f,g){var d=document.createElement("a");d.href="#";var h=document.createElement("div");h.id=b;"undefined "!=typeof f&&(h.className=f);b=document.createElement("span");b.className="icon-"+c;d.appendChild(b);d.dataset.title=virtualclass.lang.getString(c);d.className="tooltip";h.appendChild(d);"undefined"!=typeof g?(g=document.getElementById("virtualclassScreenShareTool"),a.replaceChild(h,g)):a.appendChild(h)},createElement:function(b,c,a){b=document.createElement(b);"undefined"!=typeof c&&(b.id=
c);if("undefined"!=typeof a&&1<a.length)for(c=0;c<a.length;c++)b.className+=a[c]+" ";return b}},dispvirtualclassLayout:function(b){if("undefined"!=typeof this.previous)if(this.previous.toUpperCase()!=("virtualclass"+this.currApp).toUpperCase()){if(document.getElementById(virtualclass.previous).style.display="none","undefined"!=typeof b){if("EDITORRICH"==b.toUpperCase()){var c=document.getElementById("virtualclassEditorCode");null!=c&&(c.style.display="none")}"EDITORCODE"==b.toUpperCase()&&(c=document.getElementById("virtualclassEditorRich"),
null!=c&&(c.style.display="none"))}}else for(var c=document.getElementsByClassName("virtualclass"),a=0;a<c.length;a++)c[a].style.display="none";"undefined"!=typeof b&&(b="virtualclass"+(b.charAt(0).toUpperCase()+b.slice(1)));b=document.getElementById(b);null!=b&&(b.style.display="block")},makeAppReady:function(b,c,a){this.view=d.view;this.currApp=virtualclass.vutil.capitalizeFirstLetter(b);b!=this.apps[1]&&virtualclass.hasOwnProperty("previrtualclass")&&"t"==virtualclass.gObj.uRole&&virtualclass.vutil.makeActiveApp("virtualclass"+
b,virtualclass.previrtualclass);if("undefined"!=typeof this.previous&&("virtualclassEditorRich"==this.previous||"virtualclassEditorCode"==this.previous)){var f=this.previous.split("virtualclass")[1];this.user.control.toggleDisplayEditorController(f,"none")}b!=this.apps[1]&&this.dispvirtualclassLayout(b);if(b==this.apps[0])"object"==typeof this.ss&&(this.ss.prevStream=!1),"undefined"!=typeof this.previous&&"undefined"!=typeof c&&"byclick"==c&&virtualclass.vutil.beforeSend({dispWhiteboard:!0}),"object"!=
typeof this.wb?(this.wb=new d.whiteboard(this.wbConfig),this.wb.utility=new d.utility,this.wb.alreadyReplay=!1,this.wb.packContainer=new d.packContainer,this.wb.draw_object=d.draw_object,this.wb.makeobj=d.makeobj,this.wb.readyFreeHandObj=d.readyFreeHandObj,this.wb._replay=_replay,this.wb.readyTextObj=d.readyTextObj,this.wb.bridge=d.bridge,this.wb.response=d.response,this.wb.utility.initUpdateInfo(""),virtualclass.wb.utility.displayCanvas(),"t"==virtualclass.gObj.uRole&&(virtualclass.wb.utility.setOrginalTeacherContent(b),
virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0),vcan.utility.canvasCalcOffset(vcan.main.canid)),!this.alreadyReplayFromStorage&&0<this.gObj.tempReplayObjs.length&&this.wb.utility.replayFromLocalStroage(this.gObj.tempReplayObjs)):null==document.getElementById("commandToolsWrapper")&&"t"==virtualclass.gObj.uRole&&virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0),"undefined"!=typeof this.prevScreen&&this.prevScreen.hasOwnProperty("currentStream")&&this.prevScreen.unShareScreen(),null!=
document.getElementById("canvas")&&(vcan.utility.canvasCalcOffset(vcan.main.canid),0==this.gObj.tempReplayObjs.length&&virtualclass.wb.utility.makeCanvasEnable()),"virtualclassScreenShare"==this.previous&&"t"==virtualclass.gObj.uRole&&(virtualclass.vutil.dimensionMatch("virtualclassWhiteboard","virtualclassScreenShare")||virtualclass.wb.utility.lockvirtualclass()),this.previous=this.wbConfig.id;else if(b==this.apps[1])"object"!=typeof this.ss&&(this.ss=new d.screenShare(virtualclass.ssConfig)),this.ss.init({type:"ss",
app:b});else if(b==this.apps[2])"undefined"!=typeof a?virtualclass.yts.init(a,a.startFrom):virtualclass.yts.init(),this.previous=virtualclass.ytsConfig.id;else if(b==this.apps[3]||b==this.apps[4])this.user.control.toggleDisplayEditorController(b.substring(b.indexOf("virtualclass"),b.length),"block"),c=[],b==this.apps[3]?(virtualclass.editorRich.init(0,c,"",""),this.previous=virtualclass.edConfig.id):(virtualclass.editorCode.init(0,c,"",""),this.previous=virtualclass.edCodeConfig.id),c=JSON.parse(localStorage.getItem(virtualclass.vutil.smallizeFirstLetter(b))),
a=virtualclass.vutil.smallizeFirstLetter(b),null==localStorage.getItem("orginalTeacherId")&&(null==c?(this[a].cm.setOption("readOnly",!0),this.user.control.toggleDisplayWriteModeMsgBox(b,!1),console.log("message box is created "+b)):(this.user.control.toggleDisplayWriteModeMsgBox(b,c),c?this[a].cm.setOption("readOnly",!1):this[a].cm.setOption("readOnly",!0)));this.previrtualclass=this.previous;b!=this.apps[0]&&b!=this.apps[1]&&virtualclass.system.setAppDimension();b!=this.apps[1]&&b!=this.apps[2]&&
virtualclass.hasOwnProperty("yts")&&virtualclass.yts.destroyYT()},attachFunction:function(){for(var b=document.getElementsByClassName("appOptions"),c=0;c<b.length;c++){var a=b[c].getElementsByTagName("a")[0],f=this;clickedAnchor=a;a.onclick=function(){f.initlizer(this)}}},initlizer:function(b){var c=b.parentNode.id.split("virtualclass")[1];"SessionEndTool"==c?virtualclass.popup.confirmInput(virtualclass.lang.getString("savesession"),function(a){a?(io.completeStorage(void 0,void 0,"sessionend"),setTimeout(function(){virtualclass.getContent=
!0;virtualclass.vutil.beforeSend({sEnd:!0});io.sock.close();virtualclass.recorder.startUploadProcess()},300)):virtualclass.popup.confirmInput(virtualclass.lang.getString("startnewsession"),function(a){a?(virtualclass.clearSession(c),d.location.reload()):console.log("Not start new session")})}):(c=c.substring(0,c.indexOf("Tool")),this.PrvAndCurrIsWss(this.previous,c)?alert("Already the whole screen is being shared."):this.makeAppReady(c,"byclick"));"ScreenShare"!=c&&virtualclass.vutil.removeClass("audioWidget",
"fixed")},PrvAndCurrIsWss:function(b,c){return"virtualclassWholeScreenShare"==b&&c==this.apps[2]?!0:!1},prvCurrUsersSame:function(){var b=localStorage.getItem("prvUser");if(null==b)virtualclass.setPrvUser();else if(b=JSON.parse(b),b.id!=wbUser.id||b.room!=wbUser.room)virtualclass.gObj.sessionClear=!0,virtualclass.setPrvUser(),"t"==this.gObj.uRole&&localStorage.setItem("teacherId",wbUser.id)},setPrvUser:function(){localStorage.clear();localStorage.setItem("prvUser",JSON.stringify({id:wbUser.id,room:wbUser.room}))}}}})(window);(function(d,b){var c={cmdWrapperDiv:"commandToolsWrapper",create:function(a){if("#"==a.charAt(0)){var b=a.substring(1,a.length);c.utility.canvasCalcOffset(b);return new c.main(a)}alert("there is a problem with canvas id")},main:function(a){console.log("should first");c.main.children=[];c.main.id=0;c.main.uid=0;c.main.canvas=b.querySelector(a);c.main.canid=a.substring(1,a.length);c.main.currentTransform="";c.main.replayObjs=[];c.main.dragMode=!1;c.main.scaleMode=!1;c.main.usrCurrAction="";c.main.currObj=
"";c.main.textObj=!1;c.main.action="create";c.wb={};c.wb.sentPack=!1;c.activMouse=new c.mouse;c.activMouse.init()},extend:function(a,b){if("object"==typeof a&&"object"==typeof b){for(var c in b)a[c]=b[c];return a}alert("it seems that the arguments you passed are not object")},transform:function(a,b){a.translate(b.x,b.y);a.rotate(b.theta);a.scale(b.scaleX*(b.flipX?-1:1),b.scaleY*(b.flipY?-1:1))},getStates:function(a){return c.main[a]},setValInMain:function(a,b){return c.main[a]=b},ArrayIndexOf:function(a,
b){if(!b||"function"!=typeof b||!a||!a.length||1>a.length)return-1;for(var c=0;c<a.length;c++)if(b(a[c]))return c;return-1},renderAll:function(a){var b=c.main.children.length;"object"!=typeof a&&(a=c.main.canvas.getContext("2d"));c.clearContext(a);if(b)for(var g=0;g<b;++g)"freeDrawing"==c.main.children[g].type?c.fhdRender(a,c.main.children[g]):c.render(a,c.main.children[g])},clearContext:function(a){var b=c.main.canvas;a.clearRect(0,0,b.width,b.height);return b},deactivateAll:function(){for(var a=
c.main.children,b=0,g=a.length;b<g;b++)a[b].setActive(!1)},makeDispObject:function(a){return{coreObj:a,bind:function(a,b){this.addEventListener("on"+a,b)}}},remove:function(a){var b=c.main.canvas,g=c.ArrayIndexOf(c.main.children,function(b){return b.id==a.id&&(b.mt==a.mt||!0==a.multiuser)});0<=g&&c.main.children.splice(g,1);var g=b.height,d=b.width,b=b.getContext("2d");b.beginPath();b.clearRect(0,0,d,g);b.closePath();c.renderAll()},render:function(a,b,g){a.beginPath();a.save();a.lineWidth=void 0!==
a.lineWidth?b.lineWidth:2;g||c.transform(a,b);a.strokeStyle=void 0!=b.borderColor?b.borderColor:"#000000";"rectangle"==b.type?c.objRect.draw(a,b,g):"line"==b.type?c.objLine.draw(a,b,g):"oval"==b.type?c.objOval.draw(a,b,g):"triangle"==b.type?c.objTri.draw(a,b,g):"text"==b.type&&c.objTxt.draw(a,b,g);b.active&&!g&&(b.drawBorders(a),b.hideCorners||b.drawCorners(a));a.closePath();a.restore()},fhdRender:function(a,b,g){a.save();var d=b.transformMatrix;d&&a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);g||c.transform(a,
b);b.overlayFill?a.fillStyle=b.overlayFill:b.fill&&(a.fillStyle=b.fill);b.stroke&&(a.strokeStyle=b.stroke);a.beginPath();var h;h=d=0;for(var n=-(b.width/2),r=-(b.height/2),q=0,t=b.path.length;q<t;++q)switch(h=b.path[q],h[0]){case "L":d=h[1];h=h[2];a.lineTo(d+n,h+r);break;case "M":d=h[1],h=h[2],a.moveTo(d+n,h+r)}b.fill&&a.fill();b.stroke&&(a.strokeStyle=b.stroke,a.lineWidth=b.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!g&&b.active&&(b.drawBorders(a),b.hideCorners||b.drawCorners(a));a.restore()},
makeStackObj:function(a,b,c,d){return{mt:a,ac:b,x:c,y:d}}};d.vcan=c})(window,document);(function(d,b){d.whiteboard=function(c){var a=c.hasOwnProperty("id")?c.id:"appWhitebaordCont";c=c.hasOwnProperty("class");return{id:a,classes:c,tool:"",obj:{},prvObj:"",replayTime:0,sentPackets:0,sentPackDiv:"sentPacket",sentPackDivPS:"sentPacketPS",receivedPackets:0,receivedPackDiv:"receivedNumber",receivedPackDivPS:"receivedNumberPS",uid:0,lt:"",view:{},lang:{},system:{},user:{},gObj:{myrepObj:[],replayObjs:[],myArr:[],displayedObjId:0,packQueue:[],virtualWindow:!1},init:function(){virtualclass.wb.vcan=
d.vcan;var a=virtualclass.wb.vcan;virtualclass.wb.canvas=a.create("#canvas");a=a.main.canvas;a.setAttribute("tabindex","0");a.focus();a.onkeydown=virtualclass.wb.utility.keyOperation;virtualclass.system.setAppDimension();"undefined"!==typeof Storage&&(d.virtualclass.wb=virtualclass.wb);this.arrowInit();var c=virtualclass.wb.sentPackets;virtualclass.clear2=setInterval(function(){null!=b.getElementById(virtualclass.wb.sentPackDivPS)&&(c=virtualclass.wb.utility.calcPsSentPackets(c),b.getElementById(virtualclass.wb.sentPackDiv).innerHTML=
virtualclass.wb.sentPackets)},1E3);this._init()},_init:function(){virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId")?virtualclass.wb.pageEnteredTime=localStorage.getItem("pageEnteredTime"):(virtualclass.wb.pageEnteredTime=(new Date).getTime(),localStorage.setItem("pageEnteredTime",virtualclass.wb.pageEnteredTime));virtualclass.wb.oTeacher=virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId");virtualclass.vutil.chkValueInLocalStorage("rcvdPackId")?virtualclass.wb.gObj.rcvdPackId=
parseInt(localStorage.rcvdPackId):virtualclass.wb.gObj.rcvdPackId=0;"t"==virtualclass.gObj.uRole&&d.addEventListener("resize",function(){"Whiteboard"==virtualclass.currApp&&virtualclass.wb.utility.lockvirtualclass()});d.addEventListener("click",function(){virtualclass.view.disappearBox("WebRtc");virtualclass.view.disappearBox("Canvas");virtualclass.view.disappearBox("drawArea")});virtualclass.vutil.chkValueInLocalStorage("reclaim");if(this.stHasTeacher=virtualclass.vutil.chkValueInLocalStorage("teacherId"))virtualclass.gObj.uRole=
"t";virtualclass.wb.utility.crateCanvasDrawMesssage()},arrowInit:function(){this.arrImg=new Image;this.arrImg.src="undefined"!=typeof d.whiteboardPath?d.whiteboardPath+"/images/arrow.png":"/images/arrow.png";this.arrImgDraw=!1;var a=this;this.arrImg.onload=function(){a.arrImgDraw=!0}},createCommand:function(){if(virtualclass.wb.utility.alreadyExistToolBar()||null!=localStorage.getItem("reclaim")&&localStorage.reclaim)return!0;var a=virtualclass.vutil.createCommandWrapper();virtualclass.vutil.createDiv("t_rectangle",
"rectangle",a,"tool");virtualclass.vutil.createDiv("t_line","line",a,"tool");virtualclass.vutil.createDiv("t_freeDrawing","freeDrawing",a,"tool");virtualclass.vutil.createDiv("t_oval","oval",a,"tool");virtualclass.vutil.createDiv("t_triangle","triangle",a,"tool");virtualclass.vutil.createDiv("t_text","text",a,"tool");virtualclass.vutil.createDiv("t_activeall","activeAll",a,"tool");virtualclass.vutil.createDiv("t_clearall","clearAll",a,"tool");virtualclass.wb.socketOn=parseInt(wbUser.socketOn);1==
virtualclass.wb.socketOn&&virtualclass.wb.utility.setClass("vcanvas","socketon")},createCommandWrapper:function(){var a=b.createElement("div");a.id=virtualclass.gObj.commandToolsWrapperId;var c=b.getElementById(vcan.canvasWrapperId);null!=c?b.getElementById("containerWb").insertBefore(a,c):b.getElementById("containerWb").appendChild(a);return a},createDiv_old:function(a,c,d,h){var n=c;c=virtualclass.lang.getString(c);var r=b.createElement("a");r.href="#";var q=b.createElement("div");q.id=a;"undefined"!=
typeof h&&(q.className=h);h=b.createElement("span");h.className="icon-"+n;r.appendChild(h);r.dataset.title=c;r.className="tooltip";q.appendChild(r);"t_reclaim"==a?(a=b.getElementById(virtualclass.html.id),d.appendChild(q),a.insertBefore(d,a.firstChild)):d.appendChild(q)},createCanvas:function(){var a=b.createElement("div");a.id=vcan.canvasWrapperId;vcan.canvasWrapperId=a.id;var c=b.createElement("canvas");c.id="canvas";c.innerHTML="Canvas is missing in your browsers. Please update the latest version of your browser";
a.appendChild(c);b.getElementById("containerWb").appendChild(a)},objInit:function(a){"t"==virtualclass.gObj.uRole&&"t_clearall"!=this.parentNode.id&&virtualclass.wb.utility.makeActiveTool(this.parentNode.id);"t_replay"==this.parentNode.id?(virtualclass.wb.utility.clearAll(!1),virtualclass.vutil.beforeSend({replayAll:!0})):virtualclass.wb.toolInit(this.parentNode.id);"t_replay"!=this.parentNode.id&&"t_clearall"!=this.parentNode.id&&"t_reclaim"!=this.parentNode.id&&"t_assign"!=this.parentNode.id&&(a=
(new Date).getTime(),virtualclass.wb.lt=this.parentNode.id,a={cmd:this.parentNode.id,mt:a},virtualclass.wb.uid++,a.uid=virtualclass.wb.uid,vcan.main.replayObjs.push(a),virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs)),virtualclass.vutil.beforeSend({repObj:[a]}));"t_clearall"!=this.parentNode.id&&(virtualclass.wb.prvTool=this.parentNode.id)},attachToolFunction:function(a,c){virtualclass.wb.createCommand(c);if("undefined"==typeof c){var d=virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId");
virtualclass.wb.dataInfo=parseInt(wbUser.dataInfo);d&&1==virtualclass.wb.dataInfo&&!virtualclass.wb.utility.alreadyExistPacketContainer()&&(virtualclass.wb.packContainer.createPacketContainer(),virtualclass.wb.packContainer.createPacketInfoContainer(),virtualclass.wb.utility.initStoredPacketsNumbers())}for(var d=b.getElementById(a).getElementsByTagName("div"),h=0;h<d.length;h++)d[h].getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb.objInit)},toolInit:function(a,b,c,h){"object"==
typeof virtualclass.wb.obj.drawTextObj&&!0==virtualclass.wb.obj.drawTextObj.wmode&&vcan.main.canvas.getContext("2d");0<virtualclass.wb.vcan.getStates("children").length?"t_clearall"!=a&&("undefined"!=typeof c&&"t_replay"==a||virtualclass.wb.utility.deActiveFrmDragDrop(),!0!=c&&"t_replay"!=a&&virtualclass.wb.vcan.renderAll()):virtualclass.wb.vcan.main.action="create";virtualclass.wb.utility.IsObjEmpty(virtualclass.wb.obj.freeDrawObj&&!1==c)||(virtualclass.wb.obj.freeDrawObj.freesvg=!1);virtualclass.wb.vcan.main.currUserCommand=
a+"Init";"t_activeall"==a?virtualclass.wb.utility.t_activeallInit():"t_replay"==a?("undefined"==typeof c&&vcan.setValInMain("id",0),"undefined"!=typeof h?virtualclass.wb.t_replayInit(b,h):virtualclass.wb.t_replayInit(b)):"t_clearall"==a?virtualclass.popup.confirmInput(virtualclass.lang.getString("clearAllWarnMessage"),function(b){if(!b)return!0;virtualclass.wb.utility.makeActiveTool(a);virtualclass.wb.utility.t_clearallInit();virtualclass.wb.utility.makeDefaultValue(a);virtualclass.storage.clearStorageData();
virtualclass.wb.prvTool=a;virtualclass.vutil.beforeSend({clearAll:!0})}):"t_assign"==a?(b=localStorage.getItem("toolHeight"),null!=b?virtualclass.vutil.beforeSend({assignRole:!0,toolHeight:b,socket:virtualclass.wb.socketOn}):virtualclass.vutil.beforeSend({assignRole:!0,socket:virtualclass.wb.socketOn})):"t_reclaim"==a&&virtualclass.wb.utility._reclaimRole();"t_activeall"!=a&&"t_replay"!=a&&"t_clearallInit"!=a&&"t_assign"!=a&&"t_reclaim"!=a&&(virtualclass.wb.tool=new virtualclass.wb.tool_obj(a),virtualclass.wb.utility.attachEventHandlers())},
tool_obj:function(a){this.cmd=a;"t_freeDrawing"!=a&&(virtualclass.wb.obj.freeDrawObj="");"t_text"==a||virtualclass.vutil.exitTextWrapper()||(virtualclass.wb.obj.drawTextObj="");"t_freeDrawing"==a?(virtualclass.wb.obj.freeDrawObj=new virtualclass.wb.readyFreeHandObj("#424240","3"),virtualclass.wb.obj.freeDrawObj.init()):"t_text"==a&&(virtualclass.wb.obj.drawTextObj=new virtualclass.wb.readyTextObj,virtualclass.wb.obj.drawTextObj.init("canvasWrapper"));a=a.slice(2,a.length);virtualclass.wb.draw_object(a,
virtualclass.wb.canvas,this)},t_replayInit:function(a,b){"fromFile"==a?(virtualclass.gObj.chat.removeAllChat(),virtualclass.wb.recordAudio=!0,virtualclass.recorder.init()):(virtualclass.wb.replay=virtualclass.wb._replay(),"undefined"!=typeof b?(virtualclass.wb.replay.init(a,b),virtualclass.wb.replay.renderObj(b)):(virtualclass.wb.replay.init(a),virtualclass.wb.replay.renderObj()))}}}})(window,document);(function(d){d.utility=function(){return{userIds:[],isObjExistRE:function(b){if(0<=virtualclass.wb.replay.removeElements.length){var c=virtualclass.wb.vcan.ArrayIndexOf(virtualclass.wb.replay.removeElements,function(a){return a.id==b.id});if(0<=c)return c}},IsObjEmpty:function(b){for(var c in b)if(b.hasOwnProperty(c))return!1;return!0},stringToNumber:function(b){" "==b[b.length-1]&&(b=b.substring(0,b.length-1));return b=Number(b)},clickOutSidebox:function(b){return 1!=b%2?!0:!1},keyOperation:function(b){if(8==
b.keyCode||46==b.keyCode)b=virtualclass.wb.vcan,""!=b.main.currObj&&(b=virtualclass.wb.utility.removeSelectedItem(b.main.currObj),virtualclass.vutil.beforeSend({repObj:[b]}))},removeSelectedItem:function(b,c){virtualclass.wb.canvas.removeObject(vcan.main.currObj);b={mt:(new Date).getTime(),ac:"del"};"undefined"==typeof c&&virtualclass.wb.uid++;b.uid=virtualclass.wb.uid;"s"==virtualclass.gObj.uRole?virtualclass.storage.store(JSON.stringify(virtualclass.wb.gObj.replayObjs)):(vcan.main.replayObjs.push(b),
virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs)));vcan.main.currObj="";return b},attachEventHandlers:function(){virtualclass.wb.canvas.bind("mousedown",virtualclass.wb.utility.ev_canvas);virtualclass.wb.canvas.bind("mousemove",virtualclass.wb.utility.ev_canvas);virtualclass.wb.canvas.bind("mouseup",virtualclass.wb.utility.ev_canvas)},t_clearallInit:function(){virtualclass.wb.utility.clearAll(!0)},clearAll:function(b,c){virtualclass.wb.uid=0;virtualclass.wb.lt="";for(var a=virtualclass.wb.vcan;0<
a.main.children.length;)virtualclass.wb.canvas.removeObject(a.main.children[0]);!0==b&&a.main.replayObjs.splice(0,a.main.replayObjs.length);void 0!=virtualclass.wb.replay&&(virtualclass.wb.replay.objNo=0);"move"==a.getStates("action")&&a.setValInMain("action","create");a=document.getElementById("sendPackCont");if(null!=a){var f=a.getElementsByClassName("numbers");if(0<f.length)for(a=0;a<f.length;a++)f[a].innerHTML=0}"undefined"==typeof c&&(virtualclass.wb.sentPackets=0,virtualclass.wb.receivedPackets=
0);a=document.getElementById("sentMsgInfo");null!=a&&(a.innerHTML="");a=document.getElementById("rcvdMsgInfo");null!=a&&(a.innerHTML="");f=document.getElementsByClassName("textBoxContainer");for(a=0;a<f.length;a++)f[a].parentNode.removeChild(f[a]);a=document.getElementById("serverErrorCont");null!=a&&a.parentNode.removeChild()},deActiveFrmDragDrop:function(){var b=virtualclass.wb.vcan,c=b.main.children;if("move"==b.getStates("action")){b.setValInMain("action","create");for(b=0;b<c.length;b++)c[b].dragDrop(!1),
c[b].setActive(!1);return!0}return!1},getOffset:function(b){for(var c=b.target,a=y=0;c&&!isNaN(c.offsetLeft)&&!isNaN(c.offsetTop);)a+=c.offsetLeft-c.scrollLeft,y+=c.offsetTop-c.scrollTop,c=c.offsetParent;a=b.clientX-a;y=b.clientY-y;return{x:a,y:y}},ev_canvas:function(b){var c=virtualclass.wb.vcan.utility.getReltivePoint(b);b.currX=c.x;b.currY=c.y;if(c=virtualclass.wb.tool[b.type])return c(b),this.ev_canvas},t_activeallInit:function(){var b=virtualclass.wb.vcan,c=b.getStates("children");if(1<=c.length)for(b.setValInMain("action",
"move"),b=0;b<c.length;b++)c[b].dragDrop(!0)},drawArrowImg:function(b,c){var a=virtualclass.wb.vcan.main.canvas.getContext("2d");a.clearRect(0,0,virtualclass.wb.vcan.main.canvas.width,virtualclass.wb.vcan.main.canvas.height);vcan.renderAll();a.save();a.beginPath();a.translate(c.mp.x,c.mp.y);a.drawImage(b,-3,-3,18,24);a.closePath();a.restore()},calcPsSentPackets:function(b){if(virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId"))return b=virtualclass.wb.sentPackets-b,0>b&&(b=0),document.getElementById(null!=
virtualclass.wb.sentPackDivPS)&&(document.getElementById(virtualclass.wb.sentPackDivPS).innerHTML=b),virtualclass.wb.sentPackets},calcPsRecvdPackets:function(b){b=virtualclass.wb.receivedPackets-b;0>b&&(b=0);null!=document.getElementById(virtualclass.wb.receivedPackDivPS)&&(document.getElementById(virtualclass.wb.receivedPackDivPS).innerHTML=b);return virtualclass.wb.receivedPackets},initStoredPacketsNumbers:function(){if(virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId")){if(localStorage.sentPackets){var b=
JSON.parse(localStorage.sentPackets);virtualclass.wb.sentPackets=b;null!=document.getElementById(virtualclass.wb.sentPackDiv)&&(document.getElementById(virtualclass.wb.sentPackDiv).innerHTML=b)}localStorage.receivedPackets&&(virtualclass.wb.receivedPackets=JSON.parse(localStorage.receivedPackets),null!=document.getElementById(virtualclass.wb.receivedPackDiv)&&(document.getElementById(virtualclass.wb.receivedPackDiv).innerHTML=virtualclass.wb.receivedPackets))}},updateSentPackets:function(b){1==virtualclass.wb.dataInfo&&
virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId")&&(virtualclass.wb.sentPackets+=JSON.stringify(b).length,null!=document.getElementById(virtualclass.wb.sentPackDiv)&&(document.getElementById(virtualclass.wb.sentPackDiv).innerHTML=virtualclass.wb.sentPackets))},assignRole:function(b){virtualclass.wb.tool="";"move"==vcan.main.action&&virtualclass.wb.utility.deActiveFrmDragDrop();if("undefined"!=typeof b){if(null!=localStorage.getItem("reclaim")){var c=document.getElementById(virtualclass.gObj.commandToolsWrapperId);
c.parentNode.removeChild(c);localStorage.removeItem("reclaim")}localStorage.removeItem("studentId");localStorage.setItem("teacherId",b);virtualclass.gObj.uRole="t";virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.currApp);vcan.utility.canvasCalcOffset(vcan.main.canid);"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.inputURL(),virtualclass.yts.seekChangeInterval())}else{"Yts"==virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));
virtualclass.gObj.uRole="s";c=document.getElementById(virtualclass.gObj.commandToolsWrapperId);if(null!=c)for(;c.hasChildNodes();)c.removeChild(c.lastChild);virtualclass.wb.utility.makeCanvasDisable();"undefined"!=typeof localStorage.orginalTeacherId?(virtualclass.vutil.createReclaimButton(c),localStorage.setItem("reclaim",!0),virtualclassCont=document.getElementById("virtualclassCont"),virtualclassCont.className+=" reclaim"):null!=c&&c.parentNode.removeChild(c);b=localStorage.getItem("teacherId");
localStorage.removeItem("teacherId");localStorage.setItem("studentId",b);virtualclass.wb.utility.uniqueArrOfObjsToStudent()}null==localStorage.getItem("orginalTeacherId")&&virtualclass.vutil.toggleRoleClass(!0)},reclaimRole:function(){virtualclass.gObj.controlAssign=!1;virtualclass.wb.response.assignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},dispQueuePacket:function(b){(null!=localStorage.getItem("teacherId")||null!=localStorage.getItem("orginalTeacherId")&&virtualclass.vutil.chkValueInLocalStorage("reclaim"))&&
virtualclass.wb.utility.toolWrapperEnable();virtualclass.wb.drawMode=!1;null!=localStorage.getItem("teacherId")&&(virtualclass.wb.utility.makeCanvasEnable(),virtualclass.wb.utility.enableAppsBar());0<virtualclass.wb.gObj.packQueue.length&&(d.virtualclass.wb.vcan.main.replayObjs=virtualclass.wb.gObj.packQueue,virtualclass.wb.gObj.packQueue=[],virtualclass.wb.toolInit("t_replay","fromBrowser",!0,virtualclass.wb.utility.dispQueuePacket))},updateRcvdInformation:function(b){var c=document.getElementById("rcvdMsgInfo");
if(null!=c){var a="",f;for(f in b)a+=f+" : "+b[f]+" <br />";c.innerHTML=a}},makeCanvasDisable:function(){var b=vcan.main.canvas;b.style.position="relative";b.style.pointerEvents="none"},makeCanvasEnable:function(){null==localStorage.getItem("teacherId")||virtualclass.wb.hasOwnProperty("canvasDisable")&&virtualclass.wb.canvasDisable||(vcan.main.canvas.style.pointerEvents="visible")},removeToolBox:function(){var b=document.getElementById(vcan.cmdWrapperDiv);b.parentNode.removeChild(b)},createReclaimButton:function(b){virtualclass.vutil.createDiv("t_reclaim",
"reclaim",b);document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",virtualclass.wb.objInit)},chkValueInLocalStorage:function(b){return null===localStorage.getItem(b)?!1:localStorage[b]},uniqueArrOfObjsToStudent:function(){var b="";virtualclass.wb.gObj.replayObjs=[];for(var c=0;c<vcan.main.replayObjs.length;c++)b=vcan.extend({},vcan.main.replayObjs[c]),virtualclass.wb.gObj.replayObjs.push(b)},uniqueArrOfObjsToTeacher:function(){vcan.main.replayObjs=[];for(var b=
"",c=0;c<virtualclass.wb.gObj.replayObjs.length;c++)b=vcan.extend({},virtualclass.wb.gObj.replayObjs[c]),vcan.main.replayObjs.push(b)},makeDefaultValue:function(b){"undefined"!=typeof b&&"t_clearall"==b||virtualclass.wb.utility.makeDeActiveTool();virtualclass.wb.gObj.myrepObj=[];virtualclass.wb.gObj.replayObjs=[];virtualclass.wb.gObj.rcvdPackId=0;virtualclass.wb.gObj.displayedObjId=0;virtualclass.wb.gObj.packQueue=[];virtualclass.wb.uid=0;localStorage.setItem("rcvdPackId",0);localStorage.removeItem("totalStored");
virtualclass.vutil.chkValueInLocalStorage("teacherId");virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId");virtualclass.vutil.chkValueInLocalStorage("wbrtcMsg");virtualclass.vutil.chkValueInLocalStorage("canvasDrwMsg");virtualclass.vutil.chkValueInLocalStorage("toolHeight");JSON.parse(virtualclass.vutil.chkValueInLocalStorage("prvUser"));JSON.parse(virtualclass.vutil.chkValueInLocalStorage("tc"));virtualclass.recorder.items=[];virtualclass.storage.totalStored=0;virtualclass.recorder.totalSent=
0;virtualclass.gObj.video.audio.bufferSize=0;virtualclass.gObj.video.audio.encMode="alaw";virtualclass.gObj.video.audio.rec="";virtualclass.gObj.video.audio.audioNodes=[];"undefined"!=typeof vcan.objTxt&&vcan.objTxt.removeTextNode();"undefined"!=typeof vcan.main.currentTransform&&(vcan.main.currentTransform="");virtualclass.gObj.video.audio.updateInfo()},clearCurrentTool:function(){virtualclass.wb.hasOwnProperty("tool")&&(virtualclass.wb.tool="")},setOrginalTeacherContent:function(){localStorage.setItem("canvasDrwMsg",
!0);virtualclass.wb.utility.alreadyExistPacketContainer()||1!=parseInt(wbUser.dataInfo,10)||(virtualclass.wb.packContainer.createPacketContainer(),virtualclass.wb.packContainer.createPacketInfoContainer(),virtualclass.wb.utility.initStoredPacketsNumbers())},checkWebRtcConnected:function(){return"undefined"==typeof cthis||!cthis.pc[0].hasOwnProperty("iceConnectionState")&&"undefined"==typeof cthis.pc[0].iceConnectionState?!1:!0},createVirtualWindow:function(b){virtualclass.wb.gObj.virtualWindow=!0;
var c=document.createElement("div");virtualclass.wb.utility.removeVirtualWindow("virtualWindow");c.setAttribute("id","virtualWindow");c.style.width=b.width+"px";if("undefined"!=typeof assignRoleAtStudent)var a=0;else a=parseInt(localStorage.getItem("toolHeight")),a=null!=a?a:0;null!=localStorage.getItem("orginalTeacherId")?c.style.height=b.height+a+"px":null!=localStorage.getItem("teacherId")?c.style.height=b.height+"px":c.style.height=b.height-a+"px";b=document.getElementById("containerWb");b.insertBefore(c,
b.firstChild)},removeVirtualWindow:function(b){b=document.getElementById(b);null!=b&&(virtualclass.wb.gObj.virtualWindow=!1,b.parentNode.removeChild(b))},getWideValueAppliedByCss:function(b,c){var a=document.getElementById(b);if(null!=a){var f=d.getComputedStyle(a);if("undefined"!=typeof f.marginTop){var g=parseInt(f.marginTop.match(/\d+/));null==g&&(g=0)}return a.clientHeight+g}return!1},isNumber:function(b){return isNaN(+b)?!1:+b},setCommandToolHeights:function(b,c){var a=document.getElementById("virtualWindow");
if(null!=a){var f=parseInt(a.style.height.match(/\d+/));a.style.height="decrement"==c?f-parseInt(b)+"px":f+parseInt(b)+"px"}},setClass:function(b,c){var a=document.getElementById(b),f=a.classList,g="";0<f.length&&(g=2>g.length?f[0]+" ":f.join(" ")+" ");a.setAttribute("class",g+c)},setStyleUserConnetion:function(b,c,a){b=document.getElementsByClassName(b)[0];null!=b&&b.setAttribute("class",c+" controlCmd")},existUserLikeMe:function(b){if(b.fromUser.userid!=wbUser.id){if(b.message.checkUser.hasOwnProperty("role")){var c=
b.message.checkUser.role;if(c){if(null==localStorage.getItem("otherRole")){var a=[];if(c!=virtualclass.gObj.uRole)a.push(c);else return existUser=!0}else a=JSON.parse(localStorage.getItem("otherRole")),-1==a.indexOf(c)&&a.push(c);"undefined"!=typeof a&&(localStorage.setItem("otherRole",JSON.stringify(a)),console.log("Other Browser "+c+" "+b.fromUser.userid))}return virtualclass.gObj.uRole==c?!0:!1}}else{if("undefined"!=typeof existUser)return!0;b=JSON.parse(localStorage.getItem("otherRole"));if(null!=
b){for(c=0;c<b.length;c++)if(virtualclass.gObj.uRole==b[c])return!0;return!1}}},existUserWithSameId:function(b){this.userIds.push(b.fromUser.userid);if(1<this.userIds.length&&virtualclass.wb.utility.arrayContainsSameValue(this.userIds[0],this.userIds))return!0},makeUserAvailable:function(){null==localStorage.getItem("repObjs")&&(virtualclass.wb.utility.toolWrapperEnable(),null!=vcan.main.canvas&&virtualclass.wb.utility.makeCanvasEnable())},displayCanvas:function(){vcan.canvasWrapperId="canvasWrapper";
null==document.getElementById("canvas")&&virtualclass.wb.createCanvas();d.virtualclass.wb.init();virtualclass.wb.utility.makeCanvasDisable();virtualclass.wb.utility.toolWrapperDisable()},initAll:function(b){null!=localStorage.getItem("teacherId")&&virtualclass.wb.utility.makeCanvasDisable();virtualclass.system.measureResoultion({width:d.outerWidth,height:d.innerHeight})},alreadyExistToolBar:function(){var b=document.getElementById("t_rectangle");if(null!=b)return 8<=b.parentNode.getElementsByClassName("tool").length?
!0:!1},alreadyExistPacketContainer:function(){var b=document.getElementById("packetContainer"),c=document.getElementById("informationCont");return 2<=b.getElementsByTagName("div").length||1<=c.getElementsByTagName("div").length?!0:!1},toolWrapperDisable:function(b){var c=document.getElementById("commandToolsWrapper");if(null!=c)if("undefined"!=typeof b)for(b=c.getElementsByTagName("a"),c=0;c<b.length;c++)b[c].style.pointerEvents="none";else c=document.getElementById("commandToolsWrapper"),null!=c&&
(c.style.pointerEvents="none")},toolWrapperEnable:function(b){var c=document.getElementById("commandToolsWrapper");if(null!=c)if("undefined"!=typeof b)for(b=c.getElementsByTagName("a"),c=0;c<b.length;c++)b[c].style.pointerEvents="visible";else null==c||virtualclass.gObj.hasOwnProperty("errNotDesktop")||(c.style.pointerEvents="visible")},replayFromLocalStroage:function(b){"undefined"!==typeof Storage&&(!1===virtualclass.storage.reclaim&&virtualclass.vutil.disableAppsBar(),virtualclass.wb.vcan.main.replayObjs=
b,virtualclass.wb.utility.clearAll(!1,"dontClear"),virtualclass.wb.gObj.replayObjs=virtualclass.wb.gObj.replayObjs.concat(b),0<b.length&&(virtualclass.wb.utility.makeCanvasDisable(),virtualclass.wb.utility.toolWrapperDisable(),virtualclass.wb.uid=b[b.length-1].uid,virtualclass.wb.gObj.rcvdPackId=virtualclass.wb.uid,virtualclass.wb.toolInit("t_replay","fromBrowser",!0,virtualclass.wb.utility.dispQueuePacket)))},setUserStatus:function(b,c){b||c?virtualclass.wb.utility.setClass("vcanvas","teacher"):
(virtualclass.wb.utility.removeToolBox(),virtualclass.wb.utility.setClass("vcanvas","student"))},crateCanvasDrawMesssage:function(){"undefined"!=typeof localStorage.teacherId&&null==localStorage.getItem("canvasDrwMsg")&&(d.virtualclass.view.canvasDrawMsg("Canvas"),d.virtualclass.view.drawLabel("drawArea"),localStorage.canvasDrwMsg=!0)},removeOtherUserExist:function(b){"t"==b?null!=localStorage.getItem("studentId")&&localStorage.removeItem("studentId"):"s"==b&&null!=localStorage.getItem("orginalTeacherId")&&
(localStorage.removeItem("orginalTeacherId"),null!=localStorage.getItem("teacherId")&&localStorage.removeItem("teacherId"),null!=localStorage.getItem("reclaim")&&localStorage.removeItem("reclaim"),virtualclass.wb.utility.removeToolBox())},arrayContainsSameValue:function(b,c){for(var a=0;a<c.length;a++)if(c[a]!==b)return!1;return!0},actionAfterRemovedUser:function(){virtualclass.wb.utility.makeCanvasDisable();virtualclass.wb.utility.setStyleUserConnetion("con","coff");virtualclass.wb.utility.removeVirtualWindow("virtualWindow");
virtualclass.wb.user.connected=!1;localStorage.removeItem("otherRole");"undefined"!=typeof cthis&&(tempIsInitiaor=!0,cthis.isStarted&&cthis.handleRemoteHangup())},sendRequest:function(b,c){virtualclass.vutil.beforeSend({reclaimRole:!0})},updateSentInformation:function(b,c){if(virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId")){var a=JSON.parse(b),a="undefined"!=typeof c?a:a.repObj[0],f="",g;for(g in a)f+=g+" : "+a[g]+" <br />";null!=document.getElementById("sentMsgInfo")&&(document.getElementById("sentMsgInfo").innerHTML=
f)}},beforeSend:function(b,c){if(b.hasOwnProperty("createArrow")){var a=JSON.stringify(b);virtualclass.wb.vcan.optimize.sendPacketWithOptimization(a,io.sock.readyState,100)}else{if(b.hasOwnProperty("repObj")){if("undefined"==typeof b.repObj[b.repObj.length-1])return;virtualclass.wb.gObj.rcvdPackId=b.repObj[b.repObj.length-1].uid;virtualclass.wb.gObj.displayedObjId=virtualclass.wb.gObj.rcvdPackId}a=JSON.stringify(b);virtualclass.wb.sentPackets+=a.length;1==io.sock.readyState&&("undefined"==typeof c?
io.send(b):io.send(b,c));JSON.parse(a).hasOwnProperty("repObj")&&virtualclass.wb.utility.updateSentInformation(a)}localStorage.sentPackets=virtualclass.wb.sentPackets},checkCanvasHasParents:function(){for(var b=document.getElementById("vcanvas");"BODY"!=b.parentNode.tagName;)"vcanvas"!=b.id&&(b.style.margin="0",b.style.padding="0"),b=b.parentNode;"vcanvas"!=b.id&&(b.style.margin="0",b.style.padding="0")},lockvirtualclass:function(){if(d.earlierWidth!=d.innerWidth&&(virtualclass.wb.canvasDisable=!0,
virtualclass.wb.utility.makeCanvasDisable(),virtualclass.wb.utility.toolWrapperDisable(),virtualclass.vutil.disableAppsBar(),null==document.getElementById("divForReloadMsg"))){var b=null!=localStorage.getItem("teacherId")?"msgForReload":"msgStudentForReload";d.virtualclass.view.displayMsgBox("divForReloadMsg",b);d.earlierWidth=d.innerWidth}},getElementRightOffSet:function(b){var c=20;null!=b.parentNode&&(b=b.parentNode,c=vcan.utility.getElementOffset(b),c=d.innerWidth-(b.clientWidth+(c.x-0)));return c},
initUpdateInfo:function(b){b=virtualclass.wb.receivedPackets;setInterval(function(){null!=document.getElementById(virtualclass.wb.receivedPackDivPS)&&(b=virtualclass.wb.utility.calcPsRecvdPackets(b),document.getElementById(virtualclass.wb.receivedPackDiv).innerHTML=virtualclass.wb.receivedPackets)},1E3)},objPutInContainer:function(b){vcan.main.replayObjs.push(b);virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs))},makeActiveTool:function(b){b=document.getElementById(b);var c;virtualclass.wb.hasOwnProperty("prvTool")&&
"t_reclaim"!=virtualclass.wb.prvTool?(c=virtualclass.vutil.removeClassFromElement(virtualclass.wb.prvTool,"active"),document.getElementById(virtualclass.wb.prvTool).className=c):c=b.className;b.className=c+" active";localStorage.activeTool=b.id},makeDeActiveTool:function(){virtualclass.wb.tool="";document.getElementById("commandToolsWrapper");var b=document.getElementsByClassName("tool active");0<b.length&&b[0].classList.remove("active")},createAudioTransmitIcon:function(b){var c=document.cteateElement("div");
c.id="audioTransmit"+uuserId;c.className="audioTransmit";document.getElementById(b+"ControlContainer")},_reclaimRole:function(){virtualclass.wb.utility.reclaimRole();virtualclass.wb.utility.sendRequest("reclaimRole",!0);virtualclass.user.control.changeAttrToAssign("enable")},enableAppsBar:function(){var b=document.getElementById("virtualclassOptionsCont");null!=b&&(b.style.pointerEvents="visible")}}}})(window);(function(d){d.message={notSupportCanvas:'This browser does not support Canvas. Please update your browser with the latest versionFor more information about Canvas, click on the link given here <a href="http://en.wikipedia.org/wiki/Canvas_element/">Canvas</a>',notSupportGetUserMedia:'The browser does not support getUserMedia for webRtc. Please update your browser with the latest version For more information about getUuserMedia, click on the link given here <a href="http://dev.w3.org/2011/webrtc/editor/getusermedia.html">getUserMedia</a>',
notSupportPeerConnect:'The browser is unable to create Peer Connection object for WebRtc Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',notSupportWebSocket:'This browser does not support WebSocket. Please update your browser with the latest version. For more information about WebSocket, click on the link given here <a href="http://www.websocket.org/">WebSocket</a>.',notSupportWebRtc:'This browser does not support WebRTC. Please update your browser with the latest version. For more information about WebRtc, click on the link given here <a href="http://www.webrtc.org/">WebRtc</a>',
line:"Line",rectangle:"Rectangle",triangle:"Triangle",oval:"Oval",assign:"Assign",reclaim:"Reclaim",freeDrawing:"Free Drawing",text:"Text",replay:"Replay",activeAll:"Active All",clearAll:"Clear All",drawArea:"Draw Area",totRcvdPackets:"Total Received Packets",perSecRcvdData:"Per Second Recevied Packet",totSentPackets:"Total Sent Packets",perSecSentPacket:"Per Second Sent Packets",perSecond:"Per Second",sentPackets:"Sent <br/><span>Packets</span>",receviedPackets:"Received <br/><span>Pacekts</span>",
total:"Total",dataDetails:"Data Details",sentMessageInfo:"Sent Message <br/><span>Information</span>",receivedMessageInfo:"Received Message <br/><span>information</span>",wbrtcMsgFireFox:'You can click on  "Share Selected Devices" to share your microphone and camera with other users',wbrtcMsgChrome:"You can click on deny button for not sharing your microphone and camera with other users.or click on allow button to share your microphone and camera with other users.",canvasDrawMsg:"You can click on any tool to draw object with a mouse click, mouse move and mouse up in the Draw Area",
clearAllWarnMessage:"Do you want to remove all objects you have drawn?",cof:"connection off",askForConnect:"You will be able to perform this action only when other user get connected",msgForReload:"You will be unable to draw the objects after resizing the window. <br />  So, please reload the page for drawing. ",msgStudentForReload:"After resizing the window, there can be a problem over the drawn objects, <br />  So, please realod the page for better results ",reload:"Reload",whiteboard:"Whiteboard",
screenshare:"Screen Share",sessionend:"Session End",audioTest:"Kindly speak some words for audio testing\nYour voice will be recorderd for 5 seconds after press OK.",chatEnable:"Chat is on",chatDisable:"Chat Disabled",assignEnable:"Transfer Controls",assignDisable:"Reclaim Role",editorRichDisable:"Disable Editor Rich",editorRichEnable:"Enable Editor Rich",editorCodeDisable:"Disable Editor Code",editorCodeEnable:"Enable Editor Code",audioEnable:"Audio On",audioDisable:"Audio Disabled.",audioOff:"Audio Off.",
audioOn:"Audio on",minCommonChat:"Hide Common Chat",maxCommonChat:"Show Common Chat",miniuserbox:"Hide User Box",maxuserbox:"Show User Box",miniUserList:"Show User List",maxUserList:"Hide User List",startnewsession:"Do you want start a new session with ending current session?",DevicesNotFoundError:"You may not have Webcam(camera/microphone).",PermissionDeniedError:"You denied to access your Webcam.",PERMISSION_DENIED:"You denied to access your Webcam(camera/microphone).",notSupportBrowser:"Firefox {virtualclass1} does not support Screen sharing.",
disableSpeaker:"Disable Audio",enableSpeaker:"Enable Audio",notSupportChrome:"Your browser {virtualclass1} {virtualclass2} needs to updated, We support Chrome 40",errcanvas:"canvas",errwebSocket:"Web Socket",errgetusermedia:"getUserMedia",errindexeddb:"indexedDb",errwebworker:"Web worker",errwebaudio:"Web audio",errtypedarray:"Typed array",errscreenshare:"Screen share",operaBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is partially supported. You will not be able to share your screen with Learners, We fully support chrome and Firefox",
commonBrowserIssue:"Your browser {virtualclass1} {virtualclass2} is not supported, We support Chrome and Firefox.",chFireBrowsersIssue:"Your browser {virtualclass1} {virtualclass2}  needs to updated, We support Chrome 40 and Firefox 35.",studentSafariBrowserIssue:"Your browser {virtualclass1} {virtualclass2} does not able to share your Cam with other users, We fully support Chrome  and Firefox.",ieBrowserIssue:"Your browser Internet Explorer is not supported, We fully support Chrome  and Firefox.",
ios7support:"We support only iOS 8 (Apple's operating system version 8) or higher.",supportDesktop:"For teacher we support desktop computer only not any tablet and mobile phone.",notSupportIphone:"We support iPad, Tablet or Desktop coputer, not any Mobile phone",InternalError:"It seems that you try to connect a single web cam from two different browsers on a single computer.<br /> This is not compaitible with different Operating System eg:- Windows, CentOS. ",SourceUnavailableError:"It seems that you try to connect a single web cam from two different browsers on a single computer.<br /> This is not supported for operating system like : Windows, CentOS.",
teacherSafariBrowserIssue:"Your browser Safari is not supporting for teacher, We fully support Chrome  and Firefox.",safariBrowserIssue:"Your browser Safari {virtualclass1} is not supported, We fully support Chrome  and Firefox",savesession:"Do you want to save a current Session ?",plswaitwhile:"Please wait a while....",downloadedFile:"Your files are downloading....,  <br />Number of file has been downloaded is {virtualclass1}",overallprogress:"Overall Progress",playsessionmsg:"Click play button to start playing session",
askplayMessage:'<span id="askplaymsg"> Should we start playing session?</span><br /><span id="remaingmsg">Remaining data could be downloaded in background.</span>',youTubeUrl:"I want youTube video URL.",shareYouTubeVideo:"Share YouTube Video",shareAnotherYouTubeVideo:"Share Another YouTube Video",editorCode:"Editor Code",editorRich:"Editor Rich",teachermayshow:"Teacher may show the YouTube video.",youtubeshare:"YouTube Video Share",writemode:"Write Mode.",readonlymode:"Read Only Mode."}})(window);(function(d){d.getString=function(b,c){var a=d.virtualclass.lang.message[b];if("undefined"!=typeof c&&0<c.length)for(var f=0;f<c.length;f++)a=a.replace(new RegExp("{virtualclass"+(f+1)+"}"),c[f]);return a}})(window);(function(d){var b={init:function(){this.msgBoxClass="msgBox";this.window={};this.virtualWindow={};return this},displayMessage:function(b,a,f,g,d){b="undefined"==typeof d?this.createMsgBox(b,a,f):this.createMsgBox(b,a,f,d);a=document.getElementById("vcanvas");"undefined"!=typeof g?document.getElementById(g).appendChild(b):a.insertBefore(b,a.childNodes[0])},createErrorMsg:function(b,a,f){var g=document.getElementById(a);null==g?(g=document.createElement("div"),g.id=a,g.innerHTML=b):g.innerHTML=b+"<br /> "+
g.innerHTML;b=document.getElementById(f);b.parentNode.insertBefore(g,b);return g.id},removeErrorMsg:function(b,a){var f=document.getElementById(b);if("undefined"!=typeof a){var g=f.innerHTML.split(/<br>|<br\\>/);if(1<g.length){g.shift();f.innerHTML=g.join();return}}f.parentNode.removeChild(f)},removeErrorContainer:function(b){b=document.getElementById(b);b.parentNode.removeChild(b)},customCreateElement:function(b,a,f){b=document.createElement(b);"undefined"!=typeof a&&(b.id=a);"undefined"!=typeof f&&
(b.className=f);return b},createMsgBox:function(b,a,f,g){var d=this.customCreateElement("div",a,f);"undefined"==typeof g&&(f=this.customCreateElement("div",a+"img",f+"img"),d.appendChild(f));a=this.customCreateElement("p",a+"Para");a.innerHTML=b;d.appendChild(a);return d},disappearBox:function(b){b=document.getElementsByClassName(this.msgBoxClass+b);null!=b[0]&&b[0].parentNode.removeChild(b[0])},multiMediaMsg:function(b){if("Firefox"==virtualclass.system.mybrowser.name){var a=virtualclass.lang.getString("wbrtcMsgFireFox");
this.displayMessage(a,"fireFoxWebrtcCont",this.msgBoxClass+b)}else"Chrome"==virtualclass.system.mybrowser.name&&(a=virtualclass.lang.getString("wbrtcMsgChrome"),this.displayMessage(a,"chormeWebrtcCont",this.msgBoxClass+b))},canvasDrawMsg:function(b){document.getElementById("vcanvas").className="canvasMsgBoxParent";if("Firefox"==virtualclass.system.mybrowser.name){var a=virtualclass.lang.getString("canvasDrawMsg");this.displayMessage(a,"canvasDrawMsgContFirefox",this.msgBoxClass+b,"containerWb")}else"Chrome"==
virtualclass.system.mybrowser.name&&(a=virtualclass.lang.getString("canvasDrawMsg"),this.displayMessage(a,"canvasDrawMsgContChrome",this.msgBoxClass+b,"containerWb"))},drawLabel:function(b){var a=virtualclass.lang.getString("drawArea");this.displayMessage(a,"canvasDrawArea",this.msgBoxClass+b,"containerWb",!1)},displayMsgBox:function(b,a){var f=this.customCreateElement("div",b),g=this.customCreateElement("p",b+"Para");g.innerHTML=virtualclass.lang.getString(a);f.appendChild(g);g=this.customCreateElement("a",
b+"Anchor");g.href=d.location;g.innerHTML=virtualclass.lang.getString("reload");g.onclick=function(){d.location.reload()};f.appendChild(g);g=document.getElementById("virtualclassCont");g.insertBefore(f,g.firstChild)},displayServerError:function(b,a){var f=this.customCreateElement("div",b);f.innerHTML=a;var g=document.getElementById("vcanvas");g.parentNode.insertBefore(f,g)},removeElement:function(b){b=document.getElementById(b);null!=b&&b.parentNode.removeChild(b)},disableSSUI:function(){var b=document.getElementById("virtualclassScreenShareTool");
null!=b&&(b.style.opacity="0.5",b.style.pointerEvents="none")},disableLeftAppBar:function(){var b=document.getElementById("virtualclassOptionsCont");null!=b&&(b.style.opacity="0.5",b.style.pointerEvents="none")}},b=b.init();count=0;b.window.resizeFinished=function(){var b=0;return function(a,f){clearTimeout(b);b=setTimeout(a,f)}}();b.window.resize=function(){var b=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});virtualclass.vutil.setContainerWidth(b,virtualclass.currApp);
vcan.renderAll()};b.virtualWindow.manupulation=function(b){var a=b.message.virtualWindow;if(a.hasOwnProperty("removeVirtualWindow"))b.fromUser.userid!=wbUser.id&&virtualclass.wb.utility.removeVirtualWindow("virtualWindow");else if(a.hasOwnProperty("createVirtualWindow"))a.hasOwnProperty("toolHeight")&&localStorage.setItem("toolHeight",a.toolHeight),b.fromUser.userid!=wbUser.id&&virtualclass.wb.utility.createVirtualWindow(a.createVirtualWindow);else if(a.hasOwnProperty("shareBrowserWidth")){a.hasOwnProperty("toolHeight")&&
localStorage.setItem("toolHeight",a.toolHeight);if(null!=localStorage.getItem("teacherId")){var f=virtualclass.wb.utility.getWideValueAppliedByCss("commandToolsWrapper");localStorage.setItem("toolHeight",f)}b.fromUser.userid!=wbUser.id?(null!=localStorage.getItem("teacherId")&&virtualclass.wb.utility.makeCanvasEnable(),otherBrowser=a.browserRes):myBrowser=virtualclass.system.measureResoultion({width:d.outerWidth,height:d.innerHeight});"object"==typeof myBrowser&&"object"==typeof otherBrowser&&(myBrowser.width>
otherBrowser.width?virtualclass.wb.gObj.virtualWindow||(virtualclass.wb.utility.createVirtualWindow(otherBrowser),virtualclass.wb.gObj.virtualWindow=!0):myBrowser.width<otherBrowser.width&&!virtualclass.wb.gObj.virtualWindow&&(b=document.getElementById("vcanvas"),b=virtualclass.wb.utility.getElementRightOffSet(b),null!=localStorage.getItem("teacherId")?virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-b,toolHeight:f}}):virtualclass.vutil.beforeSend({virtualWindow:{createVirtualWindow:myBrowser-
b}})))}};d.view=b})(window);(function(d){var b={init:function(){this.wbRtc={};this.wbRtc.className="webrtcCont";this.mybrowser={};return this},isCanvasSupport:function(b,a,f){return"MSIE"==a?9!=f?!1:!0:d.CanvasRenderingContext2D?!0:!1},isWebSocketSupport:function(b,a,f){return"undefined"==typeof d.WebSocket||"function"!=typeof d.WebSocket&&"object"!=typeof d.WebSocket||!d.WebSocket.hasOwnProperty("OPEN")?!1:!0},isLocalStorageSupport:function(){return void 0!==Storage},isGetUserMediaSupport:function(b,a){navigator.getUserMedia=
navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return navigator.getUserMedia?!0:!1},isIndexedDbSupport:function(){return d.indexedDB||d.webkitIndexedDB||d.mozIndexedDB||d.msIndexedDB?!0:!1},isWorkerSupport:function(){return!!d.Worker},isAudioApiSupport:function(){return d.AudioContext||d.webkitAudioContext?!0:!1},isTypedArraySupport:function(){return!!("ArrayBuffer"in d)},isScreenShareSupport:function(b,a){return"Firefox"==b?34<=a:"Chrome"==
b?39<=a?!0:!1:!1},setValue:function(b,a){this[b]=a},checkBrowserFunctions:function(b,a){this.setValue("canvas",this.isCanvasSupport());this.setValue("webSocket",this.isWebSocketSupport());this.setValue("getusermedia",this.isGetUserMediaSupport());this.setValue("indexeddb",this.isIndexedDbSupport());this.setValue("webworker",this.isWorkerSupport());this.setValue("webaudio",this.isAudioApiSupport());this.setValue("typedarray",this.isTypedArraySupport());this.setValue("screenshare",this.isScreenShareSupport(b,
a));this.setValue("localstorage",this.isLocalStorageSupport())},measureResoultion:function(b){var a=document.getElementById("virtualclassCont"),a=vcan.utility.getElementOffset(a),f=a.x;return{width:1024>b.width?1024-f:b.width-f,height:b.height-a.y}},setAppDimension:function(){var c=this.measureResoultion({width:d.innerWidth,height:d.innerHeight});virtualclass.vutil.setContainerWidth(c,virtualclass.currApp);"Whiteboard"==virtualclass.currApp&&b.setCanvasDimension(c)},setCanvasDimension:function(b){if("undefined"!=
typeof vcan.main.canvas){var a=vcan.main.canvas;ctx=vcan.main.canvas.getContext("2d");a.width=b.width;a.height=b.height-("t"==virtualclass.gObj.uRole?65:10);console.log("canvas width "+a.width);b=vcan.utility.getElementOffset(document.getElementById("canvas"));vcan.main.offset.x=b.x}},getResoultion:function(b){var a={};1280>b?(a.width=1024,a.height=768):1280<=b&&1366>b?(a.width=1280,a.height=1024):1366<=b&&1920>b?(a.width=1366,a.height=768):1920<=b&&(a.width=1920,a.height=1080);return a},reportBrowser:function(b){b=
this.getErrors(b);1<b.length?virtualclass.error.push(b.join(",")+" are disabled in your browser."):1==b.length&&virtualclass.error.push(b+" is disabled in your browser.")},getErrors:function(b){var a=[],f="canvas webSocket getusermedia webaudio indexeddb localstorage typedarray".split(" ");"t"==b&&f.push("webworker","screenshare");for(b=0;b<f.length;b++)this[f[b]]||("screenshare"==f[b]&&(virtualclass.gObj.errNotScreenShare=!0),a.push(virtualclass.lang.getString("err"+f[b])));return a},isiOSDevice:function(){return parseFloat((""+
(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1},isAndroid:function(){return-1<navigator.userAgent.toLowerCase().indexOf("android")},check:function(){var b=this.isiOSDevice();this.device="desktop";if(b){var a="iOS";this.device="mobTab"}else var f=this.isAndroid(),b=this.mybrowser.detection(),a=b[0],b=parseFloat(b[1]);this.mybrowser.name=a;this.mybrowser.version=b;this.checkBrowserFunctions(a,
b);"undefined"!=typeof f&&f?(this.device="mobTab","t"==virtualclass.gObj.uRole?(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push("We support only desktop computer not  any tablet and mobile for teacher.")):f&&("Chrome"==a?40<=b?virtualclass.vutil.initDisableAudVid():(virtualclass.error.push(a+" "+b+"  is not supported, we support chrome  versoin 40 or newer on Android"),virtualclass.vutil.initDisableVirtualClass()):(virtualclass.error.push(a+"  is not supported, we support Chrome 40 or newer on andorid"),
virtualclass.vutil.initDisableVirtualClass()))):"Chrome"==a&&40<=b||"Firefox"==a&&35<=b||"s"==virtualclass.gObj.uRole&&a=="OPR">b>=26?this.reportBrowser(virtualclass.gObj.uRole):"Chrome"==a&&40>b||"Firefox"==a&&35>b||"s"==virtualclass.gObj.uRole&&"OPR"==a&&26>b?(this.reportBrowser(virtualclass.gObj.uRole),virtualclass.error.push(virtualclass.lang.getString("chFireBrowsersIssue",[a,b]))):"OPR"==a&&26<=b?(this.reportBrowser(virtualclass.gObj.uRole),"t"==virtualclass.gObj.uRole&&virtualclass.error.push(virtualclass.lang.getString("operaBrowserIssue",
[a,b]))):"Safari"==a?8<=b?"t"==virtualclass.gObj.uRole?(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("teacherSafariBrowserIssue",[a,b]))):(virtualclass.vutil.initDisableAudVid(),virtualclass.error.push(virtualclass.lang.getString("studentSafariBrowserIssue",[a,b])),virtualclass.user.control.audioWidgetDisable()):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("safariBrowserIssue",[a,b]))):"iOS"==
a?/(iPad)/g.test(navigator.userAgent)?"s"==virtualclass.gObj.uRole?8<=b?(virtualclass.vutil.initDisableAudVid(),virtualclass.gObj.iosIpadbAudTrue=!1,a=document.createElement("div"),a.innerHTML="Tap here for enable the audio",a.id="iosAudioTrigger",a.addEventListener("click",function(){virtualclass.vutil.firstiOSaudioCall();this.parentNode.removeChild(this)}),f=document.getElementById("audioWidget"),f.parentNode.insertBefore(a,f.nextSibling)):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("ios7support"))):
(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("supportDesktop"))):(virtualclass.vutil.initDisableVirtualClass(),virtualclass.error.push(virtualclass.lang.getString("notSupportIphone"))):(this.mybrowser.detectIE()?(virtualclass.gObj.errIE=!0,virtualclass.error.push(virtualclass.lang.getString("ieBrowserIssue"))):virtualclass.error.push(virtualclass.lang.getString("commonBrowserIssue",[a,b])),virtualclass.vutil.initDisableVirtualClass())}},b=b.init();
d.addEventListener("resize",function(){d.earlierWidth!=d.innerWidth&&b.setAppDimension()});d.addEventListener("resize",function(){d.earlierWidth!=d.innerWidth&&virtualclass.view.window.resize()});b.mybrowser.detectIE=function(){var b=d.navigator.userAgent,a=b.indexOf("MSIE ");if(0<a)return parseInt(b.substring(a+5,b.indexOf(".",a)),10);if(0<b.indexOf("Trident/"))return a=b.indexOf("rv:"),parseInt(b.substring(a+3,b.indexOf(".",a)),10);a=b.indexOf("Edge/");return 0<a?parseInt(b.substring(a+5,b.indexOf(".",
a)),10):!1};b.mybrowser.detection=function(){var b=navigator.userAgent,a,f=b.match(/(opera|opr|OPR(?=\/))\/?\s*([\d\.]+)/i)||[];if(0>=f.length&&(f=b.match(/(chrome|safari|firefox|trident(?=\/))\/?\s*([\d\.]+)/i)||[],"Safari"==f[1])){var g=b.match(/(version(?=\/))\/?\s*([\d\.]+)/i)||[];f[2]=g[2]}if(/trident/i.test(f[1]))return a=/\brv[ :]+(\d+(\.\d+)?)/g.exec(b)||[],"IE "+(a[1]||"");f=f[2]?[f[1],f[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(a=b.match(/version\/([\.\d]+)/i))&&(f[2]=a[1]);
return f};d.system=b})(window);(function(d){d.packContainer=function(){return{createPacketContDiv:function(b,c){var a=document.createElement("div");"undefined"!=typeof b&&(a.id=b);"undefined"!=typeof c&&(a.clasName=c);return a},togglePacketCont:function(b){for(var c=this.className.split(" "),a=0;a<c.length;a++)if("display"==c[a]){this.className="hide";this.innerHTML="+";b._togglePacketCont(c[a]);break}else if("hide"==c[a]){this.className="display";this.innerHTML="-";b._togglePacketCont(c[a]);break}},_togglePacketCont:function(b){b=
"display"==b?"none":"block";document.getElementById("dataInfoHeading").style.display=b;var c=document.getElementById("packetContainer");c.style.display=b;c=document.getElementById("informationCont");c.style.display=b},createPacketContainer:function(){var b=document.getElementById("packetContainer"),c=document.createElement("h4");c.id="dataInfoHeading";c.innerHTML=virtualclass.lang.getString("dataDetails");var a=document.createElement("div");a.id="toggleContainer";a.className="display";var f=this;
a.addEventListener("click",function(){f.togglePacketCont.call(this,f)});a.innerHTML="-";var g=document.getElementById("mainContainer");g.insertBefore(a,g.firstChild);g.insertBefore(c,b);c=this.createPacketContDiv("dataInformation");b.appendChild(c);a=this.createPacketContDiv("blankDiv");a.innerHTML="&nbsp;<br/>&nbsp;";c.appendChild(a);a=this.createPacketContDiv("perSecData");a.innerHTML=virtualclass.lang.getString("perSecond");c.appendChild(a);a=this.createPacketContDiv("totalDataLabel");a.innerHTML=
virtualclass.lang.getString("total");c.appendChild(a);a=this.createPacketContDiv("sendPackCont");b.appendChild(a);c=this.createPacketContDiv("sentPacketsLabel");c.innerHTML=virtualclass.lang.getString("sentPackets");a.appendChild(c);g=this.createPacketContDiv("sendPackPsCont");a.appendChild(g);c=this.createPacketContDiv(this.sentPackDivPS,"numbers");c.innerHTML=0;g.appendChild(c);g=this.createPacketContDiv("totSendPackCont");a.appendChild(g);c=this.createPacketContDiv(this.sentPackDiv,"numbers");
c.innerHTML=0;g.appendChild(c);a=this.createPacketContDiv("receivePackCont");b.appendChild(a);b=this.createPacketContDiv("receivedPacketsLabel");b.innerHTML=virtualclass.lang.getString("receviedPackets");a.appendChild(b);b=this.createPacketContDiv("receivePackPsCont");a.appendChild(b);c=this.createPacketContDiv(this.receivedPackDivPS,"numbers");c.innerHTML=0;b.appendChild(c);b=this.createPacketContDiv("totReceivedPackCont");a.appendChild(b);c=this.createPacketContDiv(this.receivedPackDiv,"numbers");
c.innerHTML=0;b.appendChild(c)},createPacketInfoContainer:function(){var b=document.getElementById("informationCont");label=document.createElement("label");label.innerHTML=virtualclass.lang.getString("sentMessageInfo");var c=this.createPacketContDiv("sentMsgInfoContainer");c.appendChild(label);var a=this.createPacketContDiv("sentMsgInfo");c.appendChild(a);b.appendChild(c);c=this.createPacketContDiv("receivedMsgInfoContainer");label=document.createElement("label");label.innerHTML=virtualclass.lang.getString("receivedMessageInfo");
c.appendChild(label);a=this.createPacketContDiv("rcvdMsgInfo");c.appendChild(a);b.appendChild(c)}}}})(window);(function(d){d.draw_object=function(b,c,a){var f=this;a.started=!1;var g,d,h=[];a.mousedown=function(c,g){(new Date).getTime();c.detail.hasOwnProperty("cevent")&&(c.clientX=c.detail.cevent.x+f.vcan.main.offset.x,c.clientY=c.detail.cevent.y+f.vcan.main.offset.y,c.x=c.detail.cevent.x+f.vcan.main.offset.x,c.y=c.detail.cevent.x+f.vcan.main.offset.y,c.pageX=c.detail.cevent.x+f.vcan.main.offset.x,c.pageY=c.detail.cevent.y+f.vcan.main.offset.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);var h=f.vcan;
lastmousemovetime=null;a.startPosX=c.currX;a.startPosY=c.currY;virtualclass.wb.gObj.spx=a.startPosX;virtualclass.wb.gObj.spy=a.startPosY;if("create"==h.getStates("action")){var d=(new Date).getTime();if("text"!=b&&"t_clearall"!=f.tool.cmd){var m=h.getStates("currentTransform");if(""==m||null==m)c.detail.hasOwnProperty("cevent")||h.optimize.calculatePackets(d,"d",a.startPosX,a.startPosY),a.started=!0}else f.obj.drawTextObj.muser=!1,c.detail.hasOwnProperty("cevent")||"t_clearall"==f.tool.cmd?f.obj.drawTextObj.muser=
!0:f.utility.clickOutSidebox(f.obj.drawTextObj.textWriteMode)&&h.optimize.calculatePackets(d,"d",a.startPosX,a.startPosY),c.detail.hasOwnProperty("cevent")?c.detail.cevent.hasOwnProperty("mtext")?f.obj.drawTextObj.textUtility(a.startPosX,a.startPosY,c.detail.cevent.mtext):f.obj.drawTextObj.textUtility(a.startPosX,a.startPosY):"object"==typeof f.obj.drawTextObj&&f.obj.drawTextObj.textUtility(a.startPosX,a.startPosY)}"freeDrawing"==b&&!0==f.obj.freeDrawObj.freesvg&&f.obj.freeDrawObj.drawStart(c)};a.mousemove=
function(c,r){c.detail.hasOwnProperty("cevent")&&(c.clientX=c.detail.cevent.x+f.vcan.main.offset.x,c.clientY=c.detail.cevent.y+f.vcan.main.offset.y,c.x=c.detail.cevent.x+f.vcan.main.offset.x,c.y=c.detail.cevent.x+f.vcan.main.offset.y,c.pageX=c.detail.cevent.x+f.vcan.main.offset.x,c.pageY=c.detail.cevent.y+f.vcan.main.offset.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);if(a.started&&"t_clearall"!=f.tool.cmd)if(void 0!=f.obj.freeDrawObj&&!0==f.obj.freeDrawObj.freesvg){if(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&
(f.obj.freeDrawObj.wb_draw(c),!c.detail.hasOwnProperty("cevent"))){"undefined"!=typeof r||"undefined"!=typeof lastmousemovetime&&null!=lastmousemovetime||(lastmousemovetime=(new Date).getTime(),vcan.optimize.calculatePackets(lastmousemovetime,"m",c.currX,c.currY));var q=(new Date).getTime(),q=vcan.makeStackObj(q,"m",c.currX,c.currY);h.push(q);if("undefined"==typeof r&&(presentmousemovetime=(new Date).getTime(),2E3<=presentmousemovetime-lastmousemovetime)){for(q=0;q<h.length;q++)f.uid++,h[q].uid=f.uid,
vcan.main.replayObjs.push(h[q]);virtualclass.vutil.beforeSend({repObj:h});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));f.utility.updateSentPackets(h);h=[];lastmousemovetime=(new Date).getTime()}}}else{g=c.currX;d=c.currY;""!=f.prvObj&&f.canvas.removeObject(f.prvObj);var q=f.makeobj(a.startPosX,a.startPosY,g,d,b),t=f.canvas.readyObject(q);f.canvas.addObject(t);t.coreObj.usrCurrAction="create";q=(new Date).getTime();if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=
(new Date).getTime(),c.detail.hasOwnProperty("cevent")||"text"==b||"t_clearall"==f.tool.cmd||vcan.optimize.calculatePackets(q,"m",g,d);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&(c.detail.hasOwnProperty("cevent")||"text"==b||"t_clearall"==f.tool.cmd||vcan.optimize.calculatePackets(q,"m",g,d),lastmousemovetime=(new Date).getTime());f.prvObj=t.coreObj}else"move"==f.vcan.main.action&&(""!=vcan.main.currentTransform&&null!=vcan.main.currentTransform||"move"!=
f.vcan.main.action)||virtualclass.vutil.beforeSend({createArrow:!0,x:c.currX,y:c.currY})};a.mouseup=function(c,r){c.detail.hasOwnProperty("cevent")&&(c.clientX=c.detail.cevent.x+f.vcan.main.offset.x,c.clientY=c.detail.cevent.y+f.vcan.main.offset.y,c.x=c.detail.cevent.x+f.vcan.main.offset.x,c.y=c.detail.cevent.x+f.vcan.main.offset.y,c.pageX=c.detail.cevent.x+f.vcan.main.offset.x,c.pageY=c.detail.cevent.y+f.vcan.main.offset.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);g=c.currX;d=c.currY;
lastmousemovetime=null;if(a.started&&"text"!=b){a.mousemove(c,"up");if(!c.detail.hasOwnProperty("cevent")&&"freeDrawing"!=b){var q=(new Date).getTime();vcan.optimize.calculatePackets(q,"u",g,d)}if(void 0!=f.obj.freeDrawObj&&!0==f.obj.freeDrawObj.freesvg&&(f.obj.freeDrawObj.fdObj.isCurrentlyDrawing&&f.obj.freeDrawObj.finalizeDraw(c),!c.detail.hasOwnProperty("cevent")&&0<h.length)){q=(new Date).getTime();q=vcan.makeStackObj(q,"u",g,d);h.push(q);for(q=0;q<h.length;q++)f.uid++,h[q].uid=f.uid,vcan.main.replayObjs.push(h[q]);
virtualclass.vutil.beforeSend({repObj:h});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));f.utility.updateSentPackets(h);h=[]}""!=f.prvObj&&(f.prvObj="");f.prvObj="";a.started=!1}f.vcan.wb.sentPack&&(f.vcan.wb.sentPack=!1)}}})(window);(function(d){d.makeobj=function(b,c,a,f,g){var d={mp:{}};d.mp.x=a;d.mp.y=f;if(b>a){var h=a,n=f;a=b;f=c;b=h;c=n;d.dRoad="b2t"}else d.dRoad="t2b";d.type=g;if("rectangle"==g||"triangle"==g)d.sx=b,d.sy=c,d.ex=a,d.ey=f;if("line"==g)d.lineColor="#424240",d.lineWidth=3,d.start={x:b,y:c},d.end={x:a,y:f};else if("rectangle"==g)d.width=a-b,d.height=f-c,d.borderColor="#424240",d.lineWidth=3;else if("oval"==g)d.lineWidth=3,d.borderColor="#424240",d.width=a-b,d.height=f-c,d.x=a-d.width/2,d.y=f-d.height/2,d.rx=
d.width/2,d.ry=d.height/2;else if("triangle"==g)d.lineWidth=3,d.borderColor="#424240";else if("text"==g)return;return d}})(window);(function(d){var b=d.vcan;b.utility={canvasCalcOffset:function(c){var a=b.main;c=document.getElementById(c);c=b.utility.getElementOffset(c);return a.offset=c},getElementOffset:function(b){console.log(b.id+" should second ");var a=0,f=0;do a+=b.offsetTop||0,f+=b.offsetLeft||0,b=b.offsetParent;while(b);return{x:f,y:a}},setVal:function(c,a,f){("scaleX"===a||"scaleY"===a)&&f<c.MIN_SCALE_LIMIT&&(f=c.MIN_SCALE_LIMIT);if("object"==typeof a)for(var g in a)b.utility.setVal(c,g,a[g]);else"angle"===a?b.utility.setAngle(c,
f):c[a]=f;return c},getVal:function(b,a){return b[a]},setAngle:function(b,a){b.theta=a/180*Math.PI;b.angle=a;return b},actualPointer:function(c){return{x:b.utility.pointerX(c),y:b.utility.pointerY(c)}},pointerX:function(b){var a=document.documentElement,f=document.body||{scrollLeft:0};return b.pageX||("unknown"!=typeof b.clientX?b.clientX:0)+(a.scrollLeft||f.scrollLeft)-(a.clientLeft||0)},pointerY:function(b){var a=document.documentElement,f=document.body||{scrollTop:0};return b.pageY||("unknown"!=
typeof b.clientY?b.clientY:0)+(a.scrollTop||f.scrollTop)-(a.clientTop||0)},getReltivePoint:function(c){var a=b.main.offset;c=b.utility.actualPointer(c);return{x:c.x-a.x,y:c.y-a.y}},degreesToRadians:function(b){return Math.PI/180*b},setActiveObject:function(c){b.main.activeObject&&b.main.activeObject.setActive(!1);b.main.activeObject=c;c.setActive(!0);return c},updateObj:function(b){var a={};for(prop in b)"oCoords"!=prop?a[prop]=b[prop]:(a.start={},a.end={},a.start.x=b[prop].tl.x,a.start.y=b[prop].tl.y,
a.end.x=b[prop].br.x,a.end.y=b[prop].br.y);return a},setCursorFromEvent:function(b,a,f){var g=b.upperCanvasEl.style;if(f)if(a=f.findTargetCorner(a))if(a in b.cursorMap)g.cursor=b.cursorMap[a];else if("mtr"===a&&f.hasRotatingPoint)g.cursor=b.rotationCursor;else return g.cursor=this.defaulCursor,!1;else g.cursor=b.hoverCursor;else return g.cursor=this.defaultCursor,!1;return!0},getChildren:function(){return b.main.children}}})(window);(function(d){var b=d.vcan;b.main.prototype={addObject:function(c){if("object"==typeof c.coreObj){"freehand"!=c.coreObj.type&&b.main.children.push(c.coreObj);var a=b.main.canvas.getContext("2d");b.render(a,c.coreObj)}},removeObject:function(c){b.remove(c)},bind:function(c,a){b.events().bind(b.main.canvas,c,a)},readyObject:function(c,a){c=b.extend({},c);a||void 0!=c.id||(b.main.id++,c.id=b.main.id);c.cornersize=12;c.rotatingPointOffset=40;c.selectable=!0;c.downObj=!1;c.active=!1;c.cornersize=12;c.padding=
0;c.hasControls=!0;c.cornerColor="rgba(102,153,255,0.5)";void 0==c.borderColor&&(c.borderColor="#000");c.flipX=!1;c.flipY=!1;c.draggable=!1;c.hasBorders=!0;c.hasRotatingPoint=!1;c.hideCorners=!1;c.lockRotation=!1;c.MIN_SCALE_LIMIT=.1;c.borderOpacityWhenMoving=.4;c.hasOwnProperty("theta")||(c.theta=0);c.hasOwnProperty("scaleX")||(c.scaleX=1);c.hasOwnProperty("scaleY")||(c.scaleY=1);"line"==c.type?(b.objLine=new b.line,b.objLine.init(c)):"rectangle"==c.type?(b.objRect=new b.rectangle,b.objRect.init(c)):
"oval"==c.type?(b.objOval=new b.oval,b.objOval.init(c)):"triangle"==c.type?(b.objTri=new b.triangle,b.objTri.init(c)):"text"==c.type&&(b.objTxt=new b.text,b.objTxt.init(c));c.getWidth=function(){return this.width*this.scaleX};c.getHeight=function(){return this.height*this.scaleY};c.setCoords=function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this.hypotenuse=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2));this.angle=Math.atan(this.currentHeight/
this.currentWidth);this.theta=this.theta;var a=Math.cos(this.angle+this.theta)*this.hypotenuse,g=Math.sin(this.angle+this.theta)*this.hypotenuse,d=this.theta,h=Math.sin(d),d=Math.cos(d),a={x:this.x-a,y:this.y-g},g={x:a.x+this.currentWidth*d,y:a.y+this.currentWidth*h},n={x:a.x-this.currentHeight*h,y:a.y+this.currentHeight*d};this.oCoords={tl:a,tr:g,br:{x:g.x-this.currentHeight*h,y:g.y+this.currentHeight*d},bl:n,ml:{x:a.x-this.currentHeight/2*h,y:a.y+this.currentHeight/2*d},mt:{x:a.x+this.currentWidth/
2*d,y:a.y+this.currentWidth/2*h},mr:{x:g.x-this.currentHeight/2*h,y:g.y+this.currentHeight/2*d},mb:{x:n.x+this.currentWidth/2*d,y:n.y+this.currentWidth/2*h},mtr:{x:a.x+this.currentWidth/2*d,y:a.y+this.currentWidth/2*h}};this.setCornerCoords();c.findTargetCorner=function(a){var f=b.main.offset;if(!this.hasControls)return!1;var g=b.utility.actualPointer(a);a=g.x-f.x;var f=g.y-f.y,h;for(h in this.oCoords){if("mtr"===h&&!this.hasRotatingPoint)break;g=b.virtual_box.getImageLines(this.oCoords[h].corner,
h);g=b.virtual_box.findCrossPoints(a,f,g);if(1==g%2&&0!=g)return c.corner=h}return!1};return this};c.drawBorders=function(b){if(this.hasBorders){var a=this.padding,c=2*a;b.save();b.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;b.strokeStyle=this.borderColor;var h=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX),n=1/(this.scaleY<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);b.lineWidth=1/this.borderScaleFactor;b.scale(h,n);h=this.getWidth();n=this.getHeight();
b.strokeRect(~~(-(h/2)-a)+.5,~~(-(n/2)-a)+.5,~~(h+c),~~(n+c));!this.hasRotatingPoint||this.hideCorners||this.lockRotation||(a=(this.flipY?n:-n)/2,b.beginPath(),b.moveTo(0,a),b.lineTo(0,a+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),b.closePath(),b.stroke());b.restore();return this}};c.drawCorners=function(b){if(this.hasControls){var a=this.cornersize,c=a/2,h=this.padding,n=-(this.width/2),d=-(this.height/2),q=a/this.scaleX,t=a/this.scaleY,x=(h+c)/this.scaleY,z=(h+c)/this.scaleX,
v=(h+c-a)/this.scaleX,c=(h+c-a)/this.scaleY,h=this.height;b.save();b.fillStyle=this.cornerColor;b.fillRect(n-z,d-x,q,t);a=n+this.width-z;b.fillRect(a,d-x,q,t);b.fillRect(n-z,d+h+c,q,t);a=n+this.width+v;b.fillRect(a,d+h+c,q,t);a=n+this.width/2-z;b.fillRect(a,d-x,q,t);a=n+this.width/2-z;b.fillRect(a,d+h+c,q,t);a=n+this.width+v;b.fillRect(a,d+h/2-x,q,t);b.fillRect(n-z,d+h/2-x,q,t);this.hasRotatingPoint&&(a=n+this.width/2-z,n=this.flipY?d+h+this.rotatingPointOffset/this.scaleY-t/2:d-this.rotatingPointOffset/
this.scaleY-t/2,b.fillRect(a,n,q,t));b.restore();return this}};c.setActive=function(b){this.active=!!b;return this};c.dragDrop=function(b){this.draggable=void 0!=b?b:!1};c.setCornerCoords=function(){var a=this.oCoords,c=b.utility.degreesToRadians(45-this.getAngle()),d=Math.sqrt(2*Math.pow(this.cornersize,2))/2,h=d*Math.cos(c),c=d*Math.sin(c),d=Math.sin(this.theta),n=Math.cos(this.theta);a.tl.corner={tl:{x:a.tl.x-c,y:a.tl.y-h},tr:{x:a.tl.x+h,y:a.tl.y-c},bl:{x:a.tl.x-h,y:a.tl.y+c},br:{x:a.tl.x+c,y:a.tl.y+
h}};a.tr.corner={tl:{x:a.tr.x-c,y:a.tr.y-h},tr:{x:a.tr.x+h,y:a.tr.y-c},br:{x:a.tr.x+c,y:a.tr.y+h},bl:{x:a.tr.x-h,y:a.tr.y+c}};a.bl.corner={tl:{x:a.bl.x-c,y:a.bl.y-h},bl:{x:a.bl.x-h,y:a.bl.y+c},br:{x:a.bl.x+c,y:a.bl.y+h},tr:{x:a.bl.x+h,y:a.bl.y-c}};a.br.corner={tr:{x:a.br.x+h,y:a.br.y-c},bl:{x:a.br.x-h,y:a.br.y+c},br:{x:a.br.x+c,y:a.br.y+h},tl:{x:a.br.x-c,y:a.br.y-h}};a.ml.corner={tl:{x:a.ml.x-c,y:a.ml.y-h},tr:{x:a.ml.x+h,y:a.ml.y-c},bl:{x:a.ml.x-h,y:a.ml.y+c},br:{x:a.ml.x+c,y:a.ml.y+h}};a.mt.corner=
{tl:{x:a.mt.x-c,y:a.mt.y-h},tr:{x:a.mt.x+h,y:a.mt.y-c},bl:{x:a.mt.x-h,y:a.mt.y+c},br:{x:a.mt.x+c,y:a.mt.y+h}};a.mr.corner={tl:{x:a.mr.x-c,y:a.mr.y-h},tr:{x:a.mr.x+h,y:a.mr.y-c},bl:{x:a.mr.x-h,y:a.mr.y+c},br:{x:a.mr.x+c,y:a.mr.y+h}};a.mb.corner={tl:{x:a.mb.x-c,y:a.mb.y-h},tr:{x:a.mb.x+h,y:a.mb.y-c},bl:{x:a.mb.x-h,y:a.mb.y+c},br:{x:a.mb.x+c,y:a.mb.y+h}};a.mtr.corner={tl:{x:a.mtr.x-c+d*this.rotatingPointOffset,y:a.mtr.y-h-n*this.rotatingPointOffset},tr:{x:a.mtr.x+h+d*this.rotatingPointOffset,y:a.mtr.y-
c-n*this.rotatingPointOffset},bl:{x:a.mtr.x-h+d*this.rotatingPointOffset,y:a.mtr.y+c-n*this.rotatingPointOffset},br:{x:a.mtr.x+c+d*this.rotatingPointOffset,y:a.mtr.y+h-n*this.rotatingPointOffset}}};c.getAngle=function(){return 180*this.theta/Math.PI};c.setZindex=function(){for(var a=0;a<b.main.children.length;a++)if(this.id==b.main.children[a].id){var c=b.main.children[a];b.main.children.splice(a,1);break}return" "!=c?(b.main.children.push(c),!0):!1};c.setupCurrentTransform=function(a){var c=b.main,
d="drag",h=b.utility.actualPointer(a);if(a=this.findTargetCorner(a))d="ml"===a||"mr"===a?"scaleX":"mt"===a||"mb"===a?"scaleY":"mtr"===a?"rotate":this.hasRotatingPoint?"scale":"rotate";c.currentTransform={target:this,action:d,scaleX:this.scaleX,scaleY:this.scaleY,offsetX:h.x-this.x,offsetY:h.y-this.y,ex:h.x,ey:h.y,x:this.x,y:this.y,theta:this.theta,width:this.width*this.scaleX};c.currentTransform.original={x:this.x,y:this.y}};"text"!=c.type&&c.setCoords();return b.makeDispObject(c)}}})(window);(function(d){var b=d.vcan;b.events=function(){return{bind:function(b,a,f){b["on"+a]=f},findTarget:function(c){for(var a,f=b.main.children,g=f.length;g--;)if(f[g]&&b.virtual_box.containsPoint(c,f[g])){a=f[g];break}if(a&&a.selectable)return a}}}})(window);(function(d){var b=d.vcan;b.virtual_box={findCrossPoints:function(b,a,f){var g,d,h,n=0,r;for(r in f)if(h=f[r],!(h.o.y<a&&h.d.y<a||h.o.y>=a&&h.d.y>=a)&&(h.o.x==h.d.x&&h.o.x>=b?g=h.o.x:(g=(h.d.y-h.o.y)/(h.d.x-h.o.x),d=a-0*b,h=h.o.y-g*h.o.x,g=-(d-h)/(0-g)),g>=b&&(n+=1),2==n))break;return n},getImageLines:function(b,a){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},containsPoint:function(c,a){var f=b.utility.getReltivePoint(c),g=f.x,f=f.y,
d=b.virtual_box.getImageLines(a.oCoords);return(g=b.virtual_box.findCrossPoints(g,f,d))&&1===g%2||a.findTargetCorner(c)?!0:!1}}})(window);(function(d){var b=d.vcan;b.interact={rotateObject:function(c,a){var f=b.main.currentTransform,g=b.main.offset;if(!f.target.lockRotation){var d=Math.atan2(f.ey-f.y-g.y,f.ex-f.x-g.x),g=Math.atan2(a-f.y-g.y,c-f.x-g.x);b.utility.setVal(f.target,"theta",g-d+f.theta)}},scaleObject:function(c,a,f){var g=b.main.currentTransform,d=b.main.offset;target=g.target;if(!target.lockScalingX||!target.lockScalingY){var h=Math.sqrt(Math.pow(g.ey-g.y-d.y,2)+Math.pow(g.ex-g.x-d.x,2));c=Math.sqrt(Math.pow(a-g.y-d.y,2)+
Math.pow(c-g.x-d.x,2));target.scaling=!0;f?"x"!==f||target.lockUniScaling?"y"!==f||target.lockUniScaling||target.lockScalingY||b.utility.setVal(target,"scaleY",g.scaleY*c/h):target.lockScalingX||b.utility.setVal(target,"scaleX",g.scaleX*c/h):(target.lockScalingX||b.utility.setVal(target,"scaleX",g.scaleX*c/h),target.lockScalingY||b.utility.setVal(target,"scaleY",g.scaleY*c/h))}},translateObject:function(c,a){var f=b.main.currentTransform.target;f.lockMovementX||b.utility.setVal(f,"x",c-b.main.currentTransform.offsetX);
f.lockMovementY||b.utility.setVal(f,"y",a-b.main.currentTransform.offsetY);return f}}})(window);(function(d){d.vcan.rectangle=function(){return{type:"rectangle",init:function(b){void 0==b.x&&(b.x=b.ex-b.width/2);void 0==b.y&&(b.y=b.ey-b.height/2);return b},draw:function(b,c,a){a=-c.width/2;var f=-c.height/2,g=c.width,d=c.height;b.beginPath();b.strokeStyle=void 0!=c.borderColor?'"'+c.strokeColor+'"':"#000";b.moveTo(a,f);b.stroke();b.lineTo(a+g,f);b.stroke();b.lineTo(a+g,f+d);b.stroke();b.lineTo(a,f+d);b.stroke();b.lineTo(a,f);b.fillStyle=void 0!=c.fillColor?c.fillColor:" ";b.closePath();b.stroke();
void 0!=c.fillColor&&(b.fillStyle=c.fillColor,b.fill())}}}})(window);(function(d){d.vcan.oval=function(){return{type:"oval",init:function(b){void 0==b.width&&(b.width=2*b.rx);void 0==b.height&&(b.height=2*b.ry);void 0==b.borderColor&&(b.borderColor="#000000");void 0!=b.fillColor&&(b.fillStyle=b.fillColor);return b},draw:function(b,c,a){b.beginPath();b.save();var f=2*Math.PI;b.lineWidth=c.lineWidth;var g=c.ry/c.rx,g=g.toFixed(3);0==g&&(g=.01);b.transform(1,0,0,g,0,0);b.arc(a?c.x:0,a?c.y:0,c.rx,0,f,!1);b.closePath();void 0!=c.fillStyle&&(b.fillStyle=c.fillStyle,b.fill());
void 0!=c.borderColor&&(b.fillStyle=c.borderColor,b.stroke());b.restore()}}}})(window);(function(d){d.vcan.triangle=function(){return{type:"triangle",init:function(b){b.fillStyle=b.fillColor;void 0==b.dRoad&&(b.dRoad="ltr");void 0==b.width&&(b.width=b.ex-b.sx);void 0==b.height&&(b.height=b.ey-b.sy);void 0==b.x&&(b.x=b.ex-b.width/2);void 0==b.y&&(b.y=b.ey-b.height/2);return b},draw:function(b,c,a){b.beginPath();if("t2b"==c.dRoad){a=c.width/2;var f=c.height/2}else a=-c.width/2,f=-c.height/2;b.lineWidth=c.lineWidth;void 0!=c.borderColor&&(b.strokeStyle=c.borderColor);b.moveTo(-a,f);b.lineTo(0,
-f);b.lineTo(a,f);b.closePath();void 0!=c.fillStyle&&(b.fillStyle=c.fillStyle,b.fill());b.stroke()}}}})(window);(function(d){d.vcan.line=function(){return{type:"line",init:function(b){var c=b.start.x,a=b.start.y,f=b.end.x,g=b.end.y;void 0==b.width&&(b.width=f-c,b.height=g-a);b.x=c+(f-c)/2;b.y=a+(g-a)/2;return b},draw:function(b,c,a){b.beginPath();a=1===c.width?0:c.width/2;var f=1===c.height?0:c.height/2;b.moveTo(1===c.width?0:-c.width/2,1===c.height?0:-c.height/2);b.lineTo(a,f);b.lineWidth=c.lineWidth;void 0!=c.lineColor&&(b.strokeStyle=c.lineColor);b.closePath();b.stroke()}}}})(window);(function(d){d.vcan.text=function(){return{type:"text",init:function(b){b.lineHeight=1.3;void 0==b.fontSize&&(b.fontSize=30);b.font=b.fontSize+"px Times New Roman";return b},draw:function(b,c,a){b.font=c.font;a=c.text.split(/\r?\n/);c.height=this.getTextHeight(b,a,c);c.width=this.getTextWidth(b,a);b.beginPath();for(var f=0,g=a.length;f<g;f++)b.fillText(a[f],-c.width/2,-c.height/2+f*c.fontSize*c.lineHeight+c.fontSize);b.closePath();c.setCoords()},getTextWidth:function(b,c){for(var a=b.measureText(c[0]).width,
f=1,g=c.length;f<g;f++){var d=b.measureText(c[f]).width;d>a&&(a=d)}return a},getTextHeight:function(b,c,a){return a.fontSize*c.length*a.lineHeight},removeTextNode:function(){for(var b=document.getElementsByClassName("textBoxContainer"),c=0;c<b.length;c++)b[c].parentNode.removeChild(b[c])}}}})(window);(function(d){var b=d.vcan;b.main.freeHandDrawing=function(c){return{type:"freeDrawing",init:function(){this.contextTop={};this.isCurrentlyDrawing=!1;this.freeDrawingXPoints=[];this.freeDrawingYPoints=[];this.mdTime=[];this.freeDrawingColor=void 0==c.borderColor?"#000000":c.borderColor;this.freeDrawingLineWidth=void 0!=c.lineWidth?c.lineWidth:"3";return this},fhdStart:function(a,b,c){c=(new Date).getTime();this.contextTop=a;this.isCurrentlyDrawing=!0;this.freeDrawingXPoints.push(b.x);this.freeDrawingYPoints.push(b.y);
this.contextTop.beginPath();this.contextTop.save();this.contextTop.moveTo(b.x,b.y);this.mdTime.push(c);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=this.contextTop.lineJoin="round"},fhRendering:function(a,b){var c=(new Date).getTime();this.freeDrawingXPoints.push(a.x);this.freeDrawingYPoints.push(a.y);this.contextTop.lineTo(a.x,a.y);this.contextTop.stroke();this.mdTime.push(c)},finalizeDrawingPath:function(a,f,g){(new Date).getTime();
this.contextTop.closePath();this.isCurrentlyDrawing=!1;var d=this.utility.min(this.freeDrawingXPoints);f=this.utility.min(this.freeDrawingYPoints);var h=this.utility.max(this.freeDrawingXPoints);g=this.utility.max(this.freeDrawingYPoints);var n=[],r,q,t,x=this.freeDrawingXPoints,z=this.freeDrawingYPoints,v=this.mdTime;n.push("M ",x[0]-d," ",z[0]-f," ",v[0]," ");for(var u=1;r=x[u],q=z[u],t=v[u];u++)n.push("L ",r-d," ",q-f," ",t," ");n=n.join("");if("M 0 0 L 0 0 "!==n)return r=this.freeDrawingXPoints[this.freeDrawingXPoints.length-
1],q=this.freeDrawingYPoints[this.freeDrawingYPoints.length-1],t=new b.Path(n,this),t.mp={},t.mp.x=r,t.mp.y=q,t.init(n),t=a.readyObject(t),t.coreObj.type="freeDrawing",t=t.coreObj,t.fill=null,t.stroke=this.freeDrawingColor,t.strokeWidth=this.freeDrawingLineWidth,t.minX=d,t.minY=f,this.utility.objAdd(t),a=b.utility.setVal(t,"x",d+(h-d)/2),a=b.utility.setVal(a,"y",f+(g-f)/2),a.setCoords(),"object"==typeof c&&this.contextTop.restore(),b.renderAll(this.contextTop),a},utility:{max:function(a,b){if(a&&
0!==a.length){var c=a.length-1,d=b?a[c][b]:a[c];if(b)for(;c--;)a[c][b]>=d&&(d=a[c][b]);else for(;c--;)a[c]>=d&&(d=a[c]);return d}},min:function(b,c){if(b&&0!==b.length){var g=b.length-1,d=c?b[g][c]:b[g];if(c)for(;g--;)b[g][c]<d&&(d=b[g][c]);else for(;g--;)b[g]<d&&(d=b[g]);return d}},objAdd:function(a){b.main.children.push(a);return this}}}}})(window);(function(d){var b=d.vcan;b.Path=function(c,a){return{objectType:"path",init:function(b,a){a=a||{};this.commandLengths={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};if(!b)throw Error("`path` argument is required");if(this.path=b.match&&b.match(/[a-zA-Z][^a-zA-Z]*/g))return this.initializeFromArray(a),this},initializeFromArray:function(b){var a="width"in b,c="height"in b;this.path=this._parsePath();a&&c||(this.utility.extend(this,this._parseDimensions()),a&&(this.width=b.width),c&&(this.height=b.height))},
_render:function(b){var a,c=0;a=0;for(var h=-(this.width/2),d=-(this.height/2),r=0,q=this.path.length;r<q;++r)switch(a=this.path[r],a[0]){case "L":c=a[1];a=a[2];b.lineTo(c+h,a+d);break;case "M":c=a[1],a=a[2],b.moveTo(c+h,a+d)}},replay_render:function(b,a,c,h){var d=y=0;switch(a[0]){case "L":d+=a[1];y+=a[2];b.lineTo(d+c,y+h);b.stroke();break;case "M":d+=a[1],y+=a[2],b.moveTo(d+c,y+h)}},render:function(a,c){a.save();var d=this.transformMatrix;d&&a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);c||b.transform(a,
this);this.overlayFill?a.fillStyle=this.overlayFill:this.fill&&(a.fillStyle=this.fill);this.stroke&&(a.strokeStyle=this.stroke);a.beginPath();this._render(a);this.fill&&a.fill();this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=this.strokeWidth,a.lineCap=a.lineJoin="round",a.stroke());!c&&this.active&&(this.drawBorders(a),this.hideCorners||this.drawCorners(a));a.restore()},_parsePath:function(){for(var a=[],b,c,h,d=0,r,q=this.path.length;d<q;d++){var t=/\d+\s$/.exec(this.path[d]);null!=t&&(b=this.path[d].indexOf(t),
this.path[d]=this.path[d].substring(0,b));b=this.path[d];c=b.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);b=[b.charAt(0)];r=0;for(var x=c.length;r<x;r++)h=parseFloat(c[r]),isNaN(h)||b.push(h);c=b[0].toLowerCase();c=this.commandLengths[c];if(b.length-1>c)for(h=1,r=b.length;h<r;h+=c)null==t?a.push([b[0]].concat(b.slice(h,h+c))):(a.push([b[0]].concat(b.slice(h,h+c))),b.push(t),a.push(b));else null!=t&&b.push(t[0]),a.push(b)}return a},_parseDimensions:function(){var b=[],c=[],d,h,n=!1,
r,q;this.path.forEach(function(a,t){if(" "!=a[3])var v=a.splice(3);"H"!==a[0]&&(d=0===t?this.utility.getX(a):this.utility.getX(this.path[t-1]));"V"!==a[0]&&(h=0===t?this.utility.getY(a):this.utility.getY(this.path[t-1]));a[0]===a[0].toLowerCase()&&(n=!0);r=n?d+this.utility.getX(a):"V"===a[0]?d:this.utility.getX(a);q=n?h+this.utility.getY(a):"H"===a[0]?h:this.utility.getY(a);var u=parseInt(r,10);isNaN(u)||b.push(u);u=parseInt(q,10);isNaN(u)||c.push(u);void 0!=v&&1<=v.length&&a.push(v[0])},this);var t=
a.utility.min(b),t={y:a.utility.min(c)-0,x:t-0,bottom:a.utility.max(c)-0,right:a.utility.max(b)-0};t.width=t.right-t.x;t.height=t.bottom-t.y;return t},utility:{getX:function(a){return"H"===a[0]?a[1]:a[a.length-2]},getY:function(a){return"V"===a[0]?a[1]:a[a.length-1]},extend:function(a,b){for(var c in b)a[c]=b[c];return a}}}}})(window);(function(d){var b=d.vcan;b.mouse=function(){return{init:function(){this.bindHandlers()},bindHandlers:function(){canvasElement=b.main.canvas;var c={mousedown:"mousedown",mousemove:"mousemove",mouseup:"mouseup"};for(type in c)"mousedown"==type?canvasElement.addEventListener(type,this.mousedown,!1):"mousemove"==type?canvasElement.addEventListener(type,this.mousemove,!1):"mouseup"==type&&canvasElement.addEventListener(type,this.mouseup,!1)},mousedown:function(c,a){c.detail.hasOwnProperty("cevent")&&
"create"!=b.main.action&&(c.clientX=b.main.offset.x+c.detail.cevent.x,c.clientY=b.main.offset.y+c.detail.cevent.y,c.x=b.main.offset.x+c.detail.cevent.x,c.y=b.main.offset.y+c.detail.cevent.y,c.pageX=b.main.offset.x+c.detail.cevent.x,c.pageY=b.main.offset.y+c.detail.cevent.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);lastmousemovetime=null;this.moveChunk=[];if("move"==b.main.action){if(!b.main.currentTransform){var f=b.events().findTarget(c);b.utility.getReltivePoint(c);f?(0<b.main.children.length&&
f.setZindex(),f.downObj=!0,f.setupCurrentTransform(c),b.utility.setActiveObject(f),b.main.currObj=f):b.deactivateAll();void 0!=f&&b.renderAll();c.detail.hasOwnProperty("cevent")||(f=(new Date).getTime(),f=b.makeStackObj(f,"d",c.clientX-b.main.offset.x,c.clientY-b.main.offset.y),virtualclass.wb.uid++,console.log("uid "+virtualclass.wb.uid),f.uid=virtualclass.wb.uid,b.main.replayObjs.push(f),virtualclass.vutil.beforeSend({repObj:[f]}),virtualclass.wb.utility.updateSentPackets(f))}}else"create"==b.main.action&&
(c.detail.hasOwnProperty("cevent")&&(c.clientX=c.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,c.clientY=c.detail.cevent.y+virtualclass.wb.vcan.main.offset.y,c.x=c.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,c.y=c.detail.cevent.x+virtualclass.wb.vcan.main.offset.y,c.pageX=c.detail.cevent.x+virtualclass.wb.vcan.main.offset.x,c.pageY=c.detail.cevent.y+virtualclass.wb.vcan.main.offset.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y),f=b.events().findTarget(c),b.utility.getReltivePoint(c),
f&&"text"==f.type&&"t_text"==virtualclass.wb.tool.cmd&&f.setupCurrentTransform(c))},mousemove:function(c){c.detail.hasOwnProperty("cevent")&&(c.clientX=b.main.offset.x+c.detail.cevent.x,c.clientY=b.main.offset.y+c.detail.cevent.y,c.x=b.main.offset.x+c.detail.cevent.x,c.y=b.main.offset.y+c.detail.cevent.y,c.pageX=b.main.offset.x+c.detail.cevent.x,c.pageY=b.main.offset.y+c.detail.cevent.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);if("move"==b.main.action){var a=b.main;if(a.currentTransform){var f=
b.utility.actualPointer(c),d=f.x,f=f.y;a.currentTransform.target.isMoving=!0;if("rotate"===a.currentTransform.action)b.interact.rotateObject(d,f),a.currentTransform.target.hasRotatingPoint||b.interact.scaleObject(d,f),c.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(c);else if("scale"===a.currentTransform.action)c.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(c),b.interact.scaleObject(d,f);else if("scaleX"===a.currentTransform.action)c.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(c),
b.interact.scaleObject(d,f,"x");else if("scaleY"===a.currentTransform.action)c.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(c),b.interact.scaleObject(d,f,"y");else if(a.currentTransform.target.draggable){var m=b.extend({},b.main.currentTransform.target);(new Date).getTime();!0==a.currentTransform.target.downObj&&(b.main.dragMode=!0,a.currentTransform.target.downObj=!1);m=b.interact.translateObject(d,f);c.detail.hasOwnProperty("cevent")||b.optimize.doOptiMize(c);m.setActive(!0);m.setCoords()}if("scaleX"===
a.currentTransform.action||"scaleY"===a.currentTransform.action||"rotate"===a.currentTransform.action&&!a.currentTransform.target.hasRotatingPoint)b.main.scaleMode=!0,(new Date).getTime(),a.currentTransform.target.downObj&&(a.currentTransform.target.downObj=!1),m=b.extend({},b.main.currentTransform.target),m.setCoords();b.renderAll()}else b.events().findTarget(c)}},mouseup:function(c){c.detail.hasOwnProperty("cevent")&&(c.clientX=b.main.offset.x+c.detail.cevent.x,c.clientY=b.main.offset.y+c.detail.cevent.y,
c.x=b.main.offset.x+c.detail.cevent.x,c.y=b.main.offset.y+c.detail.cevent.y,c.pageX=b.main.offset.x+c.detail.cevent.x,c.pageY=b.main.offset.y+c.detail.cevent.y,c.currX=c.detail.cevent.x,c.currY=c.detail.cevent.y);lastmousemovetime=null;if("move"==b.main.action){b.activMouse.mousemove(c);var a=b.main;if(a.currentTransform){var f=a.currentTransform.target;f.scaling&&(f.scaling=!1);for(f=a.children.length;f--;)a.children[f].setCoords()}a.currentTransform=null;b.renderAll();if(!0==b.main.dragMode||!0==
b.main.scaleMode){b.utility.actualPointer(c);var d=(new Date).getTime();c.detail.hasOwnProperty("cevent")||b.optimize.calculatePackets(d,"u",c.clientX-b.main.offset.x,c.clientY-b.main.offset.y);b.main.dragMode&&(b.main.dragMode=!1);b.main.scaleMode&&(b.main.scaleMode=!1)}else c.detail.hasOwnProperty("cevent")||b.optimize.calculatePackets(d,"u",c.clientX-b.main.offset.x,c.clientY-b.main.offset.y);b.wb.sentPack=!0}}}}})(window);(function(d){d.readyFreeHandObj=function(b,c){return{init:function(){this.freesvg=!0;this.fdObj={};this.borderColor=b;this.freeDrawingLineWidth=c},drawStart:function(a){var b=virtualclass.wb.vcan;if(!0==virtualclass.wb.obj.freeDrawObj.freesvg){var c=b.main.canvas.getContext("2d");this.fdObj=b.main.freeHandDrawing({borderColor:this.borderColor,lineWidth:this.freeDrawingLineWidth});this.fdObj.init();pointer=b.utility.getReltivePoint(a);this.fdObj.fhdStart(c,pointer)}},wb_draw:function(a){a=vcan.utility.getReltivePoint(a);
this.fdObj.fhRendering(a)},finalizeDraw:function(a){a=virtualclass.wb.vcan;virtualclass.wb.prvObj=this.fdObj.finalizeDrawingPath(virtualclass.wb.canvas);a.main.children[a.main.children.length-1].mt=virtualclass.wb.utility.stringToNumber(virtualclass.wb.prvObj.path[virtualclass.wb.prvObj.path.length-1][3])}}}})(window);(function(d){_replay=function(){return{init:function(b,c){var a=virtualclass.wb.vcan;this.objs="undefined"!=typeof c?a.getStates("replayObjs"):recorder.items;this.objNo=0;this.repMode=b;this.callBkfunc=""},renderObj:function(b){virtualclass.wb.drawMode=!0;if("undefined"==typeof this.objs[this.objNo])console.log("is this happend");else{"undefined"!=typeof b&&(this.callBkfunc=b);if(this.objs[this.objNo].hasOwnProperty("cmd"))virtualclass.wb.gObj.displayedObjId=this.objs[this.objNo].uid,virtualclass.wb.toolInit(this.objs[this.objNo].cmd,
"fromFile",!0);else{b="";if("del"==this.objs[this.objNo].ac)""!=vcan.main.currObj&&virtualclass.wb.utility.removeSelectedItem(vcan.main.currObj,!0);else{"d"==this.objs[this.objNo].ac?b="mousedown":"m"==this.objs[this.objNo].ac?b="mousemove":"u"==this.objs[this.objNo].ac&&(b="mouseup");var c=this.objs[this.objNo],c=c.hasOwnProperty("mtext")?{detail:{cevent:{x:c.x,y:c.y,mtext:c.mtext}}}:{detail:{cevent:{x:c.x,y:c.y}}};b=new CustomEvent(b,c);vcan.main.canvas.dispatchEvent(b)}virtualclass.wb.gObj.displayedObjId=
this.objs[this.objNo].uid}"function"==typeof this.callBkfunc&&this.objs[this.objs.length-1].uid==virtualclass.wb.gObj.displayedObjId&&this.callBkfunc("callBkfunc");if("object"==typeof this.objs[this.objNo+1]){virtualclass.wb.replayTime="undefined"!=typeof this.repMode&&"fromBrowser"==this.repMode?0:0==this.objNo?0:this.objs[this.objNo+1].mt-this.objs[this.objNo].mt;this.objNo++;var a=this;setTimeout(function(){a.renderObj.call(a)},virtualclass.wb.replayTime)}}}}};d._replay=_replay})(window);(function(d){d.readyTextObj=function(){return{init:function(b){this.currTextObjWrapper=this.prevTextObj="";this.currObject={};this.prvModTextObj={};this.prvCurrTransform={};this.totalBox=this.textWriteMode=0;this.boxContainer=b;this.muser=!1},textUtility:function(b,c,a){this.startPosX=b;this.startPosY=c;var f=virtualclass.wb.vcan,d=f.main.canvas.getContext("2d"),m={};this.textWriteMode++;this.wmode=!0;void 0!=f.main.currentTransform&&""!=f.main.currentTransform?(this.currObject=f.main.currentTransform.target,
void 0!=this.currObject&&"text"==this.currObject.type&&(m={width:300,height:100,x:this.currObject.oCoords.tl.x,y:this.currObject.oCoords.tl.y,text:this.currObject.text},virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)||virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(m,this.currObject.id),f.main.currentTransform=""),virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)&&virtualclass.wb.obj.drawTextObj.renderText(this.prvCurrTransform,this.prvModTextObj,d),void 0!=this.currObject&&
"text"==this.currObject.type&&(this.prvModTextObj={prvObjId:this.currObject.id,prvText:this.currObject.text,x:this.currObject.x,y:this.currObject.y},this.prvTextObj=this.currObject),this.prvCurrTransform=this.currObject):virtualclass.wb.utility.clickOutSidebox(this.textWriteMode)?"undefined"!=typeof a?virtualclass.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,d,a):virtualclass.wb.obj.drawTextObj.renderText(this.currObject,this.prvModTextObj,d):(this.totalBox++,m={x:b,y:c,width:300,
height:100},"undefined"==typeof a?virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(m,this.totalBox):virtualclass.wb.obj.drawTextObj.drawTextBoxWrapper(m,this.totalBox,a))},drawTextBoxWrapper:function(b,c,a){var f=virtualclass.wb.vcan;a=document.createElement("div");a.id="box"+c;a.className="textBoxContainer";a.style.position="absolute";a.style.left=f.main.offset.x+b.x+"px";a.style.top=b.y+"px";c=document.createElement("textarea");c.id=a.id+"textarea";c.rows=8;c.cols=41;void 0!=b.text&&""!=b.text&&
(c.value=b.text);a.appendChild(c);document.getElementById(this.boxContainer).appendChild(a);this.prevTextObj=a;this.currTextObjWrapper=b;this.prevTextObj.measure=b;virtualclass.wb.utility.toolWrapperDisable(!0)},renderText:function(b,c,a,f){var d=virtualclass.wb.vcan;if(""!=this.prevTextObj){if(!virtualclass.wb.utility.IsObjEmpty(b))for(var m=0;m<d.main.children.length;m++)if(b.id==d.main.children[m].id){d.main.children.splice(m,1);this.currObject="";break}virtualclass.wb.utility.IsObjEmpty(b)?"undefined"!=
typeof f?this.finalizeText(a,this.prevTextObj,"undefined",f):this.finalizeText(a,this.prevTextObj):"undefined"!=typeof f?this.finalizeText(a,this.prevTextObj,c,f):this.finalizeText(a,this.prevTextObj,c);virtualclass.wb.obj.drawTextObj.wmode=!1}},finalizeText:function(b,c,a,f){a=virtualclass.wb.vcan;var d=document.getElementById(c.id),m="";if("undefined"==typeof f){f=d.getElementsByTagName("textarea");for(var h=0;h<f.length;h++)if(f[h].id==d.id+"textarea"){m=f[h].value;break}}else m=f;b.font="20px Times New Roman";
var n=0,r=m.split(/\r?\n/),n=b.measureText(r[0]).width;f=15;for(h=1;h<r.length;h++){f+=15;var q=b.measureText(r[h]).width;q>n&&(n=q)}n/=2;h=(new Date).getTime();b={type:"text",text:m,x:c.measure.x+n,y:c.measure.y+f,fontSize:20,fontWidth:b.measureText(m).width,mp:{x:c.measure.x,y:c.measure.y}};!1==virtualclass.wb.obj.drawTextObj.muser&&(m={mt:h,ac:"d",x:this.startPosX,y:this.startPosY,mtext:b.text},virtualclass.wb.uid++,m.uid=virtualclass.wb.uid,a.main.replayObjs.push(m),virtualclass.storage.store(JSON.stringify(a.main.replayObjs)),
virtualclass.vutil.beforeSend({repObj:[m]}),virtualclass.wb.utility.updateSentPackets(m));b=virtualclass.wb.canvas.readyObject(b);virtualclass.wb.canvas.addObject(b);a.main.children[a.main.children.length-1].mt=h;d.parentNode.removeChild(c);a.renderAll();0<virtualclass.wb.sentPackets&&null!=document.getElementById(virtualclass.wb.sentPackDiv)&&(document.getElementById(virtualclass.wb.sentPackDiv).innerHTML=virtualclass.wb.sentPackets);virtualclass.wb.utility.toolWrapperEnable(!0)}}}})(window);(function(d){d.keyBoard={prvTool:"",skey:!1,triggerActiveAll:function(b){b.shiftKey&&(virtualclass.wb.keyBoard.skey=!0,virtualclass.wb.keyBoard.prvTool=virtualclass.wb.tool.cmd,virtualclass.wb.toolInit("t_activeall"),b={cmd:"t_activeall",mt:(new Date).getTime()},vcan.main.replayObjs.push(b),virtualclass.vutil.beforeSend({repObj:[b]}),virtualclass.wb.vcan.main.action="move")},triggerdeActiveAll:function(b){virtualclass.wb.keyBoard.skey&&(b=(new Date).getTime(),virtualclass.wb.utility.deActiveFrmDragDrop(),
virtualclass.wb.toolInit(virtualclass.wb.keyBoard.prvTool),b={cmd:virtualclass.wb.keyBoard.prvTool,mt:b},vcan.main.replayObjs.push(b),virtualclass.vutil.beforeSend({repObj:[b]}))}}})(window);(function(d){d.adapter=function(){return{RTCPeerConnection:null,webrtcDetectedBrowser:null,init:function(b){virtualclass.system.getusermedia&&(b.mozGetUserMedia?(d.webrtcDetectedBrowser="firefox",this.RTCPeerConnection=mozRTCPeerConnection,this.RTCSessionDescription=mozRTCSessionDescription,this.RTCIceCandidate=mozRTCIceCandidate,b.getUserMedia=b.mozGetUserMedia,this.attachMediaStream=function(b,a){this.videoAdd=!0;var f=d.URL||d.webkitURL;b.src=f?f.createObjectURL(a):a;b.play()},reattachMediaStream=
function(b,a){console.log("Reattaching media stream");b.mozSrcObject=a.mozSrcObject;b.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]}):b.webkitGetUserMedia?(console.log("This appears to be Chrome"),d.webrtcDetectedBrowser="chrome",this.RTCPeerConnection=webkitRTCPeerConnection,this.RTCSessionDescription=RTCSessionDescription,this.RTCIceCandidate=RTCIceCandidate,b.getUserMedia=b.webkitGetUserMedia,this.attachMediaStream=function(b,
a){var f=d.URL||d.webkitURL;b.src=f?f.createObjectURL(a):a;b.play();this.videoAdd=!0},reattachMediaStream=function(b,a){b.src=a.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=
function(){return this.remoteStreams})):console.log("Browser does not appear to be WebRTC-capable"));return b}}}})(window);function Resampler(d,b,c,a,f){this.fromSampleRate=d;this.toSampleRate=b;this.channels=c|0;this.outputBufferSize=a;this.noReturn=!!f;this.initialize()}
Resampler.prototype.initialize=function(){if(0<this.fromSampleRate&&0<this.toSampleRate&&0<this.channels)this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1):(this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.initializeBuffers());else throw Error("Invalid settings specified for the resampler.");
};
Resampler.prototype.compileLinearInterpolationFunction=function(){for(var d="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = this.lastWeight;\t\t\tvar firstWeight = 0;\t\t\tvar secondWeight = 0;\t\t\tvar sourceOffset = 0;\t\t\tvar outputOffset = 0;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tfor (; weight < 1; weight += ratioWeight) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;",b=
0;b<this.channels;++b)d+="outputBuffer[outputOffset++] = (this.lastOutput["+b+"] * firstWeight) + (buffer["+b+"] * secondWeight);";d+="}\t\t\tweight -= 1;\t\t\tfor (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; outputOffset < outLength && sourceOffset < bufferLength;) {\t\t\t\tsecondWeight = weight % 1;\t\t\t\tfirstWeight = 1 - secondWeight;";for(b=0;b<this.channels;++b)d+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(0<b?" + "+b:"")+"] * firstWeight) + (buffer[sourceOffset + "+
(this.channels+b)+"] * secondWeight);";d+="weight += ratioWeight;\t\t\t\tsourceOffset = Math.floor(weight) * "+this.channels+";\t\t\t}";for(b=0;b<this.channels;++b)d+="this.lastOutput["+b+"] = buffer[sourceOffset++];";this.resampler=Function("buffer",d+'this.lastWeight = weight % 1;\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.compileMultiTapFunction=function(){for(var d="var bufferLength = buffer.length;\tvar outLength = this.outputBufferSize;\tif ((bufferLength % "+this.channels+") == 0) {\t\tif (bufferLength > 0) {\t\t\tvar ratioWeight = this.ratioWeight;\t\t\tvar weight = 0;",b=0;b<this.channels;++b)d+="var output"+b+" = 0;";d+="var actualPosition = 0;\t\t\tvar amountToNext = 0;\t\t\tvar alreadyProcessedTail = !this.tailExists;\t\t\tthis.tailExists = false;\t\t\tvar outputBuffer = this.outputBuffer;\t\t\tvar outputOffset = 0;\t\t\tvar currentPosition = 0;\t\t\tdo {\t\t\t\tif (alreadyProcessedTail) {\t\t\t\t\tweight = ratioWeight;";
for(b=0;b<this.channels;++b)d+="output"+b+" = 0;";d+="}\t\t\t\telse {\t\t\t\t\tweight = this.lastWeight;";for(b=0;b<this.channels;++b)d+="output"+b+" = this.lastOutput["+b+"];";d+="alreadyProcessedTail = true;\t\t\t\t}\t\t\t\twhile (weight > 0 && actualPosition < bufferLength) {\t\t\t\t\tamountToNext = 1 + actualPosition - currentPosition;\t\t\t\t\tif (weight >= amountToNext) {";for(b=0;b<this.channels;++b)d+="output"+b+" += buffer[actualPosition++] * amountToNext;";d+="currentPosition = actualPosition;\t\t\t\t\t\tweight -= amountToNext;\t\t\t\t\t}\t\t\t\t\telse {";
for(b=0;b<this.channels;++b)d+="output"+b+" += buffer[actualPosition"+(0<b?" + "+b:"")+"] * weight;";d+="currentPosition += weight;\t\t\t\t\t\tweight = 0;\t\t\t\t\t\tbreak;\t\t\t\t\t}\t\t\t\t}\t\t\t\tif (weight == 0) {";for(b=0;b<this.channels;++b)d+="outputBuffer[outputOffset++] = output"+b+" / ratioWeight;";d+="}\t\t\t\telse {\t\t\t\t\tthis.lastWeight = weight;";for(b=0;b<this.channels;++b)d+="this.lastOutput["+b+"] = output"+b+";";this.resampler=Function("buffer",d+'this.tailExists = true;\t\t\t\t\tbreak;\t\t\t\t}\t\t\t} while (actualPosition < bufferLength && outputOffset < outLength);\t\t\treturn this.bufferSlice(outputOffset);\t\t}\t\telse {\t\t\treturn (this.noReturn) ? 0 : [];\t\t}\t}\telse {\t\tthrow(new Error("Buffer was of incorrect sample length."));\t}')};
Resampler.prototype.bypassResampler=function(d){return this.noReturn?(this.outputBuffer=d,d.length):d};Resampler.prototype.bufferSlice=function(d){if(this.noReturn)return d;try{return this.outputBuffer.subarray(0,d)}catch(b){try{return this.outputBuffer.length=d,this.outputBuffer}catch(c){return this.outputBuffer.slice(0,d)}}};
Resampler.prototype.initializeBuffers=function(){try{this.outputBuffer=new Float32Array(this.outputBufferSize),this.lastOutput=new Float32Array(this.channels)}catch(d){this.outputBuffer=[],this.lastOutput=[]}};(function(d){repMode=!1;var b=0,c=0,a=0,f=0,g=65535,m=0;d.media=function(){return{isChannelReady:"",isInitiator:!1,isStarted:"",localStream:"",pc:[],cn:0,ba:!1,bb:!1,bc:!1,bNotRender:!1,remoteStream:"",turnReady:"",oneExecuted:!1,videoControlId:"videoContainer",videoContainerId:"videos",util:{imageReplaceWithVideo:function(a,b){var c=document.getElementById("ml"+a);virtualclass.vutil.elemHasAnyClass("ml"+a)&&c.classList.remove("userImg");var c=c.getElementsByTagName("a")[0],f=c.getElementsByTagName("img")[0];
c.replaceChild(b,f)}},audio:{audioStreamArr:[],tempAudioStreamArr:[],recordingLength:0,bufferSize:0,encMode:"alaw",recordAudio:!1,resampler:new Resampler(44100,8E3,1,4096),rec:"",otherSound:!1,audioNodes:[],sdElem:"silenceDetect",Html5Audio:{audioContext:new (d.AudioContext||d.webkitAudioContext)},init:function(){null!=localStorage.getItem("orginalTeacherId")&&(virtualclass.gObj.audMouseDown=!0);this.graph={height:56,width:4,average:0,display:function(){var a=cthis.video;"t"==virtualclass.gObj.uRole&&
this._display(a.tempVidCont,this.height-this.height*this.average/100)},_display:function(a,b){a.beginPath();a.moveTo(this.width,this.height);a.lineTo(this.width,b);a.lineWidth=this.width;a.strokeStyle="rgba(32, 37, 247, 0.8)";a.closePath();a.stroke()},canvasForVideo:function(){var a=cthis.video.myVideo.parentNode,b=document.createElement("canvas");b.width=this.width+3;b.height=this.height;b.id="graphCanvas";a.style.position="relative";b.style.position="absolute";b.style.left=0;b.style.top=-7;a.appendChild(b)}};
this.attachFunctionsToAudioWidget()},audioSend:function(a,b){if(virtualclass.gObj.audMouseDown&&1==io.sock.readyState){var c=virtualclass.vutil.breakintobytes(virtualclass.gObj.uid,8),c=new Int8Array([101,c[0],c[1],c[2],c[3]]),f=new Int8Array(a.length+c.length);f.set(c);f.set(a,c.length);io.sendBinary(f);virtualclass.gObj.video.audio.setAudioStatus(b)}else virtualclass.gObj.video.audio.setAudioStatus("stop")},slienceDetection:function(d,n){var r=0,q=0,t=0;for(i=0;i<n.length;i++)t=Math.abs(n[i]),r<
t&&(r=t),q+=t;f=q/n.length;t=Math.abs(f^2-a^2);a=f;5>t&&(g=r);g>r&&(g=r);m<r&&(m=r);50*g<m&&(g*=5);m/50>g&&(m=r);q=m/g;switch(!0){case 8<q:t=2.5;break;case 5<q:t=2;break;case 3<q:t=1.2;break;default:t=1}2<=q&&r>=g*t?(0==b&&0!=c&&(this.audioSend(c),c=0),this.audioSend(d,"sending"),b=9):0<b?(this.audioSend(d,"sending"),b--):2>q?this.audioSend(d,"sending"):(this.setAudioStatus("notSending"),10<q&&(m*=.8),c=d);return d},setAudioStatus:function(a){if("undefined"==typeof b)var b=document.getElementById("audioWidget").getElementsByClassName(this.sdElem)[0];
b.setAttribute("data-silence-detect",a)},makeIconNotDraggable:function(a,b){var c=document.getElementById(a,b).getContext("2d"),f=new Image;f.onload=function(){c.drawImage(f,0,0)};f.src=d.whiteboardPath+"images/"+b},attachFunctionsToAudioWidget:function(){for(var a=document.getElementById("audioWidget").getElementsByClassName("audioTool"),b=0;b<a.length;b++)"speakerPressOnce"!=a[b].id&&"speakerPressing"==a[b].id&&this.attachSpeakToStudent(a[b].id),"speakerPressing"!=a[b].id&&a[b].addEventListener("click",
this.audioToolInit)},audioToolInit:function(){var a=virtualclass.gObj.video.audio;if("speakerPressOnce"==this.id)a.clickOnceSpeaker(this.id);else if("audioTest"==this.id){var b=this;virtualclass.popup.confirmInput(virtualclass.lang.getString("audioTest"),function(c){c&&a.testInit(b.id)})}else"silenceDetect"==this.id&&(this.getElementsByTagName("a"),a.sd?(a.sd=!1,this.className+=" sdDisable"):(a.sd=!0,this.className+=" sdEnable"))},attachSpeakToStudent:function(a){var b=this,c=document.getElementById(a),
f=!1;c.addEventListener("mousedown",function(){if(!virtualclass.gObj.audMouseDown){b.studentSpeak(c);f=!0;var a=document.getElementById("speakerPressonceLabel");null!=a&&virtualclass.vutil.elemHasAnyClass("speakerPressonceLabel")&&a.classList.contains("silenceDetect")&&(a.removeAttribute("data-silence-detect"),a.classList.remove("silenceDetect"),0>=a.classList.length&&a.removeAttribute("class"),a=a.getElementsByTagName("i")[0],null!=a&&(a.setAttribute("data-silence-detect","stop"),a.className+=" silenceDetect"))}});
c.addEventListener("mouseup",function(){if(f){b.studentNotSpeak(c);f=!1;var a=document.getElementById("speakerPressonceLabel"),d=a.getElementsByTagName("i")[0];"undefined"!=typeof d.classList&&d.classList.contains("silenceDetect")&&(d.classList.remove("silenceDetect"),0>=d.classList.length&&d.removeAttribute("class"),a.removeAttribute("data-silence-detect"));null!==a&&(a.setAttribute("data-silence-detect","stop"),a.className=d.className+" silenceDetect")}})},attachAudioPressOnce:function(){var a=
document.getElementById("speakerPressOnce");a.setAttribute("data-audio-playing","false");var b=this;a.addEventListener("click",function(){b.clickOnceSpeaker.call(b,a.id)})},clickOnceSpeaker:function(a,b){var c=document.getElementById(a),f=document.getElementById("speakerPressing"),d=c.getElementsByClassName("tooltip")[0];"false"==c.getAttribute("data-audio-playing")&&"undefined"==typeof b?(this.studentSpeak(f),c.setAttribute("data-audio-playing","true"),d.setAttribute("data-title",virtualclass.lang.getString("disableSpeaker")),
c.className="audioTool active"):(this.studentNotSpeak(f),c.setAttribute("data-audio-playing","false"),d.setAttribute("data-title",virtualclass.lang.getString("enableSpeaker")),c.className="audioTool deactive")},studentSpeak:function(a){"undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("deactive"),a.classList.add("active"));virtualclass.gObj.audMouseDown=!0;virtualclass.vutil.beforeSend({sad:!0})},studentNotSpeak:function(a){virtualclass.gObj.hasOwnProperty("audMouseDown")&&
virtualclass.gObj.audMouseDown&&("undefined"!=typeof a&&(document.getElementById(a.id+"Button"),a.classList.remove("active"),a.classList.add("deactive")),a=document.getElementById("speakerPressOnce"),a.setAttribute("data-audio-playing","false"),a.className="audioTool deactive",virtualclass.gObj.audMouseDown=!1,virtualclass.gObj.video.audio.setAudioStatus("stop"),virtualclass.vutil.beforeSend({sad:!1}))},ab2str:function(a){return String.fromCharCode.apply(null,new Int8Array(a))},str2ab:function(a){for(var b=
new ArrayBuffer(a.length),b=new Int8Array(b),c=0,f=a.length;c<f;c++)b[c]=a.charCodeAt(c);return b},recorderProcess:function(a){(new Date).getTime();if(!repMode){a=a.inputBuffer.getChannelData(0);a=this.resampler.resampler(a);this.recordAudio||(this.recordingLength+=this.bufferSize);l=a.length;for(buf=new Int16Array(l);l--;)buf[l]=32767*Math.min(1,a[l]);a=buf;var b=this.audioInLocalStorage(a);this.hasOwnProperty("storeAudio")&&this.storeAudio&&this.audioForTesting(a);virtualclass.gObj.audMouseDown&&
1==io.sock.readyState&&this.slienceDetection(b,a)}},audioInLocalStorage:function(a){return G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1})},testInit:function(a){var b=document.getElementById(a);b.classList.add("audioIsTesting");this.studentNotSpeak();virtualclass.gObj.audioForTest=[];this.storeAudio=!0;var c=this;c.otherSound=!0;c.hasOwnProperty("testAudio")&&clearTimeout(c.testAudio);c.testAudio=setTimeout(function(){c.playRecordedAudio(virtualclass.gObj.audioForTest,virtualclass.gObj.uid,!0)},
5E3);setTimeout(function(){b.classList.remove("audioIsTesting");c.otherSound=!1},11E3)},audioForTesting:function(a){a=G711.encode(a,{alaw:"alaw"==this.encMode?!0:!1});virtualclass.gObj.audioForTest.push(a);virtualclass.gObj[virtualclass.gObj.uid]=!1},playRecordedAudio:function(a,b,c){var f;this.myaudioNodes=[];for(var d=0,g=0;g<a.length;g++)f=a[g],f=G711.decode(f,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0}),this.myaudioNodes.push(new Float32Array(f)),d+=f.length;f=this.mergeBuffers(this.myaudioNodes,
d);"undefined"!=typeof c?virtualclass.gObj.video.audio.play(f,b,c):virtualclass.gObj.video.audio.play(f,b)},play:function(a,b,c){var f=JSON.parse(localStorage.getItem("virtualclass"+b));"undefined"==typeof receivedResampler&&(receivedResampler=new Resampler(8E3,44100,1,16384E3));a=receivedResampler.resampler(a);var d=this.Html5Audio.audioContext.createBuffer(1,a.length,44100);d.getChannelData(0).set(a);a=this.Html5Audio.audioContext.createBufferSource();a.buffer=d;d=this.Html5Audio.audioContext.createGain();
d.gain.value=.9;a.connect(d);d.connect(this.Html5Audio.audioContext.destination);null!=f&&f.ad&&f.aud&&(virtualclass.user.control.iconAttrManupulate(b,"icon-audioEnaGreen"),d=document.getElementById(f.id+"contrAudAnch"),null!=d&&d.setAttribute("data-title",virtualclass.lang.getString("audioOn")));a.onended=function(){f=JSON.parse(localStorage.getItem("virtualclass"+b));"undefined"==typeof c&&(clearTimeout(virtualclass.gObj[b].out),virtualclass.gObj[b].isplaying=!1,0<virtualclass.gObj.video.audio.audioToBePlay[b].length?
virtualclass.gObj.video.audio.getChunks(b):f.ad&&f.aud&&virtualclass.user.control.iconAttrManupulate(b,"icon-audioEnaOrange"))};a.start(1);virtualclass.gObj[b].isplaying=!0;"undefined"==typeof c&&(virtualclass.gObj[b].out=setTimeout(function(){virtualclass.gObj[b].isplaying=!1;0<virtualclass.gObj.video.audio.audioToBePlay[b].length&&virtualclass.gObj.video.audio.getChunks(b)},1E3*a.buffer.duration+10))},calcAverage:function(){var a=new Uint8Array(analyser.frequencyBinCount);analyser.getByteFrequencyData(a);
for(var b=0,c=a.length,f=0;f<c;f++)b+=a[f];this.graph.average=b/c},audioInGraph:function(){var a=cthis.video;if("t"==virtualclass.gObj.uRole){var b=this.graph.height-this.graph.height*this.graph.average/100;a.tempVidCont.beginPath();a.tempVidCont.moveTo(a.tempVid.width-this.graph.width,this.graph.height);a.tempVidCont.lineTo(a.tempVid.width-this.graph.width,b);a.tempVidCont.lineWidth=this.graph.width;a.tempVidCont.strokeStyle="rgba(247, 25, 77, 1)";a.tempVidCont.closePath();a.tempVidCont.stroke()}},
queue:function(a,b){this.hasOwnProperty("audioToBePlay")||(this.audioToBePlay={});this.audioToBePlay.hasOwnProperty(b)||(this.audioToBePlay[b]=[]);this.audioToBePlay[b].push(a)},getChunks:function(a,b){8<this.audioToBePlay[a].length?(this.audioToBePlay[a].length=0,virtualclass.gObj[a].isplaying=!1):0<this.audioToBePlay[a].length?(this.playRecordedAudio(this.audioToBePlay[a],a),this.audioToBePlay[a].length=0):virtualclass.gObj[a].isplaying=!1},replayInit:function(){virtualclass.storage.getAllObjs(["audioData"],
function(){virtualclass.gObj.video.audio.replay(0,0)})},replay:function(a,b){repMode=!0;var c,f,d;0<this.audioNodes.length&&(c=this.mergeBuffers(this.audioNodes),f=this.Html5Audio.audioContext.currentTime+a,d=this.Html5Audio.audioContext.createBuffer(1,c.length,7800),d.getChannelData(0).set(c),c=this.Html5Audio.audioContext.createBufferSource(),c.buffer=d,c.connect(this.Html5Audio.audioContext.destination),c.start(f,b))},mergeBuffers:function(a,b){for(var c=new Float32Array(b),f=0,d=a.length,g=0;g<
d;g++){var m=a[g];c.set(m,f);f+=m.length}return c},assignFromLocal:function(a,b){this.init();for(var c=0;c<a.length;c++){var f=LZString.decompressFromBase64(a[c]),f=this.str2ab(f);samples=G711.decode(f,{alaw:"alaw"==this.encMode?!0:!1,floating_point:!0,Eight:!0});this.audioNodes.push(new Float32Array(samples));this.recordingLength+=16384}"undefined"!=typeof b&&b()},manuPulateStream:function(){var a=cthis.stream;virtualclass.vutil.chkValueInLocalStorage("recordStart")?virtualclass.wb.recordStarted=
localStorage.getItem("recordStart"):(virtualclass.wb.recordStarted=(new Date).getTime(),localStorage.setItem("recordStart",virtualclass.wb.recordStarted));a=cthis.audio.Html5Audio.audioContext.createMediaStreamSource(a);cthis.audio.bufferSize=16384;grec=cthis.audio.Html5Audio.audioContext.createScriptProcessor(cthis.audio.bufferSize,1,1);grec.onaudioprocess=cthis.audio.recorderProcess.bind(cthis.audio);var b=cthis.audio.Html5Audio.audioContext.createGain();b.gain.value=.9;a.connect(b);b.connect(grec);
grec.connect(cthis.audio.Html5Audio.audioContext.destination)},updateInfo:function(){this.audioStreamArr=[];virtualclass.wb.pageEnteredTime=virtualclass.wb.recordStarted=(new Date).getTime();repMode=this.recordAudio=!1},receivedAudioProcess:function(a){if(!virtualclass.gObj.hasOwnProperty("iosTabAudTrue")||!1!=virtualclass.gObj.iosTabAudTrue){a=this.extractData(a);var b=a[0];if("undefined"==typeof c)var c={};c.hasOwnProperty(b)||(c[b]={},c[b].ad=!0,c=virtualclass.user.control.updateUser(b,"ad",!0),
virtualclass.user.control.audioSign(c,"create"));virtualclass.gObj.video.audio.queue(a[1],b);virtualclass.gObj.hasOwnProperty(b)&&virtualclass.gObj[b].hasOwnProperty("isplaying")?!1==virtualclass.gObj[b].isplaying&&virtualclass.gObj.video.audio.getChunks(b):(virtualclass.gObj[b]={},virtualclass.gObj[b].isplaying=!0,virtualclass.gObj.video.audio.getChunks(b))}},extractData:function(a){a=new Int8Array(a);return[virtualclass.vutil.numValidateFour(a[1],a[2],a[3],a[4]),a.subarray(5,a.length)]}},video:{width:75,
height:56,tempVid:"",tempVidCont:"",myVideo:"",remoteVid:"",remoteVidCont:"",maxHeight:250,init:function(){this.videoCont=document.getElementById("allVideosCont");null!=this.videoCont&&(this.videoCont.style.maxHeight=this.maxHeight+"px")},calcDimension:function(){this.myVideo.width=this.width;this.myVideo.height=this.height},removeUser:function(a){a=document.getElementById("user"+a);null!=a&&a.parentNode.removeChild(a)},createElement:function(a){var b=document.createElement("div");b.className="videoWrapper";
var c=document.createElement("div");c.className="videoSubWrapper";c.id="user"+a.id;b.appendChild(c);vidId=a.id;var f=document.createElement("canvas");f.id="video"+vidId;f.className="userVideos";f.width=this.width;f.height=this.height;c.appendChild(f);virtualclass.gObj.video.util.imageReplaceWithVideo(a.id,b)},updateHightInSideBar:function(a){var b=document.getElementById("widgetRightSide").offsetHeight;document.getElementById("chatContainer").style.height=b-a+"px"},send:function(){function a(){function g(){try{c.tempVidCont.drawImage(c.myVideo,
0,0,c.width,c.height)}catch(a){if("NS_ERROR_NOT_AVAILABLE"==a.name)setTimeout(g,100);else throw a;}}if("t"==virtualclass.gObj.uRole){if("undefined"==typeof m){var m=document.getElementById("graphCanvas");null!=m&&(cthis.audio.graph.cvCont=m.getContext("2d"))}null!=m&&cthis.audio.graph.cvCont.clearRect(0,0,m.width,m.height)}c.tempVidCont.clearRect(0,0,c.tempVid.width,c.tempVid.height);d.navigator.userAgent.match("Firefox")?g():c.tempVidCont.drawImage(c.myVideo,0,0,c.width,c.height);"t"==virtualclass.gObj.uRole&&
cthis.audio.graph.display();m={name:virtualclass.gObj.uName,id:virtualclass.gObj.uid};"t"==virtualclass.gObj.uRole&&(m.role=virtualclass.gObj.uRole);virtualclass.vutil.beforeSend({videoByImage:m});var m=c.tempVidCont.getImageData(0,0,c.tempVid.width,c.tempVid.height),m=virtualclass.dirtyCorner.encodeRGB(m.data),z=b(virtualclass.gObj.uid,8),z=new Uint8ClampedArray([11,z[0],z[1],z[2],z[3]]),v=new Uint8ClampedArray(m.length+z.length);v.set(z);v.set(m,z.length);io.sendBinary(v);clearInterval(virtualclass.gObj.video.smallVid);
m=2E3+2500*virtualclass.gObj.totalUser.length;f!=virtualclass.gObj.totalUser?(f=virtualclass.gObj.totalUser.length,z=virtualclass.gObj.totalUser.indexOf(virtualclass.gObj.uId),virtualclass.gObj.video.smallVid=setInterval(a,m+m/f*z)):virtualclass.gObj.video.smallVid=setInterval(a,m)}function b(a,c){for(var f=a.toString(),d=f.length;d<c;d++)f="0"+f;return f.match(/[\S]{1,2}/g)||[]}virtualclass.gObj.video.hasOwnProperty("smallVid")&&clearInterval(virtualclass.gObj.video.smallVid);var c=this;randomTime=
Math.floor(10001*Math.random())+5E3;var f=-1;virtualclass.gObj.video.smallVid=setInterval(a,300)},startToStream:function(){cthis.video.calcDimension();cthis.video.send()},playWithoutSlice:function(a,b){this.remoteVid=document.getElementById("video"+a);this.remoteVidCont=this.remoteVid.getContext("2d");var c=virtualclass.dirtyCorner.decodeRGB(b,this.remoteVidCont,this.remoteVid);this.remoteVidCont.putImageData(c,0,0)},justForDemo:function(){var a=0,b=document.getElementById("allVideosCont");b.style.maxHeight=
"250px";setInterval(function(){if(20>=++a){b=document.getElementById("allVideosCont");var c=document.createElement("div");c.className="videoWrapper";var f=document.createElement("div");f.className="videoSubWrapper";f.setAttribute("data-uname","suman"+a);c.appendChild(f);var d=document.createElement("video");d.className="userVideo";d.src="http://html5demos.com/assets/dizzy.mp4";f.appendChild(d);b.appendChild(c);250<=b.offsetHeight&&"undefined"!=b.style.overflowY&&"scroll"!=b.style.overflowY&&(b.style.overflowY=
"scroll",document.getElementById(virtualclass.gObj.chat.mainChatBoxId).style.borderTop="3px solid #bbb")}},200)},createVideoElement:function(){var a=document.createElement("div");a.className="videoWrapper";var b=document.createElement("div");b.className="videoSubWrapper";a.appendChild(b);var c=document.createElement("video");c.id="video"+virtualclass.gObj.uid;c.autoplay=!0;b.appendChild(c);return a},insertTempVideo:function(a){var b=document.createElement("canvas");b.id="tempVideo";a.parentNode.insertBefore(b,
a)},tempVideoInit:function(){cthis.video.tempVid=document.getElementById("tempVideo");cthis.video.tempVid.width=cthis.video.width;cthis.video.tempVid.height=cthis.video.height;cthis.video.tempVidCont=cthis.video.tempVid.getContext("2d")},process:function(a){var b=new Uint8ClampedArray(a);a=virtualclass.vutil.numValidateFour(b[1],b[2],b[3],b[4]);b=b.subarray(5,b.length);virtualclass.gObj.video.video.playWithoutSlice(a,b)}},init:function(a){cthis=this;vcan.oneExecuted=!0;a={audio:!0,video:!0};cthis.video.init();
virtualclass.vutil.isPlayMode()||(virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).getUserMedia(a,this.handleUserMedia,this.handleUserMediaError));virtualclass.system.wbRtc.peerCon&&"undefined"==typeof localStorage.wbrtcMsg&&(virtualclass.view.multiMediaMsg("WebRtc"),localStorage.wbrtcMsg=!0)},handleUserMedia:function(a){var b=document.getElementById("audioWidget");virtualclass.vutil.elemHasAnyClass("audioWidget")&&b.classList.contains("deactive")&&virtualclass.user.control.audioWidgetEnable();
cthis.video.tempStream=a;cthis.audio.init();a=document.getElementById("ml"+virtualclass.gObj.uid);null!=a&&null!=a.getElementsByTagName("video")&&cthis._handleUserMedia(virtualclass.gObj.uid)},addUserRole:function(a,b){var c=document.getElementById("ml"+a);c.setAttribute("data-role",b);c.classList.add("s"==b?"student":"teacher")},_handleUserMedia:function(a){document.getElementById(a);var b=cthis.video.tempStream;"undefined"!=typeof b&&(a=cthis.video.createVideoElement(),virtualclass.gObj.video.util.imageReplaceWithVideo(virtualclass.gObj.uid,
a),cthis.video.insertTempVideo(a),cthis.video.tempVideoInit(),cthis.video.myVideo=document.getElementById("video"+virtualclass.gObj.uid),virtualclass.adpt.attachMediaStream(cthis.video.myVideo,b),cthis.video.myVideo.muted=!0,b.ontimeupdate=function(){console.log("raja"+b.currentTime)},virtualclass.jId==virtualclass.gObj.uid&&(cthis.stream=cthis.video.tempStream,cthis.audio.manuPulateStream(),cthis.audio.graph.canvasForVideo()),cthis.video.myVideo.onloadedmetadata=function(){cthis.video.startToStream()});
userMedia=!0},updateVidContHeight:function(){var a=document.getElementById("virtualclassCont"),a=vcan.utility.getElementOffset(a),a=d.innerHeight-(a.y+75);document.getElementById("chat_div").style.maxHeight=a+"px"},close:function(){virtualclass.gObj.video.hasOwnProperty("smallVid")&&clearInterval(virtualclass.gObj.video.smallVid)},dispAllVideo:function(a){setTimeout(function(){var b=document.getElementById(a);if(null!=b)for(var b=b.getElementsByTagName("video"),c=0;c<b.length;c++)b[c].play()},1040)},
existVideoContainer:function(a){for(var b=document.getElementsByClassName("userVideos"),c=0;c<b.length;c++)if(b[c].id=="video"+a.id)return!0;return!1},handleUserMediaError:function(a){a="object"==typeof a?virtualclass.lang.getString(a.name):virtualclass.lang.getString(a);virtualclass.view.createErrorMsg(a,"errorContainer","chatWidget");virtualclass.user.control.audioWidgetDisable();virtualclass.view.disappearBox("WebRtc");console.log("navigator.getUserMedia error: ",a)}}}})(window);(function(d){var b={requestPackets:function(b){1<b.length&&(virtualclass.wb.gObj.myArr=b);virtualclass.wb.sentReq=!0;return[0==virtualclass.wb.gObj.displayedObjId?0:virtualclass.wb.gObj.rcvdPackId,b[0].uid]},makeQueue:function(b){virtualclass.wb.gObj.rcvdPackId!=virtualclass.wb.gObj.displayedObjId&&(virtualclass.wb.gObj.packQueue=virtualclass.wb.gObj.packQueue.concat(b.message.repObj))},sendPackets:function(b,a){if(0==b.message.getMsPckt[0])var f=-1;else for(f=0;f<virtualclass.wb.gObj.myrepObj.length&&
b.message.getMsPckt[0]!=virtualclass.wb.gObj.myrepObj[f].uid;f++);for(f+=1;f<b.message.getMsPckt[1];f++)a.push(virtualclass.wb.gObj.myrepObj[f]);return a},handleMissedPackets:function(c,a,f){f=this.removeDupObjs(f);virtualclass.wb.gObj.replayObjs=virtualclass.wb.gObj.replayObjs.concat(f);b.sortingReplyObjs();c!=a&&virtualclass.storage.store(JSON.stringify(virtualclass.wb.gObj.replayObjs));this.containsIfQueuePacks(c,a,virtualclass.wb.gObj.displayedObjId,f)},removeDupObjs:function(b){0<virtualclass.wb.gObj.myArr.length&&
(b[b.length-1].uid==virtualclass.wb.gObj.myArr[0].uid&&(virtualclass.wb.gObj.myArr[0].hasOwnProperty("cmd")||virtualclass.wb.gObj.myArr.shift()),b=b.concat(virtualclass.wb.gObj.myArr),virtualclass.wb.gObj.myArr=[]);return b},containsIfQueuePacks:function(b,a,f,d){b!=a&&f+1!=d[0].uid&&0<virtualclass.wb.gObj.packQueue.length&&d[d.length-1].uid==virtualclass.wb.gObj.packQueue[0].uid&&(virtualclass.wb.gObj.packQueue=d.concat(virtualclass.wb.gObj.packQueue))},sortingReplyObjs:function(){virtualclass.wb.gObj.replayObjs=
virtualclass.wb.gObj.replayObjs.sort(function(b,a){return b.uid-a.uid})}};d.bridge=b})(window);(function(d){vcan.optimize={sendPacketWithOptimization:function(b,c,a){"undefined"==typeof this.lastarrowtime&&(this.lastarrowtime=(new Date).getTime(),virtualclass.wb.sentPackets+=b.length,1==c&&virtualclass.vutil.beforeSend(JSON.parse(b)),virtualclass.wb.utility.updateSentInformation(b,!0));this.presentarrowtime=(new Date).getTime();this.presentarrowtime-this.lastarrowtime>=a&&(virtualclass.wb.sentPackets+=b.length,1==c&&io.send(JSON.parse(b)),virtualclass.wb.utility.updateSentInformation(b,!0),
this.lastarrowtime=(new Date).getTime())},doOptiMize:function(b){if("undefined"==typeof lastmousemovetime||null==lastmousemovetime)lastmousemovetime=(new Date).getTime(),b.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,"m",b.clientX-vcan.main.offset.x,b.clientY-vcan.main.offset.y);presentmousemovetime=(new Date).getTime();2E3<=presentmousemovetime-lastmousemovetime&&((new Date).getTime(),b.detail.hasOwnProperty("cevent")||vcan.optimize.calculatePackets(lastmousemovetime,
"m",b.clientX-vcan.main.offset.x,b.clientY-vcan.main.offset.y),vcan.optimize.calculatePackets(lastmousemovetime,"m",b.clientX-vcan.main.offset.x,b.clientY-vcan.main.offset.y),lastmousemovetime=(new Date).getTime())},calculatePackets:function(b,c,a,f){b=vcan.makeStackObj(b,c,a,f);virtualclass.wb.uid++;b.uid=virtualclass.wb.uid;vcan.main.replayObjs.push(b);virtualclass.vutil.beforeSend({repObj:[b]});virtualclass.storage.store(JSON.stringify(vcan.main.replayObjs));virtualclass.wb.utility.updateSentPackets(b)}}})(window);(function(d){d.response={reclaimRole:function(b,c){b!=c&&(virtualclass.user.control._assign(c,"notsent",b),virtualclass.user.displayStudentSpeaker(!0),null!=localStorage.getItem("aId")&&localStorage.removeItem("aId"),virtualclass.user.control.removeAudioFromParticipate(b),"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0)))},assignRole:function(b,c,a){if(b!=c||"undefined"!=typeof a)if(virtualclass.vutil.assignRole(c),virtualclass.wb.utility.uniqueArrOfObjsToTeacher(),null==localStorage.getItem("orginalTeacherId")){virtualclass.vutil.removeSessionTool();c=document.getElementById("ml"+b);a=["assign"];var f=document.getElementById(b+"ControlContainer");null!=f?virtualclass.user.createAssignControl(f,b,!0):(a=virtualclass.user.createControl(b,a),c.appendChild(a));localStorage.setItem("aId",b)}else b=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],
null!=b&&virtualclass.user.control.removeCurrTeacherFromControl(b.id),virtualclass.user.control.changeAttrToAssign("enable");virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),"errorContainer","chatWidget"))},checkUser:function(b,c,a){"undefined"!=typeof vcan.teacher||a||virtualclass.wb.utility.makeCanvasDisable();virtualclass.vutil.initDefaultInfo(b,
wbUser.role,virtualclass.currApp);virtualclass.vutil.initDefaultInfo(b,wbUser.role,virtualclass.currApp);virtualclass.wb.utility.makeUserAvailable(b.message.checkUser.e.clientLen)},clearAll:function(b,c,a,f){b!=c&&(virtualclass.wb.tool=new virtualclass.wb.tool_obj("t_clearall"),virtualclass.wb.utility.t_clearallInit(),virtualclass.wb.utility.makeDefaultValue(),virtualclass.storage.clearStorageData());f&&virtualclass.wb.utility.updateRcvdInformation(a)},replayAll:function(){d.virtualclass.wb.vcan.main.replayObjs=
virtualclass.wb.gObj.replayObjs;virtualclass.wb.utility.clearAll(!1);virtualclass.wb.toolInit("t_replay","fromFile")},createArrow:function(b,c){var a=virtualclass.wb.arrImg,f={};f.mp={x:b.x,y:b.y};virtualclass.wb.utility.drawArrowImg(a,f);c&&virtualclass.wb.utility.updateRcvdInformation(b)},replayObj:function(b){d.virtualclass.wb.vcan.main.replayObjs=[];0<b.length&&virtualclass.wb.gObj.displayedObjId+1==b[0].uid&&(d.virtualclass.wb.vcan.main.replayObjs=b,virtualclass.wb.toolInit("t_replay","fromBrowser",
!0,virtualclass.wb.utility.dispQueuePacket))},chunk:function(b,c,a){virtualclass.wb.bridge.handleMissedPackets(b,c,a)},repObjForMissedPkts:function(b){(0!==virtualclass.wb.gObj.rcvdPackId||0<virtualclass.wb.uid&&0===virtualclass.wb.gObj.rcvdPackId)&&("object"===typeof b||b instanceof Array)&&b[0].hasOwnProperty("uid")&&!b.hasOwnProperty("chunk")&&(Number(virtualclass.wb.gObj.rcvdPackId+1)<Number(b[0].uid)||virtualclass.wb.gObj.rcvdPackId!=virtualclass.wb.gObj.displayedObjId)&&(b=virtualclass.wb.bridge.requestPackets(b),
virtualclass.vutil.beforeSend({getMsPckt:b}))}}})(window);var LZString={_f:String.fromCharCode,_keyStrBase64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStrUriSafe:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",_getBaseValue:function(d,b){LZString._baseReverseDic||(LZString._baseReverseDic={});if(!LZString._baseReverseDic[d]){LZString._baseReverseDic[d]={};for(var c=0;c<d.length;c++)LZString._baseReverseDic[d][d[c]]=c}return LZString._baseReverseDic[d][b]},compressToBase64:function(d){if(null==d)return"";
d=LZString._compress(d,6,function(b){return LZString._keyStrBase64.charAt(b)});switch(d.length%4){default:case 0:return d;case 1:return d+"===";case 2:return d+"==";case 3:return d+"="}},decompressFromBase64:function(d){return null==d?"":""==d?null:LZString._decompress(d.length,32,function(b){return LZString._getBaseValue(LZString._keyStrBase64,d.charAt(b))})},compressToUTF16:function(d){return null==d?"":LZString._compress(d,15,function(b){return String.fromCharCode(b+32)})+" "},decompressFromUTF16:function(d){return null==
d?"":""==d?null:LZString._decompress(d.length,16384,function(b){return d.charCodeAt(b)-32})},compressToUint8Array:function(d){d=LZString.compress(d);for(var b=new Uint8Array(2*d.length),c=0,a=d.length;c<a;c++){var f=d.charCodeAt(c);b[2*c]=f>>>8;b[2*c+1]=f%256}return b},decompressFromUint8Array:function(d){if(null===d||void 0===d)return LZString.decompress(d);for(var b=Array(d.length/2),c=0,a=b.length;c<a;c++)b[c]=256*d[2*c]+d[2*c+1];var f=[];b.forEach(function(a){f.push(String.fromCharCode(a))});
return LZString.decompress(f.join(""))},compressToEncodedURIComponent:function(d){return null==d?"":LZString._compress(d,6,function(b){return LZString._keyStrUriSafe.charAt(b)})},decompressFromEncodedURIComponent:function(d){if(null==d)return"";if(""==d)return null;d=d.replace(/ /g,"+");return LZString._decompress(d.length,32,function(b){return LZString._getBaseValue(LZString._keyStrUriSafe,d.charAt(b))})},compress:function(d){return LZString._compress(d,16,function(b){return String.fromCharCode(b)})},
_compress:function(d,b,c){if(null==d)return"";var a,f,g={},m={},h="",n="",r="",q=2,t=3,x=2,z=[],v=0,u=0,s;for(s=0;s<d.length;s+=1)if(h=d[s],Object.prototype.hasOwnProperty.call(g,h)||(g[h]=t++,m[h]=!0),n=r+h,Object.prototype.hasOwnProperty.call(g,n))r=n;else{if(Object.prototype.hasOwnProperty.call(m,r)){if(256>r.charCodeAt(0)){for(a=0;a<x;a++)v<<=1,u==b-1?(u=0,z.push(c(v)),v=0):u++;f=r.charCodeAt(0);for(a=0;8>a;a++)v=v<<1|f&1,u==b-1?(u=0,z.push(c(v)),v=0):u++,f>>=1}else{f=1;for(a=0;a<x;a++)v=v<<1|
f,u==b-1?(u=0,z.push(c(v)),v=0):u++,f=0;f=r.charCodeAt(0);for(a=0;16>a;a++)v=v<<1|f&1,u==b-1?(u=0,z.push(c(v)),v=0):u++,f>>=1}q--;0==q&&(q=Math.pow(2,x),x++);delete m[r]}else for(f=g[r],a=0;a<x;a++)v=v<<1|f&1,u==b-1?(u=0,z.push(c(v)),v=0):u++,f>>=1;q--;0==q&&(q=Math.pow(2,x),x++);g[n]=t++;r=String(h)}if(""!==r){if(Object.prototype.hasOwnProperty.call(m,r)){if(256>r.charCodeAt(0)){for(a=0;a<x;a++)v<<=1,u==b-1?(u=0,z.push(c(v)),v=0):u++;f=r.charCodeAt(0);for(a=0;8>a;a++)v=v<<1|f&1,u==b-1?(u=0,z.push(c(v)),
v=0):u++,f>>=1}else{f=1;for(a=0;a<x;a++)v=v<<1|f,u==b-1?(u=0,z.push(c(v)),v=0):u++,f=0;f=r.charCodeAt(0);for(a=0;16>a;a++)v=v<<1|f&1,u==b-1?(u=0,z.push(c(v)),v=0):u++,f>>=1}q--;0==q&&(q=Math.pow(2,x),x++);delete m[r]}else for(f=g[r],a=0;a<x;a++)v=v<<1|f&1,u==b-1?(u=0,z.push(c(v)),v=0):u++,f>>=1;q--;0==q&&(Math.pow(2,x),x++)}f=2;for(a=0;a<x;a++)v=v<<1|f&1,u==b-1?(u=0,z.push(c(v)),v=0):u++,f>>=1;for(;;)if(v<<=1,u==b-1){z.push(c(v));break}else u++;return z.join("")},decompress:function(d){return null==
d?"":""==d?null:LZString._decompress(d.length,32768,function(b){return d.charCodeAt(b)})},_decompress:function(d,b,c){var a=[],f=4,g=4,m=3,h="",n=[],r,q,t,x,z,v=LZString._f,u=c(0),s=b,w=1;for(r=0;3>r;r+=1)a[r]=r;h=0;t=Math.pow(2,2);for(x=1;x!=t;)q=u&s,s>>=1,0==s&&(s=b,u=c(w++)),h|=(0<q?1:0)*x,x<<=1;switch(h){case 0:h=0;t=Math.pow(2,8);for(x=1;x!=t;)q=u&s,s>>=1,0==s&&(s=b,u=c(w++)),h|=(0<q?1:0)*x,x<<=1;z=v(h);break;case 1:h=0;t=Math.pow(2,16);for(x=1;x!=t;)q=u&s,s>>=1,0==s&&(s=b,u=c(w++)),h|=(0<q?
1:0)*x,x<<=1;z=v(h);break;case 2:return""}r=a[3]=z;for(n.push(z);;){if(w>d)return"";h=0;t=Math.pow(2,m);for(x=1;x!=t;)q=u&s,s>>=1,0==s&&(s=b,u=c(w++)),h|=(0<q?1:0)*x,x<<=1;switch(z=h){case 0:h=0;t=Math.pow(2,8);for(x=1;x!=t;)q=u&s,s>>=1,0==s&&(s=b,u=c(w++)),h|=(0<q?1:0)*x,x<<=1;a[g++]=v(h);z=g-1;f--;break;case 1:h=0;t=Math.pow(2,16);for(x=1;x!=t;)q=u&s,s>>=1,0==s&&(s=b,u=c(w++)),h|=(0<q?1:0)*x,x<<=1;a[g++]=v(h);z=g-1;f--;break;case 2:return n.join("")}0==f&&(f=Math.pow(2,m),m++);if(a[z])h=a[z];else if(z===
g)h=r+r[0];else return null;n.push(h);a[g++]=r+h[0];f--;r=h;0==f&&(f=Math.pow(2,m),m++)}}};"undefined"!==typeof module&&null!=module&&(module.exports=LZString);(function(d){var b={BIAS:132,CLIP:32635,tables:{ulaw:{compress:[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-32124,-31100,-30076,-29052,-28028,-27004,-25980,-24956,-23932,-22908,-21884,-20860,-19836,-18812,-17788,-16764,-15996,-15484,-14972,-14460,-13948,-13436,-12924,-12412,-11900,-11388,-10876,-10364,-9852,-9340,-8828,-8316,-7932,-7676,-7420,-7164,-6908,-6652,-6396,-6140,-5884,-5628,-5372,-5116,-4860,-4604,-4348,-4092,-3900,-3772,-3644,-3516,-3388,-3260,-3132,-3004,-2876,-2748,-2620,-2492,-2364,-2236,-2108,-1980,-1884,
-1820,-1756,-1692,-1628,-1564,-1500,-1436,-1372,-1308,-1244,-1180,-1116,-1052,-988,-924,-876,-844,-812,-780,-748,-716,-684,-652,-620,-588,-556,-524,-492,-460,-428,-396,-372,-356,-340,-324,-308,-292,-276,-260,-244,-228,-212,-196,-180,-164,-148,-132,-120,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,32124,31100,30076,29052,28028,27004,25980,24956,23932,22908,21884,20860,19836,18812,17788,16764,15996,15484,14972,14460,13948,13436,12924,12412,11900,11388,10876,10364,9852,9340,8828,8316,7932,
7676,7420,7164,6908,6652,6396,6140,5884,5628,5372,5116,4860,4604,4348,4092,3900,3772,3644,3516,3388,3260,3132,3004,2876,2748,2620,2492,2364,2236,2108,1980,1884,1820,1756,1692,1628,1564,1500,1436,1372,1308,1244,1180,1116,1052,988,924,876,844,812,780,748,716,684,652,620,588,556,524,492,460,428,396,372,356,340,324,308,292,276,260,244,228,212,196,180,164,148,132,120,112,104,96,88,80,72,64,56,48,40,32,24,16,8,0]},alaw:{compress:[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],decompress:[-5504,-5248,-6016,-5760,-4480,-4224,-4992,-4736,-7552,-7296,-8064,-7808,-6528,-6272,-7040,-6784,-2752,-2624,-3008,-2880,-2240,-2112,-2496,-2368,-3776,-3648,-4032,-3904,-3264,-3136,-3520,-3392,-22016,-20992,-24064,-23040,-17920,-16896,-19968,-18944,-30208,-29184,-32256,-31232,-26112,-25088,-28160,-27136,-11008,
-10496,-12032,-11520,-8960,-8448,-9984,-9472,-15104,-14592,-16128,-15616,-13056,-12544,-14080,-13568,-344,-328,-376,-360,-280,-264,-312,-296,-472,-456,-504,-488,-408,-392,-440,-424,-88,-72,-120,-104,-24,-8,-56,-40,-216,-200,-248,-232,-152,-136,-184,-168,-1376,-1312,-1504,-1440,-1120,-1056,-1248,-1184,-1888,-1824,-2016,-1952,-1632,-1568,-1760,-1696,-688,-656,-752,-720,-560,-528,-624,-592,-944,-912,-1008,-976,-816,-784,-880,-848,5504,5248,6016,5760,4480,4224,4992,4736,7552,7296,8064,7808,6528,6272,
7040,6784,2752,2624,3008,2880,2240,2112,2496,2368,3776,3648,4032,3904,3264,3136,3520,3392,22016,20992,24064,23040,17920,16896,19968,18944,30208,29184,32256,31232,26112,25088,28160,27136,11008,10496,12032,11520,8960,8448,9984,9472,15104,14592,16128,15616,13056,12544,14080,13568,344,328,376,360,280,264,312,296,472,456,504,488,408,392,440,424,88,72,120,104,24,8,56,40,216,200,248,232,152,136,184,168,1376,1312,1504,1440,1120,1056,1248,1184,1888,1824,2016,1952,1632,1568,1760,1696,688,656,752,720,560,528,
624,592,944,912,1008,976,816,784,880,848]}},encode:function(c,a){a=a||{};c.constructor==Array&&(c.byteLength=2*c.length);for(var f=new ArrayBuffer(c.byteLength/2),f=new Int8Array(f),d=b[a.alaw?"alaw":"ulaw"],m=0;m<c.byteLength/2;m++)f[m]=d(c[m]);return f},decode:function(c,a){a=a||{};"undefined"==typeof c.byteLength&&(c.byteLength=c.length);for(var f=!!a.floating_point,d=new ArrayBuffer(c.byteLength*(f?4:2)),d=f?new Float32Array(d):new Int16Array(d),m=b[(a.alaw?"alaw":"ulaw")+"_dec"],h,n=0;n<c.byteLength;n++)h=
m(c[n]),d[n]=f?h/32768:h;return d},alaw:function(c){var a=new ArrayBuffer(2),f=new ArrayBuffer(1),a=new Int16Array(a),f=new Int8Array(f),d;d=~c>>8&128;128!=d&&(a[0]=-c,c=a[0]);c>b.CLIP&&(c=b.CLIP);256<=c?(a=b.tables.alaw.compress[c>>8&127],f[0]=a<<4|c>>a+3&15):f[0]=c>>4;f[0]=f[0]^d^85;return f[0]},alaw_dec:function(c){var a=new ArrayBuffer(2),a=new Int8Array(a);c=b.tables.alaw.decompress[c&255];a[0]=c;a[1]=c>>8;return(new Int16Array(a.buffer))[0]},ulaw:function(c){var a=new ArrayBuffer(2),f=new ArrayBuffer(1),
a=new Int16Array(a),f=new Int8Array(f),d;0>c?(a[0]=b.BIAS-c,c=a[0],a=127):(c+=b.BIAS,a=255);d=b.tables.ulaw.compress[c>>8&127];if(8<=d)return 127^a;f[0]=d<<4|c>>d+3&15;return f[0]^a},ulaw_dec:function(c){var a=new ArrayBuffer(2),a=new Int8Array(a);c=b.tables.ulaw.decompress[c&255];a[0]=c;a[1]=c>>8;return(new Int16Array(a.buffer))[0]},ulaw_dec_slow:function(c){var a=new ArrayBuffer(2),a=new Int16Array(a);a[0]=~c;c=a[0];a=((c&15)<<3)+b.BIAS;a<<=(c&112)>>4;c=128==(c&128);var f=new ArrayBuffer(2),f=new Int16Array(f);
f[0]=c?b.BIAS-a:a-b.BIAS;return f[0]}};d.G711=b;d.version="0.0.1"})("undefined"!==typeof exports?module.exports:window);window.addEventListener("message",function(d){if(d.origin==window.location.origin)if("gotScreen"==d.data.type){var b;""===d.data.sourceId?(d=Error("NavigatorUserMediaError"),d.name="PERMISSION_DENIED",virtualclass.ss.onError(d)):(b=b||{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d.data.sourceId,maxWidth:1440,maxHeight:9999},optional:[{maxFrameRate:3},{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},virtualclass.adpt=new virtualclass.adapter,navigator2=virtualclass.adpt.init(navigator),
navigator2.getUserMedia(b,function(b){virtualclass.ss._init();virtualclass.ss.initializeRecorder.call(virtualclass.ss,b)},function(b){virtualclass.ss.onError.call(virtualclass.ss,b)}))}else"getScreenPending"==d.data.type?window.clearTimeout(d.data.id):"yes"==d.data.type&&(virtualclass.gObj.ext=!0)});(function(d){d.dirtyCorner={decodeRGB:function(b,c,a){c=c.createImageData(a.width,a.height);for(a=0;a<4*b.length;a++)c.data[4*a+0]=36.5*(b[a]>>5),c.data[4*a+1]=36.5*((b[a]&28)>>2),c.data[4*a+2]=85*(b[a]&3),c.data[4*a+3]=255;return c},decodeRGBSlice:function(b,c,a){c=c.createImageData(a.w,a.h);for(a=0;a<4*b.length;a++)c.data[4*a+0]=36.5*(b[a]>>5),c.data[4*a+1]=36.5*((b[a]&28)>>2),c.data[4*a+2]=85*(b[a]&3),c.data[4*a+3]=255;return c},encodeRGB:function(b){for(var c=b.length/4,a=new Uint8ClampedArray(c),
f,d,m,h=0;h<c;h++)f=b[4*h+0],d=b[4*h+1],m=b[4*h+2],f=(Math.round(f/36.5)<<5)+(Math.round(d/36.5)<<2)+Math.round(m/85),a[h]=f;return a},str2ImageData:function(b,c){var a=context2.createImageData(c.w,c.h),f=new ArrayBuffer(b.length);a.data=new Uint8Array(f);for(f=0;f<strLen;f++)a.data[f]=b.charCodeAt(f);return a},doClearCanvas:function(){context2.clearRect(0,0,canvas2.width,canvas2.height)}}})(window);(function(d){d.vutil={createDOM:function(b,c,a){b=document.createElement(b);"undefined"!=typeof c&&(b.id=c);if("undefined"!=typeof a){c="";if(0<a.length)for(var f=0;f<a.length;f++)c+=a[f]+" ";b.className=c}return b},ab2str:function(b){return String.fromCharCode.apply(null,new Uint8ClampedArray(b))},str2ab:function(b){for(var c=new ArrayBuffer(b.length),c=new Uint8ClampedArray(c),a=0,f=b.length;a<f;a++)c[a]=b.charCodeAt(a);return c},sidebarHeightInit:function(){document.getElementById("widgetRightSide").style.height=
d.innerHeight+"px"},isSystemCompatible:function(){if(0<virtualclass.error.length){var b=1<virtualclass.error.length?virtualclass.error.join("<br />"):virtualclass.error[0];virtualclass.view.createErrorMsg(b,"errorContainer","chatWidget");virtualclass.gObj.hasOwnProperty("errIE")&&virtualclass.vutil.disableVirtualClass();virtualclass.gObj.hasOwnProperty("audIntDisable")&&virtualclass.user.control.audioWidgetDisable();virtualclass.gObj.hasOwnProperty("errNotDesktop")&&(virtualclass.user.control.audioWidgetDisable(),
virtualclass.vutil.disableVirtualClass())}else(virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable"))&&virtualclass.user.control.audioWidgetDisable()},chkValueInLocalStorage:function(b){return null===localStorage.getItem(b)?!1:localStorage[b]},setContainerWidth:function(b,c){var a="virtualclassWhiteboard";"undefined"!=typeof virtualclass.previous&&(a="virtualclass"+c!=virtualclass.previous?"virtualclass"+c:virtualclass.previous);var a=a.split("virtualclass")[1],
a="virtualclass"+virtualclass.vutil.capitalizeFirstLetter(a),f=document.getElementById(a),d=5,m;if("Whiteboard"==c)m=0;else{m=document.getElementById("virtualclassOptionsCont");if(null!=m){var h=vcan.utility.getElementOffset(m);m=m.offsetWidth+h.x}else m=0;"Yts"==c?d=75:"EditorRich"==virtualclass.currApp||"EditorCode"==virtualclass.currApp?0<m?d=12:m="t"==virtualclass.gObj.uRole?70:5:d="ScreenShare"==c?70:65}var h=70,n=document.getElementById("commandToolsWrapper");null!=n&&(h=h+n.clientHeight+3);
b.width-=d+m+0;f.style.width=b.width+"px";f.style.height=b.height-h+"px";"virtualclassScreenShare"==a&&(d=document.getElementById(a+"Local"),b.width-=10,f.style.width=b.width,d.style.width=b.width+"px",virtualclass.vutil.setScreenInnerTagsWidth(a))},setScreenInnerTagsWidth:function(b){document.getElementById(b);document.getElementById(b+"Local");document.getElementById(b+"LocalVideo")},makeActiveApp:function(b,c){b!=c&&"undefined"!=typeof c&&(c+="Tool",document.getElementById(c).className=virtualclass.vutil.removeClassFromElement(c,
"active"));document.getElementById(b+"Tool").className+=" active"},initInstallChromeExt:function(b){"EXTENSION_UNAVAILABLE"==b.name&&(console.log("ask for inline installation"),chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(b){d.location.reload()},function(b){alert(b)}))},removeAppPanel:function(){var b=document.getElementById("virtualclassOptionsCont");null!=b&&b.parentNode.removeChild(b)},removeTempVideo:function(b){b=document.getElementById(b);
b.parentNode.removeChild(b)},createLocalTempVideo:function(b,c){if("string"==typeof b||"String"==typeof b)b=document.getElementById(b);var a=virtualclass.vutil.createDOM("div",c),f=virtualclass.vutil.createDOM("canvas",c+"Video");a.appendChild(f);b.appendChild(a)},initLocCanvasCont:function(b){var c;c="ScreenShare"==virtualclass.currApp?"ss":"wss";virtualclass[c].localtempCanvas=document.getElementById(b);virtualclass[c].localtempCont=virtualclass[c].localtempCanvas.getContext("2d")},videoTeacher2Student:function(b,
c){var a=b,f=document.getElementById("virtualclass"+b+"LocalVideo");if(null!=f&&"VIDEO"==f.tagName){var d=document.createElement("canvas");d.id=f.id;d.width=f.offsetWidth;d.height=f.offsetHeight;f.parentNode.replaceChild(d,f);"ScreenShare"==a&&(a="ss");"undefined"!=typeof c||"undefined"==typeof a||"ss"!=a&&"wss"!=a||(virtualclass[a].localCanvas=d,virtualclass[a].localCont=virtualclass[a].localCanvas.getContext("2d"),f=virtualclass[a].localtempCont.getImageData(0,0,virtualclass[a].localtempCanvas.width,
virtualclass[a].localtempCanvas.height),virtualclass[a].localCont.putImageData(f,0,0));virtualclass.vutil.removeTempVideo("virtualclass"+b+"LocalTemp")}},clickOutSideCanvas:function(){this.exitTextWrapper()&&virtualclass.wb.obj.drawTextObj.textUtility(virtualclass.wb.gObj.spx,virtualclass.wb.gObj.spy)},exitTextWrapper:function(){return 0<document.getElementsByClassName("textBoxContainer").length},attachClickOutSideCanvas:function(){function b(b){b=document.getElementById(b);null!=b&&(b.onclick=function(){virtualclass.vutil.clickOutSideCanvas()})}
b("commandToolsWrapper");b("virtualclassOptionsCont");b("audioWidget");b("chatWidget")},dimensionMatch:function(b,c){var a=document.getElementById(b).offsetWidth,f=document.getElementById("virtualclassOptionsCont").offsetWidth;return document.getElementById(c).offsetWidth+f==a},disableAppsBar:function(){var b=document.getElementById("virtualclassOptionsCont");null!=b&&(b.style.pointerEvents="none")},isMiniFileIncluded:function(b){b=new RegExp(b+".js?=*([0-9]*)");for(var c=document.getElementsByTagName("script"),
a=0;a<c.length;a++)if(b.test(c[a].src))return!0;return!1},clearAllChat:function(){localStorage.removeItem(virtualclass.gObj.uid);sessionStorage.clear("chatroom");virtualclass.chat.idList.length=0;clearAllChatBox();var b=document.getElementById("chatWidget").getElementsByClassName("ui-chatbox-msg");if(0<b.length)for(;null!=b[0];)b[0].parentNode.removeChild(b[0])},isObjectEmpty:function(b){for(var c in b)if(b.hasOwnProperty(c))return!1;return!0},removeSessionTool:function(){if(null==localStorage.getItem("orginalTeacherId")){var b=
document.getElementById("virtualclassSessionEndTool");null!=b&&b.parentNode.removeChild(b)}},toggleRoleClass:function(b){if(null!=localStorage.getItem("teacherId")&&null==localStorage.getItem("orginalTeacherId")||b)document.getElementById("virtualclassCont").classList.toggle("teacher"),document.getElementById("virtualclassCont").classList.toggle("student")},addClass:function(b,c){var a=document.getElementById(b);virtualclass.vutil.elemHasAnyClass(b)?a.classList.add(c):a.className=c},removeClass:function(b,
c){var a=document.getElementById(b);virtualclass.vutil.elemHasAnyClass(b)&&a.classList.contains(c)&&a.classList.remove(c)},breakIntoBytes:function(b,c){for(var a=b.toString(),f=a.length;f<c;f++)a="0"+a;return a.match(/[\S]{1,2}/g)||[]},numValidateFour:function(b,c,a,f){b=this.preNumValidateTwo(b);c=this.preNumValidateTwo(c);a=this.preNumValidateTwo(a);f=this.preNumValidateTwo(f);return parseInt(b+c+a+f)},numValidateTwo:function(b,c){b=this.preNumValidateTwo(b);c=this.preNumValidateTwo(c);return parseInt(b+
c)},preNumValidateTwo:function(b){b=b.toString();if(1==b.length)return"0"+b;if(2==b.length)return b},elemHasAnyClass:function(b){b=document.getElementById(b);return null!=b?"undefined"!=typeof b.classList:!1},userIsOrginalTeacher:function(b){return null!=localStorage.getItem("orginalTeacherId")},isUserTeacher:function(b){return null!=localStorage.getItem("teacherId")},initDisableAudVid:function(){virtualclass.gObj.audIntDisable=!0;virtualclass.gObj.vidIntDisable=!0},initDisableVirtualClass:function(){this.initDisableAudVid();
virtualclass.gObj.errNotDesktop=!0;virtualclass.gObj.errNotScreenShare=!0;virtualclass.gObj.errAppBar=!0},disableVirtualClass:function(){var b=document.getElementById("virtualclassCont");b.style.opacity=.6;b.style.pointerEvents="none"},enableVirtualClass:function(){var b=document.getElementById("virtualclassCont");b.style.opacity=1;b.style.pointerEvents="visible"},firstiOSaudioCall:function(){virtualclass.gObj.hasOwnProperty("audioPlayMessage")&&(virtualclass.gObj.iosIpadbAudTrue=!0,virtualclass.gObj.video.audio.receivedAudioProcess(virtualclass.gObj.audioPlayMessage))},
beforeLoad:function(){if("undefined"!=typeof virtualclass.storage.wholeStoreData){var b=JSON.parse(virtualclass.storage.wholeStoreData);b.beforeRefresh=!0;virtualclass.storage.wholeStore(b,"put")}localStorage.setItem("totalStored",virtualclass.storage.totalStored);localStorage.removeItem("otherRole");virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.video.audio.studentNotSpeak();virtualclass.vutil.clickOutSideCanvas();localStorage.setItem(wbUser.sid,JSON.stringify(virtualclass.chat.vmstorage));
virtualclass.hasOwnProperty("editorRich")&&"object"==typeof virtualclass.editorRich.vcAdapter&&virtualclass.editorRich.saveIntoLocalStorage();virtualclass.hasOwnProperty("editorCode")&&"object"==typeof virtualclass.editorCode.vcAdapter&&virtualclass.editorCode.saveIntoLocalStorage();b={name:virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp)};"ScreenShare"==virtualclass.currApp?b.name="EditorRich":"Yts"==virtualclass.currApp&&(b.metaData={init:virtualclass.yts.videoId,startFrom:virtualclass.yts.player.getCurrentTime()});
"s"==virtualclass.gObj.uRole?"Yts"!=virtualclass.currApp&&localStorage.setItem("prevApp",JSON.stringify(b)):localStorage.setItem("prevApp",JSON.stringify(b));io.disconnect()},initOnBeforeUnload:function(b){"iOS"==b?document.body.onunload=function(){virtualclass.vutil.beforeLoad()}:d.onbeforeunload=function(){virtualclass.vutil.beforeLoad()}},isPlayMode:function(){return!0==d.wbUser.virtualclassPlay},progressBar:function(b,c,a,f){c>b&&(c=b,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));
b=0==b&&0==c?0:Math.round(100*c/b);document.getElementById(a).style.width=b+"%";document.getElementById(f).innerHTML=b+"%"},hidePrevIcon:function(b){var c=document.getElementById(virtualclass.previous);null!=c&&(c.style.display="none",document.getElementById(virtualclass[b].id).style.display="block")},getUserInfo:function(b,c,a){for(var f=0;f<a.length;f++)if(a[f].userid==c)return a[f][b]},smallizeFirstLetter:function(b){return b.charAt(0).toLowerCase()+b.slice(1)},capitalizeFirstLetter:function(b){return b.charAt(0).toUpperCase()+
b.slice(1)},initDefaultInfo:function(b,c){"t"==b&&"Whiteboard"==c?null==localStorage.getItem("orginalTeacherId")&&(virtualclass.wb.utility.setOrginalTeacherContent(),virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0)):"s"==b&&(vcan.studentId=wbUser.id,null==localStorage.getItem("studentId")&&null==localStorage.getItem("teacherId")&&localStorage.setItem("studentId",wbUser.id),virtualclass.vutil.removeSessionTool());virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||
(virtualclass.gObj.video.init(),virtualclass.gObj.video.isInitiator=!0);vcan.oneExecuted=!1},removeClassFromElement:function(b,c){if("t_reclaim"!=b){b=document.getElementById(b).className;for(var a=b.split(" "),f=[],d=0;d<a.length;d++)a[d]!=c&&f.push(a[d]);return 1<f.length?f.join(" "):f[0]}},beforeSend:function(b,c){if(b.hasOwnProperty("createArrow")){var a=JSON.stringify(b);virtualclass.wb.vcan.optimize.sendPacketWithOptimization(a,io.sock.readyState,100)}else{if(b.hasOwnProperty("repObj")){if("undefined"==
typeof b.repObj[b.repObj.length-1])return;virtualclass.wb.gObj.rcvdPackId=b.repObj[b.repObj.length-1].uid;virtualclass.wb.gObj.displayedObjId=virtualclass.wb.gObj.rcvdPackId}a=JSON.stringify(b);"object"==typeof virtualclass.wb&&(virtualclass.wb.sentPackets+=a.length);null!=io.sock&&1==io.sock.readyState&&("undefined"==typeof c?io.send(b):io.send(b,c));JSON.parse(a).hasOwnProperty("repObj")&&virtualclass.wb.utility.updateSentInformation(a)}localStorage.sentPackets=virtualclass.wb.sentPackets},breakintobytes:function(b,
c){for(var a=b.toString(),f=a.length;f<c;f++)a="0"+a;return a.match(/[\S]{1,2}/g)||[]},setOrginalTeacher:function(){null==localStorage.getItem("reclaim")&&localStorage.setItem("teacherId",virtualclass.gObj.uid);localStorage.setItem("orginalTeacherId",virtualclass.gObj.uid)},createReclaimButton:function(b){this.createDiv("t_reclaim","reclaim",b);var c=this;document.getElementById("t_reclaim").getElementsByTagName("a")[0].addEventListener("click",function(){c._reclaimRole()})},createDiv:function(b,
c,a,f){var d=c;c=virtualclass.lang.getString(c);var m=document.createElement("a");m.href="#";var h=document.createElement("div");h.id=b;"undefined"!=typeof f&&(h.className=f);f=document.createElement("span");f.className="icon-"+d;m.appendChild(f);m.dataset.title=c;m.className="tooltip";h.appendChild(m);"t_reclaim"==b?(b=document.getElementById(virtualclass.html.id),a.appendChild(h),b.insertBefore(a,b.firstChild)):a.appendChild(h)},assignRole:function(b){"object"==typeof virtualclass.wb&&(virtualclass.wb.tool=
"","move"==vcan.main.action&&virtualclass.wb.utility.deActiveFrmDragDrop());if("undefined"!=typeof b){if(null!=localStorage.getItem("reclaim")){var c=document.getElementById(virtualclass.gObj.commandToolsWrapperId);c.parentNode.removeChild(c);localStorage.removeItem("reclaim");virtualclass.vutil.removeClass("virtualclassCont","reclaim")}else virtualclass.vutil.addClass("virtualclassCont","assign"),virtualclass.vutil.removeClass("virtualclassCont","removedAssign");localStorage.removeItem("studentId");
localStorage.setItem("teacherId",b);virtualclass.gObj.uRole="t";virtualclass.user.assignRole(virtualclass.gObj.uRole,virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp));"object"==typeof virtualclass.wb&&vcan.utility.canvasCalcOffset(vcan.main.canid);"Yts"==virtualclass.currApp&&(b=document.getElementById("virtualclassYts"),null!=b?null==document.getElementById("player")&&virtualclass.yts.UI.createPlayerTag(b):virtualclass.yts.UI.container(),virtualclass.yts.UI.inputURL(),virtualclass.yts.seekChangeInterval())}else{"Yts"==
virtualclass.currApp&&(virtualclass.yts.UI.removeinputURL(),virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc));virtualclass.gObj.uRole="s";c=document.getElementById(virtualclass.gObj.commandToolsWrapperId);if(null!=c)for(;c.hasChildNodes();)c.removeChild(c.lastChild);else c=virtualclass.vutil.createCommandWrapper();"object"==typeof virtualclass.wb&&virtualclass.wb.utility.makeCanvasDisable();"undefined"!=typeof localStorage.orginalTeacherId?(document.getElementById("virtualclassCont"),
virtualclass.vutil.createReclaimButton(c),localStorage.setItem("reclaim",!0),virtualclass.vutil.addClass("virtualclassCont","reclaim")):(virtualclass.vutil.removeClass("virtualclassCont","assign"),virtualclass.vutil.addClass("virtualclassCont","removedAssign"),null!=c&&c.parentNode.removeChild(c));b=localStorage.getItem("teacherId");localStorage.removeItem("teacherId");localStorage.setItem("studentId",b);"object"==typeof virtualclass.wb&&virtualclass.wb.utility.uniqueArrOfObjsToStudent()}virtualclass.system.setAppDimension();
virtualclass.vutil.toggleRoleClass(!0)},createCommandWrapper:function(){var b=document.createElement("div");b.id=virtualclass.gObj.commandToolsWrapperId;var c=document.getElementById(vcan.canvasWrapperId);null!=c?document.getElementById("containerWb").insertBefore(b,c):document.getElementById("containerWb").appendChild(b);return b},_reclaimRole:function(){this.reclaimRole();virtualclass.vutil.beforeSend({reclaimRole:!0});virtualclass.user.control.changeAttrToAssign("enable")},reclaimRole:function(){virtualclass.gObj.controlAssign=
!1;this.vcResponseAssignRole(virtualclass.gObj.uid,virtualclass.gObj.uid,!0)},vcResponseAssignRole:function(b,c,a){if(b!=c||"undefined"!=typeof a)if(virtualclass.vutil.assignRole(c),"object"==typeof virtualclass.wb&&virtualclass.wb.utility.uniqueArrOfObjsToTeacher(),null==localStorage.getItem("orginalTeacherId")){virtualclass.vutil.removeSessionTool();c=document.getElementById("ml"+b);a=["assign"];var f=document.getElementById(b+"ControlContainer");null!=f?virtualclass.user.createAssignControl(f,
b,!0):(a=virtualclass.user.createControl(b,a),c.appendChild(a));localStorage.setItem("aId",b)}else b=document.getElementById("chat_div").getElementsByClassName("currTeacher")[0],null!=b&&virtualclass.user.control.removeCurrTeacherFromControl(b.id),virtualclass.user.control.changeAttrToAssign("enable");virtualclass.vutil.attachClickOutSideCanvas();"mobTab"==virtualclass.system.device&&(virtualclass.vutil.disableVirtualClass(),virtualclass.view.createErrorMsg(virtualclass.lang.getString("supportDesktop"),
"errorContainer","chatWidget"))},vcResponseAReclaimRole:function(b,c){b!=c&&(virtualclass.user.control._assign(c,"notsent",b),virtualclass.user.displayStudentSpeaker(!0),null!=localStorage.getItem("aId")&&localStorage.removeItem("aId"),virtualclass.user.control.removeAudioFromParticipate(b),"mobTab"==virtualclass.system.device&&((virtualclass.system.mybrowser.name=8<=virtualclass.system.mybrowser.version)&&/(iPad)/g.test(navigator.userAgent)&&virtualclass.vutil.enableVirtualClass(),virtualclass.view.removeErrorMsg("errorContainer",
!0)))},createReclaimButtonIfNeed:function(){if(virtualclass.vutil.chkValueInLocalStorage("reclaim")&&virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId")){var b=virtualclass.vutil.createCommandWrapper();virtualclass.vutil.createReclaimButton(b);virtualclass.gObj.uRole="s";return!0}return!1}}})(window);(function(d){var b,c,a,f,g,m;d.studentScreen=function(){return{ssProcess:function(a,b,c,f){var d=a[0];a=new Uint8ClampedArray(b);var g,m,v,u;switch(d){case 102:case 202:v=virtualclass.vutil.numValidateTwo(a[1],a[2]);m=virtualclass.vutil.numValidateTwo(a[3],a[4]);b=a.subarray(5,a.length);this.initStudentScreen(b,{w:v,h:m},c,f);break;case 103:case 203:b=7;for(v=0;v+7<=a.length;v=u+1)d=virtualclass.vutil.numValidateTwo(a[v+1],a[v+2]),g=virtualclass.vutil.numValidateTwo(a[v+3],a[v+4]),m=parseInt(a[v+
5]),v=parseInt(a[v+6]),u=b+m*v-1,b=a.subarray(b,u+1),this.initStudentScreen(b,{x:d,y:g,w:v,h:m},c,f),b=u+7+1;break;case 104:case 204:d=virtualclass.vutil.numValidateTwo(a[1],a[2]),g=virtualclass.vutil.numValidateTwo(a[3],a[4]),m=virtualclass.vutil.numValidateTwo(a[5],a[6]),v=virtualclass.vutil.numValidateTwo(a[7],a[8]),b=a.subarray(9,a.length),a={d:{w:d,h:g},vc:{w:m,h:v}},this.initStudentScreen(b,a,c,f)}},initStudentScreen:function(a,b,f,d){virtualclass.vutil.addClass("audioWidget","fixed");g=f;"object"!=
typeof virtualclass[g]?("undefined"!=typeof vtype&&(virtualclass.recorder.recImgPlay=!0),virtualclass.makeAppReady(d)):virtualclass.vutil.hidePrevIcon(g);if(b.hasOwnProperty("d"))virtualclass[g].dimensionStudentScreenResize(b),m=!0,virtualclass[g].drawImages(a);else{if("undefined"==typeof m||"undefined"!=typeof c&&c!=b.w&&!b.hasOwnProperty("x"))m=!0,virtualclass[g].dimensionStudentScreen(b.w,b.h),c=b.w;b.hasOwnProperty("x")?virtualclass[g].drawImages(a,b):(b.hasOwnProperty("w")&&(virtualclass[g].localCanvas.width=
b.w,virtualclass[g].localCanvas.height=b.h),virtualclass[g].drawImages(a))}virtualclass.previous=virtualclass[g].id}}};d.screenShare=function(c){virtualclass.getSceenFirefox=function(){var a=parseInt(d.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);33<=a?(virtualclass.adpt=new virtualclass.adapter,virtualclass.adpt.init(navigator).getUserMedia({video:{mozMediaSource:"window",mediaSource:"window"}},function(a,b){virtualclass.ss._init();virtualclass.ss.initializeRecorder.call(virtualclass.ss,a);
if("undefined"==typeof b)var c=a.currentTime,f=d.setInterval(function(){a||d.clearInterval(f);if(a.currentTime==c&&(d.clearInterval(f),a.onended))a.onended();c=a.currentTime},500)},function(a){"string"==typeof a?"PERMISSION_DENIED"===a&&d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus():"object"==typeof a&&"PermissionDeniedError"===a.name&&d.open("https://addons.mozilla.org/en-US/firefox/addon/ff_screenshare/").focus()})):alert(virtualclass.lang.getString("notSupportBrowser",
[a]))};return{prevStream:!1,init:function(a){this.type=a.type;this.ssByClick=!0;this.manualStop=!1;"t"!=virtualclass.gObj.uRole||virtualclass.recorder.recImgPlay?this._init():this.readyTostart(a.app)},_init:function(){virtualclass.previous!=c.id&&(document.getElementById(virtualclass.previous).style.display="none",virtualclass.previous=c.id);var a=document.getElementById(c.id);null!=a&&(a.style.display="block");if(!this.hasOwnProperty("id")){this.dc=virtualclass.dirtyCorner;this.postFix="Cont";this.id=
c.hasOwnProperty("id")?c.id:"virtualclassScreenShare";this.className="virtualclass";this.label="Local";this.local=this.id+this.label;this.localTemp=this.id+this.label+"Temp";this.classes=c.hasOwnProperty("class")?c.classes:"";this.initPrevImage();a=document.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);var a=this.html.UI.call(this,virtualclass.gObj.uRole),b=document.getElementById(virtualclass.rWidgetConfig.id);document.getElementById(virtualclass.html.id).insertBefore(a,b);"t"!=virtualclass.gObj.uRole||
virtualclass.recorder.recImgPlay||virtualclass.vutil.initLocCanvasCont(this.localTemp+"Video")}},readyTostart:function(a){a==virtualclass.apps[1]&&this.getScreen()},onError:function(a){console.log("Error "+a)},getScreen:function(a){"Chrome"==virtualclass.system.mybrowser.name?virtualclass.gObj.hasOwnProperty("ext")&&virtualclass.gObj.ext?d.postMessage({type:"getScreen",id:1},"*"):chrome.webstore.install("https://chrome.google.com/webstore/detail/ijhofagnokdeoghaohcekchijfeffbjl",function(){d.location.reload()}):
"Firefox"==virtualclass.system.mybrowser.name&&virtualclass.getSceenFirefox()},unShareScreen:function(){this.video.src="";this.localtempCont.clearRect(0,0,this.localtempCanvas.width,this.localtempCanvas.height);clearInterval(virtualclass.clear);this.initPrevImage();this.hasOwnProperty("currentStream")&&this.currentStream.stop();virtualclass.vutil.beforeSend({unshareScreen:!0,st:this.type})},removeStream:function(){virtualclass.vutil.removeClass("audioWidget","fixed");this.localCont.clearRect(0,0,
this.localCanvas.width,this.localCanvas.height)},initializeRecorder:function(a){virtualclass.vutil.addClass("audioWidget","fixed");b=1;this.prevStream&&(this.ssByClick=!1);"undefined"!=typeof virtualclass.prevScreen&&virtualclass.prevScreen.hasOwnProperty("currentStream")&&virtualclass.prevScreen.unShareScreen();this.video=document.getElementById(this.local+"Video");if("VIDEO"!=this.video.tagName){var c=this.video,f=document.createElement("video");f.id=c.id;this.video.parentNode.replaceChild(f,this.video);
this.video=document.getElementById(this.local+"Video");this.video.autoplay=!0;virtualclass.vutil.createLocalTempVideo("virtualclassScreenShare",this.local+"Temp");virtualclass.vutil.initLocCanvasCont(this.local+"TempVideo")}this.currentStream=a;var g=this;console.log("video changed");virtualclass.adpt.attachMediaStream(this.video,a);this.prevStream=!0;this.currentStream.onended=function(a){g.ssByClick?(g.video.src="",g.localtempCont.clearRect(0,0,g.localtempCanvas.width,g.localtempCanvas.height),
clearInterval(virtualclass.clear),g.initPrevImage(),virtualclass.vutil.beforeSend({unshareScreen:!0,st:g.type}),g.prevStream=!1,g.prevScreen="",virtualclass.prevScreen=""):g.ssByClick=!0};a={};a.width=d.innerWidth;a.height=d.innerHeight-140;var c=document.getElementById(this.local),h=this.html.getDimension(a);c.style.width=Math.round(h.width)+"px";c.style.height=Math.round(h.height)+"px";g=this;this.video.onloadedmetadata=function(){g.width=h.width;g.height=h.height;g.localtempCanvas.width=g.video.offsetWidth;
g.localtempCanvas.height=g.video.offsetHeight;virtualclass.prevScreen=g;var a=virtualclass.system.measureResoultion({width:d.innerWidth,height:d.innerHeight});g.sharing();virtualclass.vutil.setContainerWidth(a,virtualclass.currApp);"t"==virtualclass.gObj.uRole&&(virtualclass.vutil.makeActiveApp(g.id,virtualclass.previrtualclass),"virtualclassYts"==virtualclass.previrtualclass&&virtualclass.yts.destroyYT());virtualclass.previrtualclass=g.id}},sharing:function(){function c(a,b){for(var f=a.toString(),
d=f.length;d<b;d++)f="0"+f;return f.match(/[\S]{1,2}/g)||[]}function g(){clearInterval(virtualclass.clear);if("undefined"!=typeof a&&"undefined"!=typeof f){if(a!=u.video.offsetWidth||f!=u.video.offsetHeight)b=1}else a=u.video.offsetWidth,f=u.video.offsetHeight;1==b?setTimeout(m,2E3):x(u.type)}function h(a){s=400>=a||"undefined"==typeof a?400:1E4<=a?a/2:a;4*w<s&&(s=4*w);400<s&&console.trace();w=s}function m(){console.log("RESIZE");a=u.video.offsetWidth;f=u.video.offsetHeight;z=Math.round(u.localtempCanvas.height/
12);v=Math.round(u.localtempCanvas.width/12);var t=u.type;u.localtempCanvas.width=u.video.offsetWidth;u.localtempCanvas.height=u.video.offsetHeight;u.localtempCont.drawImage(u.video,0,0,u.video.offsetWidth,u.video.offsetHeight);var x=u.localtempCont.getImageData(0,0,u.localtempCanvas.width,u.localtempCanvas.height),x=u.dc.encodeRGB(x.data),w=Math.round(u.localtempCanvas.width/v),L=Math.round(u.localtempCanvas.height/z),E,S,T,U;U=u.getContainerDimension();"undefined"!=typeof a&&"undefined"!=typeof f?
(E=c(a,4),S=c(f,4)):(E=c(u.video.offsetWidth,4),S=c(u.video.offsetHeight,4));T=c(U.width,4);U=c(U.height,4);t=new Uint8ClampedArray(["ss"==t?104:204,E[0],E[1],S[0],S[1],T[0],T[1],U[0],U[1]]);E=new Uint8ClampedArray(x.length+t.length);E.set(t);E.set(x,t.length);d.Worker&&sworker.postMessage({img:x,resize:1,resA:z,resB:v,dw:w,dh:L,offsetWidth:u.video.offsetWidth,offsetHeight:u.video.offsetHeight},[x.buffer]);io.sendBinary(E);h(E.length/128);b=0;clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,
s)}function x(a){u.localtempCanvas.width=u.video.offsetWidth;u.localtempCanvas.height=u.video.offsetHeight;u.localtempCont.drawImage(u.video,0,0,u.video.offsetWidth,u.video.offsetHeight);a=Math.round(u.localtempCanvas.width/v);var b=Math.round(u.localtempCanvas.height/z),c=u.localtempCont.getImageData(0,0,u.video.offsetWidth,u.video.offsetHeight);d.Worker&&(sworker.postMessage({img:c.data,resA:z,resB:v,dw:a,dh:b,offsetWidth:u.video.offsetWidth,offsetHeight:u.video.offsetHeight,type:u.type},[c.data.buffer]),
sworker.onmessage=function(a){if(1==a.data.needFullScreen){a=virtualclass.getDataFullScreen(u.type);io.sendBinary(a);var b=a.length/128}else null!=a.data.masterSlice&&(io.sendBinary(a.data.masterSlice),b=a.data.masterSlice.length/128);h(b)});clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,s)}var z=Math.round(this.localtempCanvas.height/12),v=Math.round(this.localtempCanvas.width/12),u=this;virtualclass.hasOwnProperty("wholeImage")&&clearInterval(virtualclass.wholeImage);virtualclass.hasOwnProperty("clear")&&
clearInterval(virtualclass.clear);var s=1E3,w=1E3;virtualclass.getDataFullScreen=function(a){u.localtempCanvas.width=u.video.offsetWidth;u.localtempCanvas.height=u.video.offsetHeight;u.localtempCont.drawImage(u.video,0,0,u.video.offsetWidth,u.video.offsetHeight);var b=u.localtempCont.getImageData(0,0,u.localtempCanvas.width,u.localtempCanvas.height),b=u.dc.encodeRGB(b.data),f=c(u.localtempCanvas.height,4),d=c(u.localtempCanvas.width,4);a=new Uint8ClampedArray(["ss"==a?102:202,d[0],d[1],f[0],f[1]]);
f=new Uint8ClampedArray(b.length+a.length);f.set(a);f.set(b,a.length);return f};clearInterval(virtualclass.clear);virtualclass.clear=setInterval(g,s)},getContainerDimension:function(){var a=document.getElementById(this.id+"Local");return{width:a.offsetWidth,height:a.offsetHeight}},drawImages:function(a,b){if("undefined"!=typeof b){var c=this.dc.decodeRGBSlice(a,this.localCont,b);this.localCont.putImageData(c,b.x,b.y)}else c=this.dc.decodeRGB(a,this.localCont,this.localCanvas),this.localCont.putImageData(c,
0,0)},drawSingleImage:function(a){a=this.dc.decodeRGB(a,this.localCont,this.localCanvas);this.localCont.putImageData(a,0,0)},dimensionStudentScreen:function(a,b){this.localCanvas=document.getElementById(virtualclass[g].local+"Video");this.localCont=virtualclass[g].localCanvas.getContext("2d");this.localCanvas.width=a;this.localCanvas.height=b;console.log("normal width "+this.localCanvas.width)},dimensionStudentScreenResize:function(a,b){this.hasOwnProperty("vac")||(this.vac=!0,this.localCanvas=document.getElementById(virtualclass[g].local+
"Video"),this.localCont=virtualclass[g].localCanvas.getContext("2d"));a.hasOwnProperty("d")&&(this.localCont.clearRect(0,0,this.localCanvas.width,this.localCanvas.height),this.localCanvas.width=a.d.w,this.localCanvas.height=a.d.h);if(a.hasOwnProperty("vc")){var c=document.getElementById(virtualclass[g].local);c.style.width=a.vc.w+"px";c.style.height=a.vc.h+"px"}"virtualclassScreenShare"==virtualclass.previous&&virtualclass.vutil.setScreenInnerTagsWidth(virtualclass.previous)},html:{UI:function(a){var b=
virtualclass.vutil.createDOM("div",this.id,[this.className]),c=virtualclass.vutil.createDOM("div",this.local,[this.label]);if("t"==a){if(virtualclass.recorder.recImgPlay)var f=virtualclass.vutil.createDOM("canvas",this.local+"Video");else f=virtualclass.vutil.createDOM("video",this.local+"Video"),f.setAttribute("autoplay",!0);c.style.cssText+=";position:relative"}else f=virtualclass.vutil.createDOM("canvas",this.local+"Video");c.appendChild(f);b.appendChild(c);"t"!=a||virtualclass.recorder.recImgPlay||
virtualclass.vutil.createLocalTempVideo(b,this.localTemp);return b},getDimension:function(a,b){return{height:a.height,width:a.width}}},initPrevImage:function(){sworker.postMessage({initPrevImg:!0})}}}})(window);(function(d){function b(a){document.body.removeChild(a.target)}var c,a={},f=1,g=1,m={items:[],recImgPlay:!1,objn:0,playTimeout:"",totalSent:0,fileQueue:[],rnum:1,storeDone:0,emn:0,allFileFound:!1,waitServer:!1,waitPopup:!1,tempRecData:[],alreadyAskForPlay:!1,playStart:!1,error:0,mkDownloadLink:"",tillPlayTime:0,getPlayTotTime:!1,importfilepath:d.importfilepath,exportfilepath:d.exportfilepath,sessionKey:randomString(11),init:function(a){var b=virtualclass.wb.vcan;if("undefined"!=typeof myfunc)this.objs=
b.getStates("replayObjs");else{var f=this;if("fromplay"==a)virtualclass.storage.getAllObjs(["allData"],function(){f.play()});else{for(var b=this.hasOwnProperty("prvNum")?this.prvNum:0,d=0;d<a.length;d++)this.items.push(a[d]);for(k=0;k<a.length;k++){if(a[k].hasOwnProperty("bd"))for("a"==a[k].bd?c=virtualclass.dtCon.base64DecToArrInt(a[k].recObjs):"c"==a[k].bd&&(c=virtualclass.dtCon.base64DecToArrclm(a[k].recObjs)),this.items[b].recObjs=c,d=0;d<c.length;d++)this.items[b].recObjs[d]=c[d];b++}this.hasOwnProperty("prvNum")||
f.play();this.prvNum=b}}},replayFromStart:function(){var a=[],a=this.items;virtualclass.storage.config.endSession();virtualclass.popup.closeElem();this.recImgPlay=!1;this.objn=0;this.playTimeout="";this.totalSent=0;this.fileQueue=[];this.rnum=1;this.emn=this.storeDone=0;this.waitPopup=this.waitServer=!1;this.tempRecData=[];this.playStart=this.alreadyAskForPlay=!1;this.error=0;this.mkDownloadLink="";this.tillPlayTime=0;this.getPlayTotTime=!1;this.controller.ff=1;this.items=a;this.playProgressBar();
this.play()},startUploadProcess:function(){virtualclass.recorder.exportData(function(){});virtualclass.popup.sendBackOtherElems()},exportData:function(a){virtualclass.popup.openProgressBar();virtualclass.recorder.items=[];virtualclass.storage.getAllObjs(["allData"],function(){"function"==typeof a&&a()})},convertInto:function(a){if("string"==typeof a.data)return a;a.data=a.data.buffer;return a},clearPopups:function(){virtualclass.popup.closeElem();virtualclass.pbar.renderProgressBar(0,0,"progressBar",
"progressValue");virtualclass.storage.config.endSession()},playProgressBar:function(){this.getPlayTotTime||(this.totPlayTime=this.items.reduce(function(a,b){return b.hasOwnProperty("playTime")?{playTime:a.playTime+b.playTime}:a.playTime}),this.getPlayTotTime=!0);if(0<this.tillPlayTime){this.tillPlayTime>this.totPlayTime&&(this.tillPlayTime=this.totPlayTime);virtualclass.pbar.renderProgressBar(this.totPlayTime,this.tillPlayTime,"playProgressBar",void 0);var a=this.convertIntoReadable(this.tillPlayTime);
document.getElementById("tillRepTime").innerHTML=a.m+" : "+a.s;"undefined"==typeof alreadyCalcTotTime&&(a=this.convertIntoReadable(this.totPlayTime),document.getElementById("totalRepTime").innerHTML=a.m+" : "+a.s,alreadyCalcTotTime=!0)}else virtualclass.pbar.renderProgressBar(this.totPlayTime,0,"playProgressBar",void 0)},convertIntoReadable:function(a){a/=1E3;return{s:Math.floor(a%60),m:Math.floor(a/60)}},xhrsenddata:function(a,b,c){"undefined"!=typeof b&&(virtualclass.recorder.error=1);"undefined"!=
typeof c&&(virtualclass.recorder.mkDownloadLink=c);if(1!=virtualclass.recorder.storeDone){"undefined"!=typeof earlierTimeout&&clearTimeout(earlierTimeout);if("undefined"==typeof a||""==a)a="first";virtualclass.recorder.rnum=a;virtualclass.storage.getrowData(["chunkData"],function(a,b){if("string"==typeof a||"undefined"==typeof a)console.log("should invoke only once"),earlierTimeout=setTimeout(function(){virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum)},1E3);else if(a.hasOwnProperty("status")&&
"done"==a.status)console.log("should invoked download function on "),virtualclass.recorder.storeDone=1,console.log("From here actuall recorder finished"),"undefined"!=typeof virtualclass.recorder.mkDownloadLink&&""!=virtualclass.recorder.mkDownloadLink?virtualclass.recorder.mkDownloadLink:setTimeout(function(){virtualclass.recorder.afterRecording()},1E3);else if("undefined"!=typeof b&&(virtualclass.recorder.rnum=b),1==virtualclass.recorder.error)0==virtualclass.recorder.storeDone&&(virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum,
"error"),virtualclass.recorder.rnum++);else{var c=new FormData;c.append("record_data",JSON.stringify(a));c.append("user",virtualclass.gObj.uid);c.append("cn",g);c.append("sesseionkey",virtualclass.recorder.sessionKey);virtualclass.recorder.items=[];virtualclass.xhr.send(c,importfilepath,function(b){"done"===b?(virtualclass.pbar.renderProgressBar(a.totalStore,a.totalSent,"progressBar","progressValue"),virtualclass.recorder.rnum++,g++,virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum)):"ERROR"===
b?virtualclass.recorder.tryForReTransmit():alert(b)})}},virtualclass.recorder.rnum)}},afterRecording:function(){virtualclass.storage.config.endSession();document.getElementById("progressContainer").style.display="none";var a=document.getElementById("recordFinishedMessageBox");a.style.display="block";a.classList.add("MessageBoxFinished");document.getElementById("recordingContainer").classList.add("recordingFinished");document.getElementById("recordingClose").addEventListener("click",function(){d.location.reload()})},
tryForReTransmit:function(){setTimeout(function(){1>=virtualclass.recorder.emn?(virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum),virtualclass.recorder.emn++):virtualclass.recorder.startDownloadProcess()},1E3)},makeAvailDownloadFile:function(){var a=document.getElementById("recordingContainer"),c=document.createElement("div");c.id="downloadFileCont";var f=document.createElement("div");f.id="errormsessage";c.appendChild(f);var g=document.createElement("button");g.id="downloadButton";g.innerHTML=
"Download File";var m=document.createElement("a");m.id="dlink";m.href="";m.download="session.vcp";c.appendChild(g);a.appendChild(c);virtualclass.storage.getAllDataForDownload(["chunkData"],function(a){var c=new Blob([a],{type:"application/virtualclass"});g.addEventListener("click",function(){null!=d.webkitURL?m.href=d.webkitURL.createObjectURL(c):(m.href=d.URL.createObjectURL(c),m.onclick=b,document.body.appendChild(m));m.click()})})},startDownloadProcess:function(){console.log("this should not happend "+
virtualclass.recorder.storeDone);virtualclass.recorder.storeDone?this.makeAvailDownloadFile():virtualclass.recorder.xhrsenddata(virtualclass.recorder.rnum,"error",this.makeAvailDownloadFile)},sendDataToServer:function(){virtualclass.storage.db.transaction(["chunkData"],"readwrite").objectStore("chunkData").clear();virtualclass.popup.waitBlockAction("none");d.Worker&&(mvDataWorker.postMessage({rdata:virtualclass.recorder.items,totalStored:virtualclass.storage.totalStore,makeChunk:!0}),mvDataWorker.onmessage=
function(a){virtualclass.storage.chunkStorage(a.data)})},displayWaitPopupIfNot:function(){!1==this.waitPopup&&(virtualclass.popup.sendBackOtherElems(),document.getElementById("recordingContainer").style.display="none",virtualclass.popup.waitBlockAction("block"),virtualclass.pbar.renderProgressBar(0,0,"downloadProgressBar","downloadProgressValue"),virtualclass.popup.waitBlock(),this.waitPopup=!0)},requestDataFromServer:function(a,b){this.displayWaitPopupIfNot(virtualclass.lang.getString("plswaitwhile"));
var c=new FormData;c.append("prvfile",b);c.append("fileBundelId",a);virtualclass.xhr.send(c,exportfilepath,function(b){virtualclass.recorder.sendToWorker(b,a)})},sendToWorker:function(a,b){d.Worker&&(mvDataWorker.postMessage({rdata:a,getData:!0}),mvDataWorker.onmessage=function(a){f++;var c=virtualclass.recorder.isUptoBaseValue(a.data.alldata.totalSent,a.data.alldata.totalStore,30);virtualclass.recorder.ctotalStore=a.data.alldata.totalStore;virtualclass.recorder.ctotalSent=a.data.alldata.totalSent;
virtualclass.pbar.renderProgressBar(a.data.alldata.totalStore,a.data.alldata.totalSent,"downloadProgressBar","downloadProgressValue");c&&!virtualclass.recorder.alreadyAskForPlay?(a.data.alldata.totalSent>a.data.alldata.totalStore?virtualclass.recorder.askToPlay("completed"):virtualclass.recorder.askToPlay(),virtualclass.recorder.alreadyAskForPlay=!0,virtualclass.recorder.tempRecData.push(a.data.alldata.rdata)):c&&virtualclass.recorder.playStart&&!1==virtualclass.recorder.waitServer?virtualclass.recorder.init(a.data.alldata.rdata):
(virtualclass.recorder.tempRecData.push(a.data.alldata.rdata),!0==virtualclass.recorder.waitServer&&(virtualclass.recorder.alreadyPlayed=!0));a.data.alldata.rdata[a.data.alldata.rdata.length-1].hasOwnProperty("sessionEnd")?(console.log("Request file  Finished Here"),virtualclass.recorder.allFileFound=!0,!0==virtualclass.recorder.waitServer&&(virtualclass.storage.config.endSession(),a=virtualclass.recorder.tempRecData.reduce(function(a,b){return a.concat(b)}),virtualclass.recorder.objn=0,virtualclass.recorder.init(a),
virtualclass.recorder.play(),virtualclass.recorder.waitServer=!1,virtualclass.popup.closeElem())):(console.log("request file"),virtualclass.recorder.requestDataFromServer(b,f))})},playInt:function(){var a=virtualclass.recorder.tempRecData.reduce(function(a,b){return a.concat(b)});virtualclass.popup.closeElem();virtualclass.recorder.init(a);virtualclass.recorder.playStart=!0;virtualclass.recorder.tempRecData.length=0;virtualclass.recorder.initController()},askToPlay:function(a){"undefined"!=typeof a?
document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"):document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("askplayMessage");a=document.getElementById("playButton");null!=a&&(a.style.display="block",a.addEventListener("click",this.playInt))},isUptoBaseValue:function(a,b,c){return a>=b*c/100?!0:!1},play:function(){if(0==this.objn){var b=document.getElementById("recPlay");this.doControlActive(b)}var c=this;this.controller.pause||
("undefined"==typeof c.playTimeout&&""==c.playTimeout||clearTimeout(c.playTimeout),this.hasOwnProperty("playTime")||(this.playTime=this.items[0].playTime,a.data=JSON.parse(this.items[this.objn].recObjs),io.cfg=a.data,virtualclass.gObj.uRole="s"),"undefined"==typeof this.items[this.objn+1]||this.items[this.objn].hasOwnProperty("sessionEnd")?(this.items[this.objn].hasOwnProperty("sessionEnd")||(a.data=this.items[this.objn].recObjs,io.onRecMessage(c.convertInto(a))),!1==virtualclass.recorder.allFileFound?
(virtualclass.recorder.waitServer=!0,virtualclass.recorder.waitPopup=!1,this.displayWaitPopupIfNot(),(virtualclass.recorder.hasOwnProperty("ctotalStore")||virtualclass.recorder.hasOwnProperty("ctotalSent"))&&virtualclass.pbar.renderProgressBar(virtualclass.recorder.ctotalStore,virtualclass.recorder.ctotalSent,"downloadProgressBar","downloadProgressValue")):this.items[this.objn].hasOwnProperty("sessionEnd")&&(virtualclass.popup.replayWindow(),virtualclass.popup.sendBackOtherElems(),document.getElementById("replayClose").addEventListener("click",
function(){d.close()}),document.getElementById("replayButton").addEventListener("click",function(){virtualclass.recorder.replayFromStart.call(virtualclass.recorder)}))):c.playTimeout=setTimeout(function(){var a={};a.data=c.items[c.objn].recObjs;io.onRecMessage(c.convertInto(a));c.objn++;c.play.call(c);"object"==typeof c.items[c.objn]&&(c.playTime=c.items[c.objn].playTime/c.controller.ff,c.tillPlayTime+=c.playTime*c.controller.ff,c.allFileFound&&"object"==typeof c.items[c.objn+1]&&(c.playProgressBar(),
virtualclass.popup.sendBackOtherElems()))},c.playTime))},initController:function(){var a=document.getElementById("playControllerCont");if(null!=a){a.style.display="block";for(var b=this,a=document.getElementsByClassName("ff"),c=0;c<a.length;c++)a[c].onclick=function(){var a=this.id.split("ff")[1];b.controller.fastForward(parseInt(a,10));b.doControlActive(this)};document.getElementById("recPlay").addEventListener("click",function(){b.controller._play();b.doControlActive(this)});document.getElementById("recPause").addEventListener("click",
function(){b.controller._pause();b.doControlActive(this)});document.getElementById("replayFromStart").addEventListener("click",function(){b.replayFromStart()})}},doControlActive:function(a){for(var b=document.getElementById("playControllerCont").getElementsByClassName("recButton"),c=0;c<b.length;c++)b[c].classList.remove("controlActive");a.parentNode.classList.add("controlActive")},controller:{pause:!1,ff:1,_play:function(){this.ff=1;this.pause=!1;virtualclass.recorder.play()},_pause:function(){this.puase||
(this.pause=!0)},fastForward:function(a){this.ff=a;this.pause=!1;virtualclass.recorder.play()}}};d.recorder=m})(window);function randomString(d){for(var b="";0<d;--d)b+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return b};(function(d){function b(a){"function"==typeof a&&(virtualclass.recorder.sendDataToServer(),setTimeout(function(){virtualclass.recorder.xhrsenddata()},100),a.apply(virtualclass.recorder))}var c=[],a,f=localStorage.getItem("totalStored"),f={totalStored:null==f?0:JSON.parse(f),init:function(b){this.reclaim=JSON.parse(virtualclass.vutil.chkValueInLocalStorage("reclaim"));a=this;this.tables=["wbData","allData","audioData","config"];var c=d.indexedDB.open("vidya_apps",1);c.onerror=function(a){console.log("Error opening db");
console.dir(a)};c.onupgradeneeded=function(a){a=a.target.result;a.objectStoreNames.contains("wbData")||a.createObjectStore("wbData",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("audioData")||a.createObjectStore("audioData",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("allData")||a.createObjectStore("allData",{autoIncrement:!0});a.objectStoreNames.contains("config")||a.createObjectStore("config",{keyPath:"timeStamp",autoIncrement:!0});a.objectStoreNames.contains("chunkData")||
a.createObjectStore("chunkData",{autoIncrement:!0})};c.onsuccess=function(c){a.db=c.target.result;(new Date).getTime();virtualclass.gObj.sessionClear?a.config.endSession(!0):a.getAllObjs(a.tables,function(b){if("undefined"==typeof b)a.config.createNewSession();else{var c=b.createdDate;(10368E6<(new Date).getTime()-c||b.room!=wbUser.room)&&a.config.endSession()}},"allData");a.db.onerror=function(a){console.dir(a.target)};b()}},store:function(b){var c=a.db.transaction(["wbData"],"readwrite");c.objectStore("wbData").clear();
c.objectStore("wbData").add({repObjs:b,timeStamp:(new Date).getTime(),id:1});return!1},audioStore:function(b){a.db.transaction(["audioData"],"readwrite").objectStore("audioData").add({audiostream:b,timeStamp:(new Date).getTime(),id:2});return!1},wholeStore_working:function(b,c){var f=[],n=(new Date).getTime();"object"!=typeof b||b instanceof Array?f=b:f.push(b);for(var r=0;r<f.length;r++){b=f[r];n=b.mt;b.peTime=d.pageEnter;var q=JSON.stringify(b);"undefined"!=typeof this.prevTime&&n==this.prevTime&&
(n+=1);var t=a.db.transaction(["allData"],"readwrite");"undefined"==typeof c?t.objectStore("allData").add({recObjs:q,timeStamp:n,id:3}):t.objectStore("allData").put({recObjs:q,timeStamp:this.prevTime,id:3});this.wholeStoreData=q;this.prevTime=n}},completeStorage:function(b,c,f,d){this.totalStored++;var r=a.db.transaction(["allData"],"readwrite");"undefined"!=typeof d?r.objectStore("allData").add({recObjs:"",sessionEnd:!0,id:3}):"undefined"==typeof f?r.objectStore("allData").add({recObjs:c,playTime:b,
id:3}):r.objectStore("allData").add({recObjs:c,playTime:b,id:3,bd:f.type})},chunkStorage:function(b){var c=a.db.transaction(["chunkData"],"readwrite");b.id=4;c.objectStore("chunkData").add(b)},wholeStore:function(b,c,f){c.peTime=d.pageEnter;b=JSON.stringify(c);c=(new Date).getTime();"undefined"!=typeof this.prevTime&&c==this.prevTime&&(c+=1);var n=a.db.transaction(["allData"],"readwrite");"undefined"==typeof f?n.objectStore("allData").add({recObjs:b,timeStamp:c,id:3}):n.objectStore("allData").put({recObjs:b,
timeStamp:this.prevTime,id:3});this.wholeStoreData=b;this.prevTime=c},displayData:function(){a.db.transaction(["virtualclass"],"readonly").objectStore("virtualclass").openCursor().onsuccess=a.handleResult},getAllObjs:function(b,c,f,d){c="undefined"!=typeof c?c:"";for(var r=0;r<b.length;r++)a.db.transaction(b[r],"readonly").objectStore(b[r]).openCursor().onsuccess=function(c,m){if(b[c]!=f)return function(f){"function"==typeof m?"undefined"!=typeof d?a[b[c]].handleResult(f,m,d):a[b[c]].handleResult(f,
m):"undefined"!=typeof d?a[b[c]].handleResult(f,void 0,d):a[b[c]].handleResult(f)}}(r,c)},getAllDataForDownload:function(b,c){var f=[];a.db.transaction(b,"readonly").objectStore(b[0]).openCursor().onsuccess=function(a){(a=a.target.result)?(f.push(a.value),a["continue"]()):c(JSON.stringify(f))}},getrowData:function(b,c,f){b=a.db.transaction(b,"readonly").objectStore(b[0]);if("string"==typeof f&&"first"==f)b.openCursor().onsuccess=function(a){(a=a.target.result)?c(a.value,a.key):c("No Such Row")};else{var d=
b.get(f);d.onerror=function(a){return"No Such Row"};d.onsuccess=function(a){c(d.result)}}},wbData:{handleResult:function(a,b){var c=a.target.result;c?(c.value.hasOwnProperty("repObjs")&&("object"==typeof virtualclass.wb?virtualclass.wb.utility.replayFromLocalStroage(JSON.parse(c.value.repObjs)):virtualclass.gObj.tempReplayObjs=JSON.parse(c.value.repObjs),storeFirstObj=!0),c["continue"]()):"undefined"==typeof storeFirstObj&&"Whiteboard"==virtualclass.currApp&&virtualclass.wb.utility.makeUserAvailable()}},
audioData:{handleResult:function(a,b){var f=a.target.result;f?(f.value.hasOwnProperty("audiostream")&&c.push(JSON.parse(f.value.audiostream)),f["continue"]()):1<c.length&&(virtualclass.gObj.video.audio.recordingLength=0,"function"==typeof b?virtualclass.gObj.video.audio.assignFromLocal(c,b):virtualclass.gObj.video.audio.assignFromLocal(c))}},allData:{chunk:0,handleResult:function(a,c){var f=a.target.result;if(f){if(f.value.hasOwnProperty("recObjs")){if(f.value.hasOwnProperty("sessionEnd")){virtualclass.recorder.items.push({playTime:f.value.playTime,
recObjs:f.value.recObjs,sessionEnd:!0});b(c);return}f.value.hasOwnProperty("bd")?virtualclass.recorder.items.push({playTime:f.value.playTime,recObjs:f.value.recObjs,bd:f.value.bd}):virtualclass.recorder.items.push({playTime:f.value.playTime,recObjs:f.value.recObjs})}f["continue"]()}}},config:{handleResult:function(a,b){var c=a.target.result;if(c){if(c.value.hasOwnProperty("myconfig")){var f=JSON.parse(c.value.myconfig);"undefined"!=typeof b&&(mc=!0,b(f))}c["continue"]()}else"undefined"!=typeof b&&
"undefined"==typeof mc&&b()},createNewSession:function(){var b=(new Date).getTime();if("undefined"!=typeof a.db){var c=a.db.transaction(["config"],"readwrite").objectStore("config"),b=JSON.stringify({createdDate:b,room:wbUser.room});c.add({myconfig:b,timeStamp:(new Date).getTime()})}else console.log("The Datbase is not created for Applicatoin.")},endSession:function(b){b||("object"==typeof virtualclass.wb&&(virtualclass.wb.utility.t_clearallInit(),virtualclass.wb.utility.makeDefaultValue()),virtualclass.vutil.clearAllChat(),
virtualclass.editorRich.removeEditorData(),virtualclass.editorCode.removeEditorData());virtualclass.vutil.removeClass("audioWidget","fixed");virtualclass.hasOwnProperty("notPLayed")||virtualclass.storage.clearStorageData();virtualclass.currApp="EditorRich";a.config.createNewSession()}},shapesData:{handleResult:function(){virtualclass.recorder.items.push(JSON.parse(cursor.value.recObjs))}},clearStorageData:function(){for(var a=0;a<this.tables.length;a++){var b=this.db.transaction([this.tables[a]],
"readwrite");"undefined"!=typeof b&&(b=b.objectStore(this.tables[a]),"allData"==this.tables[a]?virtualclass.vutil.isPlayMode()||b.clear():b.clear())}},handleResultNoUsing:function(){var a=event.target.result;if(a){if(a.value.hasOwnProperty("repObjs")){var b=JSON.parse(a.value.repObjs);virtualclass.wb.utility.replayFromLocalStroage(b)}else a.value.hasOwnProperty("audiostream")?(b=JSON.parse(a.value.audiostream),virtualclass.gObj.video.audio.assignFromLocal(b)):a.value.hasOwnProperty("recObjs")&&virtualclass.recorder.items.push(JSON.parse(a.value.recObjs));
a["continue"]()}}};d.storage=f})(window);(function(d,b){d.user=function(c){return{assignRole:function(a,b){"t"==a&&(null==localStorage.getItem("reclaim")&&virtualclass.html.leftAppBar(),virtualclass.attachFunction(),"Whiteboard"==b&&d.virtualclass.wb.attachToolFunction(vcan.cmdWrapperDiv,!0),"t"==virtualclass.gObj.uRole&&(virtualclass.hasOwnProperty("previrtualclass")?virtualclass.vutil.makeActiveApp("virtualclass"+b,virtualclass.previrtualclass):virtualclass.vutil.makeActiveApp("virtualclass"+b),"Whiteboard"==b&&virtualclass.wb.utility.makeCanvasEnable()))},
teacherIsAlreadyExist:function(){for(var a=b.getElementById("chat_div").getElementsByClassName("ui-memblist-usr"),c,d=0;d<a.length;d++)if(c=a[d].getAttribute("data-role"),"t"==c)return!0;return!1},createControl:function(a,c){var d=b.createElement("div");d.id=a+"ControlContainer";d.className="controls";this.createControlDivs(d,a,c);return d},createControllerElement:function(a,c){var d=b.createElement("span");d.id=a+c+"Img";var m=b.createElement("a");m.id=a+c+"Anch";m.className="tooltip";m.appendChild(d);
var h=b.createElement("div");h.id=a+c+"Cont";h.className="controleCont";h.appendChild(m);return[h,d]},createAssignControl:function(a,c,d,m){var h=this,n=this.createControllerElement(c,"contrAssign"),r=n[0],q=n[1],n=b.getElementById(c+"ControlContainer");null!=n?0>=n.getElementsByClassName("controleCont").length?n.appendChild(r):n.insertBefore(r,n.firstChild):a.appendChild(r);virtualclass.user.control.changeAttribute(c,q,d,"assign","aRole");"undefined"!=typeof m&&(q.className+=" currTeacher");q.addEventListener("click",
function(){h.control.init.call(h,q)})},createControlDivs:function(a,b,c){var d=this,h=!1,n=localStorage.getItem("virtualclass"+b);if(null!=n&&(h=!0,n=JSON.parse(n),n.hasOwnProperty("currTeacher")))if(virtualclass.gObj[b+"currTeacher"]={},!0==n.currTeacher){var r=virtualclass.user.control.currTeacherAlready=!0;virtualclass.gObj[b+"currTeacher"].ct=!0}else virtualclass.gObj[b+"currTeacher"].ct=!1;var q=localStorage.getItem("reclaim"),q=null!=q&&q?!1:!0,t=virtualclass.vutil.userIsOrginalTeacher(b);virtualclass.vutil.isUserTeacher(b);
for(var x=0;x<c.length;x++)if("assign"==c[x]&&t)"undefined"!=typeof r?this.createAssignControl(a,b,q,r):this.createAssignControl(a,b,q);else if("audio"==c[x]){var z=this.createControllerElement(b,"contrAud"),v=z[0],u=z[1];a.appendChild(v);v=h&&n.hasOwnProperty("aud")?n.aud?!0:!1:!0;virtualclass.user.control.changeAttribute(b,u,v,"audio","aud");t&&u.addEventListener("click",function(){d.control.init.call(d,u)})}else if("chat"==c[x]){var z=this.createControllerElement(b,"contrChat"),v=z[0],s=z[1];a.appendChild(v);
t&&s.addEventListener("click",function(){d.control.init.call(d,s)});v=h&&n.hasOwnProperty("ch")?n.ch?!0:!1:!0;virtualclass.user.control.changeAttribute(b,s,v,"chat","ch")}else if(("editorRich"==c[x]||"editorCode"==c[x])&&localStorage.hasOwnProperty("orginalTeacherId")){var w=h&&n.hasOwnProperty(c[x])?n[c[x]]?!0:!1:!1,z=this.createControllerElement(b,"contr"+c[x]),v=z[0],z=z[1];v.className+=" controller"+c[x];a.appendChild(v);virtualclass.currApp!=virtualclass.vutil.capitalizeFirstLetter(c[x])&&(v.style.display=
"none");virtualclass.user.control.changeAttribute(b,z,w,c[x],c[x]);t&&z.addEventListener("click",d.closureEditor(d,z))}},closureEditor:function(a,b){return function(){a.control.init.call(a,b)}},control:{toggleDisplayWriteModeMsgBox:function(a,c){var d=b.getElementById(a+"writeModeBox"),m=c?virtualclass.lang.getString("writemode"):virtualclass.lang.getString("readonlymode");null==d&&(d=b.createElement("div"),d.id=a+"writeModeBox",b.getElementById("virtualclass"+a+"Body").appendChild(d));d.className=
"writeModeBox";d.dataset.writeMode=c;d.innerHTML=m;"EditorRich"==a&&this.tooglDisplayEditorToolBar(c)},tooglDisplayEditorToolBar:function(a){var c=b.getElementsByClassName("vceditor-toolbar"),d=c[0];0<c.length&&(a?(d.style.pointerEvents="visible",d.style.opacity="1"):(d.style.pointerEvents="none",d.style.opacity="0.5"))},received_editorRich:function(a){a.status?(virtualclass.gObj.uid==a.toUser?virtualclass.editorRich.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorRich","editorRich","editorRich"),
a=!0):(virtualclass.gObj.uid==a.toUser?virtualclass.editorRich.cm.setOption("readOnly",!0):this.disable(a.toUser,"editorRich","editorRich","editorRich"),a=!1);localStorage.setItem("editorRich",a);null==localStorage.getItem("orginalTeacherId")&&this.toggleDisplayWriteModeMsgBox("EditorRich",a)},received_editorCode:function(a){a.status?(virtualclass.gObj.uid==a.toUser?virtualclass.editorCode.cm.setOption("readOnly",!1):this.enable(a.toUser,"editorCode","editorCode","editorCode"),a=!0):(virtualclass.gObj.uid==
a.toUser?virtualclass.editorCode.cm.setOption("readOnly",!0):this.disable(a.toUser,"editorCode","editorCode","editorCode"),a=!1);localStorage.setItem("editorCode",a);null==localStorage.getItem("orginalTeacherId")&&this.toggleDisplayWriteModeMsgBox("EditorCode",a)},onmessage:function(a){this["received_"+a.message.control](a.message)},addCurrTeacherToControl:function(a){var c=b.getElementById(a);null!=c&&(virtualclass.vutil.elemHasAnyClass(a)?c.classList.add("currTeacher"):c.className="currTeacher")},
removeCurrTeacherFromControl:function(a){var c=b.getElementById(a);virtualclass.vutil.elemHasAnyClass(a)&&(c.classList.remove("currTeacher"),c=a.indexOf("contr"),a=a.substring(0,c),virtualclass.user.control.updateUser(a,"currTeacher",!1))},removeAudioFromParticipate:function(a){a=b.getElementById(a+"contrAssignCont");null!=a&&a.parentNode.removeChild(a)},disable:function(a,c,d,m){d=b.getElementById(a+"contr"+d+"Img");null!=d&&virtualclass.user.control._disable(d,c,a,m)},_disable:function(a,b,c,d){a.parentNode.setAttribute("data-title",
virtualclass.lang.getString(b+"Disable"));a.setAttribute("data-"+b+"-disable","true");a.className="icon-"+b+"Img block "+b+"Img";"assign"==b?(a.parentNode.classList.remove("tooltip"),this.addCurrTeacherToControl(a.id),a=localStorage.getItem("virtualclass"+c),a=JSON.parse(a),virtualclass.gObj.hasOwnProperty(c+"currTeacher")?(virtualclass.gObj[c+"currTeacher"].ct||virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssign&&a.currTeacher)&&virtualclass.user.control.updateUser(c,
"currTeacher",!0):virtualclass.gObj.hasOwnProperty("controlAssign")&&virtualclass.gObj.controlAssignId==c&&virtualclass.user.control.updateUser(c,"currTeacher",!0)):"audio"==b&&(a.className="icon-"+b+"DisImg block "+b+"DisImg");virtualclass.user.control.updateUser(c,d,!1)},enable:function(a,c,d,m){d=b.getElementById(a+"contr"+d+"Img");null==d?console.log("Element is Null"):virtualclass.user.control._enable(d,c,a,m)},_enable:function(a,b,c,d){a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+
"Enable"));"audio"==b&&a.parentNode.setAttribute("data-title",virtualclass.lang.getString(b+"Off"));a.setAttribute("data-"+b+"-disable","false");a.className="icon-"+b+"Img enable "+b+"Img";virtualclass.user.control.updateUser(c,d,!0)},changeAttribute:function(a,b,c,d,h){c?virtualclass.user.control._enable(b,d,a,h):virtualclass.user.control._disable(b,d,a,h)},init:function(a,b,c){"undefined"==typeof c&&(c="Img");var d=a.id,h=d.indexOf("contr"),h=d.substring(0,h),d=d.split("contr")[1];c=d.indexOf(c);
c=d.substring(0,c);if("Assign"==c)virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=h,b="true"==a.getAttribute("data-assign-disable")?!0:!1,b||(this.control.changeAttribute(h,a,b,"assign","aRole"),virtualclass.user.control._assign(h),virtualclass.user.control.changeAttrToAssign("block")),null==localStorage.getItem("orginalTeacherId")&&virtualclass.user.control.removeAudioFromParticipate(h);else{var n;"Chat"==c?(a.className="contrChatBlock",d="chat"):d="Aud"==c?"audio":c;"undefined"!=
typeof b?b=(n="enable"==b?!0:!1)?"enable":"block":"true"==a.getAttribute("data-"+d+"-disable")?(b="enable",n=!0):(b="block",n=!1);this.control.changeAttribute(h,a,n,d,virtualclass.vutil.smallizeFirstLetter(c));this.control["_"+d].call(this.control,h,b)}},init_old:function(a){var b=a.id,c=b.indexOf("contr"),c=b.substring(0,c),b=b.split("contr")[1],d=b.indexOf("Img"),b=b.substring(0,d);"Assign"==b?(virtualclass.gObj.controlAssign=!0,virtualclass.gObj.controlAssignId=c,b="true"==a.getAttribute("data-assign-disable")?
!0:!1,b||(this.control.changeAttribute(c,a,b,"assign","aRole"),virtualclass.user.control._assign(c),virtualclass.user.control.changeAttrToAssign("block")),null==localStorage.getItem("orginalTeacherId")&&virtualclass.user.control.removeAudioFromParticipate(c)):"Chat"==b?("true"==a.getAttribute("data-chat-disable")?(a.className="contrChatBlock",b="enable",this.control.changeAttribute(c,a,!0,"chat","ch")):(b="block",this.control.changeAttribute(c,a,!1,"chat","ch")),this.control._chat(c,b)):"Aud"==b&&
("true"==a.getAttribute("data-audio-disable")?(b="enable",this.control.changeAttribute(c,a,!0,"audio","aud")):(b="block",this.control.changeAttribute(c,a,!1,"audio","aud")),this.control._audio(c,b))},_assign:function(a,c,d){virtualclass.vutil.assignRole();virtualclass.vutil.removeAppPanel();if(!virtualclass.vutil.chkValueInLocalStorage("orginalTeacherId")){var m=b.getElementById("vcanvas");m.className=m.className.replace(/\bteacher\b/," ");m.className="student"}localStorage.setItem("canvasDrwMsg",
!0);m=b.getElementById("virtualclassScreenShareLocalVideo");null!=m&&"VIDEO"==m.tagName&&virtualclass.vutil.videoTeacher2Student("ScreenShare",!0);"ScreenShare"==virtualclass.currApp&&(virtualclass.ss.hasOwnProperty("currentStream")&&virtualclass.ss.currentStream.stop(),virtualclass.ss="");"undefined"==typeof c&&virtualclass.vutil.beforeSend({assignRole:!0,toUser:a});null==localStorage.getItem("orginalTeacherId")&&("undefined"==typeof d&&(d=a),a=b.getElementById(d+"ControlContainer").getElementsByClassName("controleCont")[0],
a.removeChild(a.firstChild))},_chat:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({enc:!0,toUser:a}):(virtualclass.user.control.updateUser(a,"ch",!1),virtualclass.vutil.beforeSend({dic:!0,toUser:a}))},_audio:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a}):virtualclass.vutil.beforeSend({dia:!0,toUser:a})},_editorRich:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorRich",toUser:a}):virtualclass.vutil.beforeSend({status:!1,control:"editorRich",
toUser:a})},_editorCode:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({status:!0,control:"editorCode",toUser:a}):virtualclass.vutil.beforeSend({status:!1,control:"editorCode",toUser:a})},_audio:function(a,b){"enable"==b?virtualclass.vutil.beforeSend({ena:!0,toUser:a}):virtualclass.vutil.beforeSend({dia:!0,toUser:a})},audioWidgetEnable:function(){localStorage.setItem("audEnable","true");var a=b.getElementById("audioWidget");a.className="active";a.style.opacity="1";a.style.pointerEvents="visible"},
audioWidgetDisable:function(){localStorage.setItem("audEnable","false");var a=b.getElementById("audioWidget");a.style.opacity="0.5";a.style.pointerEvents="none";a.className="deactive";a=b.getElementById("speakerPressing");virtualclass.gObj.hasOwnProperty("video")&&(virtualclass.gObj.video.audio.studentNotSpeak(a),virtualclass.gObj.video.audio.clickOnceSpeaker("speakerPressOnce","alwaysDisable"))},allChatDisable:function(){localStorage.setItem("chatEnable","false");this.disableCommonChat();this.disbaleAllChatBox();
this.disableOnLineUser()},disableCommonChat:function(){var a=b.getElementById("chatrm");null!=a&&this.makeElemDisable(a)},disbaleAllChatBox:function(){for(var a=b.getElementById("stickybar").getElementsByClassName("ui-chatbox"),c=0;c<a.length;c++)this.makeElemDisable(a[c])},disableOnLineUser:function(){for(var a=b.getElementsByClassName("ui-memblist-usr"),c=0;c<a.length;c++)a[c].style.pointerEvents="none"},makeElemDisable:function(a){virtualclass.vutil.elemHasAnyClass(a.id)?(a.classList.remove("enable"),
a.classList.add("disable")):a.className="disable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!0)},allChatEnable:function(){localStorage.setItem("chatEnable","true");var a=b.getElementById("chatrm");null!=a&&this.makeElemEnable(a);for(var c=b.getElementById("stickybar").getElementsByClassName("ui-chatbox"),a=0;a<c.length;a++)this.makeElemEnable(c[a]);c=b.getElementsByClassName("ui-memblist-usr");for(a=0;a<c.length;a++)c[a].style.pointerEvents="visible"},makeElemEnable:function(a){virtualclass.vutil.elemHasAnyClass(a.id)?
(a.classList.remove("disable"),a.classList.add("enable")):a.className="enable";a=a.getElementsByClassName("ui-chatbox-input-box")[0];null!=a&&(a.disabled=!1)},toggleAllEditorController:function(a,c){a=virtualclass.vutil.smallizeFirstLetter(a);var d=b.getElementsByClassName("controleCont");if(0<d.length)for(var m=0;m<d.length;m++)if(0<d[m].id.indexOf(a)){var h=d[m].id.indexOf("Cont");0<h&&(h=d[m].id.substr(0,h),h=b.getElementById(h+"Img"),this.control.init.call(this,h,c))}},toggleDisplayEditorController:function(a,
c){a=virtualclass.vutil.smallizeFirstLetter(a);for(var d=b.getElementsByClassName("controller"+a),m=0;m<d.length;m++)d[m].style.display=c},updateUser:function(a,b,c){var d=localStorage.getItem("virtualclass"+a),h={};null==d?h.id=a:h=JSON.parse(d);h[b]=c;localStorage["virtualclass"+h.id]=JSON.stringify(h);return h},audioSign2:function(a,c){if("create"==c){if(null==b.getElementById(a.id+"AudEnableSign")){var g=b.createElement("div");g.id=a.id+"AudEnableSign";var m=b.createElement("img");imgName="audioenable";
m.id=a.id+imgName+"Img";m.src=d.whiteboardPath+"images/"+imgName+".png";var h=b.createElement("a");h.id=a.id+imgName+"Anch";h.className="audEnableSign tooltip controleCont";h.setAttribute("data-title","student audio enable");h.appendChild(m);g.appendChild(h);b.getElementById(a.id+"ControlContainer").appendChild(g)}}else g=b.getElementById(a.id+"AudEnableSign"),g.parentNode.removeChild(g)},audioSign:function(a,b){"create"==b?this.iconAttrManupulate(a.id,"icon-audioEnaGreen"):a.aud?this.iconAttrManupulate(a.id,
"icon-audioImg"):this.iconAttrManupulate(a.id,"icon-audioDisImg")},iconAttrManupulate:function(a,c){var d=b.getElementById(a+"contrAudImg");if(null!=d)for(var m=0;m<d.classList.length;m++)if("icon-"==d.classList[m].substring(0,5)){d.classList.remove(d.classList[m]);d.classList.add(c);break}},shouldApply:function(a){var b=localStorage.getItem("virtualclass"+a);null!=b&&(b=JSON.parse(b),b.ad&&virtualclass.user.control.audioSign({id:a},"create"))},changeAttrToAssign:function(a){for(var c=b.getElementById("chatWidget").getElementsByClassName("assignImg"),
d=0;d<c.length;d++)"enable"==a?(c[d].classList.remove("block"),c[d].classList.add("enable"),c[d].parentNode.classList.add("tooltip"),c[d].parentNode.setAttribute("data-title",virtualclass.lang.getString("assignEnable")),c[d].setAttribute("data-assign-disable","false")):(c[d].classList.remove("enable"),c[d].classList.add("block"),c[d].parentNode.classList.remove("tooltip"),c[d].setAttribute("data-assign-disable","true"))}},displayStudentSpeaker:function(a){var c=b.getElementById("alwaysPress");null!=
c&&(c.style.display=a?"block":"none")}}}})(window,document);(function(d){d.xhr={init:function(){this.httpObj=d.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");this.httpObj.upload.addEventListener("progress",this.onProgress);this.onReadStateChange();this.httpObj.onerror=function(b){virtualclass.recorder.tryForReTransmit();console.log("Error "+b)};this.httpObj.onabort=function(b){console.log("Error abort "+b)}},onProgress:function(b){virtualclass.pbar.currVal=b.loaded;""!=virtualclass.pbar.prvVal&&"undefined"!=typeof virtualclass.pbar.prvVal||
virtualclass.isPlayMode||virtualclass.pbar.progressInit();virtualclass.pbar.renderProgressBar(b.total,b.loaded,"indProgressBar","indProgressValue")},onReadStateChange:function(){var b=this;this.httpObj.onreadystatechange=function(){4==b.httpObj.readyState&&"undefined"!=typeof b.cb&&(200==b.httpObj.status?b.cb(b.httpObj.responseText):b.cb("ERROR"))}},send:function(b,c,a){this.cb=a;this.httpObj.open("POST",c,!0);this.httpObj.send(b)}}})(window);var PopUp=function(d,b){function c(a){this.init(a);return this}function a(a,b){var c={},d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&(c[d]=a[d]);for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(c[d]=b[d]);return c}function f(a){var b=document.createElement("div");b.classList.add("rv-vanilla-modal-overlay");document.querySelector("body").appendChild(b);"function"===typeof a&&a()}"use strict";c.prototype.init=function(b){var c=this;this.settings=a({selector:"[data-rv-vanilla-modal]",
modalSelector:".rv-vanilla-modal",closeSelector:".rv-vanilla-modal-close",showModalClassName:"rv-vanilla-modal-is-open",showOverlay:!0},b);this.modalElements=document.querySelectorAll(this.settings.modalSelector);this.triggers=document.querySelectorAll(this.settings.selector);this.settings.showOverlay&&f(function(){c.overlayElement=document.querySelector(".rv-vanilla-modal-overlay")})};c.prototype.close=function(a){a.classList.remove(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.remove("is-shown")};
c.prototype.open=function(a){this.sendBackOtherElems();this.closeShownModal();a.classList.add(this.settings.showModalClassName);this.settings.showOverlay&&this.overlayElement.classList.add("is-shown")};c.prototype.each=function(a){[].forEach.call(this.triggers,function(b){"function"===typeof a&&a(b)})};c.prototype.closeShownModal=function(){var a=this.settings.showModalClassName;[].forEach.call(this.modalElements,function(b){b.classList.contains(a)&&b.classList.remove(a)})};c.prototype.closeElem=
function(){if(!1==virtualclass.recorder.waitServer){var a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=100);a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=2E3);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="visible");a=document.getElementById("about-modal");null!=a&&virtualclass.popup.close(a)}};c.prototype.waitBlock=function(){var a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();
document.getElementById("recordPlay").style.display="block";virtualclass.popup.replayWindowAction("none")};c.prototype.waitBlockAction=function(a){document.getElementById("recordPlay").style.display=a};c.prototype.sendBackOtherElems=function(a){a=document.getElementById("virtualclassOptionsCont");null!=a&&(a.style.zIndex=0);a=document.getElementById("commandToolsWrapper");null!=a&&(a.style.pointerEvents="none");a=document.getElementById("stickybar");null!=a&&(a.style.zIndex=0);a=document.getElementById("chatrm");
null!=a&&(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("audioWidget");null!=a&&(a.style.zIndex=0);a=document.getElementById("memlist");null!=a&&(a.style.zIndex=0)};c.prototype.openProgressBar=function(a){a=document.getElementById("about-modal");virtualclass.popup.open(a);this.hideAllPopups();document.getElementById("recordingContainer").style.display="block"};c.prototype.replayWindow=function(){var a=document.getElementById("about-modal");
virtualclass.popup.open(a);this.hideAllPopups();virtualclass.popup.replayWindowAction("block")};c.prototype.replayWindowAction=function(a){document.getElementById("replayContainer").style.display=a};c.prototype.progressBarAction=function(a){document.getElementById("recordingContainer").style.display=a};c.prototype.confirmInput=function(a,b,c){var d=document.getElementById("about-modal");virtualclass.popup.open(d);this.hideAllPopups();d=document.getElementById("confirm");d.style.display="block";var f=
d.getElementsByClassName("confirmChild");if(0<f.length)for(;1<=f.length;)f[0].parentNode.removeChild(f[0]);f=document.createElement("div");f.id="confirmMessage";f.className="confirmChild";f.innerHTML=a;d.appendChild(f);var q=this;a=function(){q.confirmInit(this.id,b,c)};f=document.createElement("div");f.id="confirmOk";f.className="confirmButton confirmChild";f.addEventListener("click",a);var t=document.createElement("button");t.id="confirmOkButton";t.className="icon-check";t.innerHTML="OK";f.appendChild(t);
d.appendChild(f);f=document.createElement("div");f.id="confirmCancel";f.className="confirmButton confirmChild";f.addEventListener("click",a);a=document.createElement("button");a.id="confirmCancelButton";a.className="icon-close";a.innerHTML="Cancel";f.appendChild(a);d.appendChild(f)};c.prototype.confirmInit=function(a,b,c){virtualclass.popup.closeElem();a="confirmOk"==a?virtualclass.popup.confirmOk():virtualclass.popup.confirmCancel();b(a,c)};c.prototype.confirmCancel=function(){return!1};c.prototype.confirmOk=
function(){return!0};c.prototype.hideAllPopups=function(){for(var a=document.getElementsByClassName("popupWindow"),b=0;b<a.length;b++)a[b].style.display="none"};return c}(window);(function(d){d.converter=function(){function b(a,b){for(var c=a.replace(/[^A-Za-z0-9\+\/]/g,""),d=c.length,h=b?Math.ceil((3*d+1>>2)/b)*b:3*d+1>>2,n=new Uint8Array(h),r,q=0,t=0,x=0;x<d;x++){r=x&3;var z=c.charCodeAt(x),q=q|(64<z&&91>z?z-65:96<z&&123>z?z-71:47<z&&58>z?z+4:43===z?62:47===z?63:0)<<6*(3-r);if(3===r||1===d-x){for(r=0;3>r&&t<h;r++,t++)n[t]=q>>>(16>>>r&24)&255;q=0}}return n}function c(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65}return{base64EncArrInt:function(a){for(var b=
new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=0>a[c]?-1*a[c]+127:a[c];return this.base64EncArr(b)},base64EncArr:function(a){for(var b=2,d="",m=a.length,h=0,n=0;n<m;n++)if(b=n%3,0<n&&0===4*n/3%76&&(d+="\r\n"),h|=a[n]<<(16>>>b&24),2===b||1===a.length-n)d+=String.fromCharCode(c(h>>>18&63),c(h>>>12&63),c(h>>>6&63),c(h&63)),h=0;return d.substr(0,d.length-2+b)+(2===b?"":1===b?"=":"==")},base64DecToArrInt:function(a){a=b(a);for(var c=new Int8Array(a.length),d=0;d<a.length;d++)c[d]=128<=a[d]?-1*(a[d]-
127):a[d];return c},base64DecToArrclm:function(a){a=b(a);return new Uint8ClampedArray(a.buffer)}}}})(window);var progressBar={prvVal:"",currVal:"",progressInit:function(){var d=this;"undefined"!=typeof prvTimeout&&clearTimeout(prvTimeout);prvTimeout=setTimeout(function(){d.prvVal==d.currVal?(console.log("start for download"),virtualclass.recorder.tryForReTransmit()):(d.prvVal=d.currVal,d.progressInit())},5E4)},renderProgressBar:function(d,b,c,a){b>d&&(b=d,document.getElementById("askplayMessage").innerHTML=virtualclass.lang.getString("playsessionmsg"));d=0==d&&0==b?0:Math.round(100*b/d);c=document.getElementById(c);
null!=c&&(c.style.width=d+"%");c=document.getElementById(a);null!=c&&(c.innerHTML=d+"%");100<=a&&(a=document.getElementById("recordingClose"),recordingClose.style.display="block",a.addEventListener("click",function(){virtualclass.popup.closeElem()}))}};if(!window.YT)var YT={loading:0,loaded:0};if(!window.YTConfig)var YTConfig={host:"http://www.youtube.com"};
YT.loading||(YT.loading=1,function(){var d=[];YT.ready=function(a){YT.loaded?a():d.push(a)};window.onYTReady=function(){YT.loaded=1;for(var a=0;a<d.length;a++)try{d[a]()}catch(b){}};YT.setConfig=function(a){for(var b in a)a.hasOwnProperty(b)&&(YTConfig[b]=a[b])};var b=document.createElement("script");b.type="text/javascript";b.id="www-widgetapi-script";b.src="https://s.ytimg.com/yts/jsbin/www-widgetapi-vfltoz0n9/www-widgetapi.js";b.async=!0;var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,
c)}());(function(d,b){d.yts=function(c){var a=0,f=-2,g=-1;return{retryForPalyer:1,player:"",init:function(a,b){if("undefined"!=typeof a&&"studentlayout"!=a.init)var c=a.init;if(null==localStorage.getItem("orginalTeacherId")||null!=localStorage.getItem("orginalTeacherId")&&null!=localStorage.getItem("reclaim"))"undefined"==typeof c&&"s"==virtualclass.gObj.uRole?this.UI.defaultLayoutForStudent():(this.UI.container(),null!=localStorage.getItem("teacherId")?(this.onYTIframApi(c,b,"fromReload"),this.UI.inputURL(),
io.send({yts:{init:"studentlayout"}})):a.hasOwnProperty("fromReload")||("undefined"==typeof b?this.onYTIframApi(c):this.onYTIframApi(c,b)));else{this.UI.container();if("undefined"!=typeof b)this.onYTIframApi(c,b,"fromReload");this.UI.inputURL();io.send({yts:{init:"studentlayout"}})}},destroyYT:function(){"object"==typeof virtualclass.yts.player&&(virtualclass.yts.player.destroy(),virtualclass.yts.player="",virtualclass.yts.hasOwnProperty("tsc")&&clearInterval(virtualclass.yts.tsc))},UI:{id:"virtualclassYts",
"class":"virtualclass",container:function(){var a=b.getElementById(this.id);null!=a&&a.parentNode.removeChild(a);a=b.createElement("div");a.id=this.id;a.className=this["class"];this.createPlayerTag(a);var c=b.getElementById(virtualclass.rWidgetConfig.id);b.getElementById(virtualclass.html.id).insertBefore(a,c)},createPlayerTag:function(a){var c=b.createElement("div");c.id="player";a.appendChild(c)},defaultLayoutForStudent:function(){var a=b.getElementById(this.id);if(null==a){a=b.createElement("div");
a.id=this.id;a.className=this["class"];var c=b.getElementById(virtualclass.rWidgetConfig.id);b.getElementById(virtualclass.html.id).insertBefore(a,c)}c=b.getElementById("youtubeUrlContainer");null!=c&&c.parentNode.removeChild(c);null==b.getElementById("messageLayout")&&(c=b.createElement("p"),c.id="messageLayout",c.innerHTML=virtualclass.lang.getString("teachermayshow"),a.appendChild(c))},inputURL:function(){var a=b.getElementById("messageLayout");null!=a&&a.parentNode.removeChild(a);if(null==b.getElementById("youtubeUrlContainer")){a=
b.createElement("div");a.id="youtubeUrlContainer";var c=b.createElement("input");c.id="youtubeurl";c.cols=70;c.rows=3;c.placeholder=virtualclass.lang.getString("youTubeUrl");b.getElementById("virtualclassYts").appendChild(c);a.appendChild(c);c=b.createElement("button");c.id="submitURL";c.innerHTML=virtualclass.lang.getString("shareYouTubeVideo");a.appendChild(c);var d=b.getElementById("virtualclassYts"),f=b.getElementById("player");d.insertBefore(a,f.nextSibling);c.addEventListener("click",function(){var a=
b.getElementById("youtubeurl").value,a=virtualclass.yts.getVideoId(a);"boolean"==typeof a?alert("Invalid YouTube URL."):(virtualclass.yts.videoId=a,virtualclass.yts.onYTIframApi(a),io.send({yts:{init:a}}))})}},removeinputURL:function(){var a=b.getElementById("youtubeUrlContainer");null!=a&&a.parentNode.removeChild(a)}},getVideoId:function(a){a=a.match(/^.*(?:(?:youtu\.be\/|v\/|vi\/|u\/\w\/|embed\/)|(?:(?:watch)?\?v(?:i)?=|\&v(?:i)?=))([^#\&\?]*).*/);return null!=a&&1<a.length&&(a=a[1].substring(0,
11),11==a.length)?a:!1},onmessage:function(a){"string"==typeof a.yts?"play"==a.yts?this.player.playVideo():"pause"==a.yts?this.player.pauseVideo():"mute"==a.yts?this.player.mute():"unmute"==a.yts&&this.player.unMute():a.yts.hasOwnProperty("init")?virtualclass.makeAppReady("Yts",void 0,a.yts):(a=parseInt(a.yts.seekto,10),this.player.hasOwnProperty("seekTo")&&this.player.seekTo(a))},onYTIframApi:function(a,c,f){"undefined"!=typeof a&&(this.videoId=a);if("object"==typeof this.player&&"t"==virtualclass.gObj.uRole)this.player.loadVideoById(a);
else{var g={playerVars:{height:"390",width:"640",autohide:0,disablekb:1,enablejsapi:1,modestbranding:1,start:"undefined"!=typeof c?Math.round(c):0},videoId:a,events:{onReady:this.onPlayerReady}};"undefined"!=typeof c&&(g.start=c);console.log("Player object is CREATED");if("undefined"!=typeof f){var q=this;d.onYouTubeIframeAPIReady=function(){q.player=new YT.Player("player",g)}}else this.player=new YT.Player("player",g);a=b.getElementById(this.UI.id);a.className+=" youTubeSharing"}},triggerOnSeekChange:function(){console.log("there should happend something after each 2 second");
if(0==a||-2==f||-1==g)a=this.player.getCurrentTime(),f=this.player.getPlayerState(),g=this.player.isMuted();else{var b=Math.abs(this.player.getCurrentTime()-a);a=this.player.getCurrentTime();4<b&&this.ytOnSeek(this.player.getCurrentTime());this.player.getPlayerState()!=f&&3!=this.player.getPlayerState()&&(this.ytOnChange(this.player.getPlayerState()),f=this.player.getPlayerState());this.player.isMuted()!=g&&(this.ytOnMuted(this.player.isMuted()),g=this.player.isMuted())}},ytOnMuted:function(a){a?
io.send({yts:"mute"}):io.send({yts:"unmute"});console.log("MUTED "+a)},ytOnSeek:function(a){io.send({yts:{seekto:a}});console.log("SEEK CHANGED "+a)},ytOnChange:function(a){console.log("STATE CHANGED "+a);1==a?io.send({yts:"play"}):2==a&&io.send({yts:"pause"})},onPlayerReady:function(a){"t"==virtualclass.gObj.uRole&&(b.getElementById("submitURL").innerHTML=virtualclass.lang.getString("shareAnotherYouTubeVideo"));a.target.playVideo();virtualclass.yts.player.unMute();virtualclass.yts.player.setVolume(40);
"t"==virtualclass.gObj.uRole&&virtualclass.yts.seekChangeInterval()},seekChangeInterval:function(){virtualclass.yts.tsc=setInterval(function(){virtualclass.yts.triggerOnSeekChange()},2E3)}}}})(window,document);(function(d){if("object"==typeof exports&&"object"==typeof module)module.exports=d();else{if("function"==typeof define&&define.amd)return define([],d);this.CodeMirror=d()}})(function(){function d(p,a){if(!(this instanceof d))return new d(p,a);this.options=a=a?ra(a):{};ra(qf,a,!1);x(a);var c=a.value;"string"==typeof c&&(c=new ia(c,a.mode,null,a.lineSeparator));this.doc=c;var xa=new d.inputStyles[a.inputStyle](this),xa=this.display=new b(p,c,xa);xa.wrapper.CodeMirror=this;n(this);m(this);a.lineWrapping&&
(this.display.wrapper.className+=" CodeMirror-wrap");a.autofocus&&!Fb&&xa.input.focus();s(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Gb,keySeq:null,specialChars:null};var na=this;M&&11>R&&setTimeout(function(){na.display.input.reset(!0)},20);rf(this);Pd||(sf(),Pd=!0);jb(this);this.curOp.forceUpdate=!0;Qd(this,c);a.autofocus&&!Fb||na.hasFocus()?setTimeout(Hb(ad,this),
20):Ib(this);for(var f in kb)if(kb.hasOwnProperty(f))kb[f](this,a[f],Rd);L(this);a.finishInit&&a.finishInit(this);for(c=0;c<bd.length;++c)bd[c](this);lb(this);Y&&a.lineWrapping&&"optimizelegibility"==getComputedStyle(xa.lineDiv).textRendering&&(xa.lineDiv.style.textRendering="auto")}function b(p,a,b){this.input=b;this.scrollbarFiller=B("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content","true");this.gutterFiller=B("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content",
"true");this.lineDiv=B("div",null,"CodeMirror-code");this.selectionDiv=B("div",null,null,"position: relative; z-index: 1");this.cursorDiv=B("div",null,"CodeMirror-cursors");this.measure=B("div",null,"CodeMirror-measure");this.lineMeasure=B("div",null,"CodeMirror-measure");this.lineSpace=B("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");this.mover=B("div",[B("div",[this.lineSpace],"CodeMirror-lines")],null,"position: relative");
this.sizer=B("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=B("div",null,null,"position: absolute; height: "+Sd+"px; width: 1px;");this.gutters=B("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=B("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=B("div",[this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");M&&8>R&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=
0);Y||Ta&&Fb||(this.scroller.draggable=!0);p&&(p.appendChild?p.appendChild(this.wrapper):p(this.wrapper));this.reportedViewFrom=this.reportedViewTo=this.viewFrom=this.viewTo=a.first;this.view=[];this.externalMeasured=this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=this.cachedCharWidth=
this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=this.wheelStartX=this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=null;b.init(this)}function c(p){p.doc.mode=d.getMode(p.options,p.doc.modeOption);a(p)}function a(p){p.doc.iter(function(p){p.stateAfter&&(p.stateAfter=null);p.styles&&(p.styles=null)});p.doc.frontier=p.doc.first;Jb(p,100);p.state.modeGen++;p.curOp&&ja(p)}function f(p){var a=Ua(p.display),b=
p.options.lineWrapping,c=b&&Math.max(5,p.display.scroller.clientWidth/Kb(p.display)-3);return function(d){if(Va(p.doc,d))return 0;var f=0;if(d.widgets)for(var g=0;g<d.widgets.length;g++)d.widgets[g].height&&(f+=d.widgets[g].height);return b?f+(Math.ceil(d.text.length/c)||1)*a:f+a}}function g(p){var a=p.doc,b=f(p);a.iter(function(p){var a=b(p);a!=p.height&&ya(p,a)})}function m(p){p.display.wrapper.className=p.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+p.options.theme.replace(/(^|\s)\s*/g,
" cm-s-");Lb(p)}function h(p){n(p);ja(p);setTimeout(function(){H(p)},20)}function n(p){var a=p.display.gutters,b=p.options.gutters;Wa(a);for(var c=0;c<b.length;++c){var d=b[c],f=a.appendChild(B("div",null,"CodeMirror-gutter "+d));"CodeMirror-linenumbers"==d&&(p.display.lineGutter=f,f.style.width=(p.display.lineNumWidth||1)+"px")}a.style.display=c?"":"none";r(p)}function r(p){p.display.sizer.style.marginLeft=p.display.gutters.offsetWidth+"px"}function q(p){if(0==p.height)return 0;for(var a=p.text.length,
b,c=p;b=Xa(c,!0);)b=b.find(0,!0),c=b.from.line,a+=b.from.ch-b.to.ch;for(c=p;b=Xa(c,!1);)b=b.find(0,!0),a-=c.text.length-b.from.ch,c=b.to.line,a+=c.text.length-b.to.ch;return a}function t(p){var a=p.display;p=p.doc;a.maxLine=D(p,p.first);a.maxLineLength=q(a.maxLine);a.maxLineChanged=!0;p.iter(function(p){var b=q(p);b>a.maxLineLength&&(a.maxLineLength=b,a.maxLine=p)})}function x(p){var a=ea(p.gutters,"CodeMirror-linenumbers");-1==a&&p.lineNumbers?p.gutters=p.gutters.concat(["CodeMirror-linenumbers"]):
-1<a&&!p.lineNumbers&&(p.gutters=p.gutters.slice(0),p.gutters.splice(a,1))}function z(p){var a=p.display,b=a.gutters.offsetWidth,c=Math.round(p.doc.height+cd(p.display));return{clientHeight:a.scroller.clientHeight,viewHeight:a.wrapper.clientHeight,scrollWidth:a.scroller.scrollWidth,clientWidth:a.scroller.clientWidth,viewWidth:a.wrapper.clientWidth,barLeft:p.options.fixedGutter?b:0,docHeight:c,scrollHeight:c+za(p)+a.barHeight,nativeBarWidth:a.nativeBarWidth,gutterWidth:b}}function v(p,a,b){this.cm=
b;var c=this.vert=B("div",[B("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),d=this.horiz=B("div",[B("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");p(c);p(d);F(c,"scroll",function(){c.clientHeight&&a(c.scrollTop,"vertical")});F(d,"scroll",function(){d.clientWidth&&a(d.scrollLeft,"horizontal")});this.checkedOverlay=!1;M&&8>R&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}function u(){}function s(p){p.display.scrollbars&&(p.display.scrollbars.clear(),
p.display.scrollbars.addClass&&Mb(p.display.wrapper,p.display.scrollbars.addClass));p.display.scrollbars=new d.scrollbarModel[p.options.scrollbarStyle](function(a){p.display.wrapper.insertBefore(a,p.display.scrollbarFiller);F(a,"mousedown",function(){p.state.focused&&setTimeout(function(){p.display.input.focus()},0)});a.setAttribute("cm-not-content","true")},function(a,b){"horizontal"==b?mb(p,a):Nb(p,a)},p);p.display.scrollbars.addClass&&Ob(p.display.wrapper,p.display.scrollbars.addClass)}function w(p,
a){a||(a=z(p));var b=p.display.barWidth,c=p.display.barHeight;G(p,a);for(var d=0;4>d&&b!=p.display.barWidth||c!=p.display.barHeight;d++)b!=p.display.barWidth&&p.options.lineWrapping&&nb(p),G(p,z(p)),b=p.display.barWidth,c=p.display.barHeight}function G(p,a){var b=p.display,c=b.scrollbars.update(a);b.sizer.style.paddingRight=(b.barWidth=c.right)+"px";b.sizer.style.paddingBottom=(b.barHeight=c.bottom)+"px";c.right&&c.bottom?(b.scrollbarFiller.style.display="block",b.scrollbarFiller.style.height=c.bottom+
"px",b.scrollbarFiller.style.width=c.right+"px"):b.scrollbarFiller.style.display="";c.bottom&&p.options.coverGutterNextToScrollbar&&p.options.fixedGutter?(b.gutterFiller.style.display="block",b.gutterFiller.style.height=c.bottom+"px",b.gutterFiller.style.width=a.gutterWidth+"px"):b.gutterFiller.style.display=""}function C(p,a,b){var c=b&&null!=b.top?Math.max(0,b.top):p.scroller.scrollTop,c=Math.floor(c-p.lineSpace.offsetTop),d=b&&null!=b.bottom?b.bottom:c+p.wrapper.clientHeight,c=Ya(a,c),d=Ya(a,d);
if(b&&b.ensure){var f=b.ensure.from.line;b=b.ensure.to.line;f<c?(c=f,d=Ya(a,Aa(D(a,f))+p.wrapper.clientHeight)):Math.min(b,a.lastLine())>=d&&(c=Ya(a,Aa(D(a,b))-p.wrapper.clientHeight),d=b)}return{from:c,to:Math.max(d,c+1)}}function H(p){var a=p.display,b=a.view;if(a.alignWidgets||a.gutters.firstChild&&p.options.fixedGutter){for(var c=S(a)-a.scroller.scrollLeft+p.doc.scrollLeft,d=a.gutters.offsetWidth,f=c+"px",g=0;g<b.length;g++)if(!b[g].hidden){p.options.fixedGutter&&b[g].gutter&&(b[g].gutter.style.left=
f);var h=b[g].alignable;if(h)for(var n=0;n<h.length;n++)h[n].style.left=f}p.options.fixedGutter&&(a.gutters.style.left=c+d+"px")}}function L(p){if(!p.options.lineNumbers)return!1;var a=p.doc,a=E(p.options,a.first+a.size-1),b=p.display;if(a.length!=b.lineNumChars){var c=b.measure.appendChild(B("div",[B("div",a)],"CodeMirror-linenumber CodeMirror-gutter-elt")),d=c.firstChild.offsetWidth,c=c.offsetWidth-d;b.lineGutter.style.width="";b.lineNumInnerWidth=Math.max(d,b.lineGutter.offsetWidth-c)+1;b.lineNumWidth=
b.lineNumInnerWidth+c;b.lineNumChars=b.lineNumInnerWidth?a.length:-1;b.lineGutter.style.width=b.lineNumWidth+"px";r(p);return!0}return!1}function E(p,a){return String(p.lineNumberFormatter(a+p.firstLineNumber))}function S(p){return p.scroller.getBoundingClientRect().left-p.sizer.getBoundingClientRect().left}function T(p,a,b){var c=p.display;this.viewport=a;this.visible=C(c,p.doc,a);this.editorIsHidden=!c.wrapper.offsetWidth;this.wrapperHeight=c.wrapper.clientHeight;this.wrapperWidth=c.wrapper.clientWidth;
this.oldDisplayWidth=Na(p);this.force=b;this.dims=Za(p);this.events=[]}function U(p,a){var b=p.display,c=p.doc;if(a.editorIsHidden)return Oa(p),!1;if(!a.force&&a.visible.from>=b.viewFrom&&a.visible.to<=b.viewTo&&(null==b.updateLineNumbers||b.updateLineNumbers>=b.viewTo)&&b.renderedView==b.view&&0==Td(p))return!1;L(p)&&(Oa(p),a.dims=Za(p));var d=c.first+c.size,f=Math.max(a.visible.from-p.options.viewportMargin,c.first),g=Math.min(d,a.visible.to+p.options.viewportMargin);b.viewFrom<f&&20>f-b.viewFrom&&
(f=Math.max(c.first,b.viewFrom));b.viewTo>g&&20>b.viewTo-g&&(g=Math.min(d,b.viewTo));Pa&&(f=dd(p.doc,f),g=Ud(p.doc,g));c=f!=b.viewFrom||g!=b.viewTo||b.lastWrapHeight!=a.wrapperHeight||b.lastWrapWidth!=a.wrapperWidth;d=p.display;0==d.view.length||f>=d.viewTo||g<=d.viewFrom?(d.view=rc(p,f,g),d.viewFrom=f):(d.viewFrom>f?d.view=rc(p,f,d.viewFrom).concat(d.view):d.viewFrom<f&&(d.view=d.view.slice($a(p,f))),d.viewFrom=f,d.viewTo<g?d.view=d.view.concat(rc(p,d.viewTo,g)):d.viewTo>g&&(d.view=d.view.slice(0,
$a(p,g))));d.viewTo=g;b.viewOffset=Aa(D(p.doc,b.viewFrom));p.display.mover.style.top=b.viewOffset+"px";g=Td(p);if(!c&&0==g&&!a.force&&b.renderedView==b.view&&(null==b.updateLineNumbers||b.updateLineNumbers>=b.viewTo))return!1;f=Ba();4<g&&(b.lineDiv.style.display="none");ed(p,b.updateLineNumbers,a.dims);4<g&&(b.lineDiv.style.display="");b.renderedView=b.view;f&&Ba()!=f&&f.offsetHeight&&f.focus();Wa(b.cursorDiv);Wa(b.selectionDiv);b.gutters.style.height=b.sizer.style.minHeight=0;c&&(b.lastWrapHeight=
a.wrapperHeight,b.lastWrapWidth=a.wrapperWidth,Jb(p,400));b.updateLineNumbers=null;return!0}function Ha(p,a){for(var b=a.viewport,c=!0;;c=!1){if(!c||!p.options.lineWrapping||a.oldDisplayWidth==Na(p))if(b&&null!=b.top&&(b={top:Math.min(p.doc.height+cd(p.display)-fd(p),b.top)}),a.visible=C(p.display,p.doc,b),a.visible.from>=p.display.viewFrom&&a.visible.to<=p.display.viewTo)break;if(!U(p,a))break;nb(p);c=z(p);Pb(p);Qb(p,c);w(p,c)}a.signal(p,"update",p);if(p.display.viewFrom!=p.display.reportedViewFrom||
p.display.viewTo!=p.display.reportedViewTo)a.signal(p,"viewportChange",p,p.display.viewFrom,p.display.viewTo),p.display.reportedViewFrom=p.display.viewFrom,p.display.reportedViewTo=p.display.viewTo}function Rb(p,a){var b=new T(p,a);if(U(p,b)){nb(p);Ha(p,b);var c=z(p);Pb(p);Qb(p,c);w(p,c);b.finish()}}function Qb(p,a){p.display.sizer.style.minHeight=a.docHeight+"px";var b=a.docHeight+p.display.barHeight;p.display.heightForcer.style.top=b+"px";p.display.gutters.style.height=Math.max(b+za(p),a.clientHeight)+
"px"}function nb(p){p=p.display;for(var a=p.lineDiv.offsetTop,b=0;b<p.view.length;b++){var c=p.view[b],d;if(!c.hidden){if(M&&8>R){var f=c.node.offsetTop+c.node.offsetHeight;d=f-a;a=f}else d=c.node.getBoundingClientRect(),d=d.bottom-d.top;f=c.line.height-d;2>d&&(d=Ua(p));if(.001<f||-.001>f)if(ya(c.line,d),ab(c.line),c.rest)for(d=0;d<c.rest.length;d++)ab(c.rest[d])}}}function ab(p){if(p.widgets)for(var a=0;a<p.widgets.length;++a)p.widgets[a].height=p.widgets[a].node.offsetHeight}function Za(p){for(var a=
p.display,b={},c={},d=a.gutters.clientLeft,f=a.gutters.firstChild,g=0;f;f=f.nextSibling,++g)b[p.options.gutters[g]]=f.offsetLeft+f.clientLeft+d,c[p.options.gutters[g]]=f.clientWidth;return{fixedPos:S(a),gutterTotalWidth:a.gutters.offsetWidth,gutterLeft:b,gutterWidth:c,wrapperWidth:a.wrapper.clientWidth}}function ed(p,a,b){function c(a){var b=a.nextSibling;Y&&sa&&p.display.currentWheelTarget==a?a.style.display="none":a.parentNode.removeChild(a);return b}for(var d=p.display,f=p.options.lineNumbers,
g=d.lineDiv,h=g.firstChild,n=d.view,d=d.viewFrom,m=0;m<n.length;m++){var q=n[m];if(!q.hidden)if(q.node&&q.node.parentNode==g){for(;h!=q.node;)h=c(h);h=f&&null!=a&&a<=d&&q.lineNumber;q.changes&&(-1<ea(q.changes,"gutter")&&(h=!1),Sb(p,q,d,b));h&&(Wa(q.lineNumber),q.lineNumber.appendChild(document.createTextNode(E(p.options,d))));h=q.node.nextSibling}else{var r=gd(p,q,d,b);g.insertBefore(r,h)}d+=q.size}for(;h;)h=c(h)}function Sb(p,a,b,c){for(var d=0;d<a.changes.length;d++){var f=a.changes[d];if("text"==
f){var f=a,g=f.text.className,h=sc(p,f);f.text==f.node&&(f.node=h.pre);f.text.parentNode.replaceChild(h.pre,f.text);f.text=h.pre;h.bgClass!=f.bgClass||h.textClass!=f.textClass?(f.bgClass=h.bgClass,f.textClass=h.textClass,Tb(f)):g&&(f.text.className=g)}else if("gutter"==f)tc(p,a,b,c);else if("class"==f)Tb(a);else if("widget"==f){f=p;g=a;h=c;g.alignable&&(g.alignable=null);for(var n=g.node.firstChild,m=void 0;n;n=m)m=n.nextSibling,"CodeMirror-linewidget"==n.className&&g.node.removeChild(n);Ub(f,g,h)}}a.changes=
null}function Ia(p){p.node==p.text&&(p.node=B("div",null,null,"position: relative"),p.text.parentNode&&p.text.parentNode.replaceChild(p.node,p.text),p.node.appendChild(p.text),M&&8>R&&(p.node.style.zIndex=2));return p.node}function sc(p,a){var b=p.display.externalMeasured;return b&&b.line==a.line?(p.display.externalMeasured=null,a.measure=b.measure,b.built):Vd(p,a)}function Tb(p){var a=p.bgClass?p.bgClass+" "+(p.line.bgClass||""):p.line.bgClass;a&&(a+=" CodeMirror-linebackground");if(p.background)a?
p.background.className=a:(p.background.parentNode.removeChild(p.background),p.background=null);else if(a){var b=Ia(p);p.background=b.insertBefore(B("div",null,a),b.firstChild)}p.line.wrapClass?Ia(p).className=p.line.wrapClass:p.node!=p.text&&(p.node.className="");p.text.className=(p.textClass?p.textClass+" "+(p.line.textClass||""):p.line.textClass)||""}function tc(p,a,b,c){a.gutter&&(a.node.removeChild(a.gutter),a.gutter=null);a.gutterBackground&&(a.node.removeChild(a.gutterBackground),a.gutterBackground=
null);if(a.line.gutterClass){var d=Ia(a);a.gutterBackground=B("div",null,"CodeMirror-gutter-background "+a.line.gutterClass,"left: "+(p.options.fixedGutter?c.fixedPos:-c.gutterTotalWidth)+"px; width: "+c.gutterTotalWidth+"px");d.insertBefore(a.gutterBackground,a.text)}var f=a.line.gutterMarkers;if(p.options.lineNumbers||f){var d=Ia(a),g=a.gutter=B("div",null,"CodeMirror-gutter-wrapper","left: "+(p.options.fixedGutter?c.fixedPos:-c.gutterTotalWidth)+"px");p.display.input.setUneditable(g);d.insertBefore(g,
a.text);a.line.gutterClass&&(g.className+=" "+a.line.gutterClass);!p.options.lineNumbers||f&&f["CodeMirror-linenumbers"]||(a.lineNumber=g.appendChild(B("div",E(p.options,b),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+c.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+p.display.lineNumInnerWidth+"px")));if(f)for(a=0;a<p.options.gutters.length;++a)b=p.options.gutters[a],(d=f.hasOwnProperty(b)&&f[b])&&g.appendChild(B("div",[d],"CodeMirror-gutter-elt","left: "+c.gutterLeft[b]+"px; width: "+
c.gutterWidth[b]+"px"))}}function gd(p,a,b,c){var d=sc(p,a);a.text=a.node=d.pre;d.bgClass&&(a.bgClass=d.bgClass);d.textClass&&(a.textClass=d.textClass);Tb(a);tc(p,a,b,c);Ub(p,a,c);return a.node}function Ub(p,a,b){Vb(p,a.line,a,b,!0);if(a.rest)for(var c=0;c<a.rest.length;c++)Vb(p,a.rest[c],a,b,!1)}function Vb(p,a,b,c,d){if(a.widgets){var f=Ia(b),g=0;for(a=a.widgets;g<a.length;++g){var h=a[g],n=B("div",[h.node],"CodeMirror-linewidget");h.handleMouseEvents||n.setAttribute("cm-ignore-events","true");
var m=h,q=n,r=c;if(m.noHScroll){(b.alignable||(b.alignable=[])).push(q);var s=r.wrapperWidth;q.style.left=r.fixedPos+"px";m.coverGutter||(s-=r.gutterTotalWidth,q.style.paddingLeft=r.gutterTotalWidth+"px");q.style.width=s+"px"}m.coverGutter&&(q.style.zIndex=5,q.style.position="relative",m.noHScroll||(q.style.marginLeft=-r.gutterTotalWidth+"px"));p.display.input.setUneditable(n);d&&h.above?f.insertBefore(n,b.gutter||b.text):f.appendChild(n);fa(h,"redraw")}}}function ob(p){return A(p.line,p.ch)}function pb(p,
a){return 0>K(p,a)?a:p}function qb(p,a){return 0>K(p,a)?p:a}function uc(p){p.state.focused||(p.display.input.focus(),ad(p))}function Qa(p){return p.options.readOnly||p.doc.cantEdit}function bb(p,a,b,c,d){var f=p.doc;p.display.shift=!1;c||(c=f.sel);var g=p.state.pasteIncoming||"paste"==d,h=f.splitLines(a),n=null;if(g&&1<c.ranges.length)if(oa&&oa.join("\n")==a){if(0==c.ranges.length%oa.length)for(var n=[],m=0;m<oa.length;m++)n.push(f.splitLines(oa[m]))}else h.length==c.ranges.length&&(n=vc(h,function(p){return[p]}));
for(m=c.ranges.length-1;0<=m;m--){var q=c.ranges[m],r=q.from(),s=q.to();q.empty()&&(b&&0<b?r=A(r.line,r.ch-b):p.state.overwrite&&!g&&(s=A(s.line,Math.min(D(f,s.line).text.length,s.ch+N(h).length))));q=p.curOp.updateInput;r={from:r,to:s,text:n?n[m%n.length]:h,origin:d||(g?"paste":p.state.cutIncoming?"cut":"+input")};rb(p.doc,r);fa(p,"inputRead",p,r)}a&&!g&&Z(p,a);sb(p);p.curOp.updateInput=q;p.curOp.typing=!0;p.state.pasteIncoming=p.state.cutIncoming=!1}function aa(p,a){var b=p.clipboardData&&p.clipboardData.getData("text/plain");
if(b)return p.preventDefault(),ka(a,function(){bb(a,b,0,null,"paste")}),!0}function Z(p,a){if(p.options.electricChars&&p.options.smartIndent)for(var b=p.doc.sel,c=b.ranges.length-1;0<=c;c--){var d=b.ranges[c];if(!(100<d.head.ch||c&&b.ranges[c-1].head.line==d.head.line)){var f=p.getModeAt(d.head),g=!1;if(f.electricChars)for(var h=0;h<f.electricChars.length;h++){if(-1<a.indexOf(f.electricChars.charAt(h))){g=Wb(p,d.head.line,"smart");break}}else f.electricInput&&f.electricInput.test(D(p.doc,d.head.line).text.slice(0,
d.head.ch))&&(g=Wb(p,d.head.line,"smart"));g&&fa(p,"electricInput",p,d.head.line)}}}function W(p){for(var a=[],b=[],c=0;c<p.doc.sel.ranges.length;c++){var d=p.doc.sel.ranges[c].head.line,d={anchor:A(d,0),head:A(d+1,0)};b.push(d);a.push(p.getRange(d.anchor,d.head))}return{text:a,ranges:b}}function Wd(p){p.setAttribute("autocorrect","off");p.setAttribute("autocapitalize","off");p.setAttribute("spellcheck","false")}function hd(p){this.cm=p;this.prevInput="";this.pollingFast=!1;this.polling=new Gb;this.hasSelection=
this.inaccurateSelection=!1;this.composing=null}function Xd(){var p=B("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none"),a=B("div",[p],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");Y?p.style.width="1000px":p.setAttribute("wrap","off");tb&&(p.style.border="1px solid black");Wd(p);return a}function id(p){this.cm=p;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new Gb;this.gracePeriod=
!1}function Yd(p,a){var b=jd(p,a.line);if(!b||b.hidden)return null;var c=D(p.doc,a.line),b=Zd(b,c,a.line),c=ta(c),d="left";c&&(d=wc(c,a.ch)%2?"right":"left");b=$d(b.map,a.ch,d);b.offset="right"==b.collapse?b.end:b.start;return b}function ub(p,a){a&&(p.bad=!0);return p}function xc(p,a,b){var c;if(a==p.display.lineDiv){c=p.display.lineDiv.childNodes[b];if(!c)return ub(p.clipPos(A(p.display.viewTo-1)),!0);a=null;b=0}else for(c=a;;c=c.parentNode){if(!c||c==p.display.lineDiv)return null;if(c.parentNode&&
c.parentNode==p.display.lineDiv)break}for(var d=0;d<p.display.view.length;d++){var f=p.display.view[d];if(f.node==c)return tf(f,a,b)}}function tf(p,a,b){function c(a,b,O){for(var d=-1;d<(m?m.length:0);d++)for(var ma=0>d?n.map:m[d],f=0;f<ma.length;f+=3){var xa=ma[f+2];if(xa==a||xa==b){b=P(0>d?p.line:p.rest[d]);d=ma[f]+O;if(0>O||xa!=a)d=ma[f+(O?1:0)];return A(b,d)}}}var d=p.text.firstChild,f=!1;if(!a||!kd(d,a))return ub(A(P(p.line),0),!0);if(a==d&&(f=!0,a=d.childNodes[b],b=0,!a))return b=p.rest?N(p.rest):
p.line,ub(A(P(b),b.text.length),f);var g=3==a.nodeType?a:null,h=a;g||1!=a.childNodes.length||3!=a.firstChild.nodeType||(g=a.firstChild,b&&(b=g.nodeValue.length));for(;h.parentNode!=d;)h=h.parentNode;var n=p.measure,m=n.maps;if(a=c(g,h,b))return ub(a,f);d=h.nextSibling;for(g=g?g.nodeValue.length-b:0;d;d=d.nextSibling){if(a=c(d,d.firstChild,0))return ub(A(a.line,a.ch-g),f);g+=d.textContent.length}h=h.previousSibling;for(g=b;h;h=h.previousSibling){if(a=c(h,h.firstChild,-1))return ub(A(a.line,a.ch+g),
f);g+=d.textContent.length}}function uf(p,a,b,c,d){function f(p){return function(a){return a.id==p}}function g(a){if(1==a.nodeType){var b=a.getAttribute("cm-text");if(null!=b)""==b&&(b=a.textContent.replace(/\u200b/g,"")),h+=b;else{var b=a.getAttribute("cm-marker"),O;if(b)a=p.findMarks(A(c,0),A(d+1,0),f(+b)),a.length&&(O=a[0].find())&&(h+=cb(p.doc,O.from,O.to).join(m));else if("false"!=a.getAttribute("contenteditable")){for(O=0;O<a.childNodes.length;O++)g(a.childNodes[O]);/^(pre|div|p)$/i.test(a.nodeName)&&
(n=!0)}}}else 3==a.nodeType&&(a=a.nodeValue)&&(n&&(h+=m,n=!1),h+=a)}for(var h="",n=!1,m=p.doc.lineSeparator();;){g(a);if(a==b)break;a=a.nextSibling}return h}function Ja(p,a){this.ranges=p;this.primIndex=a}function Q(p,a){this.anchor=p;this.head=a}function ua(p,a){var b=p[a];p.sort(function(p,a){return K(p.from(),a.from())});a=ea(p,b);for(b=1;b<p.length;b++){var c=p[b],d=p[b-1];if(0<=K(d.to(),c.from())){var f=qb(d.from(),c.from()),g=pb(d.to(),c.to()),c=d.empty()?c.from()==c.head:d.from()==d.head;b<=
a&&--a;p.splice(--b,2,new Q(c?g:f,c?f:g))}}return new Ja(p,a)}function Ca(p,a){return new Ja([new Q(p,a||p)],0)}function J(p,a){if(a.line<p.first)return A(p.first,0);var b=p.first+p.size-1;if(a.line>b)return A(b,D(p,b).text.length);var b=D(p,a.line).text.length,c=a.ch,b=null==c||c>b?A(a.line,b):0>c?A(a.line,0):a;return b}function Xb(p,a){return a>=p.first&&a<p.first+p.size}function Yb(p,a,b,c){return p.cm&&p.cm.display.shift||p.extend?(p=a.anchor,c&&(a=0>K(b,p),a!=0>K(c,p)?(p=b,b=c):a!=0>K(b,c)&&
(b=c)),new Q(p,b)):new Q(c||b,b)}function yc(p,a,b,c){ba(p,new Ja([Yb(p,p.sel.primary(),a,b)],0),c)}function ae(p,a,b){for(var c=[],d=0;d<p.sel.ranges.length;d++)c[d]=Yb(p,p.sel.ranges[d],a[d],null);a=ua(c,p.sel.primIndex);ba(p,a,b)}function ld(a,b,c,d){var f=a.sel.ranges.slice(0);f[b]=c;ba(a,ua(f,a.sel.primIndex),d)}function vf(a,b){var c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new Q(J(a,b[c].anchor),J(a,b[c].head))}};X(a,"beforeSelectionChange",
a,c);a.cm&&X(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?ua(c.ranges,c.ranges.length-1):b}function be(a,b,c){var d=a.history.done,f=N(d);f&&f.ranges?(d[d.length-1]=b,zc(a,b,c)):ba(a,b,c)}function ba(a,b,c){zc(a,b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,f=a.history,g=c&&c.origin,h;if(!(h=d==f.lastSelOp)&&(h=g&&f.lastSelOrigin==g)&&!(h=f.lastModTime==f.lastSelTime&&f.lastOrigin==g)){h=N(f.done);var n=g.charAt(0);h="*"==n||"+"==n&&h.ranges.length==b.ranges.length&&h.somethingSelected()==
b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}h?f.done[f.done.length-1]=b:Ac(b,f.done);f.lastSelTime=+new Date;f.lastSelOrigin=g;f.lastSelOp=d;c&&!1!==c.clearRedo&&ce(f.undone)}function zc(a,b,c){if(pa(a,"beforeSelectionChange")||a.cm&&pa(a.cm,"beforeSelectionChange"))b=vf(a,b);var d=c&&c.bias||(0>K(b.primary().head,a.sel.primary().head)?-1:1);de(a,ee(a,b,d,!0));c&&!1===c.scroll||!a.cm||sb(a.cm)}function de(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&(a.cm.curOp.updateInput=
a.cm.curOp.selectionChanged=!0,fe(a.cm)),fa(a,"cursorActivity",a))}function ge(a){de(a,ee(a,a.sel,null,!1),Da)}function ee(a,b,c,d){for(var f,g=0;g<b.ranges.length;g++){var h=b.ranges[g],n=Bc(a,h.anchor,c,d),m=Bc(a,h.head,c,d);if(f||n!=h.anchor||m!=h.head)f||(f=b.ranges.slice(0,g)),f[g]=new Q(n,m)}return f?ua(f,b.primIndex):b}function Bc(a,b,c,d){var f=!1,g=b,h=c||1;a.cantEdit=!1;a:for(;;){var n=D(a,g.line);if(n.markedSpans)for(var m=0;m<n.markedSpans.length;++m){var q=n.markedSpans[m],r=q.marker;
if((null==q.from||(r.inclusiveLeft?q.from<=g.ch:q.from<g.ch))&&(null==q.to||(r.inclusiveRight?q.to>=g.ch:q.to>g.ch))){if(d&&(X(r,"beforeCursorEnter"),r.explicitlyCleared))if(n.markedSpans){--m;continue}else break;if(r.atomic){m=r.find(0>h?-1:1);if(0==K(m,g)&&(m.ch+=h,0>m.ch?m=m.line>a.first?J(a,A(m.line-1)):null:m.ch>n.text.length&&(m=m.line<a.first+a.size-1?A(m.line+1,0):null),!m)){if(f){if(!d)return Bc(a,b,c,!0);a.cantEdit=!0;return A(a.first,0)}f=!0;m=b;h=-h}g=m;continue a}}}return g}}function Pb(a){a.display.input.showSelection(a.display.input.prepareSelection())}
function he(a,b){for(var c=a.doc,d={},f=d.cursors=document.createDocumentFragment(),g=d.selection=document.createDocumentFragment(),h=0;h<c.sel.ranges.length;h++)if(!1!==b||h!=c.sel.primIndex){var n=c.sel.ranges[h],m=n.empty();if(m||a.options.showCursorWhenSelecting){var q=a,r=f,s=Ka(q,n.head,"div",null,null,!q.options.singleCursorHeightPerLine),t=r.appendChild(B("div","\u00a0","CodeMirror-cursor"));t.style.left=s.left+"px";t.style.top=s.top+"px";t.style.height=Math.max(0,s.bottom-s.top)*q.options.cursorHeight+
"px";s.other&&(q=r.appendChild(B("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),q.style.display="",q.style.left=s.other.left+"px",q.style.top=s.other.top+"px",q.style.height=.85*(s.other.bottom-s.other.top)+"px")}m||wf(a,n,g)}return d}function wf(a,b,c){function d(a,p,b,c){0>p&&(p=0);p=Math.round(p);c=Math.round(c);n.appendChild(B("div",null,"CodeMirror-selected","position: absolute; left: "+a+"px; top: "+p+"px; width: "+(null==b?r-a:b)+"px; height: "+(c-p)+"px"))}function f(b,c,
O){var ma=D(h,b),na=ma.text.length,g,n;xf(ta(ma),c||0,null==O?na:O,function(f,h,ca){var m=Cc(a,A(b,f),"div",ma,"left"),s,qc;f==h?(s=m,ca=qc=m.left):(s=Cc(a,A(b,h-1),"div",ma,"right"),"rtl"==ca&&(ca=m,m=s,s=ca),ca=m.left,qc=s.right);null==c&&0==f&&(ca=q);3<s.top-m.top&&(d(ca,m.top,null,m.bottom),ca=q,m.bottom<s.top&&d(ca,m.bottom,null,s.top));null==O&&h==na&&(qc=r);if(!g||m.top<g.top||m.top==g.top&&m.left<g.left)g=m;if(!n||s.bottom>n.bottom||s.bottom==n.bottom&&s.right>n.right)n=s;ca<q+1&&(ca=q);d(ca,
s.top,qc-ca,s.bottom)});return{start:g,end:n}}var g=a.display,h=a.doc,n=document.createDocumentFragment(),m=ie(a.display),q=m.left,r=Math.max(g.sizerWidth,Na(a)-g.sizer.offsetLeft)-m.right,g=b.from();b=b.to();if(g.line==b.line)f(g.line,g.ch,b.ch);else{var s=D(h,g.line),m=D(h,b.line),m=Ea(s)==Ea(m),g=f(g.line,g.ch,m?s.text.length+1:null).end;b=f(b.line,m?0:null,b.ch).start;m&&(g.top<b.top-2?(d(g.right,g.top,null,g.bottom),d(q,b.top,b.left,b.bottom)):d(g.right,g.top,b.left-g.right,g.bottom));g.bottom<
b.top&&d(q,g.bottom,null,b.top)}c.appendChild(n)}function md(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="";0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function Jb(a,b){a.doc.mode.startState&&a.doc.frontier<a.display.viewTo&&a.state.highlight.set(b,Hb(yf,a))}function yf(a){var b=
a.doc;b.frontier<b.first&&(b.frontier=b.first);if(!(b.frontier>=a.display.viewTo)){var c=+new Date+a.options.workTime,d=vb(b.mode,Zb(a,b.frontier)),f=[];b.iter(b.frontier,Math.min(b.first+b.size,a.display.viewTo+500),function(g){if(b.frontier>=a.display.viewFrom){var h=g.styles,n=je(a,g,d,!0);g.styles=n.styles;var m=g.styleClasses;(n=n.classes)?g.styleClasses=n:m&&(g.styleClasses=null);m=!h||h.length!=g.styles.length||m!=n&&(!m||!n||m.bgClass!=n.bgClass||m.textClass!=n.textClass);for(n=0;!m&&n<h.length;++n)m=
h[n]!=g.styles[n];m&&f.push(b.frontier);g.stateAfter=vb(b.mode,d)}else nd(a,g.text,d),g.stateAfter=0==b.frontier%5?vb(b.mode,d):null;++b.frontier;if(+new Date>c)return Jb(a,a.options.workDelay),!0});f.length&&ka(a,function(){for(var b=0;b<f.length;b++)La(a,f[b],"text")})}}function zf(a,b,c){for(var d,f,g=a.doc,h=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>h;--b){if(b<=g.first)return g.first;var n=D(g,b-1);if(n.stateAfter&&(!c||b<=g.frontier))return b;n=va(n.text,null,a.options.tabSize);if(null==f||d>
n)f=b-1,d=n}return f}function Zb(a,b,c){var d=a.doc,f=a.display;if(!d.mode.startState)return!0;var g=zf(a,b,c),h=g>d.first&&D(d,g-1).stateAfter,h=h?vb(d.mode,h):Af(d.mode);d.iter(g,b,function(c){nd(a,c.text,h);c.stateAfter=g==b-1||0==g%5||g>=f.viewFrom&&g<f.viewTo?vb(d.mode,h):null;++g});c&&(d.frontier=g);return h}function cd(a){return a.mover.offsetHeight-a.lineSpace.offsetHeight}function ie(a){if(a.cachedPaddingH)return a.cachedPaddingH;var b=qa(a.measure,B("pre","x")),b=window.getComputedStyle?
window.getComputedStyle(b):b.currentStyle,b={left:parseInt(b.paddingLeft),right:parseInt(b.paddingRight)};isNaN(b.left)||isNaN(b.right)||(a.cachedPaddingH=b);return b}function za(a){return Sd-a.display.nativeBarWidth}function Na(a){return a.display.scroller.clientWidth-za(a)-a.display.barWidth}function fd(a){return a.display.scroller.clientHeight-za(a)-a.display.barHeight}function Zd(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==
b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(d=0;d<a.rest.length;d++)if(P(a.rest[d])>c)return{map:a.measure.maps[d],cache:a.measure.caches[d],before:!0}}function jd(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[$a(a,b)];var c=a.display.externalMeasured;if(c&&b>=c.lineN&&b<c.lineN+c.size)return c}function Dc(a,b){var c=P(b),d=jd(a,c);d&&!d.text?d=null:d&&d.changes&&(Sb(a,d,c,Za(a)),a.curOp.forceUpdate=!0);if(!d){var f;f=Ea(b);d=P(f);f=a.display.externalMeasured=
new ke(a.doc,f,d);f.lineN=d;d=f.built=Vd(a,f);f.text=d.pre;qa(a.display.lineMeasure,d.pre);d=f}c=Zd(d,b,c);return{line:b,view:d,rect:null,map:c.map,cache:c.cache,before:c.before,hasHeights:!1}}function od(a,b,c,d,f){b.before&&(c=-1);var g=c+(d||"");if(b.cache.hasOwnProperty(g))a=b.cache[g];else{b.rect||(b.rect=b.view.text.getBoundingClientRect());if(!b.hasHeights){var h=b.view,n=b.rect,m=a.options.lineWrapping,q=m&&Na(a);if(!h.measure.heights||m&&h.measure.width!=q){var s=h.measure.heights=[];if(m)for(h.measure.width=
q,h=h.text.firstChild.getClientRects(),m=0;m<h.length-1;m++){var q=h[m],r=h[m+1];2<Math.abs(q.bottom-r.bottom)&&s.push((q.bottom+r.top)/2-n.top)}s.push(n.bottom-n.top)}b.hasHeights=!0}h=d;m=$d(b.map,c,h);d=m.node;n=m.start;q=m.end;c=m.collapse;var t;if(3==d.nodeType){for(s=0;4>s;s++){for(;n&&$b(b.line.text.charAt(m.coverStart+n));)--n;for(;m.coverStart+q<m.coverEnd&&$b(b.line.text.charAt(m.coverStart+q));)++q;if(M&&9>R&&0==n&&q==m.coverEnd-m.coverStart)t=d.parentNode.getBoundingClientRect();else if(M&&
a.options.lineWrapping){var v=db(d,n,q).getClientRects();t=v.length?v["right"==h?v.length-1:0]:pd}else t=db(d,n,q).getBoundingClientRect()||pd;if(t.left||t.right||0==n)break;q=n;n-=1;c="right"}if(M&&11>R){if(v=window.screen&&null!=screen.logicalXDPI&&screen.logicalXDPI!=screen.deviceXDPI)null!=qd?v=qd:(s=qa(a.display.measure,B("span","x")),v=s.getBoundingClientRect(),s=db(s,0,1).getBoundingClientRect(),v=qd=1<Math.abs(v.left-s.left));v&&(v=screen.logicalXDPI/screen.deviceXDPI,s=screen.logicalYDPI/
screen.deviceYDPI,t={left:t.left*v,right:t.right*v,top:t.top*s,bottom:t.bottom*s})}}else 0<n&&(c=h="right"),t=a.options.lineWrapping&&1<(v=d.getClientRects()).length?v["right"==h?v.length-1:0]:d.getBoundingClientRect();!(M&&9>R)||n||t&&(t.left||t.right)||(t=(t=d.parentNode.getClientRects()[0])?{left:t.left,right:t.left+Kb(a.display),top:t.top,bottom:t.bottom}:pd);v=t.top-b.rect.top;d=t.bottom-b.rect.top;n=(v+d)/2;h=b.view.measure.heights;for(s=0;s<h.length-1&&!(n<h[s]);s++);c={left:("right"==c?t.right:
t.left)-b.rect.left,right:("left"==c?t.left:t.right)-b.rect.left,top:s?h[s-1]:0,bottom:h[s]};t.left||t.right||(c.bogus=!0);a.options.singleCursorHeightPerLine||(c.rtop=v,c.rbottom=d);a=c;a.bogus||(b.cache[g]=a)}return{left:a.left,right:a.right,top:f?a.rtop:a.top,bottom:f?a.rbottom:a.bottom}}function $d(a,b,c){for(var d,f,g,h,n=0;n<a.length;n+=3){var m=a[n],q=a[n+1];if(b<m)f=0,g=1,h="left";else if(b<q)f=b-m,g=f+1;else if(n==a.length-3||b==q&&a[n+3]>b)g=q-m,f=g-1,b>=q&&(h="right");if(null!=f){d=a[n+
2];m==q&&c==(d.insertLeft?"left":"right")&&(h=c);if("left"==c&&0==f)for(;n&&a[n-2]==a[n-3]&&a[n-1].insertLeft;)d=a[(n-=3)+2],h="left";if("right"==c&&f==q-m)for(;n<a.length-3&&a[n+3]==a[n+4]&&!a[n+5].insertLeft;)d=a[(n+=3)+2],h="right";break}}return{node:d,start:f,end:g,collapse:h,coverStart:m,coverEnd:q}}function le(a){if(a.measure&&(a.measure.cache={},a.measure.heights=null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function me(a){a.display.externalMeasure=null;Wa(a.display.lineMeasure);
for(var b=0;b<a.display.view.length;b++)le(a.display.view[b])}function Lb(a){me(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function rd(a,b,c,d){if(b.widgets)for(var f=0;f<b.widgets.length;++f)if(b.widgets[f].above){var g=ac(b.widgets[f]);c.top+=g;c.bottom+=g}if("line"==d)return c;d||(d="local");b=Aa(b);b="local"==d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==
d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:window.pageYOffset||(document.documentElement||document.body).scrollTop),d=a.left+("window"==d?0:window.pageXOffset||(document.documentElement||document.body).scrollLeft),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function ne(a,b,c){if("div"==c)return b;var d=b.left;b=b.top;"page"==c?(d-=window.pageXOffset||(document.documentElement||document.body).scrollLeft,b-=window.pageYOffset||(document.documentElement||
document.body).scrollTop):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-a.left,top:b-a.top}}function Cc(a,b,c,d,f){d||(d=D(a.doc,b.line));var g=d;b=b.ch;d=od(a,Dc(a,d),b,f);return rd(a,g,d,c)}function Ka(a,b,c,d,f,g){function h(b,O){var n=od(a,f,b,O?"right":"left",g);O?n.left=n.right:n.right=n.left;return rd(a,d,n,c)}function n(a,b){var p=m[b],c=p.level%2;a==sd(p)&&b&&p.level<m[b-1].level?(p=m[--b],a=td(p)-
(p.level%2?0:1),c=!0):a==td(p)&&b<m.length-1&&p.level<m[b+1].level&&(p=m[++b],a=sd(p)-p.level%2,c=!1);return c&&a==p.to&&a>p.from?h(a-1):h(a,c)}d=d||D(a.doc,b.line);f||(f=Dc(a,d));var m=ta(d);b=b.ch;if(!m)return h(b);var q=wc(m,b),q=n(b,q);null!=bc&&(q.other=n(b,bc));return q}function oe(a,b){var c=0;b=J(a.doc,b);a.options.lineWrapping||(c=Kb(a.display)*b.ch);var d=D(a.doc,b.line),f=Aa(d)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:f,bottom:f+d.height}}function Ec(a,b,c,d){a=A(a,b);a.xRel=
d;c&&(a.outside=!0);return a}function ud(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return Ec(d.first,0,!0,-1);var f=Ya(d,c),g=d.first+d.size-1;if(f>g)return Ec(d.first+d.size-1,D(d,g).text.length,!0,1);0>b&&(b=0);for(d=D(d,f);;)if(f=Bf(a,d,f,b,c),g=(d=Xa(d,!1))&&d.find(0,!0),d&&(f.ch>g.from.ch||f.ch==g.from.ch&&0<f.xRel))f=P(d=g.to.line);else return f}function Bf(a,b,c,d,f){function g(d){d=Ka(a,A(c,d),"line",b,q);n=!0;if(h>d.bottom)return d.left-m;if(h<d.top)return d.left+m;n=!1;return d.left}
var h=f-Aa(b),n=!1,m=2*a.display.wrapper.clientWidth,q=Dc(a,b),s=ta(b),r=b.text.length;f=Fc(b);var t=Gc(b),v=g(f),x=n,w=g(t),G=n;if(d>w)return Ec(c,t,G,1);for(;;){if(s?t==f||t==vd(b,f,1):1>=t-f){s=d<v||d-v<=w-d?f:t;for(d-=s==f?v:w;$b(b.text.charAt(s));)++s;return Ec(c,s,s==f?x:G,-1>d?-1:1<d?1:0)}var u=Math.ceil(r/2),z=f+u;if(s)for(var z=f,Z=0;Z<u;++Z)z=vd(b,z,1);Z=g(z);if(Z>d){t=z;w=Z;if(G=n)w+=1E3;r=u}else f=z,v=Z,x=n,r-=u}}function Ua(a){if(null!=a.cachedTextHeight)return a.cachedTextHeight;if(null==
eb){eb=B("pre");for(var b=0;49>b;++b)eb.appendChild(document.createTextNode("x")),eb.appendChild(B("br"));eb.appendChild(document.createTextNode("x"))}qa(a.measure,eb);b=eb.offsetHeight/50;3<b&&(a.cachedTextHeight=b);Wa(a.measure);return b||1}function Kb(a){if(null!=a.cachedCharWidth)return a.cachedCharWidth;var b=B("span","xxxxxxxxxx"),c=B("pre",[b]);qa(a.measure,c);b=b.getBoundingClientRect();b=(b.right-b.left)/10;2<b&&(a.cachedCharWidth=b);return b||10}function jb(a){a.curOp={cm:a,viewChanged:!1,
startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Cf};wb?wb.ops.push(a.curOp):a.curOp.ownsGroup=wb={ops:[a.curOp],delayedCallbacks:[]}}function lb(a){if(a=a.curOp.ownsGroup)try{var b=a.delayedCallbacks,c=0;do{for(;c<b.length;c++)b[c].call(null);for(var d=0;d<a.ops.length;d++){var f=a.ops[d];if(f.cursorActivityHandlers)for(;f.cursorActivityCalled<
f.cursorActivityHandlers.length;)f.cursorActivityHandlers[f.cursorActivityCalled++].call(null,f.cm)}}while(c<b.length)}finally{wb=null;for(b=0;b<a.ops.length;b++)a.ops[b].cm.curOp=null;a=a.ops;for(b=0;b<a.length;b++){var f=a[b],c=f.cm,d=c.display,g=c,h=g.display;!h.scrollbarsClipped&&h.scroller.offsetWidth&&(h.nativeBarWidth=h.scroller.offsetWidth-h.scroller.clientWidth,h.heightForcer.style.height=za(g)+"px",h.sizer.style.marginBottom=-h.nativeBarWidth+"px",h.sizer.style.borderRightWidth=za(g)+"px",
h.scrollbarsClipped=!0);f.updateMaxLine&&t(c);f.mustUpdate=f.viewChanged||f.forceUpdate||null!=f.scrollTop||f.scrollToPos&&(f.scrollToPos.from.line<d.viewFrom||f.scrollToPos.to.line>=d.viewTo)||d.maxLineChanged&&c.options.lineWrapping;f.update=f.mustUpdate&&new T(c,f.mustUpdate&&{top:f.scrollTop,ensure:f.scrollToPos},f.forceUpdate)}for(b=0;b<a.length;b++)f=a[b],f.updatedDisplay=f.mustUpdate&&U(f.cm,f.update);for(b=0;b<a.length;b++)if(f=a[b],c=f.cm,d=c.display,f.updatedDisplay&&nb(c),f.barMeasure=
z(c),d.maxLineChanged&&!c.options.lineWrapping&&(g=f,h=d.maxLine.text.length,h=od(c,Dc(c,d.maxLine),h,void 0),g.adjustWidthTo=h.left+3,c.display.sizerWidth=f.adjustWidthTo,f.barMeasure.scrollWidth=Math.max(d.scroller.clientWidth,d.sizer.offsetLeft+f.adjustWidthTo+za(c)+c.display.barWidth),f.maxScrollLeft=Math.max(0,d.sizer.offsetLeft+f.adjustWidthTo-Na(c))),f.updatedDisplay||f.selectionChanged)f.preparedSelection=d.input.prepareSelection();for(b=0;b<a.length;b++)f=a[b],c=f.cm,null!=f.adjustWidthTo&&
(c.display.sizer.style.minWidth=f.adjustWidthTo+"px",f.maxScrollLeft<c.doc.scrollLeft&&mb(c,Math.min(c.display.scroller.scrollLeft,f.maxScrollLeft),!0),c.display.maxLineChanged=!1),f.preparedSelection&&c.display.input.showSelection(f.preparedSelection),f.updatedDisplay&&Qb(c,f.barMeasure),(f.updatedDisplay||f.startHeight!=c.doc.height)&&w(c,f.barMeasure),f.selectionChanged&&md(c),c.state.focused&&f.updateInput&&c.display.input.reset(f.typing),f.focus&&f.focus==Ba()&&uc(f.cm);for(b=0;b<a.length;b++){f=
a[b];c=f.cm;d=c.display;g=c.doc;f.updatedDisplay&&Ha(c,f.update);null==d.wheelStartX||null==f.scrollTop&&null==f.scrollLeft&&!f.scrollToPos||(d.wheelStartX=d.wheelStartY=null);null==f.scrollTop||d.scroller.scrollTop==f.scrollTop&&!f.forceScroll||(g.scrollTop=Math.max(0,Math.min(d.scroller.scrollHeight-d.scroller.clientHeight,f.scrollTop)),d.scrollbars.setScrollTop(g.scrollTop),d.scroller.scrollTop=g.scrollTop);null==f.scrollLeft||d.scroller.scrollLeft==f.scrollLeft&&!f.forceScroll||(g.scrollLeft=
Math.max(0,Math.min(d.scroller.scrollWidth-Na(c),f.scrollLeft)),d.scrollbars.setScrollLeft(g.scrollLeft),d.scroller.scrollLeft=g.scrollLeft,H(c));if(f.scrollToPos){var n=void 0,h=J(g,f.scrollToPos.from),n=J(g,f.scrollToPos.to),m=f.scrollToPos.margin;null==m&&(m=0);for(var q=0;5>q;q++){var s=!1,r=Ka(c,h),v=n&&n!=h?Ka(c,n):r,v=Hc(c,Math.min(r.left,v.left),Math.min(r.top,v.top)-m,Math.max(r.left,v.left),Math.max(r.bottom,v.bottom)+m),x=c.doc.scrollTop,G=c.doc.scrollLeft;null!=v.scrollTop&&(Nb(c,v.scrollTop),
1<Math.abs(c.doc.scrollTop-x)&&(s=!0));null!=v.scrollLeft&&(mb(c,v.scrollLeft),1<Math.abs(c.doc.scrollLeft-G)&&(s=!0));if(!s)break}n=r;f.scrollToPos.isCursor&&c.state.focused&&(Fa(c,"scrollCursorIntoView")||(m=c.display,q=m.sizer.getBoundingClientRect(),h=null,0>n.top+q.top?h=!0:n.bottom+q.top>(window.innerHeight||document.documentElement.clientHeight)&&(h=!1),null==h||Df||(n=B("div","\u200b",null,"position: absolute; top: "+(n.top-m.viewOffset-c.display.lineSpace.offsetTop)+"px; height: "+(n.bottom-
n.top+za(c)+m.barHeight)+"px; left: "+n.left+"px; width: 2px;"),c.display.lineSpace.appendChild(n),n.scrollIntoView(h),c.display.lineSpace.removeChild(n))))}h=f.maybeHiddenMarkers;n=f.maybeUnhiddenMarkers;if(h)for(m=0;m<h.length;++m)h[m].lines.length||X(h[m],"hide");if(n)for(m=0;m<n.length;++m)n[m].lines.length&&X(n[m],"unhide");d.wrapper.offsetHeight&&(g.scrollTop=c.display.scroller.scrollTop);f.changeObjs&&X(c,"changes",c,f.changeObjs);f.update&&f.update.finish()}}}function ka(a,b){if(a.curOp)return b();
jb(a);try{return b()}finally{lb(a)}}function V(a,b){return function(){if(a.curOp)return b.apply(a,arguments);jb(a);try{return b.apply(a,arguments)}finally{lb(a)}}}function da(a){return function(){if(this.curOp)return a.apply(this,arguments);jb(this);try{return a.apply(this,arguments)}finally{lb(this)}}}function ga(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);jb(b);try{return a.apply(this,arguments)}finally{lb(b)}}}function ke(a,b,c){for(var d=this.line=b,f;d=Xa(d,
!1);)d=d.find(1,!0).line,(f||(f=[])).push(d);this.size=(this.rest=f)?P(N(this.rest))-c+1:1;this.node=this.text=null;this.hidden=Va(a,b)}function rc(a,b,c){var d=[],f;for(f=b;f<c;)b=new ke(a.doc,D(a.doc,f),f),f+=b.size,d.push(b);return d}function ja(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var f=a.display;d&&c<f.viewTo&&(null==f.updateLineNumbers||f.updateLineNumbers>b)&&(f.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=f.viewTo)Pa&&dd(a.doc,b)<f.viewTo&&Oa(a);
else if(c<=f.viewFrom)Pa&&Ud(a.doc,c+d)>f.viewFrom?Oa(a):(f.viewFrom+=d,f.viewTo+=d);else if(b<=f.viewFrom&&c>=f.viewTo)Oa(a);else if(b<=f.viewFrom){var g=Ic(a,c,c+d,1);g?(f.view=f.view.slice(g.index),f.viewFrom=g.lineN,f.viewTo+=d):Oa(a)}else if(c>=f.viewTo)(g=Ic(a,b,b,-1))?(f.view=f.view.slice(0,g.index),f.viewTo=g.lineN):Oa(a);else{var g=Ic(a,b,b,-1),h=Ic(a,c,c+d,1);g&&h?(f.view=f.view.slice(0,g.index).concat(rc(a,g.lineN,h.lineN)).concat(f.view.slice(h.index)),f.viewTo+=d):Oa(a)}if(a=f.externalMeasured)c<
a.lineN?a.lineN+=d:b<a.lineN+a.size&&(f.externalMeasured=null)}function La(a,b,c){a.curOp.viewChanged=!0;var d=a.display,f=a.display.externalMeasured;f&&b>=f.lineN&&b<f.lineN+f.size&&(d.externalMeasured=null);b<d.viewFrom||b>=d.viewTo||(a=d.view[$a(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==ea(a,c)&&a.push(c)))}function Oa(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function $a(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;
if(0>b)return null;for(var c=a.display.view,d=0;d<c.length;d++)if(b-=c[d].size,0>b)return d}function Ic(a,b,c,d){var f=$a(a,b),g=a.display.view;if(!Pa||c==a.doc.first+a.doc.size)return{index:f,lineN:c};for(var h=0,n=a.display.viewFrom;h<f;h++)n+=g[h].size;if(n!=b){if(0<d){if(f==g.length-1)return null;b=n+g[f].size-b;f++}else b=n-b;c+=b}for(;dd(a.doc,c)!=c;){if(f==(0>d?0:g.length-1))return null;c+=d*g[f-(0>d?1:0)].size;f+=d}return{index:f,lineN:c}}function Td(a){a=a.display.view;for(var b=0,c=0;c<
a.length;c++){var d=a[c];d.hidden||d.node&&!d.changes||++b}return b}function rf(a){function b(){d.activeTouch&&(f=setTimeout(function(){d.activeTouch=null},1E3),g=d.activeTouch,g.end=+new Date)}function c(a,b){if(null==b.left)return!0;var p=b.left-a.left,d=b.top-a.top;return 400<p*p+d*d}var d=a.display;F(d.scroller,"mousedown",V(a,pe));M&&11>R?F(d.scroller,"dblclick",V(a,function(b){if(!Fa(a,b)){var c=xb(a,b);!c||wd(a,b,"gutterClick",!0,fa)||Ma(a.display,b)||(ha(b),b=a.findWordAt(c),yc(a.doc,b.anchor,
b.head))}})):F(d.scroller,"dblclick",function(b){Fa(a,b)||ha(b)});xd||F(d.scroller,"contextmenu",function(b){qe(a,b)});var f,g={end:0};F(d.scroller,"touchstart",function(a){var b;1!=a.touches.length?b=!1:(b=a.touches[0],b=1>=b.radiusX&&1>=b.radiusY);b||(clearTimeout(f),b=+new Date,d.activeTouch={start:b,moved:!1,prev:300>=b-g.end?g:null},1==a.touches.length&&(d.activeTouch.left=a.touches[0].pageX,d.activeTouch.top=a.touches[0].pageY))});F(d.scroller,"touchmove",function(){d.activeTouch&&(d.activeTouch.moved=
!0)});F(d.scroller,"touchend",function(f){var g=d.activeTouch;if(g&&!Ma(d,f)&&null!=g.left&&!g.moved&&300>new Date-g.start){var h=a.coordsChar(d.activeTouch,"page"),g=!g.prev||c(g,g.prev)?new Q(h,h):!g.prev.prev||c(g,g.prev.prev)?a.findWordAt(h):new Q(A(h.line,0),J(a.doc,A(h.line+1,0)));a.setSelection(g.anchor,g.head);a.focus();ha(f)}b()});F(d.scroller,"touchcancel",b);F(d.scroller,"scroll",function(){d.scroller.clientHeight&&(Nb(a,d.scroller.scrollTop),mb(a,d.scroller.scrollLeft,!0),X(a,"scroll",
a))});F(d.scroller,"mousewheel",function(b){re(a,b)});F(d.scroller,"DOMMouseScroll",function(b){re(a,b)});F(d.wrapper,"scroll",function(){d.wrapper.scrollTop=d.wrapper.scrollLeft=0});d.dragFunctions={simple:function(b){Fa(a,b)||yd(b)},start:function(b){if(M&&(!a.state.draggingText||100>+new Date-se))yd(b);else if(!Fa(a,b)&&!Ma(a.display,b)&&(b.dataTransfer.setData("Text",a.getSelection()),b.dataTransfer.setDragImage&&!te)){var c=B("img",null,null,"position: fixed; left: 0; top: 0;");c.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
wa&&(c.width=c.height=1,a.display.wrapper.appendChild(c),c._top=c.offsetTop);b.dataTransfer.setDragImage(c,0,0);wa&&c.parentNode.removeChild(c)}},drop:V(a,Ef)};var h=d.input.getField();F(h,"keyup",function(b){ue.call(a,b)});F(h,"keydown",V(a,ve));F(h,"keypress",V(a,we));F(h,"focus",Hb(ad,a));F(h,"blur",Hb(Ib,a))}function Ff(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=
!1,a.setSize()}function Ma(a,b){for(var c=b.target||b.srcElement;c!=a.wrapper;c=c.parentNode)if(!c||1==c.nodeType&&"true"==c.getAttribute("cm-ignore-events")||c.parentNode==a.sizer&&c!=a.mover)return!0}function xb(a,b,c,d){var f=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;var g,h;c=f.lineSpace.getBoundingClientRect();try{g=b.clientX-c.left,h=b.clientY-c.top}catch(n){return null}b=ud(a,g,h);var m;d&&1==b.xRel&&(m=D(a.doc,b.line).text).length==b.ch&&
(d=va(m,m.length,a.options.tabSize)-m.length,b=A(b.line,Math.max(0,Math.round((g-ie(a.display).left)/Kb(a.display))-d)));return b}function pe(a){var b=this.display;if(!(b.activeTouch&&b.input.supportsTouch()||Fa(this,a)))if(b.shift=a.shiftKey,Ma(b,a))Y||(b.scroller.draggable=!1,setTimeout(function(){b.scroller.draggable=!0},100));else if(!wd(this,a,"gutterClick",!0,fa)){var c=xb(this,a);window.focus();switch(xe(a)){case 1:c?Gf(this,a,c):(a.target||a.srcElement)==b.scroller&&ha(a);break;case 2:Y&&
(this.state.lastMiddleDown=+new Date);c&&yc(this.doc,c);setTimeout(function(){b.input.focus()},20);ha(a);break;case 3:xd?qe(this,a):Hf(this)}}}function Gf(a,b,c){M?setTimeout(Hb(uc,a),0):a.curOp.focus=Ba();var d=+new Date,f;Jc&&Jc.time>d-400&&0==K(Jc.pos,c)?f="triple":Kc&&Kc.time>d-400&&0==K(Kc.pos,c)?(f="double",Jc={time:d,pos:c}):(f="single",Kc={time:d,pos:c});var d=a.doc.sel,g=sa?b.metaKey:b.ctrlKey,h;a.options.dragDrop&&If&&!Qa(a)&&"single"==f&&-1<(h=d.contains(c))&&(0>K((h=d.ranges[h]).from(),
c)||0<c.xRel)&&(0<K(h.to(),c)||0>c.xRel)?Jf(a,b,c,g):Kf(a,b,c,f,g)}function Jf(a,b,c,d){var f=a.display,g=+new Date,h=V(a,function(n){Y&&(f.scroller.draggable=!1);a.state.draggingText=!1;Ga(document,"mouseup",h);Ga(f.scroller,"drop",h);10>Math.abs(b.clientX-n.clientX)+Math.abs(b.clientY-n.clientY)&&(ha(n),!d&&+new Date-200<g&&yc(a.doc,c),Y||M&&9==R?setTimeout(function(){document.body.focus();f.input.focus()},20):f.input.focus())});Y&&(f.scroller.draggable=!0);a.state.draggingText=h;f.scroller.dragDrop&&
f.scroller.dragDrop();F(document,"mouseup",h);F(f.scroller,"drop",h)}function Kf(a,b,c,d,f){function g(b){if(0!=K(x,b))if(x=b,"rect"==d){for(var f=[],O=a.options.tabSize,h=va(D(q,c.line).text,c.ch,O),n=va(D(q,b.line).text,b.ch,O),na=Math.min(h,n),h=Math.max(h,n),n=Math.min(c.line,b.line),m=Math.min(a.lastLine(),Math.max(c.line,b.line));n<=m;n++){var ca=D(q,n).text,v=ye(ca,na,O);na==h?f.push(new Q(A(n,v),A(n,v))):ca.length>v&&f.push(new Q(A(n,v),A(n,ye(ca,h,O))))}f.length||f.push(new Q(c,c));ba(q,
ua(t.ranges.slice(0,r).concat(f),r),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else f=s,O=f.anchor,na=b,"single"!=d&&(b="double"==d?a.findWordAt(b):new Q(A(b.line,0),J(q,A(b.line+1,0))),0<K(b.anchor,O)?(na=b.head,O=qb(f.from(),b.anchor)):(na=b.anchor,O=pb(f.to(),b.head))),f=t.ranges.slice(0),f[r]=new Q(J(q,O),na),ba(q,ua(f,r),zd)}function h(b){var c=++z,f=xb(a,b,!0,"rect"==d);if(f)if(0!=K(f,x)){a.curOp.focus=Ba();g(f);var O=C(m,q);(f.line>=O.to||f.line<O.from)&&setTimeout(V(a,function(){z==
c&&h(b)}),150)}else{var ma=b.clientY<G.top?-20:b.clientY>G.bottom?20:0;ma&&setTimeout(V(a,function(){z==c&&(m.scroller.scrollTop+=ma,h(b))}),50)}}function n(a){z=Infinity;ha(a);m.input.focus();Ga(document,"mousemove",u);Ga(document,"mouseup",Z);q.history.lastSelOrigin=null}var m=a.display,q=a.doc;ha(b);var s,r,t=q.sel,v=t.ranges;f&&!b.shiftKey?(r=q.sel.contains(c),s=-1<r?v[r]:new Q(c,c)):(s=q.sel.primary(),r=q.sel.primIndex);if(b.altKey)d="rect",f||(s=new Q(c,c)),c=xb(a,b,!0,!0),r=-1;else if("double"==
d){var w=a.findWordAt(c);s=a.display.shift||q.extend?Yb(q,s,w.anchor,w.head):w}else"triple"==d?(w=new Q(A(c.line,0),J(q,A(c.line+1,0))),s=a.display.shift||q.extend?Yb(q,s,w.anchor,w.head):w):s=Yb(q,s,c);f?-1==r?(r=v.length,ba(q,ua(v.concat([s]),r),{scroll:!1,origin:"*mouse"})):1<v.length&&v[r].empty()&&"single"==d&&!b.shiftKey?(ba(q,ua(v.slice(0,r).concat(v.slice(r+1)),0)),t=q.sel):ld(q,r,s,zd):(r=0,ba(q,new Ja([s],0),zd),t=q.sel);var x=c,G=m.wrapper.getBoundingClientRect(),z=0,u=V(a,function(a){xe(a)?
h(a):n(a)}),Z=V(a,n);F(document,"mousemove",u);F(document,"mouseup",Z)}function wd(a,b,c,d,f){try{var g=b.clientX,h=b.clientY}catch(n){return!1}if(g>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&ha(b);d=a.display;var m=d.lineDiv.getBoundingClientRect();if(h>m.bottom||!pa(a,c))return Ad(b);h-=m.top-d.viewOffset;for(m=0;m<a.options.gutters.length;++m){var q=d.gutters.childNodes[m];if(q&&q.getBoundingClientRect().right>=g)return g=Ya(a.doc,h),f(a,c,a,g,a.options.gutters[m],
b),Ad(b)}}function Ef(a){var b=this;if(!Fa(b,a)&&!Ma(b.display,a)){ha(a);M&&(se=+new Date);var c=xb(b,a,!0),d=a.dataTransfer.files;if(c&&!Qa(b))if(d&&d.length&&window.FileReader&&window.File){var f=d.length,g=Array(f),h=0;a=function(a,p){var d=new FileReader;d.onload=V(b,function(){g[p]=d.result;if(++h==f){c=J(b.doc,c);var a={from:c,to:c,text:b.doc.splitLines(g.join(b.doc.lineSeparator())),origin:"paste"};rb(b.doc,a);be(b.doc,Ca(c,fb(a)))}});d.readAsText(a)};for(var n=0;n<f;++n)a(d[n],n)}else if(b.state.draggingText&&
-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(function(){b.display.input.focus()},20);else try{if(g=a.dataTransfer.getData("Text")){if(b.state.draggingText&&(sa?!a.altKey:!a.ctrlKey))var m=b.listSelections();zc(b.doc,Ca(c,c));if(m)for(n=0;n<m.length;++n)yb(b.doc,"",m[n].anchor,m[n].head,"drag");b.replaceSelection(g,"around","paste");b.display.input.focus()}}catch(q){}}}function Nb(a,b){2>Math.abs(a.doc.scrollTop-b)||(a.doc.scrollTop=b,Ta||Rb(a,{top:b}),a.display.scroller.scrollTop!=
b&&(a.display.scroller.scrollTop=b),a.display.scrollbars.setScrollTop(b),Ta&&Rb(a),Jb(a,100))}function mb(a,b,c){(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))||(b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth),a.doc.scrollLeft=b,H(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function re(a,b){var c=ze(b),d=c.x,c=c.y,f=a.display,g=f.scroller;if(d&&g.scrollWidth>g.clientWidth||c&&g.scrollHeight>g.clientHeight){if(c&&
sa&&Y){var h=b.target,n=f.view;a:for(;h!=g;h=h.parentNode)for(var m=0;m<n.length;m++)if(n[m].node==h){a.display.currentWheelTarget=h;break a}}!d||Ta||wa||null==la?(c&&null!=la&&(h=c*la,n=a.doc.scrollTop,m=n+f.wrapper.clientHeight,0>h?n=Math.max(0,n+h-50):m=Math.min(a.doc.height,m+h+50),Rb(a,{top:n,bottom:m})),20>Lc&&(null==f.wheelStartX?(f.wheelStartX=g.scrollLeft,f.wheelStartY=g.scrollTop,f.wheelDX=d,f.wheelDY=c,setTimeout(function(){if(null!=f.wheelStartX){var a=g.scrollLeft-f.wheelStartX,b=g.scrollTop-
f.wheelStartY,a=b&&f.wheelDY&&b/f.wheelDY||a&&f.wheelDX&&a/f.wheelDX;f.wheelStartX=f.wheelStartY=null;a&&(la=(la*Lc+a)/(Lc+1),++Lc)}},200)):(f.wheelDX+=d,f.wheelDY+=c))):(c&&Nb(a,Math.max(0,Math.min(g.scrollTop+c*la,g.scrollHeight-g.clientHeight))),mb(a,Math.max(0,Math.min(g.scrollLeft+d*la,g.scrollWidth-g.clientWidth))),ha(b),f.wheelStartX=null)}}function Mc(a,b,c){if("string"==typeof b&&(b=Nc[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,f=!1;try{Qa(a)&&(a.state.suppressEdits=
!0),c&&(a.display.shift=!1),f=b(a)!=Ae}finally{a.display.shift=d,a.state.suppressEdits=!1}return f}function Lf(a,b,c){for(var d=0;d<a.state.keyMaps.length;d++){var f=cc(b,a.state.keyMaps[d],c,a);if(f)return f}return a.options.extraKeys&&cc(b,a.options.extraKeys,c,a)||cc(b,a.options.keyMap,c,a)}function Oc(a,b,c,d){var f=a.state.keySeq;if(f){if(Mf(b))return"handled";Nf.set(50,function(){a.state.keySeq==f&&(a.state.keySeq=null,a.display.input.reset())});b=f+" "+b}d=Lf(a,b,d);"multi"==d&&(a.state.keySeq=
b);"handled"==d&&fa(a,"keyHandled",a,b,c);if("handled"==d||"multi"==d)ha(c),md(a);return f&&!d&&/\'$/.test(b)?(ha(c),!0):!!d}function Be(a,b){var c=Of(b,!0);return c?b.shiftKey&&!a.state.keySeq?Oc(a,"Shift-"+c,b,function(b){return Mc(a,b,!0)})||Oc(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return Mc(a,b)}):Oc(a,c,b,function(b){return Mc(a,b)}):!1}function Pf(a,b,c){return Oc(a,"'"+c+"'",b,function(b){return Mc(a,b,!0)})}function ve(a){this.curOp.focus=Ba();if(!Fa(this,a)){M&&
11>R&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=Be(this,a);wa&&(Bd=c?b:null,!c&&88==b&&!Ce&&(sa?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||Qf(this)}}function Qf(a){function b(a){18!=a.keyCode&&a.altKey||(Mb(c,"CodeMirror-crosshair"),Ga(document,"keyup",b),Ga(document,"mouseover",b))}var c=a.display.lineDiv;Ob(c,"CodeMirror-crosshair");F(document,"keyup",b);F(document,
"mouseover",b)}function ue(a){16==a.keyCode&&(this.doc.sel.shift=!1);Fa(this,a)}function we(a){if(!(Ma(this.display,a)||Fa(this,a)||a.ctrlKey&&!a.altKey||sa&&a.metaKey)){var b=a.keyCode,c=a.charCode;if(wa&&b==Bd)Bd=null,ha(a);else if(!wa||a.which&&!(10>a.which)||!Be(this,a))if(b=String.fromCharCode(null==c?b:c),!Pf(this,a,b))this.display.input.onKeyPress(a)}}function Hf(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,Ib(a))},100)}function ad(a){a.state.delayingBlurEvent&&
(a.state.delayingBlurEvent=!1);"nocursor"!=a.options.readOnly&&(a.state.focused||(X(a,"focus",a),a.state.focused=!0,Ob(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),Y&&setTimeout(function(){a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),md(a))}function Ib(a){a.state.delayingBlurEvent||(a.state.focused&&(X(a,"blur",a),a.state.focused=!1,Mb(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),
setTimeout(function(){a.state.focused||(a.display.shift=!1)},150))}function qe(a,b){var c;(c=Ma(a.display,b))||(c=pa(a,"gutterContextMenu")?wd(a,b,"gutterContextMenu",!1,X):!1);if(!c)a.display.input.onContextMenu(b)}function De(a,b){if(0>K(a,b.from))return a;if(0>=K(a,b.to))return fb(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=fb(b).ch-b.to.ch);return A(c,d)}function Cd(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var f=a.sel.ranges[d];c.push(new Q(De(f.anchor,
b),De(f.head,b)))}return ua(c,a.sel.primIndex)}function Ee(a,b,c){return a.line==b.line?A(c.line,a.ch-b.ch+c.ch):A(c.line+(a.line-b.line),a.ch)}function Fe(a,b,c){b={canceled:!1,from:b.from,to:b.to,text:b.text,origin:b.origin,cancel:function(){this.canceled=!0}};c&&(b.update=function(b,c,d,f){b&&(this.from=J(a,b));c&&(this.to=J(a,c));d&&(this.text=d);void 0!==f&&(this.origin=f)});X(a,"beforeChange",a,b);a.cm&&X(a.cm,"beforeChange",a.cm,b);return b.canceled?null:{from:b.from,to:b.to,text:b.text,origin:b.origin}}
function rb(a,b,c){if(a.cm){if(!a.cm.curOp)return V(a.cm,rb)(a,b,c);if(a.cm.state.suppressEdits)return}if(pa(a,"beforeChange")||a.cm&&pa(a.cm,"beforeChange"))if(b=Fe(a,b,!0),!b)return;if(c=Ge&&!c&&Rf(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)He(a,{from:c[d].from,to:c[d].to,text:d?[""]:b.text});else He(a,b)}function He(a,b){if(1!=b.text.length||""!=b.text[0]||0!=K(b.from,b.to)){var c=Cd(a,b);Ie(a,b,c,a.cm?a.cm.curOp.id:NaN);dc(a,b,c,Dd(a,b));var d=[];gb(a,function(a,c){c||-1!=ea(d,a.history)||(Je(a.history,
b),d.push(a.history));dc(a,b,null,Dd(a,b))})}}function Pc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits){for(var d=a.history,f,g=a.sel,h="undo"==b?d.done:d.undone,n="undo"==b?d.undone:d.done,m=0;m<h.length&&(f=h[m],c?!f.ranges||f.equals(a.sel):f.ranges);m++);if(m!=h.length){for(d.lastOrigin=d.lastSelOrigin=null;;)if(f=h.pop(),f.ranges){Ac(f,n);if(c&&!f.equals(a.sel)){ba(a,f,{clearRedo:!1});return}g=f}else break;c=[];Ac(g,n);n.push({changes:c,generation:d.generation});d.generation=f.generation||++d.maxGeneration;
d=pa(a,"beforeChange")||a.cm&&pa(a.cm,"beforeChange");for(m=f.changes.length-1;0<=m;--m){var q=f.changes[m];q.origin=b;if(d&&!Fe(a,q,!1)){h.length=0;break}c.push(Ed(a,q));g=m?Cd(a,q):N(h);dc(a,q,g,Ke(a,q));!m&&a.cm&&a.cm.scrollIntoView({from:q.from,to:fb(q)});var s=[];gb(a,function(a,b){b||-1!=ea(s,a.history)||(Je(a.history,q),s.push(a.history));dc(a,q,null,Ke(a,q))})}}}}function Le(a,b){if(0!=b&&(a.first+=b,a.sel=new Ja(vc(a.sel.ranges,function(a){return new Q(A(a.anchor.line+b,a.anchor.ch),A(a.head.line+
b,a.head.ch))}),a.sel.primIndex),a.cm)){ja(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<c.viewTo;d++)La(a.cm,d,"gutter")}}function dc(a,b,c,d){if(a.cm&&!a.cm.curOp)return V(a.cm,dc)(a,b,c,d);if(b.to.line<a.first)Le(a,b.text.length-1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var f=b.text.length-1-(a.first-b.from.line);Le(a,f);b={from:A(a.first,0),to:A(b.to.line+f,b.to.ch),text:[N(b.text)],origin:b.origin}}f=a.lastLine();b.to.line>f&&(b=
{from:b.from,to:A(f,D(a,f).text.length),text:[b.text[0]],origin:b.origin});b.removed=cb(a,b.from,b.to);c||(c=Cd(a,b));a.cm?Sf(a.cm,b,d):Fd(a,b,d);zc(a,c,Da)}}function Sf(a,b,c){var d=a.doc,g=a.display,h=b.from,n=b.to,m=!1,s=h.line;a.options.lineWrapping||(s=P(Ea(D(d,h.line))),d.iter(s,n.line+1,function(a){if(a==g.maxLine)return m=!0}));-1<d.sel.contains(b.from,b.to)&&fe(a);Fd(d,b,c,f(a));a.options.lineWrapping||(d.iter(s,h.line+b.text.length,function(a){var b=q(a);b>g.maxLineLength&&(g.maxLine=a,
g.maxLineLength=b,g.maxLineChanged=!0,m=!1)}),m&&(a.curOp.updateMaxLine=!0));d.frontier=Math.min(d.frontier,h.line);Jb(a,400);c=b.text.length-(n.line-h.line)-1;b.full?ja(a):h.line!=n.line||1!=b.text.length||Me(a.doc,b)?ja(a,h.line,n.line+1,c):La(a,h.line,"text");c=pa(a,"changes");if((d=pa(a,"change"))||c)b={from:h,to:n,text:b.text,removed:b.removed,origin:b.origin},d&&fa(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function yb(a,b,c,d,f){d||
(d=c);if(0>K(d,c)){var g=d;d=c;c=g}"string"==typeof b&&(b=a.splitLines(b));rb(a,{from:c,to:d,text:b,origin:f})}function Hc(a,b,c,d,f){var g=a.display,h=Ua(a.display);0>c&&(c=0);var n=a.curOp&&null!=a.curOp.scrollTop?a.curOp.scrollTop:g.scroller.scrollTop,m=fd(a),q={};f-c>m&&(f=c+m);var s=a.doc.height+cd(g),r=c<h,h=f>s-h;c<n?q.scrollTop=r?0:c:f>n+m&&(c=Math.min(c,(h?s:f)-m),c!=n&&(q.scrollTop=c));n=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:g.scroller.scrollLeft;a=Na(a)-(a.options.fixedGutter?
g.gutters.offsetWidth:0);(g=d-b>a)&&(d=b+a);10>b?q.scrollLeft=0:b<n?q.scrollLeft=Math.max(0,b-(g?0:10)):d>a+n-3&&(q.scrollLeft=d+(g?0:10)-a);return q}function Qc(a,b,c){null==b&&null==c||Rc(a);null!=b&&(a.curOp.scrollLeft=(null==a.curOp.scrollLeft?a.doc.scrollLeft:a.curOp.scrollLeft)+b);null!=c&&(a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+c)}function sb(a){Rc(a);var b=a.getCursor(),c=b,d=b;a.options.lineWrapping||(c=b.ch?A(b.line,b.ch-1):b,d=A(b.line,b.ch+1));a.curOp.scrollToPos=
{from:c,to:d,margin:a.options.cursorScrollMargin,isCursor:!0}}function Rc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=oe(a,b.from),d=oe(a,b.to),b=Hc(a,Math.min(c.left,d.left),Math.min(c.top,d.top)-b.margin,Math.max(c.right,d.right),Math.max(c.bottom,d.bottom)+b.margin);a.scrollTo(b.scrollLeft,b.scrollTop)}}function Wb(a,b,c,d){var f=a.doc,g;null==c&&(c="add");"smart"==c&&(f.mode.indent?g=Zb(a,b):c="prev");var h=a.options.tabSize,n=D(f,b),m=va(n.text,null,h);n.stateAfter&&(n.stateAfter=
null);var q=n.text.match(/^\s*/)[0],s;if(!d&&!/\S/.test(n.text))s=0,c="not";else if("smart"==c&&(s=f.mode.indent(g,n.text.slice(q.length),n.text),s==Ae||150<s)){if(!d)return;c="prev"}"prev"==c?s=b>f.first?va(D(f,b-1).text,null,h):0:"add"==c?s=m+a.options.indentUnit:"subtract"==c?s=m-a.options.indentUnit:"number"==typeof c&&(s=m+c);s=Math.max(0,s);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(s/h);a;--a)d+=h,c+="\t";d<s&&(c+=Ne(s-d));if(c!=q)return yb(f,c,A(b,0),A(b,q.length),"+input"),n.stateAfter=
null,!0;for(a=0;a<f.sel.ranges.length;a++)if(h=f.sel.ranges[a],h.head.line==b&&h.head.ch<q.length){d=A(b,q.length);ld(f,a,new Q(d,d));break}}function Sc(a,b,c,d){var f=b,g=b;"number"==typeof b?g=D(a,Math.max(a.first,Math.min(b,a.first+a.size-1))):f=P(b);if(null==f)return null;d(g,f)&&a.cm&&La(a.cm,f,c);return g}function zb(a,b){for(var c=a.doc.sel.ranges,d=[],f=0;f<c.length;f++){for(var g=b(c[f]);d.length&&0>=K(g.from,N(d).to);){var h=d.pop();if(0>K(h.from,g.from)){g.from=h.from;break}}d.push(g)}ka(a,
function(){for(var b=d.length-1;0<=b;b--)yb(a.doc,"",d[b].from,d[b].to,"+delete");sb(a)})}function Gd(a,b,c,d,f){function g(b){var d=(f?vd:Oe)(q,n,c,!0);if(null==d){if(b=!b)b=h+c,b<a.first||b>=a.first+a.size?b=s=!1:(h=b,b=q=D(a,b));if(b)n=f?(0>c?Gc:Fc)(q):0>c?q.text.length:0;else return s=!1}else n=d;return!0}var h=b.line,n=b.ch,m=c,q=D(a,h),s=!0;if("char"==d)g();else if("column"==d)g(!0);else if("word"==d||"group"==d){var r=null;d="group"==d;b=a.cm&&a.cm.getHelper(b,"wordChars");for(var t=!0;!(0>
c)||g(!t);t=!1){var v=q.text.charAt(n)||"\n",v=Tc(v,b)?"w":d&&"\n"==v?"n":!d||/\s/.test(v)?null:"p";!d||t||v||(v="s");if(r&&r!=v){0>c&&(c=1,g());break}v&&(r=v);if(0<c&&!g(!t))break}}m=Bc(a,A(h,n),m,!0);s||(m.hitSide=!0);return m}function Pe(a,b,c,d){var f=a.doc,g=b.left,h;"page"==d?(d=Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),h=b.top+c*(d-(0>c?1.5:.5)*Ua(a.display))):"line"==d&&(h=0<c?b.bottom+3:b.top-3);for(;;){var n=ud(a,g,h);if(!n.outside)break;
if(0>c?0>=h:h>=f.height){n.hitSide=!0;break}h+=5*c}return n}function I(a,b,c,f){d.defaults[a]=b;c&&(kb[a]=f?function(a,b,p){p!=Rd&&c(a,b,p)}:c)}function Tf(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,d,f,g,h=0;h<b.length-1;h++){var n=b[h];if(/^(cmd|meta|m)$/i.test(n))g=!0;else if(/^a(lt)?$/i.test(n))c=!0;else if(/^(c|ctrl|control)$/i.test(n))d=!0;else if(/^s(hift)$/i.test(n))f=!0;else throw Error("Unrecognized modifier name: "+n);}c&&(a="Alt-"+a);d&&(a="Ctrl-"+a);g&&(a="Cmd-"+a);f&&(a="Shift-"+
a);return a}function Uc(a){return"string"==typeof a?Ra[a]:a}function Ab(a,b,c,d,f){if(d&&d.shared)return Uf(a,b,c,d,f);if(a.cm&&!a.cm.curOp)return V(a.cm,Ab)(a,b,c,d,f);var g=new hb(a,f);f=K(b,c);d&&ra(d,g,!1);if(0<f||0==f&&!1!==g.clearWhenEmpty)return g;g.replacedWith&&(g.collapsed=!0,g.widgetNode=B("span",[g.replacedWith],"CodeMirror-widget"),d.handleMouseEvents||g.widgetNode.setAttribute("cm-ignore-events","true"),d.insertLeft&&(g.widgetNode.insertLeft=!0));if(g.collapsed){if(Qe(a,b.line,b,c,g)||
b.line!=c.line&&Qe(a,c.line,b,c,g))throw Error("Inserting collapsed marker partially overlapping an existing one");Pa=!0}g.addToHistory&&Ie(a,{from:b,to:c,origin:"markText"},a.sel,NaN);var h=b.line,n=a.cm,m;a.iter(h,c.line+1,function(a){n&&g.collapsed&&!n.options.lineWrapping&&Ea(a)==n.display.maxLine&&(m=!0);g.collapsed&&h!=b.line&&ya(a,0);var p=new Vc(g,h==b.line?b.ch:null,h==c.line?c.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([p]):[p];p.marker.attachLine(a);++h});g.collapsed&&a.iter(b.line,
c.line+1,function(b){Va(a,b)&&ya(b,0)});g.clearOnEnter&&F(g,"beforeCursorEnter",function(){g.clear()});g.readOnly&&(Ge=!0,(a.history.done.length||a.history.undone.length)&&a.clearHistory());g.collapsed&&(g.id=++Hd,g.atomic=!0);if(n){m&&(n.curOp.updateMaxLine=!0);if(g.collapsed)ja(n,b.line,c.line+1);else if(g.className||g.title||g.startStyle||g.endStyle||g.css)for(d=b.line;d<=c.line;d++)La(n,d,"text");g.atomic&&ge(n.doc);fa(n,"markerAdded",n,g)}return g}function Uf(a,b,c,d,f){d=ra(d);d.shared=!1;var g=
[Ab(a,b,c,d,f)],h=g[0],n=d.widgetNode;gb(a,function(a){n&&(d.widgetNode=n.cloneNode(!0));g.push(Ab(a,J(a,b),J(a,c),d,f));for(var p=0;p<a.linked.length;++p)if(a.linked[p].isParent)return;h=N(g)});return new Wc(g,h)}function Re(a){return a.findMarks(A(a.first,0),a.clipPos(A(a.lastLine())),function(a){return a.parent})}function Vf(a){for(var b=0;b<a.length;b++){var c=a[b],d=[c.primary.doc];gb(c.primary.doc,function(a){d.push(a)});for(var f=0;f<c.markers.length;f++){var g=c.markers[f];-1==ea(d,g.doc)&&
(g.parent=null,c.markers.splice(f--,1))}}}function Vc(a,b,c){this.marker=a;this.from=b;this.to=c}function ec(a,b){if(a)for(var c=0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function Dd(a,b){if(b.full)return null;var c=Xb(a,b.from.line)&&D(a,b.from.line).markedSpans,d=Xb(a,b.to.line)&&D(a,b.to.line).markedSpans;if(!c&&!d)return null;var f=b.from.ch,g=b.to.ch,h=0==K(b.from,b.to);if(c)for(var n=0,m;n<c.length;++n){var q=c[n],s=q.marker;if(null==q.from||(s.inclusiveLeft?q.from<=f:q.from<f)||
!(q.from!=f||"bookmark"!=s.type||h&&q.marker.insertLeft)){var r=null==q.to||(s.inclusiveRight?q.to>=f:q.to>f);(m||(m=[])).push(new Vc(s,q.from,r?null:q.to))}}c=m;if(d)for(var n=0,t;n<d.length;++n)if(m=d[n],q=m.marker,null==m.to||(q.inclusiveRight?m.to>=g:m.to>g)||m.from==g&&"bookmark"==q.type&&(!h||m.marker.insertLeft))s=null==m.from||(q.inclusiveLeft?m.from<=g:m.from<g),(t||(t=[])).push(new Vc(q,s?null:m.from-g,null==m.to?null:m.to-g));d=t;h=1==b.text.length;t=N(b.text).length+(h?f:0);if(c)for(g=
0;g<c.length;++g)if(n=c[g],null==n.to)(m=ec(d,n.marker),m)?h&&(n.to=null==m.to?null:m.to+t):n.to=f;if(d)for(g=0;g<d.length;++g)n=d[g],null!=n.to&&(n.to+=t),null==n.from?(m=ec(c,n.marker),m||(n.from=t,h&&(c||(c=[])).push(n))):(n.from+=t,h&&(c||(c=[])).push(n));c&&(c=Se(c));d&&d!=c&&(d=Se(d));f=[c];if(!h){var h=b.text.length-2,v;if(0<h&&c)for(g=0;g<c.length;++g)null==c[g].to&&(v||(v=[])).push(new Vc(c[g].marker,null,null));for(g=0;g<h;++g)f.push(v);f.push(d)}return f}function Se(a){for(var b=0;b<a.length;++b){var c=
a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function Ke(a,b){var c;if(c=b["spans_"+a.id]){for(var d=0,f=[];d<b.text.length;++d)f.push(Wf(c[d]));c=f}else c=null;d=Dd(a,b);if(!c)return d;if(!d)return c;for(f=0;f<c.length;++f){var g=c[f],h=d[f];if(g&&h){var n=0;a:for(;n<h.length;++n){for(var m=h[n],q=0;q<g.length;++q)if(g[q].marker==m.marker)continue a;g.push(m)}}else h&&(c[f]=h)}return c}function Rf(a,b,c){var d=null;a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=
0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||d&&-1!=ea(d,c)||(d||(d=[])).push(c)}});if(!d)return null;a=[{from:b,to:c}];for(b=0;b<d.length;++b){c=d[b];for(var f=c.find(0),g=0;g<a.length;++g){var h=a[g];if(!(0>K(h.to,f.from)||0<K(h.from,f.to))){var n=[g,1],m=K(h.from,f.from),q=K(h.to,f.to);(0>m||!c.inclusiveLeft&&!m)&&n.push({from:h.from,to:f.from});(0<q||!c.inclusiveRight&&!q)&&n.push({from:f.to,to:h.to});a.splice.apply(a,n);g+=n.length-1}}}return a}function Te(a){var b=
a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Ue(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Ve(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;var c=a.find(),d=b.find(),f=K(c.from,d.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return f?-f:(c=K(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function Xa(a,b){var c=Pa&&a.markedSpans,d;if(c)for(var f,g=0;g<c.length;++g)f=
c[g],f.marker.collapsed&&null==(b?f.from:f.to)&&(!d||0>Ve(d,f.marker))&&(d=f.marker);return d}function Qe(a,b,c,d,f){a=D(a,b);if(a=Pa&&a.markedSpans)for(b=0;b<a.length;++b){var g=a[b];if(g.marker.collapsed){var h=g.marker.find(0),n=K(h.from,c)||(g.marker.inclusiveLeft?-1:0)-(f.inclusiveLeft?-1:0),m=K(h.to,d)||(g.marker.inclusiveRight?1:0)-(f.inclusiveRight?1:0);if(!(0<=n&&0>=m||0>=n&&0<=m)&&(0>=n&&(0<K(h.to,c)||g.marker.inclusiveRight&&f.inclusiveLeft)||0<=n&&(0>K(h.from,d)||g.marker.inclusiveLeft&&
f.inclusiveRight)))return!0}}}function Ea(a){for(var b;b=Xa(a,!0);)a=b.find(-1,!0).line;return a}function dd(a,b){var c=D(a,b),d=Ea(c);return c==d?b:P(d)}function Ud(a,b){if(b>a.lastLine())return b;var c=D(a,b),d;if(!Va(a,c))return b;for(;d=Xa(c,!1);)c=d.find(1,!0).line;return P(c)+1}function Va(a,b){var c=Pa&&b.markedSpans;if(c)for(var d,f=0;f<c.length;++f)if(d=c[f],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&0==d.from&&d.marker.inclusiveLeft&&Id(a,b,d)))return!0}function Id(a,b,c){if(null==
c.to)return b=c.marker.find(1,!0),Id(a,b.line,ec(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,f=0;f<b.markedSpans.length;++f)if(d=b.markedSpans[f],d.marker.collapsed&&!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||c.marker.inclusiveRight)&&Id(a,b,d))return!0}function ac(a){if(null!=a.height)return a.height;var b=a.doc.cm;if(!b)return 0;if(!kd(document.body,a.node)){var c="position: relative;";a.coverGutter&&
(c+="margin-left: -"+b.display.gutters.offsetWidth+"px;");a.noHScroll&&(c+="width: "+b.display.wrapper.clientWidth+"px;");qa(b.display.measure,B("div",[a.node],null,c))}return a.height=a.node.offsetHeight}function Xf(a,b,c,d){var f=new Xc(a,c,d),g=a.cm;g&&f.noHScroll&&(g.display.alignWidgets=!0);Sc(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==f.insertAt?c.push(f):c.splice(Math.min(c.length-1,Math.max(0,f.insertAt)),0,f);f.line=b;g&&!Va(a,b)&&(c=Aa(b)<a.scrollTop,ya(b,b.height+ac(f)),
c&&Qc(g,null,f.height),g.curOp.forceUpdate=!0);return!0});return f}function We(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||(b[d]+=" "+c[2])}return a}function Xe(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode){var c=d.innerMode(a,b);if(c.mode.blankLine)return c.mode.blankLine(c.state)}}function Jd(a,
b,c,f){for(var g=0;10>g;g++){f&&(f[0]=d.innerMode(a,c).mode);var h=a.token(b,c);if(b.pos>b.start)return h}throw Error("Mode "+a.name+" failed to advance stream.");}function Ye(a,b,c,d){function f(a){return{start:s.start,end:s.pos,string:s.current(),type:n||null,state:a?vb(g.mode,q):q}}var g=a.doc,h=g.mode,n;b=J(g,b);var m=D(g,b.line),q=Zb(a,b.line,c),s=new Yc(m.text,a.options.tabSize),r;for(d&&(r=[]);(d||s.pos<b.ch)&&!s.eol();)s.start=s.pos,n=Jd(h,s,q),d&&r.push(f(!0));return d?r:f()}function Ze(a,
b,c,d,f,g,h){var n=c.flattenSpans;null==n&&(n=a.options.flattenSpans);var m=0,q=null,s=new Yc(b,a.options.tabSize),r,t=a.options.addModeClass&&[null];for(""==b&&We(Xe(c,d),g);!s.eol();){s.pos>a.options.maxHighlightLength?(n=!1,h&&nd(a,b,d,s.pos),s.pos=b.length,r=null):r=We(Jd(c,s,d,t),g);if(t){var v=t[0].name;v&&(r="m-"+(r?v+" "+r:v))}if(!n||q!=r){for(;m<s.start;)m=Math.min(s.start,m+5E4),f(m,q);q=r}s.start=s.pos}for(;m<s.pos;)a=Math.min(s.pos,m+5E4),f(a,q),m=a}function je(a,b,c,d){var f=[a.state.modeGen],
g={};Ze(a,b.text,a.doc.mode,c,function(a,b){f.push(a,b)},g,d);for(c=0;c<a.state.overlays.length;++c){var h=a.state.overlays[c],n=1,m=0;Ze(a,b.text,h.mode,!0,function(a,b){for(var c=n;m<a;){var d=f[n];d>a&&f.splice(n,1,a,f[n+1],d);n+=2;m=Math.min(a,d)}if(b)if(h.opaque)f.splice(c,n-c,a,"cm-overlay "+b),n=c+2;else for(;c<n;c+=2)d=f[c+1],f[c+1]=(d?d+" ":"")+"cm-overlay "+b},g)}return{styles:f,classes:g.bgClass||g.textClass?g:null}}function $e(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=je(a,
b,b.stateAfter=Zb(a,P(b)));b.styles=d.styles;d.classes?b.styleClasses=d.classes:b.styleClasses&&(b.styleClasses=null);c===a.doc.frontier&&a.doc.frontier++}return b.styles}function nd(a,b,c,d){var f=a.doc.mode,g=new Yc(b,a.options.tabSize);g.start=g.pos=d||0;for(""==b&&Xe(f,c);!g.eol()&&g.pos<=a.options.maxHighlightLength;)Jd(f,g,c),g.start=g.pos}function af(a,b){if(!a||/^\s*$/.test(a))return null;var c=b.addModeClass?Yf:Zf;return c[a]||(c[a]=a.replace(/\S+/g,"cm-$&"))}function Vd(a,b){var c=B("span",
null,null,Y?"padding-right: .1px":null),c={pre:B("pre",[c],"CodeMirror-line"),content:c,col:0,pos:0,cm:a,splitSpaces:(M||Y)&&a.getOption("lineWrapping")};b.measure={};for(var d=0;d<=(b.rest?b.rest.length:0);d++){var f=d?b.rest[d-1]:b.line,g;c.pos=0;c.addToken=$f;var h;if(null!=Kd)h=Kd;else{h=qa(a.display.measure,document.createTextNode("A\u062eA"));var n=db(h,0,1).getBoundingClientRect();h=n&&n.left!=n.right?Kd=3>db(h,1,2).getBoundingClientRect().right-n.right:!1}h&&(g=ta(f))&&(c.addToken=ag(c.addToken,
g));c.map=[];n=b!=a.display.externalMeasured&&P(f);a:{h=c;var n=$e(a,f,n),m=f.markedSpans,q=f.text,s=0;if(m)for(var r=q.length,t=0,v=1,w="",x=void 0,G=void 0,z=0,u=void 0,Z=void 0,C=void 0,L=void 0,aa=void 0;;){if(z==t){for(var u=Z=C=L=G="",aa=null,z=Infinity,H=[],E=0;E<m.length;++E){var A=m[E],W=A.marker;"bookmark"==W.type&&A.from==t&&W.widgetNode?H.push(W):A.from<=t&&(null==A.to||A.to>t||W.collapsed&&A.to==t&&A.from==t)?(null!=A.to&&A.to!=t&&z>A.to&&(z=A.to,Z=""),W.className&&(u+=" "+W.className),
W.css&&(G=W.css),W.startStyle&&A.from==t&&(C+=" "+W.startStyle),W.endStyle&&A.to==z&&(Z+=" "+W.endStyle),W.title&&!L&&(L=W.title),W.collapsed&&(!aa||0>Ve(aa.marker,W))&&(aa=A)):A.from>t&&z>A.from&&(z=A.from)}if(aa&&(aa.from||0)==t){bf(h,(null==aa.to?r+1:aa.to)-t,aa.marker,null==aa.from);if(null==aa.to)break a;aa.to==t&&(aa=!1)}if(!aa&&H.length)for(E=0;E<H.length;++E)bf(h,0,H[E])}if(t>=r)break;for(H=Math.min(r,z);;){if(w){E=t+w.length;aa||(A=E>H?w.slice(0,H-t):w,h.addToken(h,A,x?x+u:u,C,t+A.length==
z?Z:"",L,G));if(E>=H){w=w.slice(H-t);t=H;break}t=E;C=""}w=q.slice(s,s=n[v++]);x=af(n[v++],h.cm.options)}}else for(var v=1;v<n.length;v+=2)h.addToken(h,q.slice(s,s=n[v]),af(n[v+1],h.cm.options))}f.styleClasses&&(f.styleClasses.bgClass&&(c.bgClass=Ld(f.styleClasses.bgClass,c.bgClass||"")),f.styleClasses.textClass&&(c.textClass=Ld(f.styleClasses.textClass,c.textClass||"")));0==c.map.length&&c.map.push(0,0,c.content.appendChild(bg(a.display.measure)));0==d?(b.measure.map=c.map,b.measure.cache={}):((b.measure.maps||
(b.measure.maps=[])).push(c.map),(b.measure.caches||(b.measure.caches=[])).push({}))}Y&&/\bcm-tab\b/.test(c.content.lastChild.className)&&(c.content.className="cm-tab-wrap-hack");X(a,"renderLine",a,b.line,c.pre);c.pre.className&&(c.textClass=Ld(c.pre.className,c.textClass||""));return c}function $f(a,b,c,d,f,g,h){if(b){var n=a.splitSpaces?b.replace(/ {3,}/g,cg):b,m=a.cm.state.specialChars,q=!1;if(m.test(b))for(var s=document.createDocumentFragment(),r=0;;){m.lastIndex=r;var t=m.exec(b),v=t?t.index-
r:b.length-r;if(v){var w=document.createTextNode(n.slice(r,r+v));M&&9>R?s.appendChild(B("span",[w])):s.appendChild(w);a.map.push(a.pos,a.pos+v,w);a.col+=v;a.pos+=v}if(!t)break;r+=v+1;"\t"==t[0]?(w=a.cm.options.tabSize,t=w-a.col%w,w=s.appendChild(B("span",Ne(t),"cm-tab")),w.setAttribute("role","presentation"),w.setAttribute("cm-text","\t"),a.col+=t):("\r"==t[0]||"\n"==t[0]?(w=s.appendChild(B("span","\r"==t[0]?"\u240d":"\u2424","cm-invalidchar")),w.setAttribute("cm-text",t[0])):(w=a.cm.options.specialCharPlaceholder(t[0]),
w.setAttribute("cm-text",t[0]),M&&9>R?s.appendChild(B("span",[w])):s.appendChild(w)),a.col+=1);a.map.push(a.pos,a.pos+1,w);a.pos++}else{a.col+=b.length;var s=document.createTextNode(n);a.map.push(a.pos,a.pos+b.length,s);M&&9>R&&(q=!0);a.pos+=b.length}if(c||d||f||q||h)return b=c||"",d&&(b+=d),f&&(b+=f),d=B("span",[s],b,h),g&&(d.title=g),a.content.appendChild(d);a.content.appendChild(s)}}function cg(a){for(var b=" ",c=0;c<a.length-2;++c)b+=c%2?" ":"\u00a0";return b+" "}function ag(a,b){return function(c,
d,f,g,h,n,m){f=f?f+" cm-force-border":"cm-force-border";for(var q=c.pos,s=q+d.length;;){for(var r=0;r<b.length;r++){var t=b[r];if(t.to>q&&t.from<=q)break}if(t.to>=s)return a(c,d,f,g,h,n,m);a(c,d.slice(0,t.to-q),f,g,null,n,m);g=null;d=d.slice(t.to-q);q=t.to}}}function bf(a,b,c,d){var f=!d&&c.widgetNode;f&&a.map.push(a.pos,a.pos+b,f);!d&&a.cm.display.input.needsContentAttribute&&(f||(f=a.content.appendChild(document.createElement("span"))),f.setAttribute("cm-marker",c.id));f&&(a.cm.display.input.setUneditable(f),
a.content.appendChild(f));a.pos+=b}function Me(a,b){return 0==b.from.ch&&0==b.to.ch&&""==N(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}function Fd(a,b,c,d){function f(a,c,p){a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);Te(a);Ue(a,p);c=d?d(a):1;c!=a.height&&ya(a,c);fa(a,"change",a,b)}function g(a,b){for(var p=a,f=[];p<b;++p)f.push(new fc(m[p],c?c[p]:null,d));return f}var h=b.from,n=b.to,m=b.text,q=D(a,h.line),s=D(a,n.line),r=N(m),t=c?c[m.length-
1]:null,v=n.line-h.line;if(b.full)a.insert(0,g(0,m.length)),a.remove(m.length,a.size-m.length);else if(Me(a,b)){var w=g(0,m.length-1);f(s,s.text,t);v&&a.remove(h.line,v);w.length&&a.insert(h.line,w)}else q==s?1==m.length?f(q,q.text.slice(0,h.ch)+r+q.text.slice(n.ch),t):(w=g(1,m.length-1),w.push(new fc(r+q.text.slice(n.ch),t,d)),f(q,q.text.slice(0,h.ch)+m[0],c?c[0]:null),a.insert(h.line+1,w)):1==m.length?(f(q,q.text.slice(0,h.ch)+m[0]+s.text.slice(n.ch),c?c[0]:null),a.remove(h.line+1,v)):(f(q,q.text.slice(0,
h.ch)+m[0],c?c[0]:null),f(s,r+s.text.slice(n.ch),t),w=g(1,m.length-1),1<v&&a.remove(h.line+1,v-1),a.insert(h.line+1,w));fa(a,"change",a,b)}function gc(a){this.lines=a;this.parent=null;for(var b=0,c=0;b<a.length;++b)a[b].parent=this,c+=a[b].height;this.height=c}function hc(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var f=a[d],b=b+f.chunkSize(),c=c+f.height;f.parent=this}this.size=b;this.height=c;this.parent=null}function gb(a,b,c){function d(a,p,f){if(a.linked)for(var g=0;g<a.linked.length;++g){var h=
a.linked[g];if(h.doc!=p){var n=f&&h.sharedHist;if(!c||n)b(h.doc,n),d(h.doc,a,n)}}}d(a,null,!0)}function Qd(a,b){if(b.cm)throw Error("This document is already in use.");a.doc=b;b.cm=a;g(a);c(a);a.options.lineWrapping||t(a);a.options.mode=b.modeOption;ja(a)}function D(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(var c=a;!c.lines;)for(var d=0;;++d){var f=c.children[d],g=f.chunkSize();if(b<g){c=f;break}b-=g}return c.lines[b]}function cb(a,b,c){var d=
[],f=b.line;a.iter(b.line,c.line+1,function(a){a=a.text;f==c.line&&(a=a.slice(0,c.ch));f==b.line&&(a=a.slice(b.ch));d.push(a);++f});return d}function Md(a,b,c){var d=[];a.iter(b,c,function(a){d.push(a.text)});return d}function ya(a,b){var c=b-a.height;if(c)for(var d=a;d;d=d.parent)d.height+=c}function P(a){if(null==a.parent)return null;var b=a.parent;a=ea(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var d=0;c.children[d]!=b;++d)a+=c.children[d].chunkSize();return a+b.first}function Ya(a,b){var c=
a.first;a:do{for(var d=0;d<a.children.length;++d){var f=a.children[d],g=f.height;if(b<g){a=f;continue a}b-=g;c+=f.chunkSize()}return c}while(!a.lines);for(d=0;d<a.lines.length;++d){f=a.lines[d].height;if(b<f)break;b-=f}return c+d}function Aa(a){a=Ea(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var f=c.lines[d];if(f==a)break;else b+=f.height}for(a=c.parent;a;c=a,a=c.parent)for(d=0;d<a.children.length&&(f=a.children[d],f!=c);++d)b+=f.height;return b}function ta(a){var b=a.order;null==b&&(b=a.order=
dg(a.text));return b}function Zc(a){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function Ed(a,b){var c={from:ob(b.from),to:fb(b),text:cb(a,b.from,b.to)};cf(a,c,b.from.line,b.to.line+1);gb(a,function(a){cf(a,c,b.from.line,b.to.line+1)},!0);return c}function ce(a){for(;a.length;)if(N(a).ranges)a.pop();else break}function Ie(a,b,c,d){var f=a.history;f.undone.length=
0;var g=+new Date,h,n;if(n=f.lastOp==d||f.lastOrigin==b.origin&&b.origin&&("+"==b.origin.charAt(0)&&a.cm&&f.lastModTime>g-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0)))f.lastOp==d?(ce(f.done),h=N(f.done)):f.done.length&&!N(f.done).ranges?h=N(f.done):1<f.done.length&&!f.done[f.done.length-2].ranges?(f.done.pop(),h=N(f.done)):h=void 0,n=h;if(n){var m=N(h.changes);0==K(b.from,b.to)&&0==K(b.from,m.to)?m.to=fb(b):h.changes.push(Ed(a,b))}else for((h=N(f.done))&&h.ranges||Ac(a.sel,f.done),h={changes:[Ed(a,
b)],generation:f.generation},f.done.push(h);f.done.length>f.undoDepth;)f.done.shift(),f.done[0].ranges||f.done.shift();f.done.push(c);f.generation=++f.maxGeneration;f.lastModTime=f.lastSelTime=g;f.lastOp=f.lastSelOp=d;f.lastOrigin=f.lastSelOrigin=b.origin;m||X(a,"historyAdded")}function Ac(a,b){var c=N(b);c&&c.ranges&&c.equals(a)||b.push(a)}function cf(a,b,c,d){var f=b["spans_"+a.id],g=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((f||(f=b["spans_"+a.id]={}))[g]=
c.markedSpans);++g})}function Wf(a){if(!a)return null;for(var b=0,c;b<a.length;++b)a[b].marker.explicitlyCleared?c||(c=a.slice(0,b)):c&&c.push(a[b]);return c?c.length?c:null:a}function Bb(a,b,c){for(var d=0,f=[];d<a.length;++d){var g=a[d];if(g.ranges)f.push(c?Ja.prototype.deepCopy.call(g):g);else{var g=g.changes,h=[];f.push({changes:h});for(var n=0;n<g.length;++n){var m=g[n],q;h.push({from:m.from,to:m.to,text:m.text});if(b)for(var s in m)(q=s.match(/^spans_(\d+)$/))&&-1<ea(b,Number(q[1]))&&(N(h)[s]=
m[s],delete m[s])}}}return f}function df(a,b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function ef(a,b,c,d){for(var f=0;f<a.length;++f){var g=a[f],h=!0;if(g.ranges){g.copied||(g=a[f]=g.deepCopy(),g.copied=!0);for(var n=0;n<g.ranges.length;n++)df(g.ranges[n].anchor,b,c,d),df(g.ranges[n].head,b,c,d)}else{for(n=0;n<g.changes.length;++n){var m=g.changes[n];if(c<m.from.line)m.from=A(m.from.line+d,m.from.ch),m.to=A(m.to.line+d,m.to.ch);else if(b<=m.to.line){h=!1;break}}h||(a.splice(0,f+1),f=0)}}}
function Je(a,b){var c=b.from.line,d=b.to.line,f=b.text.length-(d-c)-1;ef(a.done,c,d,f);ef(a.undone,c,d,f)}function Ad(a){return null!=a.defaultPrevented?a.defaultPrevented:!1==a.returnValue}function xe(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));sa&&a.ctrlKey&&1==b&&(b=3);return b}function fa(a,b){function c(a){return function(){a.apply(null,f)}}var d=a._handlers&&a._handlers[b];if(d){var f=Array.prototype.slice.call(arguments,2),g;wb?g=wb.delayedCallbacks:ic?g=ic:
(g=ic=[],setTimeout(eg,0));for(var h=0;h<d.length;++h)g.push(c(d[h]))}}function eg(){var a=ic;ic=null;for(var b=0;b<a.length;++b)a[b]()}function Fa(a,b,c){"string"==typeof b&&(b={type:b,preventDefault:function(){this.defaultPrevented=!0}});X(a,c||b.type,a,b);return Ad(b)||b.codemirrorIgnore}function fe(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==ea(a,b[c])&&a.push(b[c])}}function pa(a,b){var c=
a._handlers&&a._handlers[b];return c&&0<c.length}function Cb(a){a.prototype.on=function(a,b){F(this,a,b)};a.prototype.off=function(a,b){Ga(this,a,b)}}function Gb(){this.id=null}function ye(a,b,c){for(var d=0,f=0;;){var g=a.indexOf("\t",d);-1==g&&(g=a.length);var h=g-d;if(g==a.length||f+h>=b)return d+Math.min(h,b-f);f+=g-d;f+=c-f%c;d=g+1;if(f>=b)return d}}function Ne(a){for(;$c.length<=a;)$c.push(N($c)+" ");return $c[a]}function N(a){return a[a.length-1]}function ea(a,b){for(var c=0;c<a.length;++c)if(a[c]==
b)return c;return-1}function vc(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function jc(){}function ff(a,b){var c;Object.create?c=Object.create(a):(jc.prototype=a,c=new jc);b&&ra(b,c);return c}function ra(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}function Hb(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function Tc(a,b){return b?-1<b.source.indexOf("\\w")&&gf(a)?!0:b.test(a):
gf(a)}function hf(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}function $b(a){return 768<=a.charCodeAt(0)&&fg.test(a)}function B(a,b,c,d){a=document.createElement(a);c&&(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function Wa(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function qa(a,b){return Wa(a).appendChild(b)}function Ba(){for(var a=
document.activeElement;a&&a.root&&a.root.activeElement;)a=a.root.activeElement;return a}function kc(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function Ld(a,b){for(var c=a.split(" "),d=0;d<c.length;d++)c[d]&&!kc(c[d]).test(b)&&(b+=" "+c[d]);return b}function jf(a){if(document.body.getElementsByClassName)for(var b=document.body.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function sf(){var a;F(window,"resize",function(){null==a&&(a=setTimeout(function(){a=
null;jf(Ff)},100))});F(window,"blur",function(){jf(Ib)})}function bg(a){if(null==Nd){var b=B("span","\u200b");qa(a,B("span",[b,document.createTextNode("x")]));0!=a.firstChild.offsetHeight&&(Nd=1>=b.offsetWidth&&2<b.offsetHeight&&!(M&&8>R))}a=Nd?B("span","\u200b"):B("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");a.setAttribute("cm-text","");return a}function xf(a,b,c,d){if(!a)return d(b,c,"ltr");for(var f=!1,g=0;g<a.length;++g){var h=a[g];if(h.from<c&&h.to>b||b==c&&h.to==
b)d(Math.max(h.from,b),Math.min(h.to,c),1==h.level?"rtl":"ltr"),f=!0}f||d(b,c,"ltr")}function sd(a){return a.level%2?a.to:a.from}function td(a){return a.level%2?a.from:a.to}function Fc(a){return(a=ta(a))?sd(a[0]):0}function Gc(a){var b=ta(a);return b?td(N(b)):a.text.length}function kf(a,b){var c=D(a.doc,b),d=Ea(c);d!=c&&(b=P(d));d=(c=ta(d))?c[0].level%2?Gc(d):Fc(d):0;return A(b,d)}function lf(a,b){var c=kf(a,b.line),d=D(a.doc,c.line),f=ta(d);return f&&0!=f[0].level?c:(d=Math.max(0,d.text.search(/\S/)),
A(c.line,b.line==c.line&&b.ch<=d&&b.ch?0:d))}function wc(a,b){bc=null;for(var c=0,d;c<a.length;++c){var f=a[c];if(f.from<b&&f.to>b)return c;if(f.from==b||f.to==b)if(null==d)d=c;else{var g;g=f.level;var h=a[d].level,n=a[0].level;g=g==n?!0:h==n?!1:g<h;if(g)return f.from!=f.to&&(bc=d),c;f.from!=f.to&&(bc=c);break}}return d}function Od(a,b,c,d){if(!d)return b+c;do b+=c;while(0<b&&$b(a.text.charAt(b)));return b}function vd(a,b,c,d){var f=ta(a);if(!f)return Oe(a,b,c,d);var g=wc(f,b),h=f[g];for(b=Od(a,b,
h.level%2?-c:c,d);;){if(b>h.from&&b<h.to)return b;if(b==h.from||b==h.to){if(wc(f,b)==g)return b;h=f[g+c];return 0<c==h.level%2?h.to:h.from}h=f[g+=c];if(!h)return null;b=0<c==h.level%2?Od(a,h.to,-1,d):Od(a,h.from,1,d)}}function Oe(a,b,c,d){b+=c;if(d)for(;0<b&&$b(a.text.charAt(b));)b+=c;return 0>b||b>a.text.length?null:b}var Ta=/gecko\/\d/i.test(navigator.userAgent),mf=/MSIE \d/.test(navigator.userAgent),nf=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),M=mf||nf,R=M&&(mf?document.documentMode||
6:nf[1]),Y=/WebKit\//.test(navigator.userAgent),gg=Y&&/Qt\/\d+\.\d+/.test(navigator.userAgent),hg=/Chrome\//.test(navigator.userAgent),wa=/Opera\//.test(navigator.userAgent),te=/Apple Computer/.test(navigator.vendor),ig=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Df=/PhantomJS/.test(navigator.userAgent),tb=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Fb=tb||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),sa=tb||
/Mac/.test(navigator.platform),jg=/win/i.test(navigator.platform),ib=wa&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);ib&&(ib=Number(ib[1]));ib&&15<=ib&&(wa=!1,Y=!0);var of=sa&&(gg||wa&&(null==ib||12.11>ib)),xd=Ta||M&&9<=R,Ge=!1,Pa=!1;v.prototype=ra({update:function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+
(a.viewHeight-(b?d:0)))+"px"):(this.vert.style.display="",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=a.barLeft+"px",this.horiz.firstChild.style.width=a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?d:0))+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0");!this.checkedOverlay&&0<a.clientHeight&&(0==d&&this.overlayHack(),this.checkedOverlay=!0);return{right:c?d:0,bottom:b?d:0}},setScrollLeft:function(a){this.horiz.scrollLeft!=
a&&(this.horiz.scrollLeft=a)},setScrollTop:function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a)},overlayHack:function(){this.horiz.style.minHeight=this.vert.style.minWidth=sa&&!ig?"12px":"18px";var a=this,b=function(b){(b.target||b.srcElement)!=a.vert&&(b.target||b.srcElement)!=a.horiz&&V(a.cm,pe)(b)};F(this.vert,"mousedown",b);F(this.horiz,"mousedown",b)},clear:function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)}},v.prototype);u.prototype=ra({update:function(){return{bottom:0,
right:0}},setScrollLeft:function(){},setScrollTop:function(){},clear:function(){}},u.prototype);d.scrollbarModel={"native":v,"null":u};T.prototype.signal=function(a,b){pa(a,b)&&this.events.push(arguments)};T.prototype.finish=function(){for(var a=0;a<this.events.length;a++)X.apply(null,this.events[a])};var A=d.Pos=function(a,b){if(!(this instanceof A))return new A(a,b);this.line=a;this.ch=b},K=d.cmpPos=function(a,b){return a.line-b.line||a.ch-b.ch},oa=null;hd.prototype=ra({init:function(a){function b(a){if(d.somethingSelected())oa=
d.getSelections(),c.inaccurateSelection&&(c.prevInput="",c.inaccurateSelection=!1,g.value=oa.join("\n"),Db(g));else if(d.options.lineWiseCopyCut){var f=W(d);oa=f.text;"cut"==a.type?d.setSelections(f.ranges,null,Da):(c.prevInput="",g.value=f.text.join("\n"),Db(g))}else return;"cut"==a.type&&(d.state.cutIncoming=!0)}var c=this,d=this.cm,f=this.wrapper=Xd(),g=this.textarea=f.firstChild;a.wrapper.insertBefore(f,a.wrapper.firstChild);tb&&(g.style.width="0px");F(g,"input",function(){M&&9<=R&&c.hasSelection&&
(c.hasSelection=null);c.poll()});F(g,"paste",function(a){if(aa(a,d))return!0;d.state.pasteIncoming=!0;c.fastPoll()});F(g,"cut",b);F(g,"copy",b);F(a.scroller,"paste",function(b){Ma(a,b)||(d.state.pasteIncoming=!0,c.focus())});F(a.lineSpace,"selectstart",function(b){Ma(a,b)||ha(b)});F(g,"compositionstart",function(){var a=d.getCursor("from");c.composing={start:a,range:d.markText(a,d.getCursor("to"),{className:"CodeMirror-composing"})}});F(g,"compositionend",function(){c.composing&&(c.poll(),c.composing.range.clear(),
c.composing=null)})},prepareSelection:function(){var a=this.cm,b=a.display,c=a.doc,d=he(a);if(a.options.moveInputWithCursor){var a=Ka(a,c.sel.primary().head,"div"),c=b.wrapper.getBoundingClientRect(),f=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+f.top-c.top));d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+f.left-c.left))}return d},showSelection:function(a){var b=this.cm.display;qa(b.cursorDiv,a.cursors);qa(b.selectionDiv,a.selection);
null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")},reset:function(a){if(!this.contextMenuPending){var b,c,d=this.cm,f=d.doc;d.somethingSelected()?(this.prevInput="",b=f.sel.primary(),c=(b=Ce&&(100<b.to().line-b.from().line||1E3<(c=d.getSelection()).length))?"-":c||d.getSelection(),this.textarea.value=c,d.state.focused&&Db(this.textarea),M&&9<=R&&(this.hasSelection=c)):a||(this.prevInput=this.textarea.value="",M&&9<=R&&(this.hasSelection=null));this.inaccurateSelection=
b}},getField:function(){return this.textarea},supportsTouch:function(){return!1},focus:function(){if("nocursor"!=this.cm.options.readOnly&&(!Fb||Ba()!=this.textarea))try{this.textarea.focus()}catch(a){}},blur:function(){this.textarea.blur()},resetPosition:function(){this.wrapper.style.top=this.wrapper.style.left=0},receivedFocus:function(){this.slowPoll()},slowPoll:function(){var a=this;a.pollingFast||a.polling.set(this.cm.options.pollInterval,function(){a.poll();a.cm.state.focused&&a.slowPoll()})},
fastPoll:function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,a)},poll:function(){var a=this.cm,b=this.textarea,c=this.prevInput;if(this.contextMenuPending||!a.state.focused||kg(b)&&!c&&!this.composing||Qa(a)||a.options.disableInput||a.state.keySeq)return!1;var d=b.value;if(d==c&&!a.somethingSelected())return!1;if(M&&9<=R&&this.hasSelection===d||sa&&/[\uf700-\uf7ff]/.test(d))return a.display.input.reset(),
!1;if(a.doc.sel==a.display.selForContextMenu){var f=d.charCodeAt(0);8203!=f||c||(c="\u200b");if(8666==f)return this.reset(),this.cm.execCommand("undo")}for(var g=0,f=Math.min(c.length,d.length);g<f&&c.charCodeAt(g)==d.charCodeAt(g);)++g;var h=this;ka(a,function(){bb(a,d.slice(g),c.length-g,null,h.composing?"*compose":null);1E3<d.length||-1<d.indexOf("\n")?b.value=h.prevInput="":h.prevInput=d;h.composing&&(h.composing.range.clear(),h.composing.range=a.markText(h.composing.start,a.getCursor("to"),{className:"CodeMirror-composing"}))});
return!0},ensurePolled:function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},onKeyPress:function(){M&&9<=R&&(this.hasSelection=null);this.fastPoll()},onContextMenu:function(a){function b(){if(null!=h.selectionStart){var a=f.somethingSelected(),c="\u200b"+(a?h.value:"");h.value="\u21da";h.value=c;d.prevInput=a?"":"\u200b";h.selectionStart=1;h.selectionEnd=c.length;g.selForContextMenu=f.doc.sel}}function c(){d.contextMenuPending=!1;d.wrapper.style.position="relative";h.style.cssText=q;M&&
9>R&&g.scrollbars.setScrollTop(g.scroller.scrollTop=m);if(null!=h.selectionStart){(!M||M&&9>R)&&b();var a=0,p=function(){g.selForContextMenu==f.doc.sel&&0==h.selectionStart&&0<h.selectionEnd&&"\u200b"==d.prevInput?V(f,Nc.selectAll)(f):10>a++?g.detectingSelectAll=setTimeout(p,500):g.input.reset()};g.detectingSelectAll=setTimeout(p,200)}}var d=this,f=d.cm,g=f.display,h=d.textarea,n=xb(f,a),m=g.scroller.scrollTop;if(n&&!wa){f.options.resetSelectionOnContextMenu&&-1==f.doc.sel.contains(n)&&V(f,ba)(f.doc,
Ca(n),Da);var q=h.style.cssText;d.wrapper.style.position="absolute";h.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(a.clientY-5)+"px; left: "+(a.clientX-5)+"px; z-index: 1000; background: "+(M?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";if(Y)var s=window.scrollY;g.input.focus();Y&&window.scrollTo(null,s);g.input.reset();f.somethingSelected()||(h.value=d.prevInput=" ");d.contextMenuPending=
!0;g.selForContextMenu=f.doc.sel;clearTimeout(g.detectingSelectAll);M&&9<=R&&b();if(xd){yd(a);var t=function(){Ga(window,"mouseup",t);setTimeout(c,20)};F(window,"mouseup",t)}else setTimeout(c,50)}},setUneditable:jc,needsContentAttribute:!1},hd.prototype);id.prototype=ra({init:function(a){function b(a){if(d.somethingSelected())oa=d.getSelections(),"cut"==a.type&&d.replaceSelection("",null,"cut");else if(d.options.lineWiseCopyCut){var c=W(d);oa=c.text;"cut"==a.type&&d.operation(function(){d.setSelections(c.ranges,
0,Da);d.replaceSelection("",null,"cut")})}else return;if(a.clipboardData&&!tb)a.preventDefault(),a.clipboardData.clearData(),a.clipboardData.setData("text/plain",oa.join("\n"));else{var f=Xd();a=f.firstChild;d.display.lineSpace.insertBefore(f,d.display.lineSpace.firstChild);a.value=oa.join("\n");var p=document.activeElement;Db(a);setTimeout(function(){d.display.lineSpace.removeChild(f);p.focus()},50)}}var c=this,d=c.cm;a=c.div=a.lineDiv;a.contentEditable="true";Wd(a);F(a,"paste",function(a){aa(a,
d)});F(a,"compositionstart",function(a){a=a.data;c.composing={sel:d.doc.sel,data:a,startData:a};if(a){var b=d.doc.sel.primary(),f=d.getLine(b.head.line).indexOf(a,Math.max(0,b.head.ch-a.length));-1<f&&f<=b.head.ch&&(c.composing.sel=Ca(A(b.head.line,f),A(b.head.line,f+a.length)))}});F(a,"compositionupdate",function(a){c.composing.data=a.data});F(a,"compositionend",function(a){var b=c.composing;b&&(a.data==b.startData||/\u200b/.test(a.data)||(b.data=a.data),setTimeout(function(){b.handled||c.applyComposition(b);
c.composing==b&&(c.composing=null)},50))});F(a,"touchstart",function(){c.forceCompositionEnd()});F(a,"input",function(){c.composing||c.pollContent()||ka(c.cm,function(){ja(d)})});F(a,"copy",b);F(a,"cut",b)},prepareSelection:function(){var a=he(this.cm,!1);a.focus=this.cm.state.focused;return a},showSelection:function(a){a&&this.cm.display.view.length&&(a.focus&&this.showPrimarySelection(),this.showMultipleSelections(a))},showPrimarySelection:function(){var a=window.getSelection(),b=this.cm.doc.sel.primary(),
c=xc(this.cm,a.anchorNode,a.anchorOffset),d=xc(this.cm,a.focusNode,a.focusOffset);if(!c||c.bad||!d||d.bad||0!=K(qb(c,d),b.from())||0!=K(pb(c,d),b.to()))if(c=Yd(this.cm,b.from()),d=Yd(this.cm,b.to()),c||d){var f=this.cm.display.view,b=a.rangeCount&&a.getRangeAt(0);c?d||(d=f[f.length-1].measure,d=d.maps?d.maps[d.maps.length-1]:d.map,d={node:d[d.length-1],offset:d[d.length-2]-d[d.length-3]}):c={node:f[0].measure.map[2],offset:0};try{var g=db(c.node,c.offset,d.offset,d.node)}catch(h){}g&&(a.removeAllRanges(),
a.addRange(g),b&&null==a.anchorNode?a.addRange(b):Ta&&this.startGracePeriod());this.rememberSelection()}},startGracePeriod:function(){var a=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&a.cm.operation(function(){a.cm.curOp.selectionChanged=!0})},20)},showMultipleSelections:function(a){qa(this.cm.display.cursorDiv,a.cursors);qa(this.cm.display.selectionDiv,a.selection)},rememberSelection:function(){var a=window.getSelection();this.lastAnchorNode=
a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset},selectionInEditor:function(){var a=window.getSelection();if(!a.rangeCount)return!1;a=a.getRangeAt(0).commonAncestorContainer;return kd(this.div,a)},focus:function(){"nocursor"!=this.cm.options.readOnly&&this.div.focus()},blur:function(){this.div.blur()},getField:function(){return this.div},supportsTouch:function(){return!0},receivedFocus:function(){function a(){b.cm.state.focused&&
(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=this;this.selectionInEditor()?this.pollSelection():ka(this.cm,function(){b.cm.curOp.selectionChanged=!0});this.polling.set(this.cm.options.pollInterval,a)},selectionChanged:function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset},pollSelection:function(){if(!this.composing&&!this.gracePeriod&&this.selectionChanged()){var a=
window.getSelection(),b=this.cm;this.rememberSelection();var c=xc(b,a.anchorNode,a.anchorOffset),d=xc(b,a.focusNode,a.focusOffset);c&&d&&ka(b,function(){ba(b.doc,Ca(c,d),Da);if(c.bad||d.bad)b.curOp.selectionChanged=!0})}},pollContent:function(){var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),c=c.to();if(d.line<b.viewFrom||c.line>b.viewTo-1)return!1;var f;d.line==b.viewFrom||0==(f=$a(a,d.line))?(d=P(b.view[0].line),f=b.view[0].node):(d=P(b.view[f].line),f=b.view[f-1].node.nextSibling);var g=
$a(a,c.line);g==b.view.length-1?(c=b.viewTo-1,b=b.lineDiv.lastChild):(c=P(b.view[g+1].line)-1,b=b.view[g+1].node.previousSibling);b=a.doc.splitLines(uf(a,f,b,d,c));for(f=cb(a.doc,A(d,0),A(c,D(a.doc,c).text.length));1<b.length&&1<f.length;)if(N(b)==N(f))b.pop(),f.pop(),c--;else if(b[0]==f[0])b.shift(),f.shift(),d++;else break;for(var h=0,g=0,n=b[0],m=f[0],q=Math.min(n.length,m.length);h<q&&n.charCodeAt(h)==m.charCodeAt(h);)++h;n=N(b);m=N(f);for(q=Math.min(n.length-(1==b.length?h:0),m.length-(1==f.length?
h:0));g<q&&n.charCodeAt(n.length-g-1)==m.charCodeAt(m.length-g-1);)++g;b[b.length-1]=n.slice(0,n.length-g);b[0]=b[0].slice(h);d=A(d,h);c=A(c,f.length?N(f).length-g:0);if(1<b.length||b[0]||K(d,c))return yb(a.doc,b,d,c,"+input"),!0},ensurePolled:function(){this.forceCompositionEnd()},reset:function(){this.forceCompositionEnd()},forceCompositionEnd:function(){this.composing&&!this.composing.handled&&(this.applyComposition(this.composing),this.composing.handled=!0,this.div.blur(),this.div.focus())},applyComposition:function(a){a.data&&
a.data!=a.startData&&V(this.cm,bb)(this.cm,a.data,0,a.sel)},setUneditable:function(a){a.setAttribute("contenteditable","false")},onKeyPress:function(a){a.preventDefault();V(this.cm,bb)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0)},onContextMenu:jc,resetPosition:jc,needsContentAttribute:!0},id.prototype);d.inputStyles={textarea:hd,contenteditable:id};Ja.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(a){if(a==this)return!0;if(a.primIndex!=
this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(0!=K(c.anchor,d.anchor)||0!=K(c.head,d.head))return!1}return!0},deepCopy:function(){for(var a=[],b=0;b<this.ranges.length;b++)a[b]=new Q(ob(this.ranges[b].anchor),ob(this.ranges[b].head));return new Ja(a,this.primIndex)},somethingSelected:function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1},contains:function(a,b){b||(b=a);
for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(0<=K(b,d.from())&&0>=K(a,d.to()))return c}return-1}};Q.prototype={from:function(){return qb(this.anchor,this.head)},to:function(){return pb(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var pd={left:0,right:0,top:0,bottom:0},eb,wb=null,Cf=0,Kc,Jc,se=0,Lc=0,la=null;M?la=-.53:Ta?la=15:hg?la=-.7:te&&(la=-1/3);var ze=function(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&
a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}};d.wheelEventPixels=function(a){a=ze(a);a.x*=la;a.y*=la;return a};var Nf=new Gb,Bd=null,fb=d.changeEnd=function(a){return a.text?A(a.from.line+a.text.length-1,N(a.text).length+(1==a.text.length?a.from.ch:0)):a.to};d.prototype={constructor:d,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,b){var c=this.options,d=c[a];if(c[a]!=
b||"mode"==a)c[a]=b,kb.hasOwnProperty(a)&&V(this,kb[a])(this,b,d)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](Uc(a))},removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:da(function(a,b){var c=a.token?a:d.getMode(this.options,a);if(c.startState)throw Error("Overlays may not be stateful.");this.state.overlays.push({mode:c,
modeSpec:a,opaque:b&&b.opaque});this.state.modeGen++;ja(this)}),removeOverlay:da(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;if(d==a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;ja(this);break}}}),indentLine:da(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");Xb(this.doc,a)&&Wb(this,a,b,c)}),indentSelection:da(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<
b.length;d++){var f=b[d];if(f.empty())f.head.line>c&&(Wb(this,f.head.line,a,!0),c=f.head.line,d==this.doc.sel.primIndex&&sb(this));else{for(var g=f.from(),f=f.to(),h=Math.max(c,g.line),c=Math.min(this.lastLine(),f.line-(f.ch?0:1))+1,f=h;f<c;++f)Wb(this,f,a);f=this.doc.sel.ranges;0==g.ch&&b.length==f.length&&0<f[d].from().ch&&ld(this.doc,d,new Q(g,f[d].to()),Da)}}}),getTokenAt:function(a,b){return Ye(this,a,b)},getLineTokens:function(a,b){return Ye(this,A(a),b,!0)},getTokenTypeAt:function(a){a=J(this.doc,
a);var b=$e(this,D(this.doc,a.line)),c=0,d=(b.length-1)/2;a=a.ch;var f;if(0==a)f=b[2];else for(;;){var g=c+d>>1;if((g?b[2*g-1]:0)>=a)d=g;else if(b[2*g+1]<a)c=g+1;else{f=b[2*g+2];break}}b=f?f.indexOf("cm-overlay "):-1;return 0>b?f:0==b?null:f.slice(0,b-1)},getModeAt:function(a){var b=this.doc.mode;return b.innerMode?d.innerMode(b,this.getTokenAt(a).state).mode:b},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var c=[];if(!Eb.hasOwnProperty(b))return c;var d=Eb[b],
f=this.getModeAt(a);if("string"==typeof f[b])d[f[b]]&&c.push(d[f[b]]);else if(f[b])for(var g=0;g<f[b].length;g++){var h=d[f[b][g]];h&&c.push(h)}else f.helperType&&d[f.helperType]?c.push(d[f.helperType]):d[f.name]&&c.push(d[f.name]);for(g=0;g<d._global.length;g++)h=d._global[g],h.pred(f,this)&&-1==ea(c,h.val)&&c.push(h.val);return c},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return Zb(this,a+1,b)},cursorCoords:function(a,b){var c;
c=this.doc.sel.primary();c=null==a?c.head:"object"==typeof a?J(this.doc,a):a?c.from():c.to();return Ka(this,c,b||"page")},charCoords:function(a,b){return Cc(this,J(this.doc,a),b||"page")},coordsChar:function(a,b){a=ne(this,a,b||"page");return ud(this,a.left,a.top)},lineAtHeight:function(a,b){a=ne(this,{top:a,left:0},b||"page").top;return Ya(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b){var c=!1,d;"number"==typeof a?(d=this.doc.first+this.doc.size-1,a<this.doc.first?a=this.doc.first:
a>d&&(a=d,c=!0),d=D(this.doc,a)):d=a;return rd(this,d,{top:0,left:0},b||"page").top+(c?this.doc.height-Aa(d):0)},defaultTextHeight:function(){return Ua(this.display)},defaultCharWidth:function(){return Kb(this.display)},setGutterMarker:da(function(a,b,c){return Sc(this.doc,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});d[b]=c;!c&&hf(d)&&(a.gutterMarkers=null);return!0})}),clearGutter:da(function(a){var b=this,c=b.doc,d=c.first;c.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&
(c.gutterMarkers[a]=null,La(b,d,"gutter"),hf(c.gutterMarkers)&&(c.gutterMarkers=null));++d})}),lineInfo:function(a){if("number"==typeof a){if(!Xb(this.doc,a))return null;var b=a;a=D(this.doc,a);if(!a)return null}else if(b=P(a),null==b)return null;return{line:b,handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,
d,f){var g=this.display;a=Ka(this,J(this.doc,a));var h=a.bottom,n=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);g.sizer.appendChild(b);if("over"==d)h=a.top;else if("above"==d||"near"==d){var m=Math.max(g.wrapper.clientHeight,this.doc.height),q=Math.max(g.sizer.clientWidth,g.lineSpace.clientWidth);("above"==d||a.bottom+b.offsetHeight>m)&&a.top>b.offsetHeight?h=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=m&&(h=a.bottom);n+b.offsetWidth>
q&&(n=q-b.offsetWidth)}b.style.top=h+"px";b.style.left=b.style.right="";"right"==f?(n=g.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==f?n=0:"middle"==f&&(n=(g.sizer.clientWidth-b.offsetWidth)/2),b.style.left=n+"px");c&&(a=Hc(this,n,h,n+b.offsetWidth,h+b.offsetHeight),null!=a.scrollTop&&Nb(this,a.scrollTop),null!=a.scrollLeft&&mb(this,a.scrollLeft))},triggerOnKeyDown:da(ve),triggerOnKeyPress:da(we),triggerOnKeyUp:ue,execCommand:function(a){if(Nc.hasOwnProperty(a))return Nc[a].call(null,
this)},triggerElectric:da(function(a){Z(this,a)}),findPosH:function(a,b,c,d){var f=1;0>b&&(f=-1,b=-b);var g=0;for(a=J(this.doc,a);g<b&&(a=Gd(this.doc,a,f,c,d),!a.hitSide);++g);return a},moveH:da(function(a,b){var c=this;c.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?Gd(c.doc,d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},lc)}),deleteH:da(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):zb(this,function(d){var f=
Gd(c,d.head,a,b,!1);return 0>a?{from:f,to:d.head}:{from:d.head,to:f}})}),findPosV:function(a,b,c,d){var f=1;0>b&&(f=-1,b=-b);var g=0;for(a=J(this.doc,a);g<b&&(a=Ka(this,a,"div"),null==d?d=a.left:a.left=d,a=Pe(this,a,f,c),!a.hitSide);++g);return a},moveV:da(function(a,b){var c=this,d=this.doc,f=[],g=!c.display.shift&&!d.extend&&d.sel.somethingSelected();d.extendSelectionsBy(function(h){if(g)return 0>a?h.from():h.to();var n=Ka(c,h.head,"div");null!=h.goalColumn&&(n.left=h.goalColumn);f.push(n.left);
var m=Pe(c,n,a,b);"page"==b&&h==d.sel.primary()&&Qc(c,null,Cc(c,m,"div").top-n.top);return m},lc);if(f.length)for(var h=0;h<d.sel.ranges.length;h++)d.sel.ranges[h].goalColumn=f[h]}),findWordAt:function(a){var b=D(this.doc,a.line).text,c=a.ch,d=a.ch;if(b){var f=this.getHelper(a,"wordChars");(0>a.xRel||d==b.length)&&c?--c:++d;for(var g=b.charAt(c),g=Tc(g,f)?function(a){return Tc(a,f)}:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!Tc(a)};0<c&&g(b.charAt(c-1));)--c;for(;d<
b.length&&g(b.charAt(d));)++d}return new Q(A(a.line,c),A(a.line,d))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?Ob(this.display.cursorDiv,"CodeMirror-overwrite"):Mb(this.display.cursorDiv,"CodeMirror-overwrite"),X(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==Ba()},scrollTo:da(function(a,b){null==a&&null==b||Rc(this);null!=a&&(this.curOp.scrollLeft=a);null!=b&&(this.curOp.scrollTop=
b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-za(this)-this.display.barHeight,width:a.scrollWidth-za(this)-this.display.barWidth,clientHeight:fd(this),clientWidth:Na(this)}},scrollIntoView:da(function(a,b){null==a?(a={from:this.doc.sel.primary().head,to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:A(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;if(null!=
a.from.line)Rc(this),this.curOp.scrollToPos=a;else{var c=Hc(this,Math.min(a.from.left,a.to.left),Math.min(a.from.top,a.to.top)-a.margin,Math.max(a.from.right,a.to.right),Math.max(a.from.bottom,a.to.bottom)+a.margin);this.scrollTo(c.scrollLeft,c.scrollTop)}}),setSize:da(function(a,b){function c(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a}var d=this;null!=a&&(d.display.wrapper.style.width=c(a));null!=b&&(d.display.wrapper.style.height=c(b));d.options.lineWrapping&&me(this);var f=d.display.viewFrom;
d.doc.iter(f,d.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){La(d,f,"widget");break}++f});d.curOp.forceUpdate=!0;X(d,"refresh",this)}),operation:function(a){return ka(this,a)},refresh:da(function(){var a=this.display.cachedTextHeight;ja(this);this.curOp.forceUpdate=!0;Lb(this);this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop);r(this);(null==a||.5<Math.abs(a-Ua(this.display)))&&g(this);X(this,"refresh",this)}),swapDoc:da(function(a){var b=
this.doc;b.cm=null;Qd(this,a);Lb(this);this.display.input.reset();this.scrollTo(a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;fa(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};Cb(d);var qf=d.defaults={},kb=d.optionHandlers={},Rd=d.Init={toString:function(){return"CodeMirror.Init"}};
I("value","",function(a,b){a.setValue(b)},!0);I("mode",null,function(a,b){a.doc.modeOption=b;c(a)},!0);I("indentUnit",2,c,!0);I("indentWithTabs",!1);I("smartIndent",!0);I("tabSize",4,function(b){a(b);Lb(b);ja(b)},!0);I("lineSeparator",null,function(a,b){if(a.doc.lineSep=b){var c=[],d=a.doc.first;a.doc.iter(function(a){for(var f=0;;){var p=a.text.indexOf(b,f);if(-1==p)break;f=p+b.length;c.push(A(d,p))}d++});for(var f=c.length-1;0<=f;f--)yb(a.doc,b,c[f],A(c[f].line,c[f].ch+b.length))}});I("specialChars",
/[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,c){a.state.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");c!=d.Init&&a.refresh()});I("specialCharPlaceholder",function(a){var b=B("span","\u2022","cm-invalidchar");b.title="\\u"+a.charCodeAt(0).toString(16);b.setAttribute("aria-label",b.title);return b},function(a){a.refresh()},!0);I("electricChars",!0);I("inputStyle",Fb?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");
},!0);I("rtlMoveVisually",!jg);I("wholeLineUpdateBefore",!0);I("theme","default",function(a){m(a);h(a)},!0);I("keyMap","default",function(a,b,c){b=Uc(b);(c=c!=d.Init&&Uc(c))&&c.detach&&c.detach(a,b);b.attach&&b.attach(a,c||null)});I("extraKeys",null);I("lineWrapping",!1,function(a){a.options.lineWrapping?(Ob(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(Mb(a.display.wrapper,"CodeMirror-wrap"),t(a));g(a);ja(a);Lb(a);setTimeout(function(){w(a)},100)},
!0);I("gutters",[],function(a){x(a.options);h(a)},!0);I("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?S(a.display)+"px":"0";a.refresh()},!0);I("coverGutterNextToScrollbar",!1,function(a){w(a)},!0);I("scrollbarStyle","native",function(a){s(a);w(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);I("lineNumbers",!1,function(a){x(a.options);h(a)},!0);I("firstLineNumber",1,h,!0);I("lineNumberFormatter",function(a){return a},h,
!0);I("showCursorWhenSelecting",!1,Pb,!0);I("resetSelectionOnContextMenu",!0);I("lineWiseCopyCut",!0);I("readOnly",!1,function(a,b){"nocursor"==b?(Ib(a),a.display.input.blur(),a.display.disabled=!0):(a.display.disabled=!1,b||a.display.input.reset())});I("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);I("dragDrop",!0,function(a,b,c){!b!=!(c&&c!=d.Init)&&(c=a.display.dragFunctions,b=b?F:Ga,b(a.display.scroller,"dragstart",c.start),b(a.display.scroller,"dragenter",c.simple),b(a.display.scroller,
"dragover",c.simple),b(a.display.scroller,"drop",c.drop))});I("cursorBlinkRate",530);I("cursorScrollMargin",0);I("cursorHeight",1,Pb,!0);I("singleCursorHeightPerLine",!0,Pb,!0);I("workTime",100);I("workDelay",100);I("flattenSpans",!0,a,!0);I("addModeClass",!1,a,!0);I("pollInterval",100);I("undoDepth",200,function(a,b){a.doc.history.undoDepth=b});I("historyEventDelay",1250);I("viewportMargin",10,function(a){a.refresh()},!0);I("maxHighlightLength",1E4,a,!0);I("moveInputWithCursor",!0,function(a,b){b||
a.display.input.resetPosition()});I("tabindex",null,function(a,b){a.display.input.getField().tabIndex=b||""});I("autofocus",null);var pf=d.modes={},nc=d.mimeModes={};d.defineMode=function(a,b){d.defaults.mode||"null"==a||(d.defaults.mode=a);2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));pf[a]=b};d.defineMIME=function(a,b){nc[a]=b};d.resolveMode=function(a){if("string"==typeof a&&nc.hasOwnProperty(a))a=nc[a];else if(a&&"string"==typeof a.name&&nc.hasOwnProperty(a.name)){var b=
nc[a.name];"string"==typeof b&&(b={name:b});a=ff(b,a);a.name=b.name}else if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return d.resolveMode("application/xml");return"string"==typeof a?{name:a}:a||{name:"null"}};d.getMode=function(a,b){b=d.resolveMode(b);var c=pf[b.name];if(!c)return d.getMode(a,"text/plain");c=c(a,b);if(oc.hasOwnProperty(b.name)){var f=oc[b.name],g;for(g in f)f.hasOwnProperty(g)&&(c.hasOwnProperty(g)&&(c["_"+g]=c[g]),c[g]=f[g])}c.name=b.name;b.helperType&&(c.helperType=
b.helperType);if(b.modeProps)for(g in b.modeProps)c[g]=b.modeProps[g];return c};d.defineMode("null",function(){return{token:function(a){a.skipToEnd()}}});d.defineMIME("text/plain","null");var oc=d.modeExtensions={};d.extendMode=function(a,b){var c=oc.hasOwnProperty(a)?oc[a]:oc[a]={};ra(b,c)};d.defineExtension=function(a,b){d.prototype[a]=b};d.defineDocExtension=function(a,b){ia.prototype[a]=b};d.defineOption=I;var bd=[];d.defineInitHook=function(a){bd.push(a)};var Eb=d.helpers={};d.registerHelper=
function(a,b,c){Eb.hasOwnProperty(a)||(Eb[a]=d[a]={_global:[]});Eb[a][b]=c};d.registerGlobalHelper=function(a,b,c,f){d.registerHelper(a,b,f);Eb[a]._global.push({pred:c,val:f})};var vb=d.copyState=function(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);var c={},d;for(d in b){var f=b[d];f instanceof Array&&(f=f.concat([]));c[d]=f}return c},Af=d.startState=function(a,b,c){return a.startState?a.startState(b,c):!0};d.innerMode=function(a,b){for(;a.innerMode;){var c=a.innerMode(b);if(!c||
c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}};var Nc=d.commands={selectAll:function(a){a.setSelection(A(a.firstLine(),0),A(a.lastLine()),Da)},singleSelection:function(a){a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Da)},killLine:function(a){zb(a,function(b){if(b.empty()){var c=D(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:A(b.head.line+1,0)}:{from:b.head,to:A(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){zb(a,
function(b){return{from:A(b.from().line,0),to:J(a.doc,A(b.to().line+1,0))}})},delLineLeft:function(a){zb(a,function(a){return{from:A(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){zb(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){zb(a,function(b){var c=a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:c}})},
undo:function(a){a.undo()},redo:function(a){a.redo()},undoSelection:function(a){a.undoSelection()},redoSelection:function(a){a.redoSelection()},goDocStart:function(a){a.extendSelection(A(a.firstLine(),0))},goDocEnd:function(a){a.extendSelection(A(a.lastLine()))},goLineStart:function(a){a.extendSelectionsBy(function(b){return kf(a,b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){a.extendSelectionsBy(function(b){return lf(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){a.extendSelectionsBy(function(b){b=
b.head.line;for(var c,d=D(a.doc,b);c=Xa(d,!1);)d=c.find(1,!0).line,b=null;c=(c=ta(d))?c[0].level%2?Fc(d):Gc(d):d.text.length;return A(null==b?P(d):b,c)},{origin:"+move",bias:-1})},goLineRight:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:b},"div")},lc)},goLineLeft:function(a){a.extendSelectionsBy(function(b){b=a.charCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:b},"div")},lc)},goLineLeftSmart:function(a){a.extendSelectionsBy(function(b){var c=
a.charCoords(b.head,"div").top+5,c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?lf(a,b.head):c},lc)},goLineUp:function(a){a.moveV(-1,"line")},goLineDown:function(a){a.moveV(1,"line")},goPageUp:function(a){a.moveV(-1,"page")},goPageDown:function(a){a.moveV(1,"page")},goCharLeft:function(a){a.moveH(-1,"char")},goCharRight:function(a){a.moveH(1,"char")},goColumnLeft:function(a){a.moveH(-1,"column")},goColumnRight:function(a){a.moveH(1,"column")},goWordLeft:function(a){a.moveH(-1,
"word")},goGroupRight:function(a){a.moveH(1,"group")},goGroupLeft:function(a){a.moveH(-1,"group")},goWordRight:function(a){a.moveH(1,"word")},delCharBefore:function(a){a.deleteH(-1,"char")},delCharAfter:function(a){a.deleteH(1,"char")},delWordBefore:function(a){a.deleteH(-1,"word")},delWordAfter:function(a){a.deleteH(1,"word")},delGroupBefore:function(a){a.deleteH(-1,"group")},delGroupAfter:function(a){a.deleteH(1,"group")},indentAuto:function(a){a.indentSelection("smart")},indentMore:function(a){a.indentSelection("add")},
indentLess:function(a){a.indentSelection("subtract")},insertTab:function(a){a.replaceSelection("\t")},insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,f=0;f<c.length;f++){var g=c[f].from(),g=va(a.getLine(g.line),g.ch,d);b.push(Array(d-g%d+1).join(" "))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){ka(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var f=
b[d].head,g=D(a.doc,f.line).text;if(g)if(f.ch==g.length&&(f=new A(f.line,f.ch-1)),0<f.ch)f=new A(f.line,f.ch+1),a.replaceRange(g.charAt(f.ch-1)+g.charAt(f.ch-2),A(f.line,f.ch-2),f,"+transpose");else if(f.line>a.doc.first){var h=D(a.doc,f.line-1).text;h&&a.replaceRange(g.charAt(0)+a.doc.lineSeparator()+h.charAt(h.length-1),A(f.line-1,h.length-1),A(f.line,1),"+transpose")}c.push(new Q(f,f))}a.setSelections(c)})},newlineAndIndent:function(a){ka(a,function(){for(var b=a.listSelections().length,c=0;c<
b;c++){var d=a.listSelections()[c];a.replaceRange(a.doc.lineSeparator(),d.anchor,d.head,"+input");a.indentLine(d.from().line+1,null,!0);sb(a)}})},toggleOverwrite:function(a){a.toggleOverwrite()}},Ra=d.keyMap={};Ra.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",
Insert:"toggleOverwrite",Esc:"singleSelection"};Ra.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace",
"Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};Ra.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore",
"Ctrl-K":"killLine","Ctrl-T":"transposeChars"};Ra.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev",
"Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]};Ra["default"]=sa?Ra.macDefault:Ra.pcDefault;d.normalizeKeyMap=function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=d)for(var f=vc(c.split(" "),
Tf),g=0;g<f.length;g++){var h,n;g==f.length-1?(n=f.join(" "),h=d):(n=f.slice(0,g+1).join(" "),h="...");var m=b[n];if(!m)b[n]=h;else if(m!=h)throw Error("Inconsistent bindings for "+n);}delete a[c]}}for(var q in b)a[q]=b[q];return a};var cc=d.lookupKey=function(a,b,c,d){b=Uc(b);var f=b.call?b.call(a,d):b[a];if(!1===f)return"nothing";if("..."===f)return"multi";if(null!=f&&c(f))return"handled";if(b.fallthrough){if("[object Array]"!=Object.prototype.toString.call(b.fallthrough))return cc(a,b.fallthrough,
c,d);for(f=0;f<b.fallthrough.length;f++){var g=cc(a,b.fallthrough[f],c,d);if(g)return g}}},Mf=d.isModifierKey=function(a){a="string"==typeof a?a:Sa[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a},Of=d.keyName=function(a,b){if(wa&&34==a.keyCode&&a["char"])return!1;var c=Sa[a.keyCode],d=c;if(null==d||a.altGraphKey)return!1;a.altKey&&"Alt"!=c&&(d="Alt-"+d);(of?a.metaKey:a.ctrlKey)&&"Ctrl"!=c&&(d="Ctrl-"+d);(of?a.ctrlKey:a.metaKey)&&"Cmd"!=c&&(d="Cmd-"+d);!b&&a.shiftKey&&"Shift"!=c&&(d="Shift-"+
d);return d};d.fromTextArea=function(a,b){function c(){a.value=q.getValue()}b=b?ra(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var f=Ba();b.autofocus=f==a||null!=a.getAttribute("autofocus")&&f==document.body}if(a.form&&(F(a.form,"submit",c),!b.leaveSubmitMethodAlone)){var g=a.form,h=g.submit;try{var n=g.submit=function(){c();g.submit=h;g.submit();g.submit=n}}catch(m){}}b.finishInit=function(b){b.save=
c;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;c();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&(Ga(a.form,"submit",c),"function"==typeof a.form.submit&&(a.form.submit=h))}};a.style.display="none";var q=d(function(b){a.parentNode.insertBefore(b,a.nextSibling)},b);return q};var Yc=d.StringStream=function(a,b){this.pos=this.start=0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0};Yc.prototype={eol:function(){return this.pos>=
this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(a){var b=this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&(a.test?a.test(b):a(b)))return++this.pos,b},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;
return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0},backUp:function(a){this.pos-=a},column:function(){this.lastColumnPos<this.start&&(this.lastColumnValue=va(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?va(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return va(this.string,
null,this.tabSize)-(this.lineStart?va(this.string,this.lineStart,this.tabSize):0)},match:function(a,b,c){if("string"==typeof a){var d=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);if(d(f)==d(a))return!1!==b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=
a}}};var Hd=0,hb=d.TextMarker=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=++Hd};Cb(hb);hb.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&jb(a);if(pa(this,"clear")){var c=this.find();c&&fa(this,"clear",c.from,c.to)}for(var d=c=null,f=0;f<this.lines.length;++f){var g=this.lines[f],h=ec(g.markedSpans,this);a&&!this.collapsed?La(a,P(g),"text"):a&&(null!=h.to&&(d=P(g)),null!=h.from&&(c=P(g)));for(var n=g,m=g.markedSpans,s=h,t=void 0,r=0;r<m.length;++r)m[r]!=
s&&(t||(t=[])).push(m[r]);n.markedSpans=t;null==h.from&&this.collapsed&&!Va(this.doc,g)&&a&&ya(g,Ua(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(f=0;f<this.lines.length;++f)g=Ea(this.lines[f]),h=q(g),h>a.display.maxLineLength&&(a.display.maxLine=g,a.display.maxLineLength=h,a.display.maxLineChanged=!0);null!=c&&a&&this.collapsed&&ja(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&ge(a.doc));a&&fa(a,"markerCleared",a,this);
b&&lb(a);this.parent&&this.parent.clear()}};hb.prototype.find=function(a,b){null==a&&"bookmark"==this.type&&(a=1);for(var c,d,f=0;f<this.lines.length;++f){var g=this.lines[f],h=ec(g.markedSpans,this);if(null!=h.from&&(c=A(b?g:P(g),h.from),-1==a))return c;if(null!=h.to&&(d=A(b?g:P(g),h.to),1==a))return d}return c&&{from:c,to:d}};hb.prototype.changed=function(){var a=this.find(-1,!0),b=this,c=this.doc.cm;a&&c&&ka(c,function(){var d=a.line,f=P(a.line);if(f=jd(c,f))le(f),c.curOp.selectionChanged=c.curOp.forceUpdate=
!0;c.curOp.updateMaxLine=!0;Va(b.doc,d)||null==b.height||(f=b.height,b.height=null,(f=ac(b)-f)&&ya(d,d.height+f))})};hb.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=ea(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};hb.prototype.detachLine=function(a){this.lines.splice(ea(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||
(a.maybeHiddenMarkers=[])).push(this))};var Hd=0,Wc=d.SharedTextMarker=function(a,b){this.markers=a;this.primary=b;for(var c=0;c<a.length;++c)a[c].parent=this};Cb(Wc);Wc.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();fa(this,"clear")}};Wc.prototype.find=function(a,b){return this.primary.find(a,b)};var Xc=d.LineWidget=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.doc=a;this.node=
b};Cb(Xc);Xc.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=P(c);if(null!=d&&b){for(var f=0;f<b.length;++f)b[f]==this&&b.splice(f--,1);b.length||(c.widgets=null);var g=ac(this);ya(c,Math.max(0,c.height-g));a&&ka(a,function(){var b=-g;Aa(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Qc(a,null,b);La(a,d,"widget")})}};Xc.prototype.changed=function(){var a=this.height,b=this.doc.cm,c=this.line;this.height=null;var d=ac(this)-a;d&&(ya(c,c.height+d),b&&ka(b,function(){b.curOp.forceUpdate=
!0;Aa(c)<(b.curOp&&b.curOp.scrollTop||b.doc.scrollTop)&&Qc(b,null,d)}))};var fc=d.Line=function(a,b,c){this.text=a;Ue(this,b);this.height=c?c(this):1};Cb(fc);fc.prototype.lineNo=function(){return P(this)};var Zf={},Yf={};gc.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;c<d;++c){var f=this.lines[c];this.height-=f.height;var g=f;g.parent=null;Te(g);fa(f,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,
b,c){this.height+=c;this.lines=this.lines.slice(0,a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};hc.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],f=d.chunkSize();if(a<f){var g=Math.min(b,f-a),h=d.height;d.removeInner(a,g);this.height-=h-d.height;f==g&&(this.children.splice(c--,1),d.parent=
null);if(0==(b-=g))break;a=0}else a-=f}25>this.size-b&&(1<this.children.length||!(this.children[0]instanceof gc))&&(c=[],this.collapse(c),this.children=[new gc(c)],this.children[0].parent=this)},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var f=this.children[d],g=f.chunkSize();if(a<=g){f.insertInner(a,b,c);if(f.lines&&50<f.lines.length){for(;50<f.lines.length;)a=
f.lines.splice(f.lines.length-25,25),a=new gc(a),f.height-=a.height,this.children.splice(d+1,0,a),a.parent=this;this.maybeSpill()}break}a-=g}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=a.children.splice(a.children.length-5,5),b=new hc(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=ea(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new hc(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},
iterN:function(a,b,c){for(var d=0;d<this.children.length;++d){var f=this.children[d],g=f.chunkSize();if(a<g){g=Math.min(b,g-a);if(f.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=g}}};var lg=0,ia=d.Doc=function(a,b,c,d){if(!(this instanceof ia))return new ia(a,b,c,d);null==c&&(c=0);hc.call(this,[new gc([new fc("",null)])]);this.first=c;this.scrollTop=this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.frontier=c;c=A(c,0);this.sel=Ca(c);this.history=new Zc(null);this.id=++lg;this.modeOption=
b;this.lineSep=d;"string"==typeof a&&(a=this.splitLines(a));Fd(this,{from:c,to:c,text:a});ba(this,Ca(c),Da)};ia.prototype=ff(hc.prototype,{constructor:ia,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=Md(this,this.first,this.first+this.size);return!1===a?b:b.join(a||
this.lineSeparator())},setValue:ga(function(a){var b=A(this.first,0),c=this.first+this.size-1;rb(this,{from:b,to:A(c,D(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0);ba(this,Ca(b))}),replaceRange:function(a,b,c,d){b=J(this,b);c=c?J(this,c):b;yb(this,a,b,c,d)},getRange:function(a,b,c){a=cb(this,J(this,a),J(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(Xb(this,a))return D(this,
a)},getLineNumber:function(a){return P(a)},getLineHandleVisualStart:function(a){"number"==typeof a&&(a=D(this,a));return Ea(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(a){return J(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},
setCursor:ga(function(a,b,c){a=J(this,"number"==typeof a?A(a,b||0):a);ba(this,Ca(a,null),c)}),setSelection:ga(function(a,b,c){var d=J(this,a);a=J(this,b||a);ba(this,Ca(d,a),c)}),extendSelection:ga(function(a,b,c){yc(this,J(this,a),b&&J(this,b),c)}),extendSelections:ga(function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=J(this,a[d]);ae(this,c)}),extendSelectionsBy:ga(function(a,b){ae(this,vc(this.sel.ranges,a),b)}),setSelections:ga(function(a,b,c){if(a.length){for(var d=0,f=[];d<a.length;d++)f[d]=new Q(J(this,
a[d].anchor),J(this,a[d].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));ba(this,ua(f,b),c)}}),addSelection:ga(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new Q(J(this,a),J(this,b||a)));ba(this,ua(d,d.length-1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var f=cb(this,b[d].from(),b[d].to());c=c?c.concat(f):f}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var f=cb(this,
c[d].from(),c[d].to());!1!==a&&(f=f.join(a||this.lineSeparator()));b[d]=f}return b},replaceSelection:function(a,b,c){for(var d=[],f=0;f<this.sel.ranges.length;f++)d[f]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:ga(function(a,b,c){for(var d=[],f=this.sel,g=0;g<f.ranges.length;g++){var h=f.ranges[g];d[g]={from:h.from(),to:h.to(),text:this.splitLines(a[g]),origin:c}}if(g=b&&"end"!=b){g=[];c=a=A(this.first,0);for(f=0;f<d.length;f++){var n=d[f],h=Ee(n.from,a,c),m=Ee(fb(n),a,c);a=n.to;
c=m;"around"==b?(n=this.sel.ranges[f],n=0>K(n.head,n.anchor),g[f]=new Q(n?m:h,n?h:m)):g[f]=new Q(h,h)}g=new Ja(g,this.sel.primIndex)}b=g;for(g=d.length-1;0<=g;g--)rb(this,d[g]);b?be(this,b):this.cm&&sb(this.cm)}),undo:ga(function(){Pc(this,"undo")}),redo:ga(function(){Pc(this,"redo")}),undoSelection:ga(function(){Pc(this,"undo",!0)}),redoSelection:ga(function(){Pc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=
this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new Zc(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},
getHistory:function(){return{done:Bb(this.history.done),undone:Bb(this.history.undone)}},setHistory:function(a){var b=this.history=new Zc(this.history.maxGeneration);b.done=Bb(a.done.slice(0),null,!0);b.undone=Bb(a.undone.slice(0),null,!0)},addLineClass:ga(function(a,b,c){return Sc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[d]){if(kc(c).test(a[d]))return!1;a[d]+=" "+c}else a[d]=c;return!0})}),removeLineClass:ga(function(a,
b,c){return Sc(this,a,"gutter"==b?"gutter":"class",function(a){var d="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",f=a[d];if(f)if(null==c)a[d]=null;else{var g=f.match(kc(c));if(!g)return!1;var h=g.index+g[0].length;a[d]=f.slice(0,g.index)+(g.index&&h!=f.length?" ":"")+f.slice(h)||null}else return!1;return!0})}),addLineWidget:ga(function(a,b,c){return Xf(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return Ab(this,J(this,a),J(this,
b),c,"range")},setBookmark:function(a,b){var c={replacedWith:b&&(null==b.nodeType?b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&b.handleMouseEvents};a=J(this,a);return Ab(this,a,a,c,"bookmark")},findMarksAt:function(a){a=J(this,a);var b=[],c=D(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var f=c[d];(null==f.from||f.from<=a.ch)&&(null==f.to||f.to>=a.ch)&&b.push(f.marker.parent||f.marker)}return b},findMarks:function(a,b,c){a=J(this,a);
b=J(this,b);var d=[],f=a.line;this.iter(a.line,b.line+1,function(g){if(g=g.markedSpans)for(var h=0;h<g.length;h++){var n=g[h];f==a.line&&a.ch>n.to||null==n.from&&f!=a.line||f==b.line&&n.from>b.ch||c&&!c(n.marker)||d.push(n.marker.parent||n.marker)}++f});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first;this.iter(function(d){d=d.text.length+1;if(d>
a)return b=a,!0;a-=d;++c});return J(this,A(c,b))},indexFromPos:function(a){a=J(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;this.iter(this.first,a.line,function(a){b+=a.text.length+1});return b},copy:function(a){var b=new ia(Md(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||
(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new ia(Md(this,b,c),a.mode||this.modeOption,b,this.lineSep);a.sharedHist&&(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=Re(this);for(c=0;c<a.length;c++){var d=a[c],f=d.find(),g=b.clipPos(f.from),f=b.clipPos(f.to);K(g,f)&&(g=Ab(b,g,f,d.primary,d.primary.type),d.markers.push(g),g.parent=
d)}return b},unlinkDoc:function(a){a instanceof d&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);Vf(Re(this));break}if(a.history==this.history){var c=[a.id];gb(a,function(a){c.push(a.id)},!0);a.history=new Zc(null);a.history.done=Bb(this.history.done,c);a.history.undone=Bb(this.history.undone,c)}},iterLinkedDocs:function(a){gb(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(a){return this.lineSep?
a.split(this.lineSep):mg(a)},lineSeparator:function(){return this.lineSep||"\n"}});ia.prototype.eachLine=ia.prototype.iter;var ng="iter insert remove copy getEditor constructor".split(" "),pc;for(pc in ia.prototype)ia.prototype.hasOwnProperty(pc)&&0>ea(ng,pc)&&(d.prototype[pc]=function(a){return function(){return a.apply(this.doc,arguments)}}(ia.prototype[pc]));Cb(ia);var ha=d.e_preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},og=d.e_stopPropagation=function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0},yd=d.e_stop=function(a){ha(a);og(a)},F=d.on=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),(a[b]||(a[b]=[])).push(c))},Ga=d.off=function(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else if(a=a._handlers&&a._handlers[b])for(b=0;b<a.length;++b)if(a[b]==c){a.splice(b,1);break}},X=d.signal=function(a,b){var c=a._handlers&&
a._handlers[b];if(c)for(var d=Array.prototype.slice.call(arguments,2),f=0;f<c.length;++f)c[f].apply(null,d)},ic=null,Sd=30,Ae=d.Pass={toString:function(){return"CodeMirror.Pass"}},Da={scroll:!1},zd={origin:"*mouse"},lc={origin:"+move"};Gb.prototype.set=function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var va=d.countColumn=function(a,b,c,d,f){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));d=d||0;for(f=f||0;;){var g=a.indexOf("\t",d);if(0>g||g>=b)return f+(b-d);f+=g-d;f+=c-f%c;
d=g+1}},$c=[""],Db=function(a){a.select()};tb?Db=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:M&&(Db=function(a){try{a.select()}catch(b){}});var pg=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,gf=d.isWordChar=function(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||pg.test(a))},fg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
db;db=document.createRange?function(a,b,c,d){var f=document.createRange();f.setEnd(d||a,c);f.setStart(a,b);return f}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(f){return d}d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};var kd=d.contains=function(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)};M&&11>R&&(Ba=function(){try{return document.activeElement}catch(a){return document.body}});
var Mb=d.rmClass=function(a,b){var c=a.className,d=kc(b).exec(c);if(d){var f=c.slice(d.index+d[0].length);a.className=c.slice(0,d.index)+(f?d[1]+f:"")}},Ob=d.addClass=function(a,b){var c=a.className;kc(b).test(c)||(a.className+=(c?" ":"")+b)},Pd=!1,If=function(){if(M&&9>R)return!1;var a=B("div");return"draggable"in a||"dragDrop"in a}(),Nd,Kd,mg=d.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var f=a.indexOf("\n",b);-1==f&&(f=a.length);var g=a.slice(b,"\r"==
a.charAt(f-1)?f-1:f),h=g.indexOf("\r");-1!=h?(c.push(g.slice(0,h)),b+=h+1):(c.push(g),b=f+1)}return c}:function(a){return a.split(/\r\n?|\n/)},kg=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(b){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(c){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Ce=function(){var a=B("div");if("oncopy"in a)return!0;a.setAttribute("oncopy","return;");return"function"==typeof a.oncopy}(),
qd=null,Sa={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",
63276:"PageUp",63277:"PageDown",63302:"Insert"};d.keyNames=Sa;(function(){for(var a=0;10>a;a++)Sa[a+48]=Sa[a+96]=String(a);for(a=65;90>=a;a++)Sa[a]=String.fromCharCode(a);for(a=1;12>=a;a++)Sa[a+111]=Sa[a+63235]="F"+a})();var bc,dg=function(){function a(b){return 247>=b?c.charAt(b):1424<=b&&1524>=b?"R":1536<=b&&1773>=b?d.charAt(b-1536):1774<=b&&2220>=b?"r":8192<=b&&8203>=b?"w":8204==b?"b":"L"}function b(a,c,d){this.level=a;this.from=c;this.to=d}var c="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",
d="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",f=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,g=/[stwN]/,h=/[LRr]/,n=/[Lb1n]/,m=/[1n]/;return function(c){if(!f.test(c))return!1;for(var d=c.length,q=[],s=0,t;s<d;++s)q.push(a(c.charCodeAt(s)));for(var s=0,r="L";s<d;++s)t=q[s],"m"==t?q[s]=r:r=t;s=0;for(r="L";s<
d;++s)t=q[s],"1"==t&&"r"==r?q[s]="n":h.test(t)&&(r=t,"r"==t&&(q[s]="R"));s=1;for(r=q[0];s<d-1;++s)t=q[s],"+"==t&&"1"==r&&"1"==q[s+1]?q[s]="1":","!=t||r!=q[s+1]||"1"!=r&&"n"!=r||(q[s]=r),r=t;for(s=0;s<d;++s)if(t=q[s],","==t)q[s]="N";else if("%"==t){for(r=s+1;r<d&&"%"==q[r];++r);var v=s&&"!"==q[s-1]||r<d&&"1"==q[r]?"1":"N";for(t=s;t<r;++t)q[t]=v;s=r-1}s=0;for(r="L";s<d;++s)t=q[s],"L"==r&&"1"==t?q[s]="L":h.test(t)&&(r=t);for(s=0;s<d;++s)if(g.test(q[s])){for(r=s+1;r<d&&g.test(q[r]);++r);t="L"==(r<d?q[r]:
"L");v="L"==(s?q[s-1]:"L")||t?"L":"R";for(t=s;t<r;++t)q[t]=v;s=r-1}for(var r=[],w,s=0;s<d;)if(n.test(q[s])){t=s;for(++s;s<d&&n.test(q[s]);++s);r.push(new b(0,t,s))}else{var x=s,v=r.length;for(++s;s<d&&"L"!=q[s];++s);for(t=x;t<s;)if(m.test(q[t])){x<t&&r.splice(v,0,new b(1,x,t));x=t;for(++t;t<s&&m.test(q[t]);++t);r.splice(v,0,new b(2,x,t));x=t}else++t;x<s&&r.splice(v,0,new b(1,x,s))}1==r[0].level&&(w=c.match(/^\s+/))&&(r[0].from=w[0].length,r.unshift(new b(0,0,w[0].length)));1==N(r).level&&(w=c.match(/\s+$/))&&
(N(r).to-=w[0].length,r.push(new b(0,d-w[0].length,d)));2==r[0].level&&r.unshift(new b(1,r[0].to,r[0].to));r[0].level!=N(r).level&&r.push(new b(r[0].level,d,d));return r}}();d.version="5.5.1";return d});(function(d){"object"==typeof exports&&"object"==typeof module?d(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],d):d(CodeMirror)})(function(d){d.defineMode("markdown",function(b,c){function a(a,b,c){b.f=b.inline=c;return c(a,b)}function f(a){a.linkTitle=!1;a.em=!1;a.strong=!1;a.strikethrough=!1;a.quote=0;a.indentedCode=!1;C||a.f!=m||(a.f=t,a.block=g);a.trailingSpace=0;a.trailingSpaceNewLine=
!1;a.thisLineHasContent=!1;return null}function g(f,g){var n=f.sol(),m=!1!==g.list,q=g.indentedCode;g.indentedCode=!1;m&&(0<=g.indentationDiff?(4>g.indentationDiff&&(g.indentation-=g.indentationDiff),g.list=null):0<g.indentation?(g.list=null,g.listDepth=Math.floor(g.indentation/4)):(g.list=!1,g.listDepth=0));var s=null;if(4<=g.indentationDiff)return f.skipToEnd(),q||!g.prevLineHasContent?(g.indentation-=4,g.indentedCode=!0,S):null;if(f.eatSpace())return null;if((s=f.match(pb))&&6>=s[1].length)return g.header=
s[1].length,c.highlightFormatting&&(g.formatting="header"),g.f=g.inline,r(g);if(!g.prevLineHasContent||g.quote||m||q||!(s=f.match(qb))){if(f.eat(">"))return g.quote=n?1:g.quote+1,c.highlightFormatting&&(g.formatting="quote"),f.eatSpace(),r(g);if("["===f.peek())return a(f,g,u);if(f.match(gd,!0))return g.hr=!0,Qb;if((!g.prevLineHasContent||m)&&(f.match(Ub,!1)||f.match(Vb,!1)))return n=null,f.match(Ub,!0)?n="ul":(f.match(Vb,!0),n="ol"),g.indentation+=4,g.list=!0,g.listDepth++,c.taskLists&&f.match(ob,
!1)&&(g.taskList=!0),g.f=g.inline,c.highlightFormatting&&(g.formatting=["list","list-"+n]),r(g);if(c.fencedCodeBlocks&&f.match(/^```[ \t]*([\w+#]*)/,!0))return n=RegExp.$1,d.findModeByName&&(m=d.findModeByName(n))&&(n=m.mime||m.mimes[0]),n=d.getMode(b,n),g.localMode="null"==n.name?null:n,g.localMode&&(g.localState=g.localMode.startState()),g.f=g.block=h,c.highlightFormatting&&(g.formatting="code-block"),g.code=!0,r(g)}else return g.header="="==s[0].charAt(0)?1:2,c.highlightFormatting&&(g.formatting=
"header"),g.f=g.inline,r(g);return a(f,g,g.inline)}function m(a,b){var c=H.token(a,b.htmlState);if(C&&null===b.htmlState.tagStart&&!b.htmlState.context||b.md_inside&&-1<a.current().indexOf(">"))b.f=t,b.block=g,b.htmlState=null;return c}function h(a,b){if(a.sol()&&a.match("```",!1))return b.localMode=b.localState=null,b.f=b.block=n,null;if(b.localMode)return b.localMode.token(a,b.localState);a.skipToEnd();return S}function n(a,b){a.match("```");b.block=g;b.f=t;c.highlightFormatting&&(b.formatting=
"code-block");b.code=!0;var d=r(b);b.code=!1;return d}function r(a){var b=[];if(a.formatting){b.push(ab);"string"===typeof a.formatting&&(a.formatting=[a.formatting]);for(var d=0;d<a.formatting.length;d++)b.push(ab+"-"+a.formatting[d]),"header"===a.formatting[d]&&b.push(ab+"-"+a.formatting[d]+"-"+a.header),"quote"===a.formatting[d]&&(!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push(ab+"-"+a.formatting[d]+"-"+a.quote):b.push("error"))}if(a.taskOpen)return b.push("meta"),b.length?b.join(" "):
null;if(a.taskClosed)return b.push("property"),b.length?b.join(" "):null;if(a.linkHref)return b.push(Ia),b.length?b.join(" "):null;a.strong&&b.push(Tb);a.em&&b.push(sc);a.strikethrough&&b.push(tc);a.linkText&&b.push(Sb);a.code&&b.push(S);a.header&&(b.push(E),b.push(E+"-"+a.header));a.quote&&(b.push(T),!c.maxBlockquoteDepth||c.maxBlockquoteDepth>=a.quote?b.push(T+"-"+a.quote):b.push(T+"-"+c.maxBlockquoteDepth));!1!==a.list&&((d=(a.listDepth-1)%3)?1===d?b.push(Ha):b.push(Rb):b.push(U));a.trailingSpaceNewLine?
b.push("trailing-space-new-line"):a.trailingSpace&&b.push("trailing-space-"+(a.trailingSpace%2?"a":"b"));return b.length?b.join(" "):null}function q(a,b){if(a.match(uc,!0))return r(b)}function t(a,b){var f=b.text(a,b);if("undefined"!==typeof f)return f;if(b.list)return b.list=null,r(b);if(b.taskList)return"x"!==a.match(ob,!0)[1]?b.taskOpen=!0:b.taskClosed=!0,c.highlightFormatting&&(b.formatting="task"),b.taskList=!1,r(b);b.taskOpen=!1;b.taskClosed=!1;if(b.header&&a.match(/^#+$/,!0))return c.highlightFormatting&&
(b.formatting="header"),r(b);var f=a.sol(),g=a.next();if("\\"===g&&(a.next(),c.highlightFormatting))return(f=r(b))?f+" formatting-escape":"formatting-escape";if(b.linkTitle){b.linkTitle=!1;var h=g;"("===g&&(h=")");h=(h+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");if(a.match(new RegExp("^\\s*(?:[^"+h+"\\\\]+|\\\\\\\\|\\\\.)"+h),!0))return Ia}if("`"===g){f=b.formatting;c.highlightFormatting&&(b.formatting="code");g=r(b);h=a.pos;a.eatWhile("`");h=1+a.pos-h;if(b.code){if(h===L)return b.code=!1,g;b.formatting=
f}else L=h,b.code=!0;return r(b)}if(b.code)return r(b);if("!"===g&&a.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return a.match(/\[[^\]]*\]/),b.inline=b.f=z,nb;if("["===g&&a.match(/.*\](\(.*\)| ?\[.*\])/,!1))return b.linkText=!0,c.highlightFormatting&&(b.formatting="link"),r(b);if("]"===g&&b.linkText&&a.match(/\(.*\)| ?\[.*\]/,!1))return c.highlightFormatting&&(b.formatting="link"),f=r(b),b.linkText=!1,b.inline=b.f=z,f;if("<"===g&&a.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return b.f=b.inline=x,c.highlightFormatting&&
(b.formatting="link"),f=r(b),(f?f+" ":"")+Za;if("<"===g&&a.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return b.f=b.inline=x,c.highlightFormatting&&(b.formatting="link"),f=(f=r(b))?f+" ":"",f+ed;if("<"===g&&a.match(/^\w/,!1))return-1!=a.string.indexOf(">")&&(f=a.string.substring(1,a.string.indexOf(">")),/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(f)&&(b.md_inside=!0)),a.backUp(1),b.htmlState=d.startState(H),f=m,b.f=b.block=f,f(a,b);if("<"===g&&a.match(/^\/\w*?>/))return b.md_inside=!1,"tag";h=!1;if(!c.underscoresBreakWords&&
"_"===g&&"_"!==a.peek()&&a.match(/(\w)/,!1)){var n=a.pos-2;0<=n&&(n=a.string.charAt(n),"_"!==n&&n.match(/(\w)/,!1)&&(h=!0))}if("*"===g||"_"===g&&!h){if(!f||" "!==a.peek()){if(b.strong===g&&a.eat(g))return c.highlightFormatting&&(b.formatting="strong"),g=r(b),b.strong=!1,g;if(!b.strong&&a.eat(g))return b.strong=g,c.highlightFormatting&&(b.formatting="strong"),r(b);if(b.em===g)return c.highlightFormatting&&(b.formatting="em"),g=r(b),b.em=!1,g;if(!b.em)return b.em=g,c.highlightFormatting&&(b.formatting=
"em"),r(b)}}else if(" "===g&&(a.eat("*")||a.eat("_"))){if(" "===a.peek())return r(b);a.backUp(1)}if(c.strikethrough)if("~"===g&&a.eatWhile(g)){if(b.strikethrough)return c.highlightFormatting&&(b.formatting="strikethrough"),g=r(b),b.strikethrough=!1,g;if(a.match(/^[^\s]/,!1))return b.strikethrough=!0,c.highlightFormatting&&(b.formatting="strikethrough"),r(b)}else if(" "===g&&a.match(/^~~/,!0)){if(" "===a.peek())return r(b);a.backUp(2)}" "===g&&(a.match(/ +$/,!1)?b.trailingSpace++:b.trailingSpace&&
(b.trailingSpaceNewLine=!0));return r(b)}function x(a,b){if(">"===a.next()){b.f=b.inline=t;c.highlightFormatting&&(b.formatting="link");var d=r(b);return(d?d+" ":"")+Za}a.match(/^[^>]+/,!0);return Za}function z(a,b){if(a.eatSpace())return null;var d=a.next();return"("===d||"["===d?(b.f=b.inline=v("("===d?")":"]"),c.highlightFormatting&&(b.formatting="link-string"),b.linkHref=!0,r(b)):"error"}function v(a){return function(b,d){if(b.next()===a){d.f=d.inline=t;c.highlightFormatting&&(d.formatting="link-string");
var f=r(d);d.linkHref=!1;return f}b.match(G(a),!0)&&b.backUp(1);d.linkHref=!0;return r(d)}}function u(b,d){return b.match(/^[^\]]*\]:/,!1)?(d.f=s,b.next(),c.highlightFormatting&&(d.formatting="link"),d.linkText=!0,r(d)):a(b,d,t)}function s(a,b){if(a.match(/^\]:/,!0)){b.f=b.inline=w;c.highlightFormatting&&(b.formatting="link");var d=r(b);b.linkText=!1;return d}a.match(/^[^\]]+/,!0);return Sb}function w(a,b){if(a.eatSpace())return null;a.match(/^[^\s]+/,!0);void 0===a.peek()?b.linkTitle=!0:a.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,
!0);b.f=b.inline=t;return Ia}function G(a){Qa[a]||(a=(a+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),Qa[a]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+a+")"));return Qa[a]}var C=d.modes.hasOwnProperty("xml"),H=d.getMode(b,C?{name:"xml",htmlMode:!0}:"text/plain");void 0===c.highlightFormatting&&(c.highlightFormatting=!1);void 0===c.maxBlockquoteDepth&&(c.maxBlockquoteDepth=0);void 0===c.underscoresBreakWords&&(c.underscoresBreakWords=!0);void 0===c.fencedCodeBlocks&&(c.fencedCodeBlocks=!1);void 0===c.taskLists&&
(c.taskLists=!1);void 0===c.strikethrough&&(c.strikethrough=!1);var L=0,E="header",S="comment",T="quote",U="variable-2",Ha="variable-3",Rb="keyword",Qb="hr",nb="tag",ab="formatting",Za="link",ed="link",Sb="link",Ia="string",sc="em",Tb="strong",tc="strikethrough",gd=/^([*\-_])(?:\s*\1){2,}\s*$/,Ub=/^[*\-+]\s+/,Vb=/^[0-9]+([.)])\s+/,ob=/^\[(x| )\](?=\s)/,pb=/^(#+)(?: |$)/,qb=/^ *(?:\={1,}|-{1,})\s*$/,uc=/^[^#!\[\]*_\\<>` "'(~]+/,Qa=[],bb={startState:function(){return{f:g,prevLineHasContent:!1,thisLineHasContent:!1,
block:g,htmlState:null,indentation:0,inline:t,text:q,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1}},copyState:function(a){return{f:a.f,prevLineHasContent:a.prevLineHasContent,thisLineHasContent:a.thisLineHasContent,block:a.block,htmlState:a.htmlState&&d.copyState(H,a.htmlState),indentation:a.indentation,localMode:a.localMode,localState:a.localMode?d.copyState(a.localMode,
a.localState):null,inline:a.inline,text:a.text,formatting:!1,linkTitle:a.linkTitle,em:a.em,strong:a.strong,strikethrough:a.strikethrough,header:a.header,hr:a.hr,taskList:a.taskList,list:a.list,listDepth:a.listDepth,quote:a.quote,indentedCode:a.indentedCode,trailingSpace:a.trailingSpace,trailingSpaceNewLine:a.trailingSpaceNewLine,md_inside:a.md_inside}},token:function(a,b){b.formatting=!1;if(a.sol()){var c=!!b.header||b.hr;b.header=0;b.hr=!1;if(a.match(/^\s*$/,!0)||c)return b.prevLineHasContent=!1,
f(b),c?this.token(a,b):null;b.prevLineHasContent=b.thisLineHasContent;b.thisLineHasContent=!0;b.taskList=!1;b.code=!1;b.trailingSpace=0;b.trailingSpaceNewLine=!1;b.f=b.block;var c=a.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,d=4*Math.floor((c-b.indentation)/4);4<d&&(d=4);d=b.indentation+d;b.indentationDiff=d-b.indentation;b.indentation=d;if(0<c)return null}return b.f(a,b)},innerMode:function(a){return a.block==m?{state:a.htmlState,mode:H}:a.localState?{state:a.localState,mode:a.localMode}:{state:a,
mode:bb}},blankLine:f,getType:r,fold:"markdown"};return bb},"xml");d.defineMIME("text/x-markdown","markdown")});Server=function(d){function b(b,a){this.document=b;this.operations=a||[]}b.prototype.receiveOperation=function(b,a){if(0>b||this.operations.length<b)return 1<b&&virtualclass.editorRich.requestData("from_s"),console.log("operation revision "+b+" not in history"),!1;for(var d=this.operations.slice(b),g=a.constructor.transform,m=0;m<d.length;m++)a=g(a,d[m])[0];this.document=a.apply(this.document);this.operations.push(a);return a};return b}(this);"object"===typeof module&&(module.exports=ot.Server);virtualclassAdapter=function(){function d(b,c){c=c.charAt(0).toLowerCase()+c.slice(1);var a=Vceditor.getvcEditor();if(b.operations&&b.revision>b.operations.length){var d=[];d[b.revision-b.operations.length-1]=null;this.operations=d.concat(b.operations)}else this.operations=b.operations?b.operations:[];var g=new a.Server(b.doc,this.operations);this.trigger=function(a){this.callbacks[a].apply(this,Array.prototype.slice.call(arguments,1))};this.receivedMessage=function(b){var d=b.message;if(d.hasOwnProperty("data")){var f=
JSON.parse(d.data);if(null!=f&&f.revision<virtualclass[c].cmClient.revision&&5<virtualclass[c].cmClient.revision-f.revision){console.log("should not update older revision if neweer version is available");return}}if("virtualclass-editor-operation"==d.eddata){if("EditorRich"!=virtualclass.previous&&("editorRich"==c?virtualclass.currApp="EditorRich":"editorCode"==c&&(virtualclass.currApp="EditorCode"),virtualclass.dispvirtualclassLayout(virtualclass.currApp)),d=new a.WrappedOperation(a.TextOperation.fromJSON(f.operation),
f.cursor&&a.Cursor.fromJSON(f.cursor)),f=g.receiveOperation(f.revision,d))b.fromUser.userid==virtualclass.gObj.uid?this.trigger("ack"):(this.trigger("operation",f.wrapped.toJSON()),this.trigger("cursor",b.fromUser.userid,f.meta))}else"virtualclass-editor-cursor"==d.eddata?this.trigger("cursor",b.fromUser.userid,f):"selection"==d.eddata&&(b=JSON.parse(d.data),this.trigger("selection",virtualclass.gObj.uid,b))}}d.prototype.sendOperation=function(b,c,a,d){if("undefined"!=typeof d)var g="richtext"==d?
"editorRich":"editorCode";b={eddata:"virtualclass-editor-operation",data:JSON.stringify({revision:b,operation:c,cursor:a}),et:g};io.send(b);console.log("send operation")};d.prototype.sendSelection=function(b){io.send({eddata:"selection",data:JSON.stringify(b)})};d.prototype.sendCursor=function(b){io.send({eddata:"virtualclass-editor-cursor",data:JSON.stringify(b)})};d.prototype.registerCallbacks=function(b){this.callbacks=b};return d}();(function(d,b,c){"undefined"!=typeof module&&module.exports?module.exports=b():"function"==typeof c.define&&c.define.amd?define(b):c[d]=b()})("Vceditor",function(){var d=d||{};d.utils={};d.utils.makeEventEmitter=function(a,b){a.prototype.allowedEvents_=b;a.prototype.on=function(a,b,c){this.validateEventType_(a);this.eventListeners_=this.eventListeners_||{};this.eventListeners_[a]=this.eventListeners_[a]||[];this.eventListeners_[a].push({callback:b,context:c})};a.prototype.off=function(a,b){this.validateEventType_(a);
this.eventListeners_=this.eventListeners_||{};for(var c=this.eventListeners_[a]||[],d=0;d<c.length;d++)if(c[d].callback===b){c.splice(d,1);break}};a.prototype.trigger=function(a){this.eventListeners_=this.eventListeners_||{};for(var b=this.eventListeners_[a]||[],c=0;c<b.length;c++)b[c].callback.apply(b[c].context,Array.prototype.slice.call(arguments,1))};a.prototype.validateEventType_=function(a){if(this.allowedEvents_){for(var b=!1,c=0;c<this.allowedEvents_.length;c++)if(this.allowedEvents_[c]===
a){b=!0;break}if(!b)throw Error('Unknown event "'+a+'"');}}};d.utils.elt=function(a,b,c){a=document.createElement(a);if("string"===typeof b)d.utils.setTextContent(a,b);else if(b)for(var m=0;m<b.length;++m)a.appendChild(b[m]);for(var h in c||{})a.setAttribute(h,c[h]);return a};d.utils.setTextContent=function(a,b){a.innerHTML="";a.appendChild(document.createTextNode(b))};d.utils.on=function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent&&a.attachEvent("on"+b,c)};d.utils.off=
function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d||!1):a.detachEvent&&a.detachEvent("on"+b,c)};d.utils.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};d.utils.stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0};d.utils.stopEvent=function(a){d.utils.preventDefault(a);d.utils.stopPropagation(a)};d.utils.stopEventAnd=function(a){return function(b){a(b);d.utils.stopEvent(b);return!1}};d.utils.trim=function(a){return a.replace(/^\s+/g,
"").replace(/\s+$/g,"")};d.utils.stringEndsWith=function(a,b){for(var c="string"==typeof b?[b]:b,d=0;d<c.length;d++)if(b=c[d],-1!==a.indexOf(b,a.length-b.length))return!0;return!1};d.utils.assert=function(a,b){if(!a)throw Error(b||"assertion error");};d.utils.log=function(){if("undefined"!==typeof console&&"undefined"!==typeof console.log){for(var a=["Vceditor:"],b=0;b<arguments.length;b++)a.push(arguments[b]);console.log.apply(console,a)}};d=d||{};d.Span=function(){function a(a,b){this.pos=a;this.length=
b}a.prototype.end=function(){return this.pos+this.length};return a}();d=d||{};d.TextOp=function(){function a(a,c,d){this.type=a;this.attributes=this.text=this.chars=null;"insert"===a?(this.text=c,b.assert("string"===typeof this.text),this.attributes=d||{},b.assert("object"===typeof this.attributes)):"delete"===a?(this.chars=c,b.assert("number"===typeof this.chars)):"retain"===a&&(this.chars=c,b.assert("number"===typeof this.chars),this.attributes=d||{},b.assert("object"===typeof this.attributes))}
var b=d.utils;a.prototype.isInsert=function(){return"insert"===this.type};a.prototype.isDelete=function(){return"delete"===this.type};a.prototype.isRetain=function(){return"retain"===this.type};a.prototype.equals=function(a){return this.type===a.type&&this.text===a.text&&this.chars===a.chars&&this.attributesEqual(a.attributes)};a.prototype.attributesEqual=function(a){for(var b in this.attributes)if(this.attributes[b]!==a[b])return!1;for(b in a)if(this.attributes[b]!==a[b])return!1;return!0};a.prototype.hasEmptyAttributes=
function(){var a=!0,b;for(b in this.attributes){a=!1;break}return a};return a}();d=d||{};d.TextOperation=function(){function a(){if(!this||this.constructor!==a)return new a;this.ops=[];this.targetLength=this.baseLength=0}function b(a){a=a.ops;switch(a.length){case 1:return a[0];case 2:return a[0].isRetain()?a[1]:a[1].isRetain()?a[0]:null;case 3:if(a[0].isRetain()&&a[2].isRetain())return a[1]}return null}function c(a){return a.ops[0].isRetain()?a.ops[0].chars:0}var m=d.TextOp,h=d.utils;a.prototype.equals=
function(a){if(this.baseLength!==a.baseLength||this.targetLength!==a.targetLength||this.ops.length!==a.ops.length)return!1;for(var b=0;b<this.ops.length;b++)if(!this.ops[b].equals(a.ops[b]))return!1;return!0};a.prototype.retain=function(a,b){if("number"!==typeof a||0>a)throw Error("retain expects a positive integer.");if(0===a)return this;this.baseLength+=a;this.targetLength+=a;b=b||{};var c=0<this.ops.length?this.ops[this.ops.length-1]:null;c&&c.isRetain()&&c.attributesEqual(b)?c.chars+=a:this.ops.push(new m("retain",
a,b));return this};a.prototype.insert=function(a,b){if("string"!==typeof a)throw Error("insert expects a string");if(""===a)return this;b=b||{};this.targetLength+=a.length;var c=0<this.ops.length?this.ops[this.ops.length-1]:null,d=1<this.ops.length?this.ops[this.ops.length-2]:null;c&&c.isInsert()&&c.attributesEqual(b)?c.text+=a:c&&c.isDelete()?d&&d.isInsert()&&d.attributesEqual(b)?d.text+=a:(this.ops[this.ops.length-1]=new m("insert",a,b),this.ops.push(c)):this.ops.push(new m("insert",a,b));return this};
a.prototype["delete"]=function(a){"string"===typeof a&&(a=a.length);if("number"!==typeof a||0>a)throw Error("delete expects a positive integer or a string");if(0===a)return this;this.baseLength+=a;var b=0<this.ops.length?this.ops[this.ops.length-1]:null;b&&b.isDelete()?b.chars+=a:this.ops.push(new m("delete",a));return this};a.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()};a.prototype.clone=function(){for(var b=
new a,c=0;c<this.ops.length;c++)if(this.ops[c].isRetain())b.retain(this.ops[c].chars,this.ops[c].attributes);else if(this.ops[c].isInsert())b.insert(this.ops[c].text,this.ops[c].attributes);else b["delete"](this.ops[c].chars);return b};a.prototype.toString=function(){return(Array.prototype.map||function(a){for(var b=[],c=0,d=this.length;c<d;c++)b[c]=a(this[c]);return b}).call(this.ops,function(a){return a.isRetain()?"retain "+a.chars:a.isInsert()?"insert '"+a.text+"'":"delete "+a.chars}).join(", ")};
a.prototype.toJSON=function(){for(var a=[],b=0;b<this.ops.length;b++)this.ops[b].hasEmptyAttributes()||a.push(this.ops[b].attributes),"retain"===this.ops[b].type?a.push(this.ops[b].chars):"insert"===this.ops[b].type?a.push(this.ops[b].text):"delete"===this.ops[b].type&&a.push(-this.ops[b].chars);0===a.length&&a.push(0);return a};a.fromJSON=function(b){for(var c=new a,d=0,f=b.length;d<f;d++){var g=b[d],m={};"object"===typeof g&&(m=g,d++,g=b[d]);if("number"===typeof g)if(0<g)c.retain(g,m);else c["delete"](-g);
else h.assert("string"===typeof g),c.insert(g,m)}return c};a.prototype.apply=function(a,b,c){b=b||[];c=c||[];if(a.length!==this.baseLength)throw Error("The operation's base length must be equal to the string's length.");for(var d=[],f=0,g,m,u=0,s=this.ops,w=0,G=s.length;w<G;w++){var C=s[w];if(C.isRetain()){if(u+C.chars>a.length)throw Error("Operation can't retain more characters than are left in the string.");d[f++]=a.slice(u,u+C.chars);for(g=0;g<C.chars;g++){var H=b[u+g]||{},L={};for(m in H)L[m]=
H[m],h.assert(!1!==L[m]);for(m in C.attributes)!1===C.attributes[m]?delete L[m]:L[m]=C.attributes[m],h.assert(!1!==L[m]);c.push(L)}u+=C.chars}else if(C.isInsert())for(d[f++]=C.text,g=0;g<C.text.length;g++){H={};for(m in C.attributes)H[m]=C.attributes[m],h.assert(!1!==H[m]);c.push(H)}else u+=C.chars}if(u!==a.length)throw Error("The operation didn't operate on the whole string.");a=d.join("");h.assert(a.length===c.length);return a};a.prototype.invert=function(b){for(var c=0,d=new a,f=this.ops,g=0,h=
f.length;g<h;g++){var m=f[g];if(m.isRetain())d.retain(m.chars),c+=m.chars;else if(m.isInsert())d["delete"](m.text.length);else d.insert(b.slice(c,c+m.chars)),c+=m.chars}return d};a.prototype.compose=function(b){function c(a,b,d){var f={},g;for(g in a)f[g]=a[g];for(g in b)d&&!1===b[g]?delete f[g]:f[g]=b[g];return f}if(this.targetLength!==b.baseLength)throw Error("The base length of the second operation has to be the target length of the first operation");var d=new a,f=this.clone().ops;b=b.clone().ops;
for(var g=0,h=0,m=f[g++],u=b[h++],s;"undefined"!==typeof m||"undefined"!==typeof u;)if(m&&m.isDelete())d["delete"](m.chars),m=f[g++];else if(u&&u.isInsert())d.insert(u.text,u.attributes),u=b[h++];else{if("undefined"===typeof m)throw Error("Cannot compose operations: first operation is too short.");if("undefined"===typeof u)throw Error("Cannot compose operations: first operation is too long.");if(m.isRetain()&&u.isRetain())s=c(m.attributes,u.attributes),m.chars>u.chars?(d.retain(u.chars,s),m.chars-=
u.chars,u=b[h++]):m.chars===u.chars?(d.retain(m.chars,s),m=f[g++],u=b[h++]):(d.retain(m.chars,s),u.chars-=m.chars,m=f[g++]);else if(m.isInsert()&&u.isDelete())m.text.length>u.chars?(m.text=m.text.slice(u.chars),u=b[h++]):m.text.length===u.chars?(m=f[g++],u=b[h++]):(u.chars-=m.text.length,m=f[g++]);else if(m.isInsert()&&u.isRetain())s=c(m.attributes,u.attributes,!0),m.text.length>u.chars?(d.insert(m.text.slice(0,u.chars),s),m.text=m.text.slice(u.chars),u=b[h++]):m.text.length===u.chars?(d.insert(m.text,
s),m=f[g++],u=b[h++]):(d.insert(m.text,s),u.chars-=m.text.length,m=f[g++]);else if(m.isRetain()&&u.isDelete())m.chars>u.chars?(d["delete"](u.chars),m.chars-=u.chars,u=b[h++]):m.chars===u.chars?(d["delete"](u.chars),m=f[g++],u=b[h++]):(d["delete"](m.chars),u.chars-=m.chars,m=f[g++]);else throw Error("This shouldn't happen: op1: "+JSON.stringify(m)+", op2: "+JSON.stringify(u));}return d};a.prototype.shouldBeComposedWith=function(a){if(this.isNoop()||a.isNoop())return!0;var d=c(this),h=c(a),m=b(this);
a=b(a);return m&&a?m.isInsert()&&a.isInsert()?d+m.text.length===h:m.isDelete()&&a.isDelete()?h+a.chars===d||d===h:!1:!1};a.prototype.shouldBeComposedWithInverted=function(a){if(this.isNoop()||a.isNoop())return!0;var d=c(this),h=c(a),m=b(this);a=b(a);return m&&a?m.isInsert()&&a.isInsert()?d+m.text.length===h||d===h:m.isDelete()&&a.isDelete()?h+a.chars===d:!1:!1};a.transformAttributes=function(a,b){var c={},d={},f,g={};for(f in a)g[f]=!0;for(f in b)g[f]=!0;for(f in g){var g=a[f],m=b[f];h.assert(null!=
g||null!=m);null==g?d[f]=m:null==m?c[f]=g:g!==m&&(c[f]=g)}return[c,d]};a.transform=function(b,c){if(b.baseLength!==c.baseLength)throw Error("Both operations have to have the same base length");for(var d=new a,f=new a,g=b.clone().ops,h=c.clone().ops,m=0,u=0,s=g[m++],w=h[u++];"undefined"!==typeof s||"undefined"!==typeof w;)if(s&&s.isInsert())d.insert(s.text,s.attributes),f.retain(s.text.length),s=g[m++];else if(w&&w.isInsert())d.retain(w.text.length),f.insert(w.text,w.attributes),w=h[u++];else{if("undefined"===
typeof s)throw Error("Cannot transform operations: first operation is too short.");if("undefined"===typeof w)throw Error("Cannot transform operations: first operation is too long.");var G;if(s.isRetain()&&w.isRetain()){var C=a.transformAttributes(s.attributes,w.attributes);s.chars>w.chars?(G=w.chars,s.chars-=w.chars,w=h[u++]):s.chars===w.chars?(G=w.chars,s=g[m++],w=h[u++]):(G=s.chars,w.chars-=s.chars,s=g[m++]);d.retain(G,C[0]);f.retain(G,C[1])}else if(s.isDelete()&&w.isDelete())s.chars>w.chars?(s.chars-=
w.chars,w=h[u++]):s.chars===w.chars?(s=g[m++],w=h[u++]):(w.chars-=s.chars,s=g[m++]);else if(s.isDelete()&&w.isRetain())s.chars>w.chars?(G=w.chars,s.chars-=w.chars,w=h[u++]):s.chars===w.chars?(G=w.chars,s=g[m++],w=h[u++]):(G=s.chars,w.chars-=s.chars,s=g[m++]),d["delete"](G);else if(s.isRetain()&&w.isDelete())s.chars>w.chars?(G=w.chars,s.chars-=w.chars,w=h[u++]):s.chars===w.chars?(G=s.chars,s=g[m++],w=h[u++]):(G=s.chars,w.chars-=s.chars,s=g[m++]),f["delete"](G);else throw Error("The two operations aren't compatible");
}return[d,f]};return a}();"object"===typeof module&&(module.exports=d.TextOperation);d=d||{};d.AnnotationList=function(){function a(a,b){if(!a)throw Error("AnnotationList assertion failed"+(b?": "+b:""));}function b(a,c){this.pos=a;this.length=c.length;this.annotation=c.annotation;this.attachedObject_=c.attachedObject}function c(a,b){this.pos=a;this.length=b.length;this.annotation=b.annotation;this.node_=b}function m(a){this.head_=new h(0,r);this.changeHandler_=a}function h(a,b){this.length=a;this.annotation=
b;this.next=this.attachedObject=null}var n=d.Span;b.prototype.getAttachedObject=function(){return this.attachedObject_};c.prototype.attachObject=function(a){this.node_.attachedObject=a};var r={equals:function(){return!1}};m.prototype.insertAnnotatedSpan=function(b,c){this.wrapOperation_(new n(b.pos,0),function(d,f){a(!f||null===f.next);var g=new h(b.length,c);if(f){a(b.pos>d&&b.pos<d+f.length);var m=new h(0,r);m.next=new h(b.pos-d,f.annotation);m.next.next=g;g.next=new h(d+f.length-b.pos,f.annotation);
return m.next}return g})};m.prototype.removeSpan=function(b){0!==b.length&&this.wrapOperation_(b,function(c,d){a(null!==d);var f=new h(0,r),g=f;b.pos>c&&(g.next=new h(b.pos-c,d.annotation),g=g.next);for(;b.end()>c+d.length;)c+=d.length,d=d.next;var m=c+d.length-b.end();0<m&&(g.next=new h(m,d.annotation));return f.next})};m.prototype.updateSpan=function(b,c){0!==b.length&&this.wrapOperation_(b,function(d,f){a(null!==f);var g=new h(0,r),m=g,n=d,w=b.pos-n;a(w<f.length);0<w&&(m.next=new h(w,f.annotation),
m=m.next,n+=m.length);for(;null!==f&&b.end()>=d+f.length;)n=d+f.length-n,m.next=new h(n,c(f.annotation,n)),m=m.next,d+=f.length,f=f.next,n=d;w=b.end()-n;0<w&&(a(w<f.length),m.next=new h(w,c(f.annotation,w)),m=m.next,n+=m.length,m.next=new h(d+f.length-n,f.annotation));return g.next})};m.prototype.wrapOperation_=function(a,d){if(0>a.pos)throw Error("Span start cannot be negative.");var m=[],n=[],r=this.getAffectedNodes_(a),u;null!==r.start?(u=r.end.next,r.end.next=null):u=r.succ;var s=d(r.startPos,
r.start),w=!1,G=!1;if(s){this.mergeNodesWithSameAnnotations_(s);var C;r.pred&&r.pred.annotation.equals(s.annotation)?(w=!0,s.length+=r.pred.length,r.beforePred.next=s,C=r.predPos):(r.beforeStart.next=s,C=r.startPos);for(;s.next;)n.push(new c(C,s)),C+=s.length,s=s.next;r.succ&&r.succ.annotation.equals(s.annotation)?(s.length+=r.succ.length,G=!0,s.next=r.succ.next):s.next=u;n.push(new c(C,s))}else r.pred&&r.succ&&r.pred.annotation.equals(r.succ.annotation)?(G=w=!0,s=new h(r.pred.length+r.succ.length,
r.pred.annotation),r.beforePred.next=s,s.next=r.succ.next,n.push(new c(r.startPos-r.pred.length,s))):r.beforeStart.next=u;w&&m.push(new b(r.predPos,r.pred));u=r.startPos;for(s=r.start;null!==s;)m.push(new b(u,s)),u+=s.length,s=s.next;G&&m.push(new b(u,r.succ));this.changeHandler_(m,n)};m.prototype.getAffectedNodes_=function(a){for(var b={},c=null,d=this.head_,f=d.next,g=0;null!==f&&a.pos>=g+f.length;)g+=f.length,c=d,d=f,f=f.next;if(null===f&&(0!==a.length||a.pos!==g))throw Error("Span start exceeds the bounds of the AnnotationList.");
b.startPos=g;b.start=0===a.length&&a.pos===g?null:f;b.beforeStart=d;g===a.pos&&0<g?(b.pred=d,b.predPos=g-d.length,b.beforePred=c):b.pred=null;for(;null!==f&&a.end()>g;)g+=f.length,d=f,f=f.next;if(a.end()>g)throw Error("Span end exceeds the bounds of the AnnotationList.");0===a.length&&a.end()===g?b.end=null:b.end=d;b.succ=g===a.end()?f:null;return b};m.prototype.mergeNodesWithSameAnnotations_=function(a){if(a)for(var b=null;a;)b&&b.annotation.equals(a.annotation)?(b.length+=a.length,b.next=a.next):
b=a,a=a.next};m.prototype.forEach=function(a){for(var b=this.head_.next;null!==b;)a(b.length,b.annotation,b.attachedObject),b=b.next};m.prototype.getAnnotatedSpansForPos=function(a){for(var c=0,d=this.head_.next,g=null;null!==d&&c+d.length<=a;)c+=d.length,g=d,d=d.next;if(null===d&&c!==a)throw Error("pos exceeds the bounds of the AnnotationList");var h=[];c===a&&g&&h.push(new b(c-g.length,g));d&&h.push(new b(c,d));return h};m.prototype.getAnnotatedSpansForSpan=function(a){if(0===a.length)return[];
for(var b=[],c=this.getAffectedNodes_(a),d=c.startPos,c=c.start;null!==c&&d<a.end();){var f=Math.max(d,a.pos),g=Math.min(d+c.length,a.end()),f=new n(f,g-f);f.annotation=c.annotation;b.push(f);d+=c.length;c=c.next}return b};m.prototype.count=function(){for(var b=0,c=this.head_.next,d=null;null!==c;)d&&a(!d.annotation.equals(c.annotation)),d=c,c=c.next,b++;return b};h.prototype.clone=function(){var a=new h(this.spanLength,this.annotation);a.next=this.next;return a};return m}();d=d||{};d.Cursor=function(){function a(a,
b){this.position=a;this.selectionEnd=b}a.fromJSON=function(b){return new a(b.position,b.selectionEnd)};a.prototype.equals=function(a){return this.position===a.position&&this.selectionEnd===a.selectionEnd};a.prototype.compose=function(a){return a};a.prototype.transform=function(b){function c(a){for(var d=a,g=b.ops,m=0,t=b.ops.length;m<t&&!(g[m].isRetain()?a-=g[m].chars:g[m].isInsert()?d+=g[m].text.length:(d-=Math.min(a,g[m].chars),a-=g[m].chars),0>a);m++);return d}var d=c(this.position);return this.position===
this.selectionEnd?new a(d,d):new a(d,c(this.selectionEnd))};return a}();d=d=d||{};d.RichTextToolbar=function(a){function b(a){this.imageInsertionUI=a;this.element_=this.makeElement_()}var c=d.utils;c.makeEventEmitter(b,"bold italic underline strike font font-size color left center right unordered-list ordered-list todo-list indent-increase indent-decrease undo redo insert-image".split(" "));b.prototype.element=function(){return this.element_};b.prototype.makeButton_=function(a,b){var d=this,f=c.elt("a",
[c.elt("span","",{"class":"vceditor-tb-"+(b||a)})],{"class":"vceditor-btn"});c.on(f,"click",c.stopEventAnd(function(){d.trigger(a)}));return f};b.prototype.makeElement_=function(){var a=this.makeFontDropdown_(),b=this.makeFontSizeDropdown_(),d=this.makeColorDropdown_(),a=[c.elt("div",[a],{"class":"vceditor-btn-group"}),c.elt("div",[b],{"class":"vceditor-btn-group"}),c.elt("div",[d],{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("bold"),this.makeButton_("italic"),this.makeButton_("underline"),
this.makeButton_("strike","strikethrough")],{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("unordered-list","list-2"),this.makeButton_("ordered-list","numbered-list"),this.makeButton_("todo-list","list")],{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("indent-decrease"),this.makeButton_("indent-increase")],{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("left","paragraph-left"),this.makeButton_("center","paragraph-center"),this.makeButton_("right","paragraph-right")],
{"class":"vceditor-btn-group"}),c.elt("div",[this.makeButton_("undo"),this.makeButton_("redo")],{"class":"vceditor-btn-group"})];this.imageInsertionUI&&a.push(c.elt("div",[this.makeButton_("insert-image")],{"class":"vceditor-btn-group"}));a=c.elt("div",a,{"class":"vceditor-toolbar-wrapper"});b=c.elt("div",null,{"class":"vceditor-toolbar"});b.appendChild(a);return b};b.prototype.makeFontDropdown_=function(){for(var a="Arial;Comic Sans MS;Courier New;Impact;Times New Roman;Verdana".split(";"),b=[],
d=0;d<a.length;d++){var f=c.elt("span",a[d]);f.setAttribute("style","font-family:"+a[d]);b.push({content:f,value:a[d]})}return this.makeDropdown_("Font","font",b)};b.prototype.makeFontSizeDropdown_=function(){for(var a=[9,10,12,14,18,24,32,42],b=[],d=0;d<a.length;d++){var f=c.elt("span",a[d].toString());f.setAttribute("style","font-size:"+a[d]+"px; line-height:"+(a[d]-6)+"px;");b.push({content:f,value:a[d]})}return this.makeDropdown_("Size","font-size",b,"px")};b.prototype.makeColorDropdown_=function(){for(var a=
"black red green blue yellow cyan magenta grey".split(" "),b=[],d=0;d<a.length;d++){var f=c.elt("div");f.className="vceditor-color-dropdown-item";f.setAttribute("style","background-color:"+a[d]);b.push({content:f,value:a[d]})}return this.makeDropdown_("Color","color",b)};b.prototype.makeDropdown_=function(a,b,d,f){function q(){v&&(z.style.display="",c.off(document,"click",q,!0),v=!1);u=!0;setTimeout(function(){u=!1},0)}function t(a,d){"object"!==typeof a&&(a=document.createTextNode(String(a)));var m=
c.elt("a",[a]);c.on(m,"click",c.stopEventAnd(function(){q();x.trigger(b,d+f)}));z.appendChild(m)}f=f||"";var x=this;a=c.elt("a",a+" \u25be",{"class":"vceditor-btn vceditor-dropdown"});var z=c.elt("ul",[],{"class":"vceditor-dropdown-menu"});a.appendChild(z);for(var v=!1,u=!1,s=0;s<d.length;s++)t(d[s].content,d[s].value);c.on(a,"click",c.stopEventAnd(function(){u||v||(z.style.display="block",c.on(document,"click",q,!0),v=!0)}));return a};return b}();d=d||{};d.WrappedOperation=function(a){function b(a,
c){this.wrapped=a;this.meta=c}function c(a,b){for(var d in a)a.hasOwnProperty(d)&&(b[d]=a[d])}function d(a,b){return a&&"object"===typeof a&&"function"===typeof a.transform?a.transform(b):a}b.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)};b.prototype.invert=function(){var a=this.meta;return new b(this.wrapped.invert.apply(this.wrapped,arguments),a&&"object"===typeof a&&"function"===typeof a.invert?a.invert.apply(a,arguments):a)};b.prototype.compose=function(a){var d=
this.wrapped.compose(a.wrapped),m;m=this.meta;a=a.meta;if(m&&"object"===typeof m)if("function"===typeof m.compose)m=m.compose(a);else{var q={};c(m,q);c(a,q);m=q}else m=a;return new b(d,m)};b.transform=function(a,c){var g=a.wrapped.constructor.transform,g=g(a.wrapped,c.wrapped);return[new b(g[0],d(a.meta,c.wrapped)),new b(g[1],d(c.meta,a.wrapped))]};return b}();d=d||{};d.UndoManager=function(){function a(a){this.maxItems=a||50;this.state=c;this.dontCompose=!1;this.undoStack=[];this.redoStack=[]}function b(a,
c){for(var d=[],f=c.constructor,g=a.length-1;0<=g;g--){var t=f.transform(a[g],c);"function"===typeof t[0].isNoop&&t[0].isNoop()||d.push(t[0]);c=t[1]}return d.reverse()}var c="normal";a.prototype.add=function(a,b){if("undoing"===this.state)this.redoStack.push(a),this.dontCompose=!0;else if("redoing"===this.state)this.undoStack.push(a),this.dontCompose=!0;else{var c=this.undoStack;!this.dontCompose&&b&&0<c.length?c.push(a.compose(c.pop())):(c.push(a),c.length>this.maxItems&&c.shift());this.dontCompose=
!1;this.redoStack=[]}};a.prototype.transform=function(a){this.undoStack=b(this.undoStack,a);this.redoStack=b(this.redoStack,a)};a.prototype.performUndo=function(a){this.state="undoing";if(0===this.undoStack.length)throw Error("undo not possible");a(this.undoStack.pop());this.state=c};a.prototype.performRedo=function(a){this.state="redoing";if(0===this.redoStack.length)throw Error("redo not possible");a(this.redoStack.pop());this.state=c};a.prototype.canUndo=function(){return 0!==this.undoStack.length};
a.prototype.canRedo=function(){return 0!==this.redoStack.length};a.prototype.isUndoing=function(){return"undoing"===this.state};a.prototype.isRedoing=function(){return"redoing"===this.state};return a}();d=d||{};d.Client=function(){function a(a){this.revision=a;this.state=h}function b(){}function c(a){this.outstanding=a}function d(a,b){this.outstanding=a;this.buffer=b}a.prototype.setState=function(a){this.state=a};a.prototype.applyClient=function(a){this.setState(this.state.applyClient(this,a))};a.prototype.applyServer=
function(a){this.revision++;this.setState(this.state.applyServer(this,a))};a.prototype.serverAck=function(){this.revision++;this.setState(this.state.serverAck(this))};a.prototype.serverRetry=function(){this.setState(this.state.serverRetry(this))};a.prototype.transformCursor=function(a){return this.state.transformCursor(a)};a.prototype.sendOperation=function(a){throw Error("sendOperation must be defined in child class");};a.prototype.applyOperation=function(a){throw Error("applyOperation must be defined in child class");
};a.Synchronized=b;b.prototype.applyClient=function(a,b){a.sendOperation(a.revision,b);return new c(b)};b.prototype.applyServer=function(a,b){a.applyOperation(b);return this};b.prototype.transformCursor=function(a){return a};b.prototype.serverAck=function(a){throw Error("There is no pending operation.");};b.prototype.serverRetry=function(a){throw Error("There is no pending operation.");};var h=new b;a.AwaitingConfirm=c;c.prototype.applyClient=function(a,b){return new d(this.outstanding,b)};c.prototype.applyServer=
function(a,b){var d=b.constructor.transform(this.outstanding,b);a.applyOperation(d[1]);return new c(d[0])};c.prototype.serverAck=function(a){return h};c.prototype.serverRetry=function(a){a.sendOperation(this.outstanding);return this};c.prototype.transformCursor=function(a){return a.transform(this.outstanding)};a.AwaitingWithBuffer=d;d.prototype.applyClient=function(a,b){var c=this.buffer.compose(b);return new d(this.outstanding,c)};d.prototype.applyServer=function(a,b){var c=b.constructor.transform,
f=c(this.outstanding,b),c=c(this.buffer,f[1]);a.applyOperation(c[1]);return new d(f[0],c[0])};d.prototype.serverRetry=function(a){var b=this.outstanding.compose(this.buffer);a.sendOperation(b);return new c(b)};d.prototype.serverAck=function(a){a.sendOperation(a.revision,this.buffer);return new c(this.buffer)};d.prototype.transformCursor=function(a){return a.transform(this.outstanding).transform(this.buffer)};return a}();d=d||{};d.EditorClient=function(){function a(a,b){this.cursorBefore=a;this.cursorAfter=
b}function b(a,c){this.id=a;this.editorAdapter=c;this.li=document.createElement("li")}function c(a,b,d,f){h.call(this,a);this.serverAdapter=d;this.editorAdapter=f;this.undoManager=new r;this.clients={};var g=this;this.editorAdapter.registerCallbacks({change:function(a,b){g.onChange(a,b)},cursorActivity:function(){g.onCursorActivity()},blur:function(){g.onBlur()},focus:function(){g.onFocus()}});this.editorAdapter.registerUndo(function(){g.undo()});this.editorAdapter.registerRedo(function(){g.redo()});
this.serverAdapter.registerCallbacks({client_left:function(a){g.onClientLeft(a)},set_name:function(a,b){g.getClientObject(a).setName(b)},ack:function(){g.serverAck()},operation:function(a){g.applyServer(q.fromJSON(a))},cursor:function(a,b){b?g.getClientObject(a).updateCursor(g.transformCursor(n.fromJSON(b))):g.getClientObject(a).removeCursor()},clients:function(a){for(var b in g.clients)if(g.clients.hasOwnProperty(b)&&!a.hasOwnProperty(b))g.onClientLeft(b);for(b in a)if(a.hasOwnProperty(b)){var c=
g.getClientObject(b);a[b].name&&c.setName(a[b].name);(c=a[b].selection)?g.clients[b].updateSelection(g.transformSelection(Selection.fromJSON(c))):g.clients[b].removeSelection()}},reconnect:function(){g.serverReconnect()}})}function m(a){return a[a.length-1]}var h=d.Client,n=d.Cursor,r=d.UndoManager,q=d.TextOperation,t=d.WrappedOperation;a.prototype.invert=function(){return new a(this.cursorAfter,this.cursorBefore)};a.prototype.compose=function(b){return new a(this.cursorBefore,b.cursorAfter)};a.prototype.transform=
function(b){return new a(this.cursorBefore?this.cursorBefore.transform(b):null,this.cursorAfter?this.cursorAfter.transform(b):null)};b.prototype.setColor=function(a){this.color=a};b.prototype.updateCursor=function(a){this.color="#86BA7D";this.removeCursor();this.cursor=a;this.mark=this.editorAdapter.setOtherCursor(a,this.color,this.id)};b.prototype.removeCursor=function(){this.mark&&this.mark.clear()};(function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a})(c,
h);c.prototype.getClientObject=function(a){var c=this.clients[a];return c?c:this.clients[a]=new b(a,this.editorAdapter)};c.prototype.applyUnredo=function(a){this.undoManager.add(this.editorAdapter.invertOperation(a));this.editorAdapter.applyOperation(a.wrapped);(this.cursor=a.meta.cursorAfter)&&this.editorAdapter.setCursor(this.cursor);this.applyClient(a.wrapped)};c.prototype.undo=function(){var a=this;this.undoManager.canUndo()&&this.undoManager.performUndo(function(b){a.applyUnredo(b)})};c.prototype.redo=
function(){var a=this;this.undoManager.canRedo()&&this.undoManager.performRedo(function(b){a.applyUnredo(b)})};c.prototype.onChange=function(b,c){var d=this.cursor;this.updateCursor();var f=0<this.undoManager.undoStack.length&&c.shouldBeComposedWithInverted(m(this.undoManager.undoStack).wrapped),d=new a(this.cursor,d);this.undoManager.add(new t(c,d),f);this.applyClient(b)};c.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()};c.prototype.onCursorActivity=function(){var a=
this.cursor;this.updateCursor();!this.focused||a&&this.cursor.equals(a)||this.sendCursor(this.cursor)};c.prototype.onBlur=function(){this.cursor=null;this.sendCursor(null);this.focused=!1};c.prototype.onFocus=function(){this.focused=!0;this.onCursorActivity()};c.prototype.sendCursor=function(a){this.state instanceof h.AwaitingWithBuffer||this.serverAdapter.sendCursor(a)};c.prototype.sendOperation=function(a,b){this.serverAdapter.sendOperation(a,b.toJSON(),this.cursor,this.editorAdapter.cm.options.keyMap)};
c.prototype.applyOperation=function(a){this.editorAdapter.applyOperation(a);this.updateCursor();this.undoManager.transform(new t(a,null))};c.prototype.emitStatus=function(){var a=this;setTimeout(function(){a.trigger("synced",a.state instanceof h.Synchronized)},0)};return c}();d.utils.makeEventEmitter(d.EditorClient,["synced"]);var b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].slice;if("undefined"===typeof d||null===d)d={};d.ACEAdapter=function(){function a(a){this.onCursorActivity=
b(this.onCursorActivity,this);this.onFocus=b(this.onFocus,this);this.onBlur=b(this.onBlur,this);this.onChange=b(this.onChange,this);var c;this.ace=a;this.aceSession=this.ace.getSession();this.aceDoc=this.aceSession.getDocument();this.aceDoc.setNewLineMode("unix");this.grabDocumentState();this.ace.on("change",this.onChange);this.ace.on("blur",this.onBlur);this.ace.on("focus",this.onFocus);this.aceSession.selection.on("changeCursor",this.onCursorActivity);null==this.aceRange&&(this.aceRange=(null!=
(c=ace.require)?c:require)("ace/range").Range)}a.prototype.ignoreChanges=!1;a.prototype.grabDocumentState=function(){this.lastDocLines=this.aceDoc.getAllLines();return this.lastCursorRange=this.aceSession.selection.getRange()};a.prototype.detach=function(){this.ace.removeListener("change",this.onChange);this.ace.removeListener("blur",this.onBlur);this.ace.removeListener("focus",this.onCursorActivity);return this.aceSession.selection.removeListener("changeCursor",this.onCursorActivity)};a.prototype.onChange=
function(a){if(!this.ignoreChanges)return a=this.operationFromACEChange(a),this.trigger.apply(this,["change"].concat(c.call(a))),this.grabDocumentState()};a.prototype.onBlur=function(){if(this.ace.selection.isEmpty())return this.trigger("blur")};a.prototype.onFocus=function(){return this.trigger("focus")};a.prototype.onCursorActivity=function(){var a=this;return setTimeout(function(){return a.trigger("cursorActivity")},0)};a.prototype.operationFromACEChange=function(a){var b,c,h,n;a=a.data;"insertLines"===
(b=a.action)||"removeLines"===b?(c=a.lines.join("\n")+"\n",b=a.action.replace("Lines","")):(c=a.text.replace(this.aceDoc.getNewLineCharacter(),"\n"),b=a.action.replace("Text",""));n=this.indexFromPos(a.range.start);h=this.lastDocLines.join("\n").length-n;"remove"===b&&(h-=c.length);a=(new d.TextOperation).retain(n).insert(c).retain(h);c=(new d.TextOperation).retain(n)["delete"](c).retain(h);"remove"===b&&(b=[c,a],a=b[0],c=b[1]);return[a,c]};a.prototype.applyOperationToACE=function(a){var b,c,d,n,
r;c=0;r=a.ops;a=0;for(n=r.length;a<n;a++)d=r[a],d.isRetain()?c+=d.chars:d.isInsert()?(this.aceDoc.insert(this.posFromIndex(c),d.text),c+=d.text.length):d.isDelete()&&(b=this.posFromIndex(c),d=this.posFromIndex(c+d.chars),b=this.aceRange.fromPoints(b,d),this.aceDoc.remove(b));return this.grabDocumentState()};a.prototype.posFromIndex=function(a){var b,c,d,n,r;r=this.aceDoc.$lines;c=d=0;for(n=r.length;d<n;c=++d){b=r[c];if(a<=b.length)break;a-=b.length+1}return{row:c,column:a}};a.prototype.indexFromPos=
function(a,b){var c,d,n,r;c=n=d=0;for(r=a.row;0<=r?n<r:n>r;c=0<=r?++n:--n)d+=this.lastDocLines[c].length+1;return d+a.column};a.prototype.getValue=function(){return this.aceDoc.getValue()};a.prototype.getCursor=function(){var a,b;try{b=this.indexFromPos(this.aceSession.selection.getRange().start,this.aceDoc.$lines),a=this.indexFromPos(this.aceSession.selection.getRange().end,this.aceDoc.$lines)}catch(c){try{b=this.indexFromPos(this.lastCursorRange.start),a=this.indexFromPos(this.lastCursorRange.end)}catch(h){console.log("Couldn't figure out the cursor range:",
h,"-- setting it to 0:0."),a=[0,0],b=a[0],a=a[1]}}b>a&&(a=[a,b],b=a[0],a=a[1]);return new d.Cursor(b,a)};a.prototype.setCursor=function(a){var b,c;c=this.posFromIndex(a.position);b=this.posFromIndex(a.selectionEnd);a.position>a.selectionEnd&&(a=[b,c],c=a[0],b=a[1]);return this.aceSession.selection.setSelectionRange(new this.aceRange(c.row,c.column,b.row,b.column))};a.prototype.setOtherCursor=function(a,b,c){var d,n,r,q,t,x=this;null==this.otherCursors&&(this.otherCursors={});if(n=this.otherCursors[c])n.start.detach(),
n.end.detach(),this.aceSession.removeMarker(n.id);t=this.posFromIndex(a.position);r=this.posFromIndex(a.selectionEnd);a.selectionEnd<a.position&&(d=[r,t],t=d[0],r=d[1]);d="other-client-selection-"+b.replace("#","");(a=a.position===a.selectionEnd)&&(d=d.replace("selection","cursor"));this.addStyleRule("."+d+" {\n  position: absolute;\n  background-color: "+(a?"transparent":b)+";\n  border-left: 2px solid "+b+";\n}");this.otherCursors[c]=n=new this.aceRange(t.row,t.column,r.row,r.column);q=this;n.clipRows=
function(){var a;a=q.aceRange.prototype.clipRows.apply(this,arguments);a.isEmpty=function(){return!1};return a};n.start=this.aceDoc.createAnchor(n.start);n.end=this.aceDoc.createAnchor(n.end);n.id=this.aceSession.addMarker(n,d,"text");return{clear:function(){n.start.detach();n.end.detach();return x.aceSession.removeMarker(n.id)}}};a.prototype.addStyleRule=function(a){var b;if("undefined"!==typeof document&&null!==document&&(this.addedStyleRules||(this.addedStyleRules={},b=document.createElement("style"),
document.documentElement.getElementsByTagName("head")[0].appendChild(b),this.addedStyleSheet=b.sheet),!this.addedStyleRules[a]))return this.addedStyleRules[a]=!0,this.addedStyleSheet.insertRule(a,0)};a.prototype.registerCallbacks=function(a){this.callbacks=a};a.prototype.trigger=function(){var a,b,d,h;b=arguments[0];a=2<=arguments.length?c.call(arguments,1):[];return null!=(d=this.callbacks)?null!=(h=d[b])?h.apply(this,a):void 0:void 0};a.prototype.applyOperation=function(a){a.isNoop()||(this.ignoreChanges=
!0);this.applyOperationToACE(a);return this.ignoreChanges=!1};a.prototype.registerUndo=function(a){return this.ace.undo=a};a.prototype.registerRedo=function(a){return this.ace.redo=a};a.prototype.invertOperation=function(a){return a.invert(this.getValue())};return a}();d=d||{};d.AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"};d.sentinelConstants=
{LINE_SENTINEL_CHARACTER:"\ue000",ENTITY_SENTINEL_CHARACTER:"\ue001"};d=d||{};d.EntityManager=function(){function a(){this.entities_={};var a="src alt width height style class".split(" ");this.register("img",{render:function(a){b.assert(a.src,"image entity should have 'src'!");for(var c="src alt width height style class".split(" "),d="<img ",g=0;g<c.length;g++){var q=c[g];q in a&&(d+=" "+q+'="'+a[q]+'"')}return d+">"},fromElement:function(b){for(var c={},d=0;d<a.length;d++){var f=a[d];b.hasAttribute(f)&&
(c[f]=b.getAttribute(f))}return c}})}var b=d.utils;a.prototype.register=function(a,b){d.utils.assert(b.render,"Entity options should include a 'render' function!");d.utils.assert(b.fromElement,"Entity options should include a 'fromElement' function!");this.entities_[a]=b};a.prototype.renderToElement=function(a,b){return this.tryRenderToElement_(a,"render",b)};a.prototype.exportToElement=function(a){var b=this.tryRenderToElement_(a,"export")||this.tryRenderToElement_(a,"getHtml")||this.tryRenderToElement_(a,
"render");b.setAttribute("data-vceditor-entity",a.type);return b};a.prototype.updateElement=function(a,b){var c=a.type,d=a.info;this.entities_[c]&&"undefined"!=typeof this.entities_[c].update&&this.entities_[c].update(d,b)};a.prototype.fromElement=function(a){var b=a.getAttribute("data-vceditor-entity");b||(b=a.nodeName.toLowerCase());if(b&&this.entities_[b])return a=this.entities_[b].fromElement(a),new d.Entity(b,a)};a.prototype.tryRenderToElement_=function(a,b,c){var f=a.type;a=a.info;if(this.entities_[f]&&
this.entities_[f][b]&&(b=this.entities_[f][b](a,c,d.document||window&&window.document))){if("string"===typeof b)return f=(d.document||document).createElement("div"),f.innerHTML=b,f.childNodes[0];if("object"===typeof b)return d.utils.assert("undefined"!==typeof b.nodeType,"Error rendering "+f+" entity.  render() function must return an html string or a DOM element."),b}};a.prototype.entitySupportsUpdate=function(a){return this.entities_[a]&&this.entities_[a].update};return a}();d=d||{};d.Entity=function(){function a(b,
c){if(!(this instanceof a))return new a(b,c);this.type=b;this.info=c||{}}var b=d.AttributeConstants.ENTITY_SENTINEL,c=b+"_";a.prototype.toAttributes=function(){var a={};a[b]=this.type;for(var d in this.info)a[c+d]=this.info[d];return a};a.fromAttributes=function(d){var h=d[b],n={},r;for(r in d)0===r.indexOf(c)&&(n[r.substr(c.length)]=d[r]);return new a(h,n)};return a}();d=d||{};d.RichTextCodeMirror=function(){function a(a,b,c){this.codeMirror=a;this.options_=c||{};this.entityManager_=b;this.currentAttributes_=
null;var d=this;this.annotationList_=new n(function(a,b){d.onAnnotationsChanged_(a,b)});this.initAnnotationList_();h(this,"onCodeMirrorBeforeChange_");h(this,"onCodeMirrorChange_");h(this,"onCursorActivity_");if(/^4\./.test(CodeMirror.version))this.codeMirror.on("changes",this.onCodeMirrorChange_);else this.codeMirror.on("change",this.onCodeMirrorChange_);this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.on("cursorActivity",this.onCursorActivity_);this.changeId_=0;
this.outstandingChanges_={};this.dirtyLines_=[]}function b(a,c){return a.line-c.line||a.ch-c.ch}function c(a){if(0===a.length)return 0;for(var b=0,d=0;d<a.length;d++)b+=a[d].length;return b+a.length-1}function m(a){this.attributes=a||{}}function h(a,b){var c=a[b];a[b]=function(){c.apply(a,arguments)}}var n=d.AnnotationList,r=d.Span,q=d.utils,t=d.AttributeConstants,x={c:"color",bc:"background-color",fs:"font-size",li:function(a){return"padding-left: "+40*a+"px"}},z={};q.makeEventEmitter(a,["change",
"attributesChange","newLine"]);var v=d.sentinelConstants.LINE_SENTINEL_CHARACTER,u=d.sentinelConstants.ENTITY_SENTINEL_CHARACTER;a.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_);this.codeMirror.off("change",this.onCodeMirrorChange_);this.codeMirror.off("changes",this.onCodeMirrorChange_);this.codeMirror.off("cursorActivity",this.onCursorActivity_);this.clearAnnotations_()};a.prototype.toggleAttribute=function(a,b){var c=b||!0;if(this.emptySelection_()){var d=
this.getCurrentAttributes_();d[a]===c?delete d[a]:d[a]=c;this.currentAttributes_=d}else c=this.getCurrentAttributes_()[a]!==c?c:!1,this.setAttribute(a,c)};a.prototype.setAttribute=function(a,b){var c=this.codeMirror;this.emptySelection_()?(c=this.getCurrentAttributes_(),!1===b?delete c[a]:c[a]=b,this.currentAttributes_=c):(this.updateTextAttributes(c.indexFromPos(c.getCursor("start")),c.indexFromPos(c.getCursor("end")),function(c){!1===b?delete c[a]:c[a]=b}),this.updateCurrentAttributes_())};a.prototype.updateTextAttributes=
function(a,b,c,d,f){var g=[],h=a,n=this;this.annotationList_.updateSpan(new r(a,b-a),function(a,b){var s={},q;for(q in a.attributes)s[q]=a.attributes[q];s[t.LINE_SENTINEL]&&!f||c(s);q={};var r={};n.computeChangedAttributes_(a.attributes,s,q,r);var w;a:{for(w in q){w=!1;break a}w=!0}w||g.push({start:h,end:h+b,attributes:q,attributesInverse:r,origin:d});h+=b;return new m(s)});0<g.length&&this.trigger("attributesChange",this,g)};a.prototype.computeChangedAttributes_=function(a,b,c,d){var f={},g;for(g in a)f[g]=
!0;for(g in b)f[g]=!0;for(g in f)g in b?g in a?a[g]!==b[g]&&(c[g]=b[g],d[g]=a[g]):(c[g]=b[g],d[g]=!1):(c[g]=!1,d[g]=a[g])};a.prototype.toggleLineAttribute=function(a,b){var c=this.getCurrentLineAttributes_();this.setLineAttribute(a,a in c&&c[a]===b?!1:b)};a.prototype.setLineAttribute=function(a,b){this.updateLineAttributesForSelection(function(c){!1===b?delete c[a]:c[a]=b})};a.prototype.updateLineAttributesForSelection=function(a){var b=this.codeMirror,c=b.getCursor("start"),d=b.getCursor("end"),
c=c.line,f=d.line,b=b.getLine(f),d=this.areLineSentinelCharacters_(b.substr(0,d.ch));f>c&&d&&f--;this.updateLineAttributes(c,f,a)};a.prototype.updateLineAttributes=function(a,b,c){for(;a<=b;a++){var d=this.codeMirror.getLine(a),f=this.codeMirror.indexFromPos({line:a,ch:0});d[0]!==v?(d={},d[t.LINE_SENTINEL]=!0,c(d),this.insertText(f,v,d)):this.updateTextAttributes(f,f+1,c,null,!0)}};a.prototype.replaceText=function(a,b,c,d,f){this.changeId_++;var g="cmrt-"+this.changeId_;this.outstandingChanges_[g]=
{origOrigin:f,attributes:d};d=this.codeMirror;a=d.posFromIndex(a);b="number"===typeof b?d.posFromIndex(b):null;d.replaceRange(c,a,b,g)};a.prototype.insertText=function(a,b,c,d){var f=this.codeMirror,g=f.getCursor(),h="RTCMADAPTER"==d&&!f.somethingSelected()&&a==f.indexFromPos(g);this.replaceText(a,null,b,c,d);h&&f.setCursor(g)};a.prototype.removeText=function(a,b,c){var d=this.codeMirror;d.replaceRange("",d.posFromIndex(a),d.posFromIndex(b),c)};a.prototype.insertEntityAtCursor=function(a,b,c){var d=
this.codeMirror,d=d.indexFromPos(d.getCursor("head"));this.insertEntityAt(d,a,b,c)};a.prototype.insertEntityAt=function(a,b,c,f){this.insertEntity_(a,new d.Entity(b,c),f)};a.prototype.insertEntity_=function(a,b,c){this.replaceText(a,null,u,b.toAttributes(),c)};a.prototype.getAttributeSpans=function(a,b){for(var c=[],d=this.annotationList_.getAnnotatedSpansForSpan(new r(a,b-a)),f=0;f<d.length;f++)c.push({length:d[f].length,attributes:d[f].annotation.attributes});return c};a.prototype.end=function(){var a=
this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:a,ch:this.codeMirror.getLine(a).length})};a.prototype.getRange=function(a,b){var c=this.codeMirror.posFromIndex(a),d=this.codeMirror.posFromIndex(b);return this.codeMirror.getRange(c,d)};a.prototype.initAnnotationList_=function(){var a=this.end();0!==a&&this.annotationList_.insertAnnotatedSpan(new r(0,a),new m)};a.prototype.onAnnotationsChanged_=function(a,b){var c,d={};this.tryToUpdateEntitiesInPlace(a,b);for(var f=0;f<a.length;f++)t.LINE_SENTINEL in
a[f].annotation.attributes&&(d[this.codeMirror.posFromIndex(a[f].pos).line]=!0),(c=a[f].getAttachedObject())&&c.clear();for(f=0;f<b.length;f++){var g=b[f].annotation,h=t.LINE_SENTINEL in g.attributes,n=t.ENTITY_SENTINEL in g.attributes;c=this.codeMirror.posFromIndex(b[f].pos);h?d[c.line]=!0:n?this.markEntity_(b[f]):(g=this.getClassNameForAttributes_(g.attributes),""!==g&&(h=this.codeMirror.posFromIndex(b[f].pos+b[f].length),c=this.codeMirror.markText(c,h,{className:g}),b[f].attachObject(c)))}for(var m in d)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(m))),
this.queueLineMarking_()};a.prototype.tryToUpdateEntitiesInPlace=function(a,b){for(var c=a.length;c--;)for(var d=a[c],f=b.length;f--;){var g=b[f];if(d.pos==g.pos&&d.annotation.attributes.ent&&d.annotation.attributes.ent==g.annotation.attributes.ent&&this.entityManager_.entitySupportsUpdate(g.annotation.attributes.ent)){a.splice(c,1);b.splice(f,1);var h=d.getAttachedObject();h.update(g.annotation.attributes);g.attachObject(h)}}};a.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var a=
this;this.lineMarkTimeout_=setTimeout(function(){a.lineMarkTimeout_=null;for(var b=[],c=0;c<a.dirtyLines_.length;c++){var d=a.codeMirror.getLineNumber(a.dirtyLines_[c]);b.push(Number(d))}a.dirtyLines_=[];b.sort(function(a,b){return a-b});d=-1;for(c=0;c<b.length;c++){var f=b[c];f>d&&(d=a.markLineSentinelCharactersForChangedLines_(f,f))}},0)}};a.prototype.addStyleWithCSS_=function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet?c.styleSheet.cssText=
a:c.appendChild(document.createTextNode(a));b.appendChild(c)};a.prototype.getClassNameForAttributes_=function(a){var b="",c;for(c in a){var f=a[c];if(c===t.LINE_SENTINEL)d.utils.assert(!0===f,"LINE_SENTINEL attribute should be true if it exists.");else{var g=(this.options_.cssPrefix||"cmrt-")+c;if(!0!==f){c===t.FONT_SIZE&&"string"!==typeof f&&(f+="px");var h=f.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-"),g=g+("-"+h);x[c]&&(z[c]||(z[c]={}),z[c][h]||(z[c][h]=!0,h=x[c],f="function"===typeof h?
h(f):h+": "+f,this.addStyleWithCSS_((c==t.LINE_INDENT?"pre."+g:"."+g)+" { "+f+" }")))}b=b+" "+g}}return b};a.prototype.markEntity_=function(a){for(var b=d.Entity.fromAttributes(a.annotation.attributes),c=this.codeMirror,f=this,g=[],h=0;h<a.length;h++){var n=c.posFromIndex(a.pos+h),m=c.posFromIndex(a.pos+h+1),q={collapsed:!0,atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},r=this.createEntityHandle_(b,a.pos),t=this.entityManager_.renderToElement(b,r);t&&(q.replacedWith=t);n=c.markText(n,m,q);g.push(n);
r.setMarker(n)}a.attachObject({clear:function(){for(var a=0;a<g.length;a++)g[a].clear()},update:function(a){a=d.Entity.fromAttributes(a);for(var b=0;b<g.length;b++)f.entityManager_.updateElement(a,g[b].replacedWith)}});this.queueRefresh_()};a.prototype.queueRefresh_=function(){var a=this;this.refreshTimer_||(this.refreshTimer_=setTimeout(function(){a.codeMirror.refresh();a.refreshTimer_=null},0))};a.prototype.createEntityHandle_=function(a,b){function c(){if(f){var a=f.find();return a?g.codeMirror.indexFromPos(a.from):
null}return b}var f=null,g=this;return{find:c,remove:function(){var a=c();null!=a&&(g.codeMirror.focus(),g.removeText(a,a+1))},replace:function(b){var f=d.AttributeConstants.ENTITY_SENTINEL,h=f+"_",n=c();g.updateTextAttributes(n,n+1,function(c){for(var d in c)delete c[d];c[f]=a.type;for(var g in b)c[h+g]=b[g]})},setMarker:function(a){f=a}}};a.prototype.lineClassRemover_=function(a){var b=this.codeMirror,c=b.getLineHandle(a);return{clear:function(){b.removeLineClass(c,"text",".*")}}};a.prototype.emptySelection_=
function(){var a=this.codeMirror.getCursor("start"),b=this.codeMirror.getCursor("end");return a.line===b.line&&a.ch===b.ch};a.prototype.onCodeMirrorBeforeChange_=function(a,b){if("+input"===b.origin||"paste"===b.origin){for(var c=[],d=0;d<b.text.length;d++){var f=b.text[d],f=f.replace(new RegExp("["+v+u+"]","g"),"");c.push(f)}b.update(b.from,b.to,c)}};a.prototype.onCodeMirrorChange_=function(a,b){if("object"===typeof b.from){for(var c=[];b;)c.push(b),b=b.next;b=c}for(var c=this.convertCoordinateSystemForChanges_(b),
d=[],f=0;f<c.length;f++){var g=c[f],h=g.start,n=g.text,q=g.removed,t=g.origin;if(0<q.length){for(var v=this.annotationList_.getAnnotatedSpansForSpan(new r(h,q.length)),u=0,x=0;x<v.length;x++){var z=v[x];d.push({start:h,end:h+z.length,removedAttributes:z.annotation.attributes,removed:q.substr(u,z.length),attributes:{},text:"",origin:g.origin});u+=z.length}this.annotationList_.removeSpan(new r(h,q.length))}0<n.length&&("+input"===g.origin||"paste"===g.origin?g=this.currentAttributes_||{}:t in this.outstandingChanges_?
(g=this.outstandingChanges_[t].attributes,t=this.outstandingChanges_[t].origOrigin,delete this.outstandingChanges_[t]):g={},this.annotationList_.insertAnnotatedSpan(new r(h,n.length),new m(g)),d.push({start:h,end:h,removedAttributes:{},removed:"",text:n,attributes:g,origin:t}))}this.markLineSentinelCharactersForChanges_(b);0<d.length&&this.trigger("change",this,d)};a.prototype.convertCoordinateSystemForChanges_=function(a){function d(a,h){return function(d){if(0>=b(d,h.from))return a(d);if(0>=b(h.to,
d)){var n=d.line+h.text.length-1-(h.to.line-h.from.line);if(h.to.line<d.line)d=d.ch;else if(1>=h.text.length)d=d.ch-(h.to.ch-h.from.ch)+c(h.text);else{var m=h.text;d=d.ch-h.to.ch+m[m.length-1].length}return a({line:n,ch:d})+c(h.removed)-c(h.text)}return h.from.line===d.line?a(h.from)+d.ch-h.from.ch:a(h.from)+c(h.removed.slice(0,d.line-h.from.line))+1+d.ch}}for(var h=this,n=function(a){return h.codeMirror.indexFromPos(a)},m=[],q=a.length-1;0<=q;q--){var r=a[q],n=d(n,r),t=n(r.from),v=r.removed.join("\n"),
u=r.text.join("\n");m.unshift({start:t,end:t+v.length,removed:v,text:u,origin:r.origin})}return m};a.prototype.markLineSentinelCharactersForChanges_=function(a){for(var b=Number.MAX_VALUE,c=-1,d=0;d<a.length;d++){var f=a[d],g=f.from.line;if(1<f.removed.length||0<=f.removed[0].indexOf(v))b=Math.min(b,g),c=Math.max(c,g);1<f.text.length?(b=Math.min(b,g),c=Math.max(c,g+f.text.length-1)):0<=f.text[0].indexOf(v)&&(b=Math.min(b,g),c=Math.max(c,g))}c=Math.min(c,this.codeMirror.lineCount()-1);this.markLineSentinelCharactersForChangedLines_(b,
c)};a.prototype.markLineSentinelCharactersForChangedLines_=function(a,b){if(a<Number.MAX_VALUE)for(;0<a&&this.lineIsListItemOrIndented_(a-1);)a--;if(-1<b)for(var c=this.codeMirror.lineCount();b+1<c&&this.lineIsListItemOrIndented_(b+1);)b++;for(var c=[],d=this.codeMirror,f=a;f<=b;f++){var g=d.getLine(f),h=d.getLineHandle(f);d.removeLineClass(h,"text",".*");if(0<g.length)for(h=g.indexOf(v);0<=h;){for(var n=h;h<g.length&&g[h]===v;){for(var m=d.findMarksAt({line:f,ch:h}),q=0;q<m.length;q++)m[q].isForLineSentinel&&
m[q].clear();h++}this.markLineSentinelCharacters_(f,n,h,c);h=g.indexOf(v,h)}else c=[]}return b};a.prototype.markLineSentinelCharacters_=function(a,b,c,d){var f=this.codeMirror,g=null,h=null,n=function(){var a=h.find();return a?a.from.line:null};if(0===b){var m=this.getLineAttributes_(a),q=m[t.LIST_TYPE],r=m[t.LINE_INDENT]||0;for(q&&0===r&&(r=1);r>=d.length;)d.push(1);"o"===q?(g=this.makeOrderedListElement_(d[r]),d[r]++):"u"===q?(g=this.makeUnorderedListElement_(),d[r]=1):"t"===q?(g=this.makeTodoListElement_(!1,
n),d[r]=1):"tc"===q&&(g=this.makeTodoListElement_(!0,n),d[r]=1);n=this.getClassNameForAttributes_(m);""!==n&&this.codeMirror.addLineClass(a,"text",n);d=d.slice(0,r+1)}d={inclusiveLeft:!0,collapsed:!0};g&&(d.replacedWith=g);h=f.markText({line:a,ch:b},{line:a,ch:c},d);h.isForLineSentinel=!0};a.prototype.makeOrderedListElement_=function(a){return q.elt("div",a+".",{"class":"vceditor-list-left"})};a.prototype.makeUnorderedListElement_=function(){return q.elt("div","\u2022",{"class":"vceditor-list-left"})};
a.prototype.toggleTodo=function(a){var b=t.LIST_TYPE,c=this.getCurrentLineAttributes_(),d;b in c&&("t"===c[b]||"tc"===c[b])?"t"===c[b]?d="tc":"tc"===c[b]&&(d=a?"t":!1):d="t";this.setLineAttribute(b,d)};a.prototype.makeTodoListElement_=function(a,b){var c={type:"checkbox","class":"vceditor-todo-left"};a&&(c.checked=!0);var c=q.elt("input",!1,c),d=this;q.on(c,"click",q.stopEventAnd(function(a){d.codeMirror.setCursor({line:b(),ch:1});d.toggleTodo(!0)}));return c};a.prototype.lineIsListItemOrIndented_=
function(a){a=this.getLineAttributes_(a);return!1!==(a[t.LIST_TYPE]||!1)||0!==(a[t.LINE_INDENT]||0)};a.prototype.onCursorActivity_=function(){var a=this;clearTimeout(a.cursorTimeout);a.cursorTimeout=setTimeout(function(){a.updateCurrentAttributes_()},1)};a.prototype.getCurrentAttributes_=function(){this.currentAttributes_||this.updateCurrentAttributes_();return this.currentAttributes_};a.prototype.updateCurrentAttributes_=function(){var a=this.codeMirror,b=a.indexFromPos(a.getCursor("anchor")),c=
a.indexFromPos(a.getCursor("head")),a=c;if(b>c){for(;a<this.end();){b=this.getRange(a,a+1);if("\n"!==b&&b!==v)break;a++}a<this.end()&&a++}else for(;0<a;){b=this.getRange(a-1,a);if("\n"!==b&&b!==v)break;a--}b=this.annotationList_.getAnnotatedSpansForPos(a);this.currentAttributes_={};a={};0<b.length&&!(t.LINE_SENTINEL in b[0].annotation.attributes)?a=b[0].annotation.attributes:1<b.length&&(d.utils.assert(!(t.LINE_SENTINEL in b[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),
a=b[1].annotation.attributes);for(var f in a)"l"!==f&&"lt"!==f&&"li"!==f&&0!==f.indexOf(t.ENTITY_SENTINEL)&&(this.currentAttributes_[f]=a[f])};a.prototype.getCurrentLineAttributes_=function(){var a=this.codeMirror,b=a.getCursor("anchor"),a=a.getCursor("head"),c=a.line;0===a.ch&&b.line<a.line&&c--;return this.getLineAttributes_(c)};a.prototype.getLineAttributes_=function(a){var b={},c=this.codeMirror.getLine(a);if(0<c.length&&c[0]===v){a=this.codeMirror.indexFromPos({line:a,ch:0});a=this.annotationList_.getAnnotatedSpansForSpan(new r(a,
1));d.utils.assert(1===a.length);for(var f in a[0].annotation.attributes)b[f]=a[0].annotation.attributes[f]}return b};a.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new r(0,this.end()),function(a,b){return new m({})})};a.prototype.newline=function(){var a=this.codeMirror,b=this;if(this.emptySelection_()){var c=a.getCursor("head").line,d=this.getLineAttributes_(c),f=d[t.LIST_TYPE];f&&1===a.getLine(c).length?this.updateLineAttributes(c,c,function(a){delete a[t.LIST_TYPE];delete a[t.LINE_INDENT]}):
(a.replaceSelection("\n","end","+input"),this.updateLineAttributes(c+1,c+1,function(a){for(var g in d)a[g]=d[g];"tc"===f&&(a[t.LIST_TYPE]="t");b.trigger("newLine",{line:c+1,attr:a})}))}else a.replaceSelection("\n","end","+input")};a.prototype.deleteLeft=function(){var a=this.codeMirror,b=a.getCursor("head"),c=this.getLineAttributes_(b.line),d=c[t.LIST_TYPE],c=c[t.LINE_INDENT],f=this.emptySelection_()&&1===b.ch;f&&d?this.updateLineAttributes(b.line,b.line,function(a){delete a[t.LIST_TYPE];delete a[t.LINE_INDENT]}):
f&&c&&0<c?this.updateLineAttributes(b.line,b.line,function(a){a[t.LINE_INDENT]--}):a.deleteH(-1,"char")};a.prototype.deleteRight=function(){var a=this.codeMirror,b=a.getCursor("head"),c=a.getLine(b.line),c=this.areLineSentinelCharacters_(c),d=b.line+1<a.lineCount()?a.getLine(b.line+1):"";this.emptySelection_()&&c&&d[0]===v?a.replaceRange("",{line:b.line,ch:0},{line:b.line+1,ch:0},"+input"):a.deleteH(1,"char")};a.prototype.indent=function(){this.updateLineAttributesForSelection(function(a){var b=a[t.LIST_TYPE];
a[t.LINE_INDENT]?a[t.LINE_INDENT]++:a[t.LINE_INDENT]=b?2:1})};a.prototype.unindent=function(){this.updateLineAttributesForSelection(function(a){var b=a[t.LINE_INDENT];b&&1<b?a[t.LINE_INDENT]=b-1:(delete a[t.LIST_TYPE],delete a[t.LINE_INDENT])})};a.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(v,"g"),"")};a.prototype.areLineSentinelCharacters_=function(a){for(var b=0;b<a.length;b++)if(a[b]!==v)return!1;return!0};m.prototype.equals=function(a){if(!(a instanceof m))return!1;
for(var b in this.attributes)if(a.attributes[b]!==this.attributes[b])return!1;for(b in a.attributes)if(a.attributes[b]!==this.attributes[b])return!1;return!0};return a}();d=d||{};d.RichTextCodeMirrorAdapter=function(){function a(a){this.rtcm=a;this.cm=a.codeMirror;c(this,"onChange");c(this,"onAttributesChange");c(this,"onCursorActivity");c(this,"onFocus");c(this,"onBlur");this.rtcm.on("change",this.onChange);this.rtcm.on("attributesChange",this.onAttributesChange);this.cm.on("cursorActivity",this.onCursorActivity);
this.cm.on("focus",this.onFocus);this.cm.on("blur",this.onBlur)}function b(a){var c=a.lineCount()-1;return a.indexFromPos({line:c,ch:a.getLine(c).length})}function c(a,b){var d=a[b];a[b]=function(){d.apply(a,arguments)}}function m(a){for(var b in a)return!1;return!0}var h=d.TextOperation,n=d.WrappedOperation,r=d.Cursor;a.prototype.detach=function(){this.rtcm.off("change",this.onChange);this.rtcm.off("attributesChange",this.onAttributesChange);this.cm.off("cursorActivity",this.onCursorActivity);this.cm.off("focus",
this.onFocus);this.cm.off("blur",this.onBlur)};a.operationFromCodeMirrorChanges=function(a,c){for(var d=b(c),g=(new h).retain(d),n=(new h).retain(d),m=a.length-1;0<=m;m--)var r=a[m],w=r.start,G=d-w-r.text.length,g=(new h).retain(w)["delete"](r.removed.length).insert(r.text,r.attributes).retain(G).compose(g),n=n.compose((new h).retain(w)["delete"](r.text.length).insert(r.removed,r.removedAttributes).retain(G)),d=d+(r.removed.length-r.text.length);return[g,n]};a.operationFromAttributesChanges=function(a,
c){for(var d=b(c),g=new h,n=new h,m=0,r=0;r<a.length;r++){var w=a[r],m=w.start-m;if(!(0<=m))throw Error("assertion error");g.retain(m);n.retain(m);m=w.end-w.start;g.retain(m,w.attributes);n.retain(m,w.attributesInverse);m=w.start+m}g.retain(d-m);n.retain(d-m);return[g,n]};a.applyOperationToCodeMirror=function(a,b){10<a.ops.length&&b.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var c=a.ops,d=0,f=0,g=c.length;f<g;f++){var h=c[f];h.isRetain()?(m(h.attributes)||b.updateTextAttributes(d,
d+h.chars,function(a){for(var b in h.attributes)!1===h.attributes[b]?delete a[b]:a[b]=h.attributes[b]},"RTCMADAPTER",!0),d+=h.chars):h.isInsert()?(b.insertText(d,h.text,h.attributes,"RTCMADAPTER"),d+=h.text.length):h.isDelete()&&b.removeText(d,d+h.chars,"RTCMADAPTER")}10<a.ops.length&&(b.codeMirror.getWrapperElement().setAttribute("style",""),b.codeMirror.refresh())};a.prototype.registerCallbacks=function(a){this.callbacks=a};a.prototype.onChange=function(b,c){if("RTCMADAPTER"!==c[0].origin){var d=
a.operationFromCodeMirrorChanges(c,this.cm);this.trigger("change",d[0],d[1])}};a.prototype.onAttributesChange=function(b,c){if("RTCMADAPTER"!==c[0].origin){var d=a.operationFromAttributesChanges(c,this.cm);this.trigger("change",d[0],d[1])}};a.prototype.onCursorActivity=function(){this.trigger("cursorActivity")};a.prototype.onFocus=function(){this.trigger("focus")};a.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")};a.prototype.getValue=function(){return this.cm.getValue()};
a.prototype.getCursor=function(){var a=this.cm,b=a.getCursor(),c=a.indexFromPos(b);if(a.somethingSelected())var d=a.getCursor(!0),b=0===(b.line<d.line?-1:b.line>d.line?1:b.ch<d.ch?-1:b.ch>d.ch?1:0)?a.getCursor(!1):d,a=a.indexFromPos(b);else a=c;return new r(c,a)};a.prototype.setCursor=function(a){this.cm.setSelection(this.cm.posFromIndex(a.position),this.cm.posFromIndex(a.selectionEnd))};a.prototype.addStyleRule=function(a){if("undefined"!==typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules=
{};var b=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(b);this.addedStyleSheet=b.sheet}if(!this.addedStyleRules[a])return this.addedStyleRules[a]=!0,this.addedStyleSheet.insertRule(a,0)}};a.prototype.setOtherCursor=function(a,b,c){var d=this.cm.posFromIndex(a.position);if("string"===typeof b&&b.match(/^#[a-fA-F0-9]{3,6}$/)){var f=this.rtcm.end();if("object"===typeof a&&"number"===typeof a.position&&"number"===typeof a.selectionEnd&&!(0>a.position||
a.position>f||0>a.selectionEnd||a.selectionEnd>f)){var g=this.cm.cursorCoords(d),f=document.createElement("span");f.className="other-client";f.id="cursorId"+c;f.style.borderLeftWidth="3px";f.style.borderLeftStyle="solid";f.style.borderLeftColor=b;f.style.marginLeft=f.style.marginRight="-3px";f.style.height=.9*(g.bottom-g.top)+"px";f.setAttribute("data-clientname",virtualclass.vutil.getUserInfo("name",c,virtualclass.connectedUsers));f.setAttribute("data-clientid",c);f.style.position="relative";g=document.getElementById("cursorId"+
c);null!=g&&g.parentNode.removeChild(g);if(c!=virtualclass.gObj.uid){if(a.position===a.selectionEnd)return f.style.zIndex=0,this.cm.setBookmark(d,{widget:f,insertLeft:!0});this.cm.setBookmark(d,{widget:f,insertLeft:!0});c="selection-"+b.replace("#","");this.addStyleRule("."+c+" { background: "+b+"; }");a.selectionEnd>a.position?(b=d,a=this.cm.posFromIndex(a.selectionEnd)):(b=this.cm.posFromIndex(a.selectionEnd),a=d);return this.cm.markText(b,a,{className:c})}}}};a.prototype.trigger=function(a){var b=
Array.prototype.slice.call(arguments,1),c=this.callbacks&&this.callbacks[a];c&&c.apply(this,b)};a.prototype.applyOperation=function(b){a.applyOperationToCodeMirror(b,this.rtcm)};a.prototype.registerUndo=function(a){this.cm.undo=a};a.prototype.registerRedo=function(a){this.cm.redo=a};a.prototype.invertOperation=function(a){for(var b=0,c=this.rtcm.codeMirror,d,f,g=new h,r=0;r<a.wrapped.ops.length;r++){var w=a.wrapped.ops[r];if(w.isRetain())if(m(w.attributes))g.retain(w.chars),b+=w.chars;else for(d=
this.rtcm.getAttributeSpans(b,b+w.chars),f=0;f<d.length;f++){var G={},C;for(C in w.attributes){var H=w.attributes[C],L=d[f].attributes[C];!1===H?L&&(G[C]=L):H!==L&&(G[C]=L||!1)}g.retain(d[f].length,G);b+=d[f].length}else if(w.isInsert())g["delete"](w.text.length);else if(w.isDelete()){G=c.getRange(c.posFromIndex(b),c.posFromIndex(b+w.chars));d=this.rtcm.getAttributeSpans(b,b+w.chars);for(f=H=0;f<d.length;f++)g.insert(G.substr(H,d[f].length),d[f].attributes),H+=d[f].length;b+=w.chars}}return new n(g,
a.meta.invert())};return a}();d=d||{};d.Formatting=function(){function a(b){if(!(this instanceof a))return new a(b);this.attributes=b||{}}var b=d.AttributeConstants;a.prototype.cloneWithNewAttribute_=function(b,c){var d={},f;for(f in this.attributes)d[f]=this.attributes[f];!1===c?delete d[b]:d[b]=c;return new a(d)};a.prototype.bold=function(a){return this.cloneWithNewAttribute_(b.BOLD,a)};a.prototype.italic=function(a){return this.cloneWithNewAttribute_(b.ITALIC,a)};a.prototype.underline=function(a){return this.cloneWithNewAttribute_(b.UNDERLINE,
a)};a.prototype.strike=function(a){return this.cloneWithNewAttribute_(b.STRIKE,a)};a.prototype.font=function(a){return this.cloneWithNewAttribute_(b.FONT,a)};a.prototype.fontSize=function(a){return this.cloneWithNewAttribute_(b.FONT_SIZE,a)};a.prototype.color=function(a){return this.cloneWithNewAttribute_(b.COLOR,a)};a.prototype.backgroundColor=function(a){return this.cloneWithNewAttribute_(b.BACKGROUND_COLOR,a)};return a}();d=d||{};d.Text=function(){function a(b,c){if(!(this instanceof a))return new a(b,
c);this.text=b;this.formatting=c||d.Formatting()}return a}();d=d||{};d.LineFormatting=function(){function a(c){if(!(this instanceof a))return new a(c);this.attributes=c||{};this.attributes[b.LINE_SENTINEL]=!0}var b=d.AttributeConstants;a.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"};a.prototype.cloneWithNewAttribute_=function(b,c){var d={},f;for(f in this.attributes)d[f]=this.attributes[f];!1===c?delete d[b]:d[b]=c;return new a(d)};a.prototype.indent=function(a){return this.cloneWithNewAttribute_(b.LINE_INDENT,
a)};a.prototype.align=function(a){return this.cloneWithNewAttribute_(b.LINE_ALIGN,a)};a.prototype.listItem=function(a){d.utils.assert(!1===a||"u"===a||"o"===a||"t"===a||"tc"===a);return this.cloneWithNewAttribute_(b.LIST_TYPE,a)};a.prototype.getIndent=function(){return this.attributes[b.LINE_INDENT]||0};a.prototype.getAlign=function(){return this.attributes[b.LINE_ALIGN]||0};a.prototype.getListItem=function(){return this.attributes[b.LIST_TYPE]||!1};return a}();d=d||{};d.Line=function(){function a(b,
c){if(!(this instanceof a))return new a(b,c);"[object Array]"!==Object.prototype.toString.call(b)&&(b="undefined"===typeof b?[]:[b]);this.textPieces=b;this.formatting=c||d.LineFormatting()}return a}();d=d||{};d.ParseHtml=function(){function a(a,b,c){this.listType=a||n.UNORDERED;this.lineFormatting=b||d.LineFormatting();this.textFormatting=c||d.Formatting()}function b(){this.lines=[];this.currentLine=[];this.currentLineListItemType=null}function c(a,b,f){if(a.nodeType===q.ELEMENT_NODE){var g=r.fromElement(a);
if(g){f.currentLine.push(new d.Text(d.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new d.Formatting(g.toAttributes())));return}}switch(a.nodeType){case q.TEXT_NODE:a=a.nodeValue.replace(/[ \n\t]+/g," ");f.currentLine.push(d.Text(a,b.textFormatting));break;case q.ELEMENT_NODE:switch(g=a.getAttribute("style")||"",b=h(b,g),a.nodeName.toLowerCase()){case "div":case "h1":case "h2":case "h3":case "p":f.newlineIfNonEmpty(b);m(a,b,f);f.newlineIfNonEmpty(b);break;case "center":b=b.withAlign("center");f.newlineIfNonEmpty(b);
m(a,b.withAlign("center"),f);f.newlineIfNonEmpty(b);break;case "b":case "strong":m(a,b.withTextFormatting(b.textFormatting.bold(!0)),f);break;case "u":m(a,b.withTextFormatting(b.textFormatting.underline(!0)),f);break;case "i":case "em":m(a,b.withTextFormatting(b.textFormatting.italic(!0)),f);break;case "s":m(a,b.withTextFormatting(b.textFormatting.strike(!0)),f);break;case "font":var g=a.getAttribute("face"),u=a.getAttribute("color"),s=parseInt(a.getAttribute("size"));g&&(b=b.withTextFormatting(b.textFormatting.font(g)));
u&&(b=b.withTextFormatting(b.textFormatting.color(u)));s&&(b=b.withTextFormatting(b.textFormatting.fontSize(s)));m(a,b,f);break;case "br":f.newline(b);break;case "ul":f.newlineIfNonEmptyOrListItem(b);g="vceditor-todo"===a.getAttribute("class")?n.TODO:n.UNORDERED;m(a,b.withListType(g).withIncreasedIndent(),f);f.newlineIfNonEmpty(b);break;case "ol":f.newlineIfNonEmptyOrListItem(b);m(a,b.withListType(n.ORDERED).withIncreasedIndent(),f);f.newlineIfNonEmpty(b);break;case "li":f.newlineIfNonEmptyOrListItem(b);
g="vceditor-checked"===a.getAttribute("class")?n.TODOCHECKED:b.listType;f.makeListItem(g);g=f.currentLine;m(a,b,f);(g===f.currentLine||0<f.currentLine.length)&&f.newline(b);break;case "style":break;default:m(a,b,f)}}}function m(a,b,d){if(a.hasChildNodes())for(var f=0;f<a.childNodes.length;f++)c(a.childNodes[f],b,d)}function h(a,b){for(var c=a.textFormatting,f=a.lineFormatting,g=b.split(";"),h=0;h<g.length;h++){var n=g[h].split(":");if(2===n.length){var m=d.utils.trim(n[0]).toLowerCase(),n=d.utils.trim(n[1]).toLowerCase();
switch(m){case "text-decoration":m=0<=n.indexOf("underline");n=0<=n.indexOf("line-through");c=c.underline(m).strike(n);break;case "font-weight":n="bold"===n||600<=parseInt(n);c=c.bold(n);break;case "font-style":c=c.italic("italic"===n||"oblique"===n);break;case "color":c=c.color(n);break;case "background-color":c=c.backgroundColor(n);break;case "text-align":f=f.align(n);break;case "font-size":m=null;d.utils.stringEndsWith(n,"px pt % em xx-small x-small small medium large x-large xx-large smaller larger".split(" "))?
m=n:parseInt(n)&&(m=parseInt(n)+"px");m&&(c=c.fontSize(m));break;case "font-family":n=d.utils.trim(n.split(",")[0]),n=n.replace(/['"]/g,""),n=n.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}),c=c.font(n)}}}return a.withLineFormatting(f).withTextFormatting(c)}var n=d.LineFormatting.LIST_TYPE;a.prototype.withTextFormatting=function(b){return new a(this.listType,this.lineFormatting,b)};a.prototype.withLineFormatting=function(b){return new a(this.listType,b,this.textFormatting)};
a.prototype.withListType=function(b){return new a(b,this.lineFormatting,this.textFormatting)};a.prototype.withIncreasedIndent=function(){var b=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new a(this.listType,b,this.textFormatting)};a.prototype.withAlign=function(b){b=this.lineFormatting.align(b);return new a(this.listType,b,this.textFormatting)};b.prototype.newlineIfNonEmpty=function(a){this.cleanLine_();0<this.currentLine.length&&this.newline(a)};b.prototype.newlineIfNonEmptyOrListItem=
function(a){this.cleanLine_();(0<this.currentLine.length||null!==this.currentLineListItemType)&&this.newline(a)};b.prototype.newline=function(a){this.cleanLine_();a=a.lineFormatting;null!==this.currentLineListItemType&&(a=a.listItem(this.currentLineListItemType),this.currentLineListItemType=null);this.lines.push(d.Line(this.currentLine,a));this.currentLine=[]};b.prototype.makeListItem=function(a){this.currentLineListItemType=a};b.prototype.cleanLine_=function(){if(0<this.currentLine.length){var a=
this.currentLine.length-1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,"");this.currentLine[a].text=this.currentLine[a].text.replace(/ +$/g,"");for(a=0;a<this.currentLine.length;a++)this.currentLine[a].text=this.currentLine[a].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var r,q=q||{ELEMENT_NODE:1,TEXT_NODE:3};return function(h,n){var m=(d.document||document).createElement("div");m.innerHTML=h;r=n;var q=new b,u=new a;
c(m,u,q);return q.lines}}();d=d||{};d.SerializeHtml=function(){function a(a){return a===h.ORDERED?"</ol>":"</ul>"}function b(a,c){return a===c||a===h.TODO&&c===h.TODOCHECKED||a===h.TODOCHECKED&&c===h.TODO}var c=d.utils,m=d.AttributeConstants,h=d.LineFormatting.LIST_TYPE;return function(n,r){for(var q="",t=!0,x=[],z=!1,v=!0,u=!0,s=0,w=n.ops[s],G=!1;w;){c.assert(w.isInsert());var C=w.attributes;if(t){var t=!1,H=0,L=null,E="left";m.LINE_SENTINEL in C&&(H=C[m.LINE_INDENT]||0,L=C[m.LIST_TYPE]||null,E=
C[m.LINE_ALIGN]||"left");L&&(H=H||1);z?(q+="</li>",z=!1):v||(u&&(q+="<br/>"),q+="</div>");v=!1;for(c.assert(0<=H,"Indent must not be negative.");x.length>H||H===x.length&&null!==L&&!b(L,x[x.length-1]);)q+=a(x.pop());for(;x.length<H;)u=L||h.UNORDERED,G=L==h.TODO||L==h.TODOCHECKED||G,q+=u===h.ORDERED?"<ol>":u===h.UNORDERED?"<ul>":'<ul class="vceditor-todo">',x.push(u);u="left"!==E?' style="text-align:'+E+'"':"";if(L){z="";switch(L){case h.TODOCHECKED:z=' class="vceditor-checked"';break;case h.TODO:z=
' class="vceditor-unchecked"'}q+="<li"+z+u+">";z=!0}else q+="<div"+u+">";u=!0}if(m.LINE_SENTINEL in C)w=n.ops[++s];else if(m.ENTITY_SENTINEL in C){for(L=0;L<w.text.length;L++)H=d.Entity.fromAttributes(C),H=r.exportToElement(H),q+=H.outerHTML;w=n.ops[++s]}else{var H=L="",S;for(S in C){var E=C[S],T,U;S===m.BOLD||S===m.ITALIC||S===m.UNDERLINE||S===m.STRIKE?(c.assert(!0===E),T=U=S):S===m.FONT_SIZE?(T='span style="font-size: '+E,T+="string"!==typeof E||-1===E.indexOf("px",E.length-2)?'px"':'"',U="span"):
S===m.FONT?(T='span style="font-family: '+E+'"',U="span"):S===m.COLOR?(T='span style="color: '+E+'"',U="span"):S===m.BACKGROUND_COLOR?(T='span style="background-color: '+E+'"',U="span"):c.log(!1,"Encountered unknown attribute while rendering html: "+S);T&&(L+="<"+T+">");U&&(H="</"+U+">"+H)}var E=w.text,Ha=E.indexOf("\n");0<=Ha?(t=!0,w=Ha<E.length-1?new d.TextOp("insert",E.substr(Ha+1),C):n.ops[++s],E=E.substr(0,Ha)):w=n.ops[++s];E=E.replace(/  +/g,function(a){return Array(a.length+1).join("\u00a0")}).replace(/^ /,
"\u00a0").replace(/ $/,"\u00a0");0<E.length&&(u=!1);q+=L+E.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")+H}}z?q+="</li>":v||(u&&(q+="&nbsp;"),q+="</div>");for(;0<x.length;)q+=a(x.pop());G&&(q='<style>ul.vceditor-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.vceditor-todo > li { padding-left: 1em; text-indent: -1em; } ul.vceditor-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.vceditor-todo > li.vceditor-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+
q);return q}}();d=d||{};d.textPiecesToInserts=function(a,b){function c(b,f){b instanceof d.Text&&(f=b.formatting.attributes,b=b.text);h.push({string:b,attributes:f});a="\n"===b[b.length-1]}function m(b){a&&c(d.sentinelConstants.LINE_SENTINEL_CHARACTER,b.formatting.attributes);for(var f=0;f<b.textPieces.length;f++)c(b.textPieces[f]);c("\n")}for(var h=[],n=0;n<b.length;n++)b[n]instanceof d.Line?m(b[n]):c(b[n]);return h};d=d||{};d.Headless=function(){function a(b){if(!(this instanceof a))return new a(b);
this.ready=!1;this.entityManager=new c}var b=d.TextOperation,c=d.EntityManager,m=d.ParseHtml;a.prototype.getDocument=function(a){var b=this;if(b.ready)return a(b.adapter.getDocument());b.adapter.on("ready",function(){b.ready=!0;a(b.adapter.getDocument())})};a.prototype.getText=function(a){this.getDocument(function(b){b=b.apply("");for(key in d.sentinelConstants)b=b.replace(new RegExp(d.sentinelConstants[key],"g"),"");a(b)})};a.prototype.setText=function(a,c){var d=b().insert(a);this.sendOperationWithRetry(d,
c)};a.prototype.initializeFakeDom=function(a){"object"===typeof document||"object"===typeof d.document?a():require("jsdom").env("<head></head><body></body>",function(b,c){if(d.document)return c.close(),a();d.document=c.document;a()})};a.prototype.getHtml=function(a){var b=this;b.initializeFakeDom(function(){b.getDocument(function(b){a(d.SerializeHtml(b,this.entityManager))})})};a.prototype.setHtml=function(a,c){var g=this;g.initializeFakeDom(function(){for(var q=m(a,g.entityManager),q=d.textPiecesToInserts(!0,
q),t=new b,x=0;x<q.length;x++)t.insert(q[x].string,q[x].attributes);g.sendOperationWithRetry(t,c)})};a.prototype.sendOperationWithRetry=function(a,b){var c=this;c.getDocument(function(d){d=a.clone()["delete"](d.targetLength);c.adapter.sendOperation(d,function(d,f){f?"undefined"!==typeof b&&b(null,f):c.sendOperationWithRetry(a,b)})})};return a}();d=d||{};d.Vceditor=function(a){function b(a,d,h,m){if(!(this instanceof b))return new b(a,d,h,m);if(!s&&!w)throw Error("Couldn't find CodeMirror or ACE.  Did you forget to include codemirror.js or ace.js?");
if(s&&d instanceof s){if(this.codeMirror_=this.editor_=d,a=this.codeMirror_.getValue(),""!==a)throw Error("Can't initialize Vceditor with a CodeMirror instance that already contains text.");}else if(w&&d&&d.session instanceof w.EditSession){if(this.ace_=this.editor_=d,a=this.ace_.getValue(),""!==a)throw Error("Can't initialize Vceditor with an ACE instance that already contains text.");}else this.codeMirror_=this.editor_=new s(d);a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;
this.vcEditorWrapper_=u.elt("div",null,{"class":"vceditor"});a.parentNode.replaceChild(this.vcEditorWrapper_,a);this.vcEditorWrapper_.appendChild(a);u.on(a,"dragstart",u.stopEvent);this.editor_.vceditor=this;this.options_=h||{};this.getOption("richTextShortcuts",!1)&&(s.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.vcEditorWrapper_.className+=" vceditor-richtext");this.imageInsertionUI=this.getOption("imageInsertionUI",!0);this.getOption("richTextToolbar",
!1)&&(this.addToolbar_(),this.vcEditorWrapper_.className+=" vceditor-richtext vceditor-with-toolbar");this.addPoweredByLogo_();this.codeMirror_&&this.codeMirror_.refresh();this.getOption("userColor",c("JqrwCaZm29-CLg-Pfz2"));this.entityManager_=new z;a=[];this.codeMirror_?(this.richTextCodeMirror_=new r(this.codeMirror_,this.entityManager_,{cssPrefix:"vceditor-"}),this.editorAdapter_=new n(this.richTextCodeMirror_)):this.editorAdapter_=new t(this.ace_);h.hasOwnProperty("richTextToolbar")?(virtualclass.editorRich.vcAdapter=
new virtualclassAdapter(m,"EditorRich"),virtualclass.editorRich.cmClient=new x(0,a,virtualclass.editorRich.vcAdapter,this.editorAdapter_)):(virtualclass.editorCode.vcAdapter=new virtualclassAdapter(m,"EditorCode"),virtualclass.editorCode.cmClient=new x(0,a,virtualclass.editorCode.vcAdapter,this.editorAdapter_));"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("style");
b.type="text/css";b.styleSheet.cssText=":before,:after{content:none !important;}";a.appendChild(b);setTimeout(function(){a.removeChild(b)},0)})}function c(a){for(var b=1,d=0;d<a.length;d++)b=17*(b+a.charCodeAt(d))%360;return h(b/360,1,.85)}function m(a,b,c){function d(a){a=Math.round(255*a).toString(16);return 1===a.length?"0"+a:a}return"#"+d(a)+d(b)+d(c)}function h(a,b,c){if(0===b)return m(c,c,c);var d=.5>c?c*(1+b):c+b-b*c,f=2*c-d;b=function(a){0>a&&(a+=1);1<a&&(a-=1);return 1>6*a?f+6*(d-f)*a:1>
2*a?d:2>3*a?f+6*(d-f)*(2/3-a):f};return m(b(a+1/3),b(a),b(a-1/3))}if(!d.RichTextCodeMirrorAdapter)throw Error("Oops! It looks like you're trying to include lib/vceditor.js directly.  This is actually one of many source files that make up vceditor.  You want dist/vceditor.js instead.");var n=d.RichTextCodeMirrorAdapter,r=d.RichTextCodeMirror,q=d.RichTextToolbar,t=d.ACEAdapter,x=d.EditorClient,z=d.EntityManager,v=d.AttributeConstants,u=d.utils,s=a.CodeMirror,w=a.ace;u.makeEventEmitter(b);b.fromCodeMirror=
b;b.fromACE=b;b.prototype.dispose=function(){this.zombie_=!0;var a=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_.container;this.vcEditorWrapper_.removeChild(a);this.vcEditorWrapper_.parentNode.replaceChild(a,this.vcEditorWrapper_);this.editor_.vceditor=null;this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default");this.vcAdapter.dispose();this.editorAdapter_.detach();this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()};
b.prototype.setUserId=function(a){this.vcAdapter.setUserId(a)};b.prototype.setUserColor=function(a){this.vcAdapter.setColor(a)};b.prototype.getText=function(){this.assertReady_("getText");return this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_.getSession().getDocument().getValue()};b.prototype.setText=function(a){if(this.ace_)return this.ace_.getSession().getDocument().setValue(a);this.codeMirror_.getWrapperElement().setAttribute("style","display: none");this.codeMirror_.setValue("");
this.insertText(0,a);this.codeMirror_.getWrapperElement().setAttribute("style","");this.codeMirror_.refresh()};b.prototype.insertTextAtCursor=function(a){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.insertText=function(a,b){u.assert(!this.ace_,"Not supported for ace yet.");this.assertReady_("insertText");"[object Array]"!==Object.prototype.toString.call(b)&&(b=[b]);for(var c=d.textPiecesToInserts(0===a,b),f=0;f<c.length;f++){var g=c[f].string;this.richTextCodeMirror_.insertText(a,
g,c[f].attributes);a+=g.length}};b.prototype.getOperationForSpan=function(a,b){for(var c=this.richTextCodeMirror_.getRange(a,b),f=this.richTextCodeMirror_.getAttributeSpans(a,b),g=0,h=new d.TextOperation,m=0;m<f.length;m++)h.insert(c.substr(g,f[m].length),f[m].attributes),g+=f[m].length;return h};b.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)};b.prototype.getHtmlFromSelection=function(){var a=this.codeMirror_.getCursor("start"),b=this.codeMirror_.getCursor("end"),a=this.codeMirror_.indexFromPos(a),
b=this.codeMirror_.indexFromPos(b);return this.getHtmlFromRange(a,b)};b.prototype.getHtmlFromRange=function(a,b){var c=null!=a&&null!=b?this.getOperationForSpan(a,b):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return d.SerializeHtml(c,this.entityManager_)};b.prototype.insertHtml=function(a,b){var c=d.ParseHtml(b,this.entityManager_);this.insertText(a,c)};b.prototype.insertHtmlAtCursor=function(a){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),a)};b.prototype.setHtml=
function(a){a=d.ParseHtml(a,this.entityManager_);this.setText(a)};b.prototype.isHistoryEmpty=function(){this.assertReady_("isHistoryEmpty");return this.vcAdapter.isHistoryEmpty()};b.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(v.BOLD);this.codeMirror_.focus()};b.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(v.ITALIC);this.codeMirror_.focus()};b.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(v.UNDERLINE);this.codeMirror_.focus()};
b.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(v.STRIKE);this.codeMirror_.focus()};b.prototype.fontSize=function(a){this.richTextCodeMirror_.setAttribute(v.FONT_SIZE,a);this.codeMirror_.focus()};b.prototype.font=function(a){this.richTextCodeMirror_.setAttribute(v.FONT,a);this.codeMirror_.focus()};b.prototype.color=function(a){this.richTextCodeMirror_.setAttribute(v.COLOR,a);this.codeMirror_.focus()};b.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(v.BACKGROUND_COLOR,
"rgba(255,255,0,.65)");this.codeMirror_.focus()};b.prototype.align=function(a){if("left"!==a&&"center"!==a&&"right"!==a)throw Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(v.LINE_ALIGN,a);this.codeMirror_.focus()};b.prototype.orderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(v.LIST_TYPE,"o");this.codeMirror_.focus()};b.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(v.LIST_TYPE,"u");this.codeMirror_.focus()};
b.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo();this.codeMirror_.focus()};b.prototype.newline=function(){this.richTextCodeMirror_.newline()};b.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()};b.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()};b.prototype.indent=function(){this.richTextCodeMirror_.indent();this.codeMirror_.focus()};b.prototype.unindent=function(){this.richTextCodeMirror_.unindent();this.codeMirror_.focus()};b.prototype.undo=
function(){this.codeMirror_.undo()};b.prototype.redo=function(){this.codeMirror_.redo()};b.prototype.insertEntity=function(a,b,c){this.richTextCodeMirror_.insertEntityAtCursor(a,b,c)};b.prototype.insertEntityAt=function(a,b,c,d){this.richTextCodeMirror_.insertEntityAt(a,b,c,d)};b.prototype.registerEntity=function(a,b){this.entityManager_.register(a,b)};b.prototype.getOption=function(a,b){return a in this.options_?this.options_[a]:b};b.prototype.assertReady_=function(a){if(!this.ready_)throw Error('You must wait for the "ready" event before calling '+
a+".");if(this.zombie_)throw Error("You can't use a Vceditor after calling dispose()!");};b.prototype.makeImageDialog_=function(){this.makeDialog_("img","Insert image url")};b.prototype.makeDialog_=function(a,b){var c=this,d=u.elt("input",null,{"class":"vceditor-dialog-input",id:a,type:"text",placeholder:b,autofocus:"autofocus"}),f=u.elt("a","Submit",{"class":"vceditor-btn",id:"submitbtn"});u.on(f,"click",u.stopEventAnd(function(){var b=document.getElementById("overlay");b.style.visibility="hidden";
var d=document.getElementById(a).value;null!==d&&c.insertEntity(a,{src:d});c.vcEditorWrapper_.removeChild(b)}));var g=u.elt("a","Cancel",{"class":"vceditor-btn"});u.on(g,"click",u.stopEventAnd(function(){var a=document.getElementById("overlay");a.style.visibility="hidden";c.vcEditorWrapper_.removeChild(a)}));f=u.elt("div",[f,g],{"class":"vceditor-btn-group"});d=u.elt("div",[d,f],{"class":"vceditor-dialog-div"});d=u.elt("div",[d],{"class":"vceditor-dialog",id:"overlay"});this.vcEditorWrapper_.appendChild(d)};
b.prototype.addToolbar_=function(){this.toolbar=new q(this.imageInsertionUI);this.toolbar.on("undo",this.undo,this);this.toolbar.on("redo",this.redo,this);this.toolbar.on("bold",this.bold,this);this.toolbar.on("italic",this.italic,this);this.toolbar.on("underline",this.underline,this);this.toolbar.on("strike",this.strike,this);this.toolbar.on("font-size",this.fontSize,this);this.toolbar.on("font",this.font,this);this.toolbar.on("color",this.color,this);this.toolbar.on("left",function(){this.align("left")},
this);this.toolbar.on("center",function(){this.align("center")},this);this.toolbar.on("right",function(){this.align("right")},this);this.toolbar.on("ordered-list",this.orderedList,this);this.toolbar.on("unordered-list",this.unorderedList,this);this.toolbar.on("todo-list",this.todo,this);this.toolbar.on("indent-increase",this.indent,this);this.toolbar.on("indent-decrease",this.unindent,this);this.toolbar.on("insert-image",this.makeImageDialog_,this);this.vcEditorWrapper_.insertBefore(this.toolbar.element(),
this.vcEditorWrapper_.firstChild)};b.prototype.addPoweredByLogo_=function(){};b.prototype.initializeKeyMap_=function(){function a(b){return function(a){setTimeout(function(){b.call(a.vceditor)},0)}}this.getOption("readOnly")?s.keyMap.richtext={fallthrough:["default"]}:s.keyMap.richtext={"Ctrl-B":a(this.bold),"Cmd-B":a(this.bold),"Ctrl-I":a(this.italic),"Cmd-I":a(this.italic),"Ctrl-U":a(this.underline),"Cmd-U":a(this.underline),"Ctrl-H":a(this.highlight),"Cmd-H":a(this.highlight),Enter:a(this.newline),
Delete:a(this.deleteRight),Backspace:a(this.deleteLeft),Tab:a(this.indent),"Shift-Tab":a(this.unindent),fallthrough:["default"]}};return b}(this);d.Vceditor.Formatting=d.Formatting;d.Vceditor.Text=d.Text;d.Vceditor.Entity=d.Entity;d.Vceditor.LineFormatting=d.LineFormatting;d.Vceditor.Line=d.Line;d.Vceditor.TextOperation=d.TextOperation;d.Vceditor.Headless=d.Headless;d.Vceditor.RichTextCodeMirrorAdapter=d.RichTextCodeMirrorAdapter;d.Vceditor.ACEAdapter=d.ACEAdapter;d.Server=Server;d.Vceditor.getvcEditor=
function(){return d};return d.Vceditor},this);(function(d){var b=function(a){return a.map(function(a){return{operation:a.wrapped.toJSON()}})},c=function(a){var b=Vceditor.getvcEditor();return a.map(function(a){return new b.WrappedOperation(b.TextOperation.fromJSON(a.operation),a.cursor&&b.Cursor.fromJSON(a.cursor))})};d.editor=function(a,d,g){this.etype=a;if("editorRich"==a)var m={lineWrapping:!0},h={richTextToolbar:!0,richTextShortcuts:!0,readOnly:!0};else m={lineNumbers:!0,mode:"markdown",readOnly:!0},h={defaultText:"Markdown Editor "};return{etype:a,
cm:"",vcAdapter:"",initialised:!1,prvEdRev:0,dataReqTry:0,stroageData:localStorage.getItem(this.etype+"_allEditorOperations"),stroageDataRev:localStorage.getItem(this.etype+"_edOperationRev"),readonly:!1,veryInit:function(){if(null!=this.stroageData){var a=JSON.parse(this.stroageData),a=JSON.parse(a.data);console.log("Current Editor type "+virtualclass.currAppEditorType);virtualclass.hasOwnProperty("currAppEditor")?virtualclass.currAppEditorType==this.etype?this.initialiseDataWithEditor(a,"displayEditor",
virtualclass.currAppEditorType):this.initialiseDataWithEditor(a):this.initialiseDataWithEditor(a)}else"s"==virtualclass.gObj.uRole&&this.requestData("from_"+virtualclass.gObj.uRole)},init:function(a,b,c,d){var f={};"undefined"!=typeof a&&(f.revision=a);"undefined"!=typeof b&&(f.clients=b);"undefined"!=typeof c&&(f.doc=c);"undefined"!=typeof d&&(f.operations=d);this.cm||"object"==typeof this.cm?virtualclass.dispvirtualclassLayout(virtualclass.currApp):(this.codemirrorWithLayout(m),this.createEditorClient(h,
f));"t"==virtualclass.gObj.uRole?(null!=localStorage.getItem("orginalTeacherId")&&this.createAllEditorController(),io.send({eddata:"init",et:this.etype})):null!=localStorage.getItem("orginalTeacherId")&&this.createAllEditorController()},createAllEditorController:function(){var a=this.etype,b="all"+a+"Container";if(null==document.getElementById(b)){var c="enable",d=document.createElement("div");d.id=b;d["class"]="editorController";var f=document.createElement("a");f.id=d.id+"Anch";f.href="#";f.innerHTML=
"Enable All";f.dataset.action=c;d.appendChild(f);a=virtualclass.vutil.capitalizeFirstLetter(a);document.getElementById("virtualclass"+a+"Body").appendChild(d);f.addEventListener("click",function(){var d=document.getElementById(b+"Anch");null!=d&&(c=d.dataset.action,"enable"==d.dataset.action?(d.dataset.action="disable",d.innerHTML="Disable All"):(d.dataset.action="enable",d.innerHTML="Enable All"));virtualclass.user.control.toggleAllEditorController.call(virtualclass.user,a,c)})}},createEditorClient:function(a,
b){virtualclass.isPlayMode&&this.readOnlyMode("enable","notCreateSyncBox");null!=localStorage.getItem("orginalTeacherId")&&(this.cm.setOption("readOnly",!1),this.createAllEditorController(),a.readOnly=!1);Vceditor.fromCodeMirror({},this.cm,a,b)},codemirrorWithLayout:function(a){this.UI.container(this.etype);document.getElementById(this.UI.edId);"object"!=typeof this.cm&&(this.cm=CodeMirror(document.getElementById(this.UI.edId),a))},requestData:function(a,b){for(var c="",d=0;d<virtualclass.connectedUsers.length;d++)if(virtualclass.gObj.uid!=
virtualclass.connectedUsers[d].userid)if("t"==virtualclass.connectedUsers[d].role)if("undefined"!=typeof b){if(!this.hasOwnProperty("toAlreadyRequestUser")||this.toAlreadyRequestUser!=virtualclass.connectedUsers[d].userid){c=virtualclass.connectedUsers[d].userid;this.toAlreadyRequestUser=virtualclass.connectedUsers[d].userid;this.dataReqTry++;break}}else{c=virtualclass.connectedUsers[d].userid;break}else{c=virtualclass.connectedUsers[d].userid;break}""!=c&&"undefined"!=typeof c&&null!=io.sock&&(1==
io.sock.readyState&&io.send({eddata:"requestForEditorData",et:this.etype},c),this.readOnlyMode("enable"))},readOnlyMode:function(a,b){"object"==typeof this.cm&&("enable"==a?this.readonly||(this.cm.setOption("readOnly",!0),"undefined"==typeof b&&this.UI.createSynchMessageBox(),this.readonly=!0):this.readonly&&!virtualclass.isPlayMode&&(this.cm.setOption("readOnly",!1),this.readonly=!1,this.UI.hideSynchMessageBox()))},receivedOperations:{currAppEditor:function(a){a.fromUser.userid!=virtualclass.gObj.userid&&
(console.log("curr app editor"),virtualclass.currAppEditor=!0,virtualclass.currAppEditorType=a.message.et,virtualclass.dispvirtualclassLayout(virtualclass.currAppEditorType))},init:function(a,b){a.fromUser.userid==virtualclass.gObj.uid&&"1"!=wbUser.virtualclassPlay||virtualclass.makeAppReady(b)},initVcEditor:function(a){if("t"!=virtualclass.gObj.uRole||"t"==virtualclass.gObj.uRole&&a.message.hasOwnProperty("resFromUser")&&a.fromUser.userid!=virtualclass.gObj.uid){var b=JSON.parse(a.message.data);
a.message.hasOwnProperty("layoutEd")?this.initialiseDataWithEditor(b,"displayEditor",a.message.et):this.initialiseDataWithEditor(b)}},requestForEditorData:function(a){a.fromUser.userid!=virtualclass.gObj.uid&&("object"!=typeof this.vcAdapter||0==this.vcAdapter.operations.length?io.send({eddata:"noDataForEditor"}):this.reponseToRequest({toUser:a.fromUser.userid}))},noDataForEditor:function(){},"virtualclass-editor-operation":function(a){"object"==typeof this.vcAdapter&&(this.readOnlyMode("disable"),
this.vcAdapter.receivedMessage(a))},"virtualclass-editor-cursor":function(a){"object"==typeof this.vcAdapter&&this.vcAdapter.receivedMessage(a)},select:function(){"object"==typeof this.vcAdapter&&this.vcAdapter.receivedMessage(e)}},onmessage:function(a,b){this.receivedOperations[a.message.eddata].call(this,a,b);"object"!=typeof this.vcAdapter&&("t"==virtualclass.gObj.uRole&&"virtualclass-editor-operation"==a.message.eddata&&(virtualclass.makeAppReady(b),this.vcAdapter.receivedMessage(a,onmessage)),
console.log("virtualclass adapter is not ready for editor"))},UI:{id:d,"class":"vmApp virtualclass",edId:g,container:function(a){if(null==document.getElementById(this.id)){var b=document.createElement("div");b.id=this.id;b.className=this["class"]+" "+a;a=document.createElement("div");a.id=this.edId;b.appendChild(a);a=document.getElementById(virtualclass.rWidgetConfig.id);document.getElementById(virtualclass.html.id).insertBefore(b,a)}},createSynchMessageBox:function(){if(null!=document.getElementById("synchMessageBox"))this.showSynchMessageBox();
else{var a=document.createElement("div");a.id="synchMessageBox";a.style.width="340px";a.style.height="15px";var b=document.createElement("p");b.id="readOnlyMsg";b.innerHTML="Please wait a while.  Synchronizing with new content.";a.appendChild(b);b=document.getElementById(this.id);b.insertBefore(a,b.firstChild)}},showSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");null!=a&&(a.style.display="block")},hideSynchMessageBox:function(){var a=document.getElementById("synchMessageBox");
null!=a&&(a.style.display="none")}},reponseToRequest:function(a){var b=this.getWrappedOperations();if("undefined"!=typeof a){if(a.hasOwnProperty("editorRich")||a.hasOwnProperty("editorCode")||this.isEidtorWithTeacher())b.layoutEd="1",b.cet=virtualclass.currApp,b.et=this.etype;a.hasOwnProperty("toUser")&&(b.resFromUser=!0);io.send(b,a.toUser)}else io.send(b)},isEidtorWithTeacher:function(){return"t"==virtualclass.gObj.uRole&&("EditorRich"==virtualclass.currApp||"EditorCode"==virtualclass.currApp)},
getWrappedOperations:function(){var a=this.vcAdapter&&this.vcAdapter.operations?b(this.vcAdapter.operations):[];return{eddata:"initVcEditor",data:JSON.stringify({revision:this.cmClient.revision,clients:[],str:this.cm.getValue(),operations:a}),et:this.etype}},removeCodeMirror:function(){this.readonly=!1;var a=document.getElementById(this.UI.id);null!=a&&a.parentNode.removeChild(a);this.cm=""},initialiseDataWithEditor:function(a,b,d){"undefined"!=typeof b&&(virtualclass.currAppEditor?virtualclass.currAppEditorType==
d&&(virtualclass.currApp=virtualclass.vutil.capitalizeFirstLetter(d)):virtualclass.currApp=virtualclass.vutil.capitalizeFirstLetter(d));this.removeCodeMirror();this.codemirrorWithLayout(m);virtualclass.dispvirtualclassLayout(virtualclass.currApp);this.cm&&this.cm.getValue()!==a.str&&(document.getElementById(this.UI.edId),console.log("new string set"),this.vcAdapter=this.cmClient="",a.operations=c(a.operations),a.doc=a.str,this.createEditorClient(h,a),this.prvEdRev=a.revision);for(b=0;b<a.operations.length;b++)this.vcAdapter.trigger("operation",
a.operations[b].wrapped.toJSON());this.cm.refresh();a=JSON.parse(localStorage.getItem(this.etype));null==localStorage.getItem("orginalTeacherId")&&(null!=a?a?(this.cm.setOption("readOnly",!1),a=!0):(this.cm.setOption("readOnly",!0),a=!1):(this.cm.setOption("readOnly",!0),a=!1),virtualclass.user.control.toggleDisplayWriteModeMsgBox(virtualclass.vutil.capitalizeFirstLetter(this.etype),a));a=virtualclass.vutil.capitalizeFirstLetter(virtualclass.currApp);if("EditorRich"==a||"EditorCode"==a)virtualclass.previous=
"virtualclass"+virtualclass.currApp,virtualclass.system.setAppDimension(virtualclass.currApp);a=document.getElementById("virtualclassEditorTool");null!=a&&(a.style.pointerEvents="visible")},removeEditorData:function(){"object"==typeof this.cm&&("object"==typeof this.vcAdapter&&(this.vcAdapter.operations.length=0),this.cm.setValue(""),localStorage.removeItem(this.etype+"_allEditorOperations"),localStorage.removeItem(this.etype+"_edOperationRev"))},saveIntoLocalStorage:function(){if("object"==typeof this.vcAdapter&&
0<this.vcAdapter.operations.length){var a=this.getWrappedOperations();localStorage.removeItem(this.etype+"_allEditorOperations");localStorage.setItem(this.etype+"_allEditorOperations",JSON.stringify(a));localStorage.setItem(this.etype+"_edOperationRev",this.cmClient.revision)}}}}})(window);(function(d,b){d.Chat=function(){return{init:function(){this.chatroombox=null;this.counter=0;this.idList=[];b.htab=[];b.htabIndex=[];this.vmstorage={};b("body").footerbar();"false"==localStorage.getItem("init")&&(b("#stickybar").removeClass("maximize").addClass("minimize"),b("#hide_bar input").removeClass("close").addClass("expand"));tabs=b("#tabs").tabs({cache:!0,activeOnAdd:!0});!1==browserSupportsLocalStorage()?alert(lang.sterror):(this.history(),this.UI.privateChatBox.init(),b("ul.tabs").on("click, focus",
"li",function(){b("li[aria-controls='"+b(this).attr("id")+"']").removeClass("ui-state-highlight")}))},history:function(){var b=null;null!=localStorage.getItem(wbUser.sid)&&(displayPvtChatHistory(),b=localStorage.getItem("chatEnable"),null!=b&&"false"==b&&virtualclass.user.control.disbaleAllChatBox(),this.vmstorage=JSON.parse(localStorage.getItem(wbUser.sid)));0<sessionStorage.length&&(displaycomChatHistory(),null!=b&&"false"==b&&virtualclass.user.control.disableCommonChat())},UI:{privateChatBox:{init:function(){b("#tabs").delegate("span.ui-icon-close",
"click",this.close);b("#tabs").on("click","li a",this.toggle)},close:function(){var c=b(this).closest("li").attr("id").substring(5);b("#"+c).chatbox("option").boxClosed(c);b("div#cb"+c+".ui-widget").hide();var a=b(this).closest("li").remove().attr("aria-controls");b("#"+a).remove();delete virtualclass.chat.vmstorage[c]},toggle:function(){var c=b(this).closest("li").attr("id").substring(5);b("#"+c).chatbox("toggleContentbox");"hidden"==localStorage.getItem(c)?localStorage.removeItem(c):localStorage.setItem(c,
"hidden")}}},removedPrvLoggedInDetail:function(){b(".ui-memblist").remove();b(".ui-chatbox").remove();b("div#chatrm").remove();virtualclass.chat.chatroombox=null;for(key in io.uniquesids)key!=io.cfg.userid&&(chatboxManager.delBox(key),b("li#tabcb"+key).remove());this.idList=0;b("#stickybar").removeClass("maximize").addClass("minimize");tabs.tabs("refresh")},removeCookieUserInfo:function(b){document.cookie="auth_user=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";document.cookie="auth_pass=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";
document.cookie="path=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";display_error(b.message)},makeUserListEmpty:function(){b("#user_list .inner_bt #usertab_icon").css({background:"url("+d.whiteboardPath+"images/offline.png)no-repeat top left"});b("#user_list .inner_bt #usertab_text").html("<span id='onlineusertext'>"+lang.whos+" (0) </span> <span id='usertab_toogle_icon' class='icon-arrow-up'></span>");b("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" (0)");b("div#memlist").css("display",
"none")}}}})(window,$);(function(d){d.widget("ui.footerbar",{options:{id:null,offset:0,width:"100%",barscroll:d(window).width()-430,boxClosed:function(b){}},init:function(b){this.elem=b},widget:function(){return this.uiFooterbar},_create:function(){var b=(this.uiFooterbar=d("<div></div>")).appendTo(document.getElementById("stickycontainer")).prop("id","stickybar").addClass("maximize"),c=(this.uiFooterbarchatroomtab=d("<div></div>")).addClass("vmchat_room_bt tooltip").attr("data-title",virtualclass.lang.getString("maxCommonChat")).prop("id",
"chatroom_bt2").appendTo(b),a=(this.uiFooterbarchatroomContent=d('<div class = "inner_bt"></div>')).appendTo(c);uiFooterbarchatroomIcon=(this.uiFooterbarchatroomIcon=d('<div id = "chatroom_icon"><span class="icon-chatroom"></span></div>')).appendTo(a);uiFooterbarchatroomText=(this.uiFooterbarchatroomText=d('<div id = "chatroom_text"></div>')).appendTo(a).html('Chatroom <span id="cc_arrow_button" class="icon-arrow-up"></span>').click(function(){if(virtualclass.chat.chatroombox){"hidden"==sessionStorage.getItem("chatroom_status")?
(sessionStorage.removeItem("chatroom_status"),c.attr("data-title",virtualclass.lang.getString("minCommonChat"))):(sessionStorage.setItem("chatroom_status","hidden"),c.attr("data-title",virtualclass.lang.getString("maxCommonChat")));var a=document.getElementById("cc_arrow_button");null!=a&&(virtualclass.vutil.elemHasAnyClass("cc_arrow_button")?a.classList.contains("icon-arrow-up")?(a.classList.add("icon-arrow-down"),a.classList.remove("icon-arrow-up")):(a.classList.add("icon-arrow-up"),a.classList.remove("icon-arrow-down")):
a.className="icon-arrow-up");virtualclass.chat.chatroombox.chatroom("option","boxManager").toggleBox()}else 0==d("div#chat_room").length&&(a=document.createElement("div"),a.id="chat_room",document.body.appendChild(a),virtualclass.chat.chatroombox=d("#chat_room").chatroom({id:"chat_room",user:{name:"test"},title:lang.chatroom_header,offset:"20px",messageSent:function(a,b){d("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}),virtualclass.gObj.hasOwnProperty("chatEnable")&&!virtualclass.gObj.chatEnable&&
(a=document.getElementById("chatrm"),null!=a&&virtualclass.user.control.makeElemDisable(a)),a=document.getElementById("cc_arrow_button"),a.classList.add("icon-arrow-down"),a.classList.remove("icon-arrow-up"))});uiFooterbarUserlisttab=(this.uiFooterbarUserlisttab=d("<div></div>")).addClass("vmchat_bar_button").prop("id","user_list").appendTo(b);uiFooterbarUserlistContent=(this.uiFooterbarUserlistContent=d('<div class="inner_bt"></div>')).appendTo(uiFooterbarUserlisttab);uiFooterbarUserlistIcon=(this.uiFooterbarUserlistIcon=
d('<div id="usertab_icon"></div>')).appendTo(uiFooterbarUserlistContent);uiFooterbarUserlistText=(this.uiFooterbarUserlistText=d('<div id="usertab_text" class="tooltip close " data-title="'+virtualclass.lang.getString("maxUserList")+'"></div>')).appendTo(uiFooterbarUserlistContent).text("Private Chat").click(function(){virtualclass.gObj.video.dispAllVideo("chat_div");0<Object.keys(io.uniquesids).length&&(d(this).hasClass("close")?(d(this).addClass("open"),d(this).removeClass("close"),d("#usertab_toogle_icon").addClass("icon-arrow-down"),
d("#usertab_toogle_icon").removeClass("close icon-arrow-up"),d(this).attr("data-title",virtualclass.lang.getString("miniUserList"))):(d(this).addClass("close"),d(this).removeClass("open"),d("#usertab_toogle_icon").addClass("icon-arrow-up"),d("#usertab_toogle_icon").removeClass("icon-arrow-down"),d(this).attr("data-title",virtualclass.lang.getString("maxUserList"))),d("#chat_div").memberlist("option","boxManager").toggleBox())});uiFooterbartabCont=(this.uiFooterbartabCont=d("<div></div>")).attr("id",
"tabs").addClass("tabs-bottom").appendTo(b);uiFooterbartabs=(this.uiFooterbartabs=d('<ul class="tabs"></ul>')).appendTo(uiFooterbartabCont);this._setWidth(this.options.width);this.init(this)},destroy:function(){this.element.remove();this._destroy()},_setWidth:function(b){this.uiFooterbar.width(b+"px")}})})(jQuery);
(function(d){d.fn.clickToggle=function(b,c){var a=[b,c];this.data("toggleclicked",0);this.click(function(){var b=d(this).data(),c=b.toggleclicked;d.proxy(a[c],this)();b.toggleclicked=(c+1)%2});return this}})(jQuery);(function(d){d.widget("ui.memberlist",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,userSent:function(b){this.boxManager.addUsr(b.name)},boxClosed:function(b){},boxManager:{init:function(b){this.elem=b},addUsr:function(b){var c=this.elem.uiChatboxLog,a=document.getElementById("ml"+b.userid);null!=a&&a.parentNode.removeChild(a);a=document.createElement("div");a.className+="userImg";c.append(a);if(b){c=document.createElement("a");c.href="#"+b.userid;c.classList.add("tooltip");
c.setAttribute("data-title","Click to chat");var f=document.createElement("img");f.src=b.img;c.appendChild(f);f=document.createElement("span");void 0==b.lname&&(b.lname="");d(f).text(b.name+" "+b.lname);c.appendChild(f);a.appendChild(c);c=["assign","audio","chat","editorRich","editorCode"];b.userid!=wbUser.id&&(c=virtualclass.user.createControl(b.userid,c),a.appendChild(c),virtualclass.user.control.shouldApply.call(virtualclass.user,b.userid));null!=localStorage.getItem("teacherId")&&null==localStorage.getItem("orginalTeacherId")&&
b.userid==localStorage.getItem("aId")&&(c=["assign"],f=document.getElementById(b.userid+"ControlContainer"),null!=f?virtualclass.user.createAssignControl(f,b.userid,!0):(f=document.getElementById("ml"+b.userid),c=virtualclass.user.createControl(b.userid,c),f.appendChild(c)))}d(a).addClass("ui-memblist-usr");d(a).attr("id","ml"+b.userid);d(a).fadeIn();this._scrollToBottom();a=localStorage.getItem("chatEnable");null!=a&&"false"==a&&virtualclass.user.control.disableOnLineUser();virtualclass.gObj.uid==
b.userid&&(b=document.getElementById("ml"+virtualclass.gObj.uid),null!=b&&b.classList.add("mySelf"))},highlightBox:function(){var b=this;b.elem.uiChatboxTitlebar.effect("highlight",{},300);b.elem.uiChatbox.effect("bounce",{times:3},300,function(){b.highlightLock=!1;b._scrollToBottom()})},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var b=this.elem.uiChatboxLog;b.scrollTop(b.get(0).scrollHeight)}}},toggleContent:function(b){this.uiChatboxContent.toggle();
this.uiChatboxContent.is(":visible")},widget:function(){return this.uiChatbox},_create:function(){var b=this,c=b.options.title||"No Title",a=(b.uiChatbox=d("<div></div>")).appendTo(document.getElementById("chatWidget")).addClass("ui-widget ui-corner-top ui-memblist").attr("id","memlist").css("display","none").focusin(function(){b.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){b.uiChatboxTitlebar.removeClass("ui-state-focus")}),f=(b.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-memblist-titlebar ui-dialog-header").click(function(a){}).appendTo(a);
(b.uiChatboxTitle=d("<span></span>")).html('<span class="icon-user"> </span>'+c).appendTo(f);var g=(b.uiChatboxTitlebarClose=d('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")});uiChatboxTitlebarMinimize=(b.uiChatboxTitlebarMinimize=d('<a href="#"></a>')).addClass("ui-corner-all ui-memblist-icon").attr("role","button").hover(function(){uiChatboxTitlebarMinimize.addClass("ui-state-hover")},
function(){uiChatboxTitlebarMinimize.removeClass("ui-state-hover")}).click(function(a){d("#chat_div").memberlist("option","boxManager").toggleBox();return!1}).appendTo(f);uiChatboxTitlebarMinimizeText=d("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(uiChatboxTitlebarMinimize);uiChatboxContent=(b.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-memblist-content ").appendTo(a);uiChatboxLog=(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-memblist-log").appendTo(uiChatboxContent).focusin(function(){var a=
d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)});f.find("*").add(f).disableSelection();d(document).on("click","#chat_div .ui-memblist-usr a",function(a){a=d(this);var b=a.attr("href");"undefined"!=typeof b&&(b=b.replace("#",""),a=a.find("span").html(),-1==d.inArray(b,virtualclass.chat.idList)&&(virtualclass.chat.counter++,virtualclass.chat.idList.push(b),virtualclass.chat.vmstorage[b]=[],virtualclass.chat.vmstorage[b].push({userid:b,name:a})),chatboxManager.addBox(b,{dest:"dest"+virtualclass.chat.counter,
title:"box"+virtualclass.chat.counter,first_name:a}),chatboxManager.init({user:{name:a},messageSent:function(a,b,c){d("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}}),a=b=null)});b._setWidth(b.options.width);b._position(b.options.offset);b.options.boxManager.init(b)},_setOption:function(b,c){if(null!=c)switch(b){case "hidden":c?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(c);break;case "width":this._setWidth(c)}d.Widget.prototype._setOption.apply(this,arguments)},
_setWidth:function(b){this.uiChatboxTitlebar.width(b+"px");this.uiChatboxLog.width(b+"px")},_position:function(b){this.uiChatbox.css("right",b)}})})(jQuery);(function(d){d.widget("ui.chatbox",{options:{id:null,title:null,user:null,hidden:!1,offset:0,width:230,messageSent:function(b,c,a){this.boxManager.addMsg(c.name,a)},boxClosed:function(b){},boxManager:{init:function(b){this.elem=b},addMsg:function(b,c){var a=this.elem.uiChatboxLog,f=document.createElement("div");a.append(f);a=!1;if(b){var g=document.createElement("b");d(g).text(b+": ");f.appendChild(g)}else a=!0;a=document.createElement(a?"i":"span");d(a).text(c);f.appendChild(a);d(f).addClass("ui-chatbox-msg");
d(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){},toggleBox:function(){this.elem.uiChatbox.toggle()},_scrollToBottom:function(){var b=this.elem.uiChatboxLog;b.scrollTop(b.get(0).scrollHeight)}}},toggleContent:function(b){},toggleContentbox:function(b){this.uiChatboxContent.is(":visible")?(this.uiChatboxInputBox.focus(),d(d('#tabs ul li[id = "tabcb'+this.options.id+
'"]')).removeClass("ui-state-active")):d(d('#tabs ul li[id="tabcb'+this.options.id+'"]')).addClass("ui-state-active");this.uiChatbox.toggle("slide",{direction:"down"},1E3)},widget:function(){return this.uiChatbox},_create:function(){createTab(this.options.id,this.options.title);var b=this,c=b.options.title||"No Title",a=(b.uiChatbox=d("<div></div>")).appendTo(document.body).addClass("ui-widget ui-corner-top ui-chatbox").attr("id","cb"+b.options.id).focusin(function(){b.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){b.uiChatboxTitlebar.removeClass("ui-state-focus")}),
f=(b.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatbox-titlebar ui-dialog-header").click(function(a){}).appendTo(a);(b.uiChatboxTitle=d("<span></span>")).html(c).appendTo(f);var g=(b.uiChatboxTitlebarClose=d('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon ").attr("role","button").hover(function(){g.addClass("ui-state-hover")},function(){g.removeClass("ui-state-hover")}).click(function(c){a.hide();b.options.boxClosed(b.options.id);d("#tabcb"+b.options.id).remove();
delete virtualclass.chat.vmstorage[b.options.id];localStorage.removeItem(b.options.id);return!1}).appendTo(f);d("<span></span>").addClass("ui-icon ui-icon-closethick").text("close").appendTo(g);var m=(b.uiChatboxTitlebarMinimize=d('<a href = "#"></a>')).addClass("ui-corner-all ui-chatbox-icon").attr("role","button").hover(function(){m.addClass("ui-state-hover")},function(){m.removeClass("ui-state-hover")}).click(function(a){b.toggleContentbox(a);"hidden"==localStorage.getItem(b.options.id)?localStorage.removeItem(b.options.id):
localStorage.setItem(b.options.id,"hidden");return!1}).appendTo(f);d("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(m);c=(b.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(a);(b.uiChatboxLog=b.element).addClass("ui-widget-content ui-chatbox-log").appendTo(c);var h=(b.uiChatboxInput=d("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(c),n=(b.uiChatboxInputBox=d("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id",
"ta"+b.options.id).appendTo(h).keypress(function(a){if(a.keyCode&&a.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());if(0<msg.length){io.send(msg,b.options.id);d(this).val("");d("#"+b.options.id).chatbox("option").messageSent(b.options.id,{name:io.cfg.userobj.name},msg);a=b.options.id;"undefined"==typeof virtualclass.chat.vmstorage[a]&&(virtualclass.chat.vmstorage[a]=[]);var c=(new Date).getTime();virtualclass.chat.vmstorage[a].push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:c})}return!1}}).focusin(function(){n.addClass("ui-chatbox-input-focus");
var a=d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){n.removeClass("ui-chatbox-input-focus")});f.find("*").add(f).disableSelection();c.children().click(function(){b.uiChatboxInputBox.focus()});b._setWidth(b.options.width);b._position(b.options.offset);b.options.boxManager.init(b);b.options.hidden||a.show();d(d('#tabs ul li[id = "tabcb'+b.options.id+'"]')).append(a)},_setOption:function(b,c){if(null!=c)switch(b){case "hidden":c?this.uiChatbox.hide():this.uiChatbox.show();
break;case "offset":this._position(c);break;case "width":this._setWidth(c)}d.Widget.prototype._setOption.apply(this,arguments)},_setWidth:function(b){this.uiChatbox.width(b+"px");this.uiChatboxInputBox.css("width",b-14+"px")},_position:function(b){}})})(jQuery);(function(d){d.widget("ui.chatroom",{options:{id:null,title:null,user:null,hidden:!1,offset:20,width:230,messageSent:function(b,c){this.boxManager.addMsg(b.name,c)},boxClosed:function(b){},boxManager:{init:function(b){this.elem=b},addMsg:function(b,c){var a=this.elem.uiChatboxLog,f=document.createElement("div");a.append(f);a=!1;if(b){var g=document.createElement("b");d(g).text(b+": ");f.appendChild(g)}else a=!0;a=document.createElement(a?"i":"span");d(a).text(c);f.appendChild(a);d(f).addClass("ui-chatbox-msg");
d(f).fadeIn();this._scrollToBottom();this.elem.uiChatboxTitlebar.hasClass("ui-state-focus")||this.highlightLock||(this.highlightLock=!0,this.highlightBox())},highlightBox:function(){this.elem.uiChatboxTitlebar.addClass("ui-state-highlight");this.highlightLock=!1;this._scrollToBottom()},toggleBox:function(){this.elem.uiChatbox.toggle("slide",{direction:"down"},1E3)},_scrollToBottom:function(){var b=this.elem.uiChatboxLog;b.scrollTop(b.get(0).scrollHeight)}}},toggleContent:function(b){this.uiChatboxContent.toggle();
this.uiChatboxContent.is(":visible")&&this.uiChatboxInputBox.focus()},widget:function(){return this.uiChatbox},_create:function(){var b=null!=localStorage.getItem("chatEnable")?"true"==localStorage.chatEnable?"enable":"disable":"enable",c=this,a=c.options,f=a.title||"No Title",b=(c.uiChatbox=d("<div></div>")).appendTo(document.getElementById("chatWidget")).addClass("ui-widget ui-corner-top ui-chatroom "+b).prop("id","chatrm").focusin(function(){c.uiChatboxTitlebar.removeClass("ui-state-highlight");
c.uiChatboxTitlebar.addClass("ui-state-focus")}).focusout(function(){c.uiChatboxTitlebar.removeClass("ui-state-focus")}),g=(c.uiChatboxTitlebar=d("<div></div>")).addClass("ui-widget-header ui-corner-top ui-chatroom-titlebar ui-dialog-header").click(function(a){c.uiChatboxTitlebar.removeClass("ui-state-highlight")}).appendTo(b);(c.uiChatboxTitle=d("<span></span>")).html(f).appendTo(g);var m=(c.uiChatboxTitlebarMinimize=d('<a href="#"></a>')).addClass("ui-corner-all ui-chatbox-icon").prop("role","button").hover(function(){m.addClass("ui-state-hover")},
function(){m.removeClass("ui-state-hover")}).focus(function(){m.addClass("ui-state-focus")}).blur(function(){m.removeClass("ui-state-focus")}).click(function(b){a.boxManager.toggleBox();sessionStorage.setItem("chatroom_status","hidden");return!1}).appendTo(g);d("<span></span>").addClass("ui-icon ui-icon-minusthick").text("minimize").appendTo(m);f=(c.uiChatboxContent=d("<div></div>")).addClass("ui-widget-content ui-chatbox-content ").appendTo(b);(c.uiChatboxLog=c.element).addClass("ui-widget-content ui-chatbox-log").appendTo(f);
var h=(c.uiChatboxInput=d("<div></div>")).addClass("ui-widget-content ui-chatbox-input").click(function(a){}).appendTo(f),n=(c.uiChatboxInputBox=d("<textarea></textarea>")).addClass("ui-widget-content ui-chatbox-input-box ui-corner-all").prop("id","ta_chrm").appendTo(h).keydown(function(a){if(a.keyCode&&a.keyCode==d.ui.keyCode.ENTER){msg=d.trim(d(this).val());a={receiver:"chatroom",msg:msg};if(0<msg.length)if(io.send(a),d(this).val(""),c.options.messageSent({name:io.cfg.userobj.name},msg),a=(new Date).getTime(),
null!=sessionStorage.getItem("chatroom")){var b=JSON.parse(sessionStorage.getItem("chatroom"));b.push({userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a});sessionStorage.setItem("chatroom",JSON.stringify(b))}else sessionStorage.setItem("chatroom",JSON.stringify([{userid:io.cfg.userid,name:io.cfg.userobj.name,msg:msg,time:a}]));return!1}}).focusin(function(){n.addClass("ui-chatbox-input-focus");var a=d(this).parent().prev();a.scrollTop(a.get(0).scrollHeight)}).focusout(function(){n.removeClass("ui-chatbox-input-focus")});
g.find("*").add(g).disableSelection();f.children().click(function(){c.uiChatboxInputBox.focus()});c._setWidth(c.options.width);c._position(c.options.offset);c.options.boxManager.init(c);c.options.hidden||(b.show(),virtualclass.vutil.isPlayMode()&&disCommonChatInput())},_setOption:function(b,c){if(null!=c)switch(b){case "hidden":c?this.uiChatbox.hide():this.uiChatbox.show();break;case "offset":this._position(c);break;case "width":this._setWidth(c)}d.Widget.prototype._setOption.apply(this,arguments)},
_setWidth:function(b){this.uiChatbox.width(b+"px");this.uiChatboxInputBox.css("width",b-14+"px")},_position:function(b){this.uiChatbox.css("left",b)}})})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(d){for(var b=0;b<this.length;b++)if(this[b]==d)return b;return-1});
var chatboxManager=function(){var d=[],b=[],c={width:230,gap:20,maxBoxes:5,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b,c)}},a=function(a){var f=b.indexOf(a);if(-1!=f)for(b.splice(f,1),d.splice(f,1),diff=c.width+c.gap,a=f;a<b.length;a++)offset=$("#"+b[a]).chatbox("option","offset"),$("#"+b[a]).chatbox("option","offset",offset-diff);else alert("should not happen: "+a)},f=function(a,b,f){d.indexOf(b.userid);c.messageSent(a,b,f)};return{init:function(a){$.extend(c,a)},
addBox:function(g,m,h){h=b.indexOf(g);var n=d.indexOf(g);-1==h&&(-1!=n?($("#"+g).chatbox("option","offset",285+(c.width+c.gap)*b.length),$("#"+g).chatbox("option","boxManager").toggleBox(),b.push(g),m=-1,m=$("#tabs li").index($("#tabcb"+g)),$($(".tabs li")[m]).css("display","list-item"),$("#tabs").tabs("option","active",m),$("#tabs").tabs("show")):(void 0==m.last_name&&(m.last_name=""),h=document.createElement("div"),h.setAttribute("id",g),$(h).chatbox({id:g,user:m,title:m.first_name+" "+m.last_name,
hidden:!1,width:c.width,offset:285+(c.width+c.gap)*b.length,messageSent:f,boxClosed:a}),d.push(g),b.push(g)))},delBox:function(a){b=$.grep(b,function(b){return a!=b});d=$.grep(d,function(b){return a!=b})},dispatch:function(a,b){$("#"+a.userid).chatbox("option","boxManager").addMsg(a.name,b)}}}();function memberUpdate(d,b){var c=d.message,a="undefined"===typeof whiteboardPath?"../images/online.png":window.whiteboardPath+"images/online.png";if(0<c.length){var f=c.length-1;virtualclass.gObj.totalUser=[];for(var g=0;g<c.length;g++)virtualclass.gObj.totalUser.push(c[g].id);virtualclass.gObj.totalUser.sort();$("#user_list .inner_bt #usertab_icon").css({background:"url("+a+")no-repeat top left"})}$("#user_list .inner_bt #usertab_text").html("<span id='onlineusertext'>"+lang.whos+" ( "+f+" )</span> <span id='usertab_toogle_icon' class='icon-arrow-up'></span>");
$("#chatroom_bt .inner_bt #chatroom_text").text(lang.chatroom+" ("+f+")");0<c.length?(document.getElementById("chat_div")||(a=document.createElement("div"),a.id="chat_div",document.body.appendChild(a)),$("#chat_div").memberlist({id:"chat_div",user:c,offset:"7px",title:lang.online,userSent:function(a){$("#chat_div").memberlist("option","boxManager").addUsr(a)}}),$("#chat_div .ui-memblist-usr:not(.mySelf)").remove(),$.each(c,function(a,c){null==document.getElementById("video"+c.userid)&&$("#chat_div").memberlist("option").userSent(c);
if(c.userid==io.cfg.userid&&"undefined"!=typeof b&&"removed"!=b){var d=document.getElementById("video"+c.userid);virtualclass.gObj.hasOwnProperty("audIntDisable")||virtualclass.gObj.hasOwnProperty("vidIntDisable")||null!=d||virtualclass.gObj.video._handleUserMedia(c.userid)}virtualclass.gObj.video.addUserRole(c.userid,c.role)})):$("div#memlist").length&&$("div#memlist").remove()}
function messageUpdate2(d){var b=$.isPlainObject(d.message)?d.message.msg:d.message,c=d.toUser,a=d.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==d.message.receiver&&(""==c||void 0==c))f==a.userid||virtualclass.chat.chatroombox||0!=$("div#chat_room").length||(d=document.createElement("div"),d.id="chat_room",document.body.appendChild(d),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:a,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option",
"boxManager").addMsg(a.name,b)}})),$("#chat_room").chatroom("option").messageSent(a,b),null!=sessionStorage.getItem("chatroom")?(d=JSON.parse(sessionStorage.getItem("chatroom")),d.push({userid:a.userid,name:a.name,msg:b,time:g}),sessionStorage.setItem("chatroom",JSON.stringify(d))):sessionStorage.setItem("chatroom",JSON.stringify([{userid:a.userid,name:a.name,msg:b,time:g}]));else if(void 0!=c&&""!=c){if(f==c.userid&&a.userid!=f){-1==$.inArray(a.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,
virtualclass.chat.idList.push(a.userid),virtualclass.chat.vmstorage[a.userid]=[],virtualclass.chat.vmstorage[a.userid].push({userid:a.userid,name:a.name+" "+a.lname}));chatboxManager.addBox(a.userid,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:a.name,last_name:a.lname});chatboxManager.init({user:a,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});d=localStorage.getItem("chatEnable");null!=d&&"false"==d&&virtualclass.user.control.allChatDisable();
$("#"+a.userid).chatbox("option").messageSent(a.userid,a,b);$("li[aria-controls='tabcb"+a.userid+"']").addClass("ui-state-highlight");var m=a.userid}virtualclass.chat.vmstorage[m].push({userid:a.userid,name:a.name,msg:b,time:g})}}
function messageUpdate(d){var b=$.isPlainObject(d.message)?d.message.msg:d.message,c=d.toUser,a=d.fromUser,f=io.cfg.userid,g=(new Date).getTime();if("chatroom"==d.message.receiver&&(""==c||void 0==c))virtualclass.chat.chatroombox||0!=$("div#chat_room").length||(d=document.createElement("div"),d.id="chat_room",document.body.appendChild(d),virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:a,title:lang.chatroom_header,messageSent:function(a,b){$("#chat_room").chatroom("option",
"boxManager").addMsg(a.name,b)}})),$("#chat_room").chatroom("option").messageSent(a,b),null!=sessionStorage.getItem("chatroom")?(d=JSON.parse(sessionStorage.getItem("chatroom")),d.push({userid:a.userid,name:a.name,msg:b,time:g}),sessionStorage.setItem("chatroom",JSON.stringify(d))):sessionStorage.setItem("chatroom",JSON.stringify([{userid:a.userid,name:a.name,msg:b,time:g}]));else if(void 0!=c&&""!=c){if(f==c.userid&&a.userid!=f){-1==$.inArray(a.userid,virtualclass.chat.idList)&&(virtualclass.chat.counter++,
virtualclass.chat.idList.push(a.userid),virtualclass.chat.vmstorage[a.userid]=[],virtualclass.chat.vmstorage[a.userid].push({userid:a.userid,name:a.name+" "+a.lname}));chatboxManager.addBox(a.userid,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:a.name,last_name:a.lname});chatboxManager.init({user:a,messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}});d=localStorage.getItem("chatEnable");null!=d&&"false"==d&&virtualclass.user.control.allChatDisable();
$("#"+a.userid).chatbox("option").messageSent(a.userid,a,b);$("li[aria-controls='tabcb"+a.userid+"']").addClass("ui-state-highlight");var m=a.userid}virtualclass.chat.vmstorage[m].push({userid:a.userid,name:a.name,msg:b,time:g})}}function statusUpdate(d,b,c){$("#"+d.userid).length&&($("#"+d.userid).chatbox("option").messageSent(d.userid,d,b),$("#ta"+d.userid).prop("disabled",c))}function common_chatbox_update(d,b){$("div#chat_room").length&&$("#chat_room").chatroom("option").messageSent(d,b)}
function newStatus(d){$.each(d.message,function(b,c){null!=d.newuser&&c.userid==d.newuser&&(statusUpdate(c,"Online",!1),common_chatbox_update(c,"Online"))})}function createTab(d,b){var c=$("#tabs").tabs(),a=$("div#tabs ul li").length;tabId="tabcb"+d;addTab(c,tabId,a,b)}
function addTab(d,b,c,a){var f=$("#tab_content");c=a||"Tab "+c;b=$(("<li id = '"+b+"' class = 'ui-state-default ui-corner-bottom ui-tabs-active ui-state-active' aria-controls = '"+b+"'><a href = '#{href}' class = 'ui-tabs-anchor'>#{label}</a> <a href = '#' role = 'button'class = 'ui-corner-all ui-chatbox-icon'><span class = 'ui-icon ui-icon-close'>close</span></a></li>").replace(/#\{href\}/g,"#"+b).replace(/#\{label\}/g,c));f.val();d.find(".ui-tabs-nav").append(b)}
function browserSupportsLocalStorage(){return"localStorage"in window&&null!=window.localStorage}
function displaycomChatHistory(){if(1<sessionStorage.length||1==sessionStorage.length&&null==sessionStorage.getItem("chatroom_status")){var d=document.createElement("div");d.id="chat_room";document.body.appendChild(d);d=JSON.parse(sessionStorage.getItem("chatroom"));$.each(d,function(b,c){1>b&&(virtualclass.chat.chatroombox=$("#chat_room").chatroom({id:"chat_room",user:c,title:"Common chat",messageSent:function(a,b){$("#chat_room").chatroom("option","boxManager").addMsg(a.name,b)}}));$("#chat_room").chatroom("option").messageSent(c,
c.msg)})}"hidden"==sessionStorage.getItem("chatroom_status")&&$("#chatrm").hide()}
function displayPvtChatHistory(){if(null!=localStorage.getItem(wbUser.sid)){var d=JSON.parse(localStorage.getItem(wbUser.sid));$.each(d,function(b,c){virtualclass.chat.counter++;virtualclass.chat.idList.push(b);$.each(c,function(a,c){1>a?(chatboxManager.addBox(b,{dest:"dest"+virtualclass.chat.counter,title:"box"+virtualclass.chat.counter,first_name:c.name}),chatboxManager.init({messageSent:function(a,b,c){$("#"+a).chatbox("option","boxManager").addMsg(b.name,c)}})):$("#"+b).chatbox("option").messageSent(b,
c,c.msg)});"hidden"==localStorage.getItem(b)&&($("#cb"+b).hide(),$("#tabcb"+b).removeClass("ui-state-active"))})}}function display_error(d){$("<div id = 'dialog' title = 'VmChat Error:'></div>").prependTo("#stickybar");$("#dialog").html(d);$("#dialog").dialog()}function clearAllChatBox(){$(".ui-icon-closethick").trigger("click")}function disCommonChatInput(){var d=document.getElementById("ta_chrm");null!=d&&(d.disabled=!0)};var lang={online:"Online Users",whos:"Who's online",chatroom:"Chatroom",chatroom_header:"Common Chat",error:"Something bad happend. Sorry!",wserror:"Browser does not support WebSocket",sterror:"This browser doesn't support Web Storage standard"};
